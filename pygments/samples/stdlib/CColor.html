<LINK href="styles.css" rel="stylesheet" type="text/css">

New Lexer: 
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">	Function:	CColor</span>
<span class="cm">				Set text and background color for some Gui controls. </span>
<span class="cm">				Supported types: Edit, Text, ListBox, ComboBox, DropDownList, CheckBox, RadioButton, ListView, TreeView, RichEdit</span>
<span class="cm">   </span>
<span class="cm">	Parameters:   </span>
<span class="cm">		Hwnd		-  Handle of the control.</span>
<span class="cm">		Background  -  Background color. HTML color name or 6-digit RGB value. Optional.</span>
<span class="cm">		Foreground  -  Foreground color. HTML color name or 6-digit RGB value. Optional.</span>
<span class="cm">	  </span>
<span class="cm">	Remarks:</span>
<span class="cm">		You need to redraw the window for changes to take effect. For some controls, it may be needed to explicitelly specify </span>
<span class="cm">		foreground color (&quot;cRed&quot;) when creating control, otherwise text will stay black.</span>

<span class="cm">		On tha first call for a specific control class the function registers itself as message handler for WM_CTLCOLOR</span>
<span class="cm">		message of appropriate class.</span>

<span class="cm">		Buttons are always drawn with the default system colors. Drawing buttons requires several different brushes-face, highlight and shadow </span>
<span class="cm">		but the WM_CTLCOLORBTN message allows only one brush to be returned. To provide a custom appearance for push buttons, use an owner-drawn button.</span>

<span class="cm">	About:</span>
<span class="cm">		o Version 1.0 by majkinetor.</span>
<span class="cm">		o Original code by (de)nick, See: &lt;http://www.autohotkey.com/forum/topic39055.html&gt;.</span>
<span class="cm">		o Licensed under BSD &lt;http://creativecommons.org/licenses/BSD/&gt;.</span>
<span class="cm"> */</span>
<span class="n">CColor</span><span class="p">(</span><span class="n">Hwnd</span><span class="p">,</span> <span class="n">Background</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Foreground</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nf"></span>
<span class="nf">	return</span> <span class="n">CColor_</span><span class="p">(</span><span class="n">Background</span><span class="p">,</span> <span class="n">Foreground</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Hwnd</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">CColor_</span><span class="p">(</span><span class="n">Wp</span><span class="p">,</span> <span class="n">Lp</span><span class="p">,</span> <span class="n">Msg</span><span class="p">,</span> <span class="n">Hwnd</span><span class="p">)</span> <span class="p">{</span><span class="nf"> </span>
<span class="nf">	static </span>
<span class="nf">	static</span> <span class="n">WM_CTLCOLOREDIT</span><span class="o">=</span><span class="mh">0x0133</span><span class="p">,</span> <span class="n">WM_CTLCOLORLISTBOX</span><span class="o">=</span><span class="mh">0x134</span><span class="p">,</span> <span class="n">WM_CTLCOLORSTATIC</span><span class="o">=</span><span class="mh">0x0138</span>
		  <span class="p">,</span><span class="n">LVM_SETBKCOLOR</span><span class="o">=</span><span class="mh">0x1001</span><span class="p">,</span> <span class="n">LVM_SETTEXTCOLOR</span><span class="o">=</span><span class="mh">0x1024</span><span class="p">,</span> <span class="n">LVM_SETTEXTBKCOLOR</span><span class="o">=</span><span class="mh">0x1026</span><span class="p">,</span> <span class="n">TVM_SETTEXTCOLOR</span><span class="o">=</span><span class="mh">0x111E</span><span class="p">,</span> <span class="n">TVM_SETBKCOLOR</span><span class="o">=</span><span class="mh">0x111D</span>
		  <span class="p">,</span><span class="n">BS_CHECKBOX</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">BS_RADIOBUTTON</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ES_READONLY</span><span class="o">=</span><span class="mh">0x800</span>
		  <span class="p">,</span><span class="n">CLR_NONE</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">CSILVER</span><span class="o">=</span><span class="mh">0xC0C0C0</span><span class="p">,</span> <span class="n">CGRAY</span><span class="o">=</span><span class="mh">0x808080</span><span class="p">,</span> <span class="n">CWHITE</span><span class="o">=</span><span class="mh">0xFFFFFF</span><span class="p">,</span> <span class="n">CMAROON</span><span class="o">=</span><span class="mh">0x80</span><span class="p">,</span> <span class="n">CRED</span><span class="o">=</span><span class="mh">0x0FF</span><span class="p">,</span> <span class="n">CPURPLE</span><span class="o">=</span><span class="mh">0x800080</span><span class="p">,</span> <span class="n">CFUCHSIA</span><span class="o">=</span><span class="mh">0xFF00FF</span><span class="p">,</span> <span class="n">CGREEN</span><span class="o">=</span><span class="mh">0x8000</span><span class="p">,</span> <span class="n">CLIME</span><span class="o">=</span><span class="mh">0xFF00</span><span class="p">,</span> <span class="n">COLIVE</span><span class="o">=</span><span class="mh">0x8080</span><span class="p">,</span> <span class="n">CYELLOW</span><span class="o">=</span><span class="mh">0xFFFF</span><span class="p">,</span> <span class="n">CNAVY</span><span class="o">=</span><span class="mh">0x800000</span><span class="p">,</span> <span class="n">CBLUE</span><span class="o">=</span><span class="mh">0xFF0000</span><span class="p">,</span> <span class="n">CTEAL</span><span class="o">=</span><span class="mh">0x808000</span><span class="p">,</span> <span class="n">CAQUA</span><span class="o">=</span><span class="mh">0xFFFF00</span>
 		  <span class="p">,</span><span class="n">CLASSES</span> <span class="o">:=</span> <span class="s">&quot;Button,ComboBox,Edit,ListBox,Static,RICHEDIT50W,SysListView32,SysTreeView32&quot;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="n">If</span><span class="p"> (</span><span class="n">Msg</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span><span class="w">      </span>
<span class="w">		</span><span class="n">if</span><span class="p"> </span><span class="o">!</span><span class="n">adrSetTextColor</span>
<span class="w">			</span><span class="n">adrSetTextColor</span><span class="p">	</span><span class="o">:=</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetProcAddress&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;Gdi32.dll&quot;</span><span class="p">),</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;SetTextColor&quot;</span><span class="p">)</span>
		   <span class="p">,</span><span class="n">adrSetBkColor</span>	<span class="o">:=</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetProcAddress&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;Gdi32.dll&quot;</span><span class="p">),</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;SetBkColor&quot;</span><span class="p">)</span>
		   <span class="p">,</span><span class="n">adrSetBkMode</span>	<span class="o">:=</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetProcAddress&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;Gdi32.dll&quot;</span><span class="p">),</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;SetBkMode&quot;</span><span class="p">)</span><span class="c-Singleline"></span>
<span class="c-Singleline">	</span>
<span class="c-Singleline">      ;Set the colors (RGB -&gt; BGR)</span>
<span class="w">		</span><span class="n">BG</span><span class="p"> </span><span class="o">:=</span> <span class="o">!</span><span class="n">Wp</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="n">C</span><span class="nv">%Wp%</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span> <span class="o">?</span> <span class="n">C</span><span class="nv">%Wp%</span> <span class="o">:</span> <span class="s">&quot;0x&quot;</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">WP</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">WP</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">WP</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span>
<span class="w">		</span><span class="n">FG</span><span class="p"> </span><span class="o">:=</span> <span class="o">!</span><span class="n">Lp</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="n">C</span><span class="nv">%Lp%</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span> <span class="o">?</span> <span class="n">C</span><span class="nv">%Lp%</span> <span class="o">:</span> <span class="s">&quot;0x&quot;</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">LP</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">LP</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">LP</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="c-Singleline"></span>

<span class="c-Singleline">	  ;Activate message handling with OnMessage() on the first call for a class </span>
<span class="w">		</span><span class="nb">WinGetClass</span><span class="p">,</span><span class="s"> class</span><span class="p">,</span><span class="s"> ahk_id %Hwnd% </span><span class="w"></span>
<span class="w">		</span><span class="nf">	If </span><span class="n">class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nv">%CLASSES%</span><span class="nf"> </span>
<span class="nf">			return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt; Unsupported control class: &quot;</span> <span class="n">class</span><span class="w"></span>

<span class="w">		</span><span class="nb">ControlGet</span><span class="p">,</span><span class="s"> style</span><span class="p">,</span><span class="s"> Style</span><span class="p">,</span><span class="s"> </span><span class="p">,</span><span class="s"> </span><span class="p">,</span><span class="s"> ahk_id %Hwnd% </span><span class="w"></span>
<span class="w">		</span>	<span class="n">if</span> <span class="p">(</span><span class="n">class</span> <span class="o">=</span> <span class="s">&quot;Edit&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">Style</span> <span class="o">&amp;</span> <span class="n">ES_READONLY</span><span class="p">)</span><span class="w"> </span>
<span class="w">			</span><span class="n">class</span><span class="p"> </span><span class="o">:=</span> <span class="s">&quot;Static&quot;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">		</span><span class="n">if</span><span class="p"> (</span><span class="n">class</span> <span class="o">=</span> <span class="s">&quot;Button&quot;</span><span class="p">)</span>
<span class="w">			</span><span class="n">if</span><span class="p"> (</span><span class="n">style</span> <span class="o">&amp;</span> <span class="n">BS_RADIOBUTTON</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">style</span> <span class="o">&amp;</span> <span class="n">BS_CHECKBOX</span><span class="p">)</span><span class="w"> </span>
<span class="w">				 </span><span class="n">class</span><span class="p"> </span><span class="o">:=</span> <span class="s">&quot;Static&quot;</span><span class="w"> </span>
<span class="w">			</span><span class="nb">else</span><span class="w"> </span><span class="s">return A_ThisFunc &quot;&gt; Unsupported control class: &quot; class</span><span class="w"></span>
<span class="w">		</span>
<span class="w">		</span>	<span class="n">if</span> <span class="p">(</span><span class="n">class</span> <span class="o">=</span> <span class="s">&quot;ComboBox&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nf"> </span>
<span class="nf">			VarSetCapacity</span><span class="p">(</span><span class="n">CBBINFO</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="nf"> NumPut</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="n">CBBINFO</span><span class="p">),</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetComboBoxInfo&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="n">Hwnd</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CBBINFO</span><span class="p">)</span><span class="w"> </span>
<span class="w">			</span><span class="n">hwnd</span><span class="p"> </span><span class="o">:=</span><span class="nf"> NumGet</span><span class="p">(</span><span class="n">CBBINFO</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span><span class="c-Singleline">		;hwndList</span>
			<span class="nv">%hwnd%</span><span class="n">BG</span> <span class="o">:=</span> <span class="n">BG</span><span class="p">,</span> <span class="nv">%hwnd%</span><span class="n">FG</span> <span class="o">:=</span> <span class="n">FG</span><span class="p">,</span> <span class="nv">%hwnd%</span> <span class="o">:=</span> <span class="n">BG</span> <span class="o">?</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;CreateSolidBrush&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="n">BG</span><span class="p">)</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="nf"></span>

<span class="nf">			IfEqual</span><span class="p">,</span> <span class="n">CTLCOLORLISTBOX</span><span class="p">,,</span><span class="n">SetEnv</span><span class="p">,</span> <span class="n">CTLCOLORLISTBOX</span><span class="p">,</span> <span class="o">%</span><span class="nf"> OnMessage</span><span class="p">(</span><span class="n">WM_CTLCOLORLISTBOX</span><span class="p">,</span> <span class="nv">A_ThisFunc</span><span class="p">)</span><span class="nf"> </span>

<span class="nf">			If NumGet</span><span class="p">(</span><span class="n">CBBINFO</span><span class="p">,</span><span class="mi">44</span><span class="p">)</span><span class="c-Singleline">	;hwndEdit</span>
<span class="w">				</span><span class="n">Hwnd</span><span class="p"> </span><span class="o">:=</span><span class="nf">  Numget</span><span class="p">(</span><span class="n">CBBINFO</span><span class="p">,</span><span class="mi">44</span><span class="p">),</span> <span class="n">class</span> <span class="o">:=</span> <span class="s">&quot;Edit&quot;</span>
		<span class="p">}</span><span class="nf"> </span>

<span class="nf">		if </span><span class="n">class</span> <span class="ow">in</span> <span class="n">SysListView32</span><span class="p">,</span><span class="n">SysTreeView32</span>
		<span class="p">{</span>
<span class="w">			</span><span class="n">m</span><span class="p"> </span><span class="o">:=</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;SysListView32&quot;</span> <span class="o">?</span> <span class="s">&quot;LVM&quot;</span> <span class="o">:</span> <span class="s">&quot;TVM&quot;</span><span class="w"> </span>
<span class="w">			</span><span class="nb">SendMessage</span><span class="p">,</span><span class="s"> %m%_SETBKCOLOR</span><span class="p">,</span><span class="s"> </span><span class="p">,</span><span class="s">BG</span><span class="p">,</span><span class="s"> </span><span class="p">,</span><span class="s">ahk_id %Hwnd%</span><span class="w"></span>
<span class="w">			</span>	<span class="n">SendMessage</span><span class="p">,</span> <span class="nv">%m%</span><span class="n">_SETTEXTCOLOR</span><span class="p">,</span> <span class="p">,</span><span class="n">FG</span><span class="p">,</span> <span class="p">,</span><span class="n">ahk_id</span> <span class="nv">%Hwnd%</span>
<span class="w">			</span><span class="nb">SendMessage</span><span class="p">,</span><span class="s"> %m%_SETTEXTBKCOLOR</span><span class="p">,</span><span class="s"> </span><span class="p">,</span><span class="s">CLR_NONE</span><span class="p">,</span><span class="s"> </span><span class="p">,</span><span class="s">ahk_id %Hwnd%</span><span class="w"></span>
<span class="w">			</span><span class="nf">	return</span>
		<span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">if</span><span class="p"> (</span><span class="n">class</span> <span class="o">=</span> <span class="s">&quot;RICHEDIT50W&quot;</span><span class="p">)</span><span class="nf"></span>
<span class="nf">			return</span> <span class="n">f</span> <span class="o">:=</span> <span class="s">&quot;RichEdit_SetBgColor&quot;</span><span class="p">,</span> <span class="nv">%f%</span><span class="p">(</span><span class="n">Hwnd</span><span class="p">,</span> <span class="o">-</span><span class="n">BG</span><span class="p">)</span><span class="w"></span>

<span class="w">		</span><span class="n">if</span><span class="p"> (</span><span class="o">!</span><span class="n">CTLCOLOR</span><span class="nv">%Class%</span><span class="p">)</span>
			<span class="n">CTLCOLOR</span><span class="nv">%Class%</span> <span class="o">:=</span><span class="nf"> OnMessage</span><span class="p">(</span><span class="n">WM_CTLCOLOR</span><span class="nv">%Class%</span><span class="p">,</span> <span class="nv">A_ThisFunc</span><span class="p">)</span><span class="nf"> </span>

<span class="nf">		return</span> <span class="nv">%Hwnd%</span> <span class="o">:=</span> <span class="n">BG</span> <span class="o">?</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;CreateSolidBrush&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="n">BG</span><span class="p">)</span> <span class="o">:</span> <span class="n">CLR_NONE</span><span class="p">,</span>  <span class="nv">%Hwnd%</span><span class="n">BG</span> <span class="o">:=</span> <span class="n">BG</span><span class="p">,</span>  <span class="nv">%Hwnd%</span><span class="n">FG</span> <span class="o">:=</span> <span class="n">FG</span>
   <span class="p">}</span><span class="c-Singleline"> </span>
<span class="c-Singleline"> </span>
<span class="c-Singleline"> ; Message handler </span>
<span class="w">	</span><span class="nb">critical</span><span class="c-Singleline">					;its OK, always in new thread.</span><span class="w"></span>

<span class="w">		</span><span class="n">Hwnd</span><span class="p"> </span><span class="o">:=</span> <span class="n">Lp</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hDC</span> <span class="o">:=</span> <span class="n">Wp</span> <span class="o">+</span> <span class="mi">0</span>
<span class="w">	</span><span class="n">If</span><span class="p"> (</span><span class="nv">%Hwnd%</span><span class="p">)</span> <span class="p">{</span><span class="nf"> </span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="n">adrSetBkMode</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">		</span><span class="n">if</span><span class="p"> (</span><span class="nv">%Hwnd%</span><span class="n">FG</span><span class="p">)</span><span class="nf"></span>
<span class="nf">			DllCall</span><span class="p">(</span><span class="n">adrSetTextColor</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="nv">%Hwnd%</span><span class="n">FG</span><span class="p">)</span>
<span class="w">		</span><span class="n">if</span><span class="p"> (</span><span class="nv">%Hwnd%</span><span class="n">BG</span><span class="p">)</span><span class="nf"></span>
<span class="nf">			DllCall</span><span class="p">(</span><span class="n">adrSetBkColor</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="nv">%Hwnd%</span><span class="n">BG</span><span class="p">)</span><span class="nf"></span>
<span class="nf">		return</span> <span class="p">(</span><span class="nv">%Hwnd%</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
