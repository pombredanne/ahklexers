<LINK href="styles.css" rel="stylesheet" type="text/css">old lexer: 
<div class="highlight"><pre><span class="nf">Affinity_Set</span><span class="p">(</span><span class="w"> </span>CPU<span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>PID<span class="o">=</span><span class="mh">0x0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">; CPU0=1 CPU1=2 | to use both, CPU should be 3</span>
<span class="w">  </span><span class="k">Process</span><span class="p">,</span><span class="w"> </span>Exist<span class="p">,</span><span class="w"> </span><span class="nv">%PID%</span>
<span class="w">  </span>IfEqual<span class="p">,</span>ErrorLevel<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w">  </span><span class="k">SetEnv</span><span class="p">,</span>PID<span class="p">,</span><span class="o">%</span><span class="w"> </span>DllCall<span class="p">(</span><span class="w"> </span><span class="s">&quot;GetCurrentProcessId&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span>hPr<span class="w"> </span><span class="o">:=</span><span class="w"> </span>DllCall<span class="p">(</span><span class="w"> </span><span class="s">&quot;OpenProcess&quot;</span><span class="p">,</span>Int<span class="p">,</span><span class="mi">1536</span><span class="p">,</span>Int<span class="p">,</span><span class="mi">0</span><span class="p">,</span>Int<span class="p">,</span>PID<span class="w"> </span><span class="p">)</span><span class="w">  </span>
<span class="w">  </span><span class="nf">DllCall</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;GetProcessAffinityMask&quot;</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span>hPr<span class="p">,</span><span class="w"> </span>IntP<span class="p">,</span>PAM<span class="p">,</span><span class="w"> </span>IntP<span class="p">,</span>SAM<span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="nf">If</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>CPU<span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>CPU<span class="o">&lt;=</span>SAM<span class="w"> </span><span class="p">)</span>
<span class="w">     </span>Res<span class="w"> </span><span class="o">:=</span><span class="w"> </span>DllCall<span class="p">(</span><span class="w"> </span><span class="s">&quot;SetProcessAffinityMask&quot;</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span>hPr<span class="p">,</span><span class="w"> </span>Int<span class="p">,</span>CPU<span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="nf">DllCall</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span>hPr<span class="w"> </span><span class="p">)</span>
<span class="nf">Return</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>Res<span class="o">=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>Res
<span class="p">}</span>

<span class="o">/*</span>
MSDN<span class="w"> </span>Links<span class="o">:</span>

SetProcessAffinityMask<span class="w"> </span><span class="o">:</span><span class="w"> </span>http<span class="o">://</span>msdn<span class="p">.</span>microsoft<span class="p">.</span>com<span class="o">/</span>en<span class="o">-</span>us<span class="o">/</span>library<span class="o">/</span>ms686223<span class="p">(</span>VS<span class="mf">.85</span><span class="p">).</span>aspx<span class="w"> </span>
GetProcessAffinityMask<span class="w"> </span><span class="o">:</span><span class="w"> </span>http<span class="o">://</span>msdn<span class="p">.</span>microsoft<span class="p">.</span>com<span class="o">/</span>en<span class="o">-</span>us<span class="o">/</span>library<span class="o">/</span>ms683213<span class="p">(</span>VS<span class="mf">.85</span><span class="p">).</span>aspx

MSDN<span class="w"> </span>DOC<span class="w"> </span>Follows<span class="w"> </span><span class="o">:</span>

<span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>
SetProcessAffinityMask<span class="w"> </span>Function
Sets<span class="w"> </span>a<span class="w"> </span>processor<span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>threads<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span><span class="k">process</span><span class="p">.</span>
<span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">--</span>

Syntax
BOOL<span class="w"> </span>WINAPI<span class="w"> </span><span class="nf">SetProcessAffinityMask</span><span class="p">(</span>
<span class="w">  </span>__in<span class="w">  </span>HANDLE<span class="w"> </span>hProcess<span class="p">,</span>
<span class="w">  </span>__in<span class="w">  </span>DWORD_PTR<span class="w"> </span>dwProcessAffinityMask
<span class="p">);</span>

Parameters<span class="w"> </span><span class="o">:</span>

hProcess<span class="w"> </span><span class="k">[in]</span><span class="err"> : A handle to the process whose affinity mask is to be set. This handle must</span>
<span class="w">                </span>have<span class="w"> </span>the<span class="w"> </span>PROCESS_SET_INFORMATION<span class="w"> </span>access<span class="w"> </span>right<span class="p">.</span><span class="w"> </span>For<span class="w"> </span>more<span class="w"> </span>information<span class="p">,</span><span class="w"> </span>
<span class="w">                </span>see<span class="w"> </span><span class="k">Process</span><span class="w"> </span>Security<span class="w"> </span><span class="kr">and</span><span class="w"> </span>Access<span class="w"> </span>Rights<span class="p">.</span>

dwProcessAffinityMask<span class="w"> </span><span class="k">[in]</span><span class="err"> </span>
<span class="w">                </span>The<span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>threads<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="k">process</span><span class="p">.</span>

<span class="k">Return</span><span class="w"> </span>Value<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>the<span class="w"> </span>function<span class="w"> </span>succeeds<span class="p">,</span><span class="w"> </span>the<span class="w"> </span>return<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>nonzero<span class="p">.</span><span class="w">  </span>
<span class="w">                </span><span class="kr">If</span><span class="w"> </span>the<span class="w"> </span>function<span class="w"> </span>fails<span class="p">,</span><span class="w"> </span>the<span class="w"> </span><span class="k">return</span><span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>zero<span class="p">.</span><span class="w"> </span>To<span class="w"> </span>get<span class="w"> </span>extended<span class="w"> </span>error<span class="w"> </span>
<span class="w">                </span>information<span class="p">,</span><span class="w"> </span>call<span class="w"> </span>GetLastError<span class="p">.</span>

Remarks<span class="w">       </span><span class="o">:</span><span class="w"> </span>A<span class="w"> </span>process<span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>bit<span class="w"> </span>vector<span class="w"> </span>in<span class="w"> </span>which<span class="w"> </span>each<span class="w"> </span>bit<span class="w"> </span>represents<span class="w"> </span>the<span class="w"> </span>
<span class="w">                </span>processor<span class="w"> </span>on<span class="w"> </span>which<span class="w"> </span>the<span class="w"> </span>threads<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="k">process</span><span class="w"> </span>are<span class="w"> </span>allowed<span class="w"> </span>to<span class="w"> </span><span class="k">run</span><span class="p">.</span>

<span class="w">                </span>The<span class="w"> </span>value<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="k">process</span><span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>a<span class="w"> </span>subset<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>system<span class="w"> </span>
<span class="w">                </span>affinity<span class="w"> </span>mask<span class="w"> </span>values<span class="w"> </span>obtained<span class="w"> </span>by<span class="w"> </span>the<span class="w"> </span>GetProcessAffinityMask<span class="w"> </span>function<span class="p">.</span>

<span class="w">                </span>Do<span class="w"> </span>not<span class="w"> </span>call<span class="w"> </span>SetProcessAffinityMask<span class="w"> </span>in<span class="w"> </span>a<span class="w"> </span>DLL<span class="w"> </span>that<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>called<span class="w"> </span>by<span class="w"> </span>
<span class="w">                </span>processes<span class="w"> </span>other<span class="w"> </span>than<span class="w"> </span>your<span class="w"> </span>own<span class="p">.</span>

<span class="w">                </span><span class="k">Process</span><span class="w"> </span>affinity<span class="w"> </span>is<span class="w"> </span>inherited<span class="w"> </span>by<span class="w"> </span>any<span class="w"> </span>child<span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span>newly<span class="w"> </span>instantiated<span class="w"> </span>
<span class="w">                </span><span class="kt">local</span><span class="w"> </span><span class="k">process</span><span class="p">.</span>

Requirements<span class="w">  </span><span class="o">:</span><span class="w"> </span>Client<span class="w"> </span>Requires<span class="w"> </span>Windows<span class="w"> </span>Vista<span class="p">,</span><span class="w"> </span>Windows<span class="w"> </span>XP<span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span>Windows<span class="w"> </span><span class="mi">2000</span><span class="w"> </span>Professional<span class="p">.</span><span class="w"> </span>
<span class="w">                </span>Server<span class="w"> </span>Requires<span class="w"> </span>Windows<span class="w"> </span>Server<span class="w"> </span><span class="mi">2008</span><span class="p">,</span><span class="w"> </span>Windows<span class="w"> </span>Server<span class="w"> </span><span class="mi">2003</span><span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span>Windows<span class="w"> </span><span class="mi">2000</span><span class="w"> </span>
<span class="w">                </span>Server<span class="p">.</span><span class="w"> </span>

<span class="w">                </span>DLL<span class="w"> </span>Requires<span class="w"> </span>Kernel32<span class="p">.</span>dll<span class="p">.</span>
<span class="w"> </span>
<span class="w"> </span>
<span class="w"> </span>
<span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>
GetProcessAffinityMask<span class="w"> </span>Function
Retrieves<span class="w"> </span>the<span class="w"> </span><span class="k">process</span><span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span>the<span class="w"> </span>system<span class="w"> </span>affinity<span class="w"> </span>mask
for<span class="w"> </span>the<span class="w"> </span>system<span class="p">.</span>
<span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">--</span>

Syntax
BOOL<span class="w"> </span>WINAPI<span class="w"> </span><span class="nf">GetProcessAffinityMask</span><span class="p">(</span>
<span class="w">  </span>__in<span class="w">   </span>HANDLE<span class="w"> </span>hProcess<span class="p">,</span>
<span class="w">  </span>__out<span class="w">  </span>PDWORD_PTR<span class="w"> </span>lpProcessAffinityMask<span class="p">,</span>
<span class="w">  </span>__out<span class="w">  </span>PDWORD_PTR<span class="w"> </span>lpSystemAffinityMask
<span class="p">);</span>

Parameters

hProcess<span class="w"> </span><span class="k">[in]</span><span class="err"> : A handle to the process whose affinity mask is desired. </span>
<span class="w">                </span>This<span class="w"> </span>handle<span class="w"> </span>must<span class="w"> </span>have<span class="w"> </span>the<span class="w"> </span>PROCESS_QUERY_INFORMATION<span class="w"> </span><span class="kr">or</span><span class="w"> </span>
<span class="w">                </span>PROCESS_QUERY_LIMITED_INFORMATION<span class="w"> </span>access<span class="w"> </span>right<span class="p">.</span><span class="w"> </span>For<span class="w"> </span>more<span class="w"> </span>information<span class="p">,</span><span class="w"> </span>
<span class="w">                </span>see<span class="w"> </span><span class="k">Process</span><span class="w"> </span>Security<span class="w"> </span><span class="kr">and</span><span class="w"> </span>Access<span class="w"> </span>Rights<span class="p">.</span>

<span class="w">                </span>Windows<span class="w"> </span>Server<span class="w"> </span><span class="mi">2003</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span>Windows<span class="w"> </span>XP<span class="o">/</span><span class="mi">2000</span><span class="o">:</span><span class="w">  </span>The<span class="w"> </span>handle<span class="w"> </span>must<span class="w"> </span>have<span class="w"> </span>the<span class="w"> </span>
<span class="w">                </span>PROCESS_QUERY_INFORMATION<span class="w"> </span>access<span class="w"> </span>right<span class="p">.</span>

lpProcessAffinityMask<span class="w"> </span><span class="k">[out]</span><span class="err"> </span>

<span class="w">                </span>A<span class="w"> </span>pointer<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>variable<span class="w"> </span>that<span class="w"> </span>receives<span class="w"> </span>the<span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span>
<span class="w">                </span><span class="k">process</span><span class="p">.</span>

lpSystemAffinityMask<span class="w"> </span><span class="k">[out]</span><span class="err"> </span>
<span class="w">                </span>A<span class="w"> </span>pointer<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>variable<span class="w"> </span>that<span class="w"> </span>receives<span class="w"> </span>the<span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>system<span class="p">.</span>

<span class="k">Return</span><span class="w"> </span>Value<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>the<span class="w"> </span>function<span class="w"> </span>succeeds<span class="p">,</span><span class="w"> </span>the<span class="w"> </span>return<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>nonzero<span class="w"> </span><span class="kr">and</span><span class="w"> </span>the<span class="w"> </span>function<span class="w"> </span>sets
<span class="w">               </span>the<span class="w"> </span>variables<span class="w"> </span>pointed<span class="w"> </span>to<span class="w"> </span>by<span class="w"> </span>lpProcessAffinityMask<span class="w"> </span><span class="kr">and</span><span class="w"> </span>lpSystemAffinityMask<span class="w"> </span>
<span class="w">               </span>to<span class="w"> </span>the<span class="w"> </span>appropriate<span class="w"> </span>affinity<span class="w"> </span>masks<span class="p">.</span>

<span class="w">               </span><span class="kr">If</span><span class="w"> </span>the<span class="w"> </span>function<span class="w"> </span>fails<span class="p">,</span><span class="w"> </span>the<span class="w"> </span><span class="k">return</span><span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>zero<span class="p">,</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span>the<span class="w"> </span>values<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>
<span class="w">               </span>variables<span class="w"> </span>pointed<span class="w"> </span>to<span class="w"> </span>by<span class="w"> </span>lpProcessAffinityMask<span class="w"> </span><span class="kr">and</span><span class="w"> </span>lpSystemAffinityMask<span class="w"> </span>are<span class="w"> </span>
<span class="w">               </span>undefined<span class="p">.</span><span class="w"> </span>To<span class="w"> </span>get<span class="w"> </span>extended<span class="w"> </span>error<span class="w"> </span>information<span class="p">,</span><span class="w"> </span>call<span class="w"> </span>GetLastError<span class="p">.</span>

Remarks<span class="w">     </span><span class="o">:</span><span class="w">  </span>A<span class="w"> </span>process<span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>bit<span class="w"> </span>vector<span class="w"> </span>in<span class="w"> </span>which<span class="w"> </span>each<span class="w"> </span>bit<span class="w"> </span>represents<span class="w"> </span>the<span class="w"> </span>
<span class="w">               </span>processors<span class="w"> </span>that<span class="w"> </span>a<span class="w"> </span><span class="k">process</span><span class="w"> </span>is<span class="w"> </span>allowed<span class="w"> </span>to<span class="w"> </span><span class="k">run</span><span class="w"> </span>on<span class="p">.</span><span class="w"> </span>A<span class="w"> </span>system<span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>
<span class="w">               </span>bit<span class="w"> </span>vector<span class="w"> </span>in<span class="w"> </span>which<span class="w"> </span>each<span class="w"> </span>bit<span class="w"> </span>represents<span class="w"> </span>the<span class="w"> </span>processors<span class="w"> </span>that<span class="w"> </span>are<span class="w"> </span>configured<span class="w"> </span>
<span class="w">               </span>into<span class="w"> </span>a<span class="w"> </span>system<span class="p">.</span>

<span class="w">               </span>A<span class="w"> </span><span class="k">process</span><span class="w"> </span>affinity<span class="w"> </span>mask<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>subset<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>system<span class="w"> </span>affinity<span class="w"> </span>mask<span class="p">.</span><span class="w"> </span>A<span class="w"> </span><span class="k">process</span><span class="w"> </span>
<span class="w">               </span>is<span class="w"> </span>only<span class="w"> </span>allowed<span class="w"> </span>to<span class="w"> </span><span class="k">run</span><span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>processors<span class="w"> </span>configured<span class="w"> </span>into<span class="w"> </span>a<span class="w"> </span>system<span class="p">.</span>

Requirement<span class="w"> </span><span class="o">:</span><span class="w">  </span>Client<span class="w"> </span>Requires<span class="w"> </span>Windows<span class="w"> </span>Vista<span class="p">,</span><span class="w"> </span>Windows<span class="w"> </span>XP<span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span>Windows<span class="w"> </span><span class="mi">2000</span><span class="w"> </span>Professional<span class="p">.</span><span class="w"> </span>
<span class="w">              </span>Server<span class="w"> </span>Requires<span class="w"> </span>Windows<span class="w"> </span>Server<span class="w"> </span><span class="mi">2008</span><span class="p">,</span><span class="w"> </span>Windows<span class="w"> </span>Server<span class="w"> </span><span class="mi">2003</span><span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span>Windows<span class="w"> </span><span class="mi">2000</span><span class="w"> </span>
<span class="w">              </span>Server<span class="p">.</span>
<span class="w">               </span>
<span class="w">              </span>DLL<span class="w"> </span>Requires<span class="w"> </span>Kernel32<span class="p">.</span>dll<span class="p">.</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span>
</pre></div>


New Lexer: 
<div class="highlight"><pre><span class="n">Affinity_Set</span><span class="p">(</span> <span class="n">CPU</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">PID</span><span class="o">=</span><span class="mh">0x0</span> <span class="p">)</span> <span class="p">{</span><span class="c-Singleline"> ; CPU0=1 CPU1=2 | to use both, CPU should be 3</span>
<span class="w">  </span><span class="nb">Process</span><span class="p">,</span> <span class="n">Exist</span><span class="p">,</span> <span class="nv">%PID%</span>
<span class="w">  </span><span class="nb">IfEqual</span><span class="p">,</span><span class="nv">ErrorLevel</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>  <span class="n">SetEnv</span><span class="p">,</span><span class="n">PID</span><span class="p">,</span><span class="o">%</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;GetCurrentProcessId&quot;</span> <span class="p">)</span>
  <span class="n">hPr</span> <span class="o">:=</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;OpenProcess&quot;</span><span class="p">,</span><span class="n">Int</span><span class="p">,</span><span class="mi">1536</span><span class="p">,</span><span class="n">Int</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Int</span><span class="p">,</span><span class="n">PID</span> <span class="p">)</span>  
  <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;GetProcessAffinityMask&quot;</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="n">hPr</span><span class="p">,</span> <span class="n">IntP</span><span class="p">,</span><span class="n">PAM</span><span class="p">,</span> <span class="n">IntP</span><span class="p">,</span><span class="n">SAM</span> <span class="p">)</span>
  <span class="n">If</span> <span class="p">(</span> <span class="n">CPU</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">CPU</span><span class="o">&lt;=</span><span class="n">SAM</span> <span class="p">)</span>
     <span class="n">Res</span> <span class="o">:=</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;SetProcessAffinityMask&quot;</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="n">hPr</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="n">CPU</span> <span class="p">)</span>
  <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="n">hPr</span> <span class="p">)</span>
<span class="nb">Return</span> <span class="p">(</span> <span class="n">Res</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">Res</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">MSDN Links:</span>

<span class="cm">SetProcessAffinityMask : http://msdn.microsoft.com/en-us/library/ms686223(VS.85).aspx </span>
<span class="cm">GetProcessAffinityMask : http://msdn.microsoft.com/en-us/library/ms683213(VS.85).aspx</span>

<span class="cm">MSDN DOC Follows :</span>

<span class="cm">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -- </span>
<span class="cm">SetProcessAffinityMask Function</span>
<span class="cm">Sets a processor affinity mask for the threads of the specified process.</span>
<span class="cm">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --</span>

<span class="cm">Syntax</span>
<span class="cm">BOOL WINAPI SetProcessAffinityMask(</span>
<span class="cm">  __in  HANDLE hProcess,</span>
<span class="cm">  __in  DWORD_PTR dwProcessAffinityMask</span>
<span class="cm">);</span>

<span class="cm">Parameters :</span>

<span class="cm">hProcess [in] : A handle to the process whose affinity mask is to be set. This handle must</span>
<span class="cm">                have the PROCESS_SET_INFORMATION access right. For more information, </span>
<span class="cm">                see Process Security and Access Rights.</span>

<span class="cm">dwProcessAffinityMask [in] </span>
<span class="cm">                The affinity mask for the threads of the process.</span>

<span class="cm">Return Value  : If the function succeeds, the return value is nonzero.  </span>
<span class="cm">                If the function fails, the return value is zero. To get extended error </span>
<span class="cm">                information, call GetLastError.</span>

<span class="cm">Remarks       : A process affinity mask is a bit vector in which each bit represents the </span>
<span class="cm">                processor on which the threads of the process are allowed to run.</span>

<span class="cm">                The value of the process affinity mask must be a subset of the system </span>
<span class="cm">                affinity mask values obtained by the GetProcessAffinityMask function.</span>

<span class="cm">                Do not call SetProcessAffinityMask in a DLL that may be called by </span>
<span class="cm">                processes other than your own.</span>

<span class="cm">                Process affinity is inherited by any child process or newly instantiated </span>
<span class="cm">                local process.</span>

<span class="cm">Requirements  : Client Requires Windows Vista, Windows XP, or Windows 2000 Professional. </span>
<span class="cm">                Server Requires Windows Server 2008, Windows Server 2003, or Windows 2000 </span>
<span class="cm">                Server. </span>

<span class="cm">                DLL Requires Kernel32.dll.</span>
<span class="cm"> </span>
<span class="cm"> </span>
<span class="cm"> </span>
<span class="cm">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -- </span>
<span class="cm">GetProcessAffinityMask Function</span>
<span class="cm">Retrieves the process affinity mask for the specified process and the system affinity mask</span>
<span class="cm">for the system.</span>
<span class="cm">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --</span>

<span class="cm">Syntax</span>
<span class="cm">BOOL WINAPI GetProcessAffinityMask(</span>
<span class="cm">  __in   HANDLE hProcess,</span>
<span class="cm">  __out  PDWORD_PTR lpProcessAffinityMask,</span>
<span class="cm">  __out  PDWORD_PTR lpSystemAffinityMask</span>
<span class="cm">);</span>

<span class="cm">Parameters</span>

<span class="cm">hProcess [in] : A handle to the process whose affinity mask is desired. </span>
<span class="cm">                This handle must have the PROCESS_QUERY_INFORMATION or </span>
<span class="cm">                PROCESS_QUERY_LIMITED_INFORMATION access right. For more information, </span>
<span class="cm">                see Process Security and Access Rights.</span>

<span class="cm">                Windows Server 2003 and Windows XP/2000:  The handle must have the </span>
<span class="cm">                PROCESS_QUERY_INFORMATION access right.</span>

<span class="cm">lpProcessAffinityMask [out] </span>

<span class="cm">                A pointer to a variable that receives the affinity mask for the specified </span>
<span class="cm">                process.</span>

<span class="cm">lpSystemAffinityMask [out] </span>
<span class="cm">                A pointer to a variable that receives the affinity mask for the system.</span>

<span class="cm">Return Value : If the function succeeds, the return value is nonzero and the function sets</span>
<span class="cm">               the variables pointed to by lpProcessAffinityMask and lpSystemAffinityMask </span>
<span class="cm">               to the appropriate affinity masks.</span>

<span class="cm">               If the function fails, the return value is zero, and the values of the </span>
<span class="cm">               variables pointed to by lpProcessAffinityMask and lpSystemAffinityMask are </span>
<span class="cm">               undefined. To get extended error information, call GetLastError.</span>

<span class="cm">Remarks     :  A process affinity mask is a bit vector in which each bit represents the </span>
<span class="cm">               processors that a process is allowed to run on. A system affinity mask is a </span>
<span class="cm">               bit vector in which each bit represents the processors that are configured </span>
<span class="cm">               into a system.</span>

<span class="cm">               A process affinity mask is a subset of the system affinity mask. A process </span>
<span class="cm">               is only allowed to run on the processors configured into a system.</span>

<span class="cm">Requirement :  Client Requires Windows Vista, Windows XP, or Windows 2000 Professional. </span>
<span class="cm">              Server Requires Windows Server 2008, Windows Server 2003, or Windows 2000 </span>
<span class="cm">              Server.</span>
<span class="cm">               </span>
<span class="cm">              DLL Requires Kernel32.dll.</span>
<span class="cm"> - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
</pre></div>
