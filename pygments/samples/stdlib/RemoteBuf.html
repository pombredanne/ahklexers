<LINK href="styles.css" rel="stylesheet" type="text/css">old lexer: 
<div class="highlight"><pre><span class="c1">;	Title:	Remote Buffer</span>
<span class="c1">;			*Read and write process memory*</span>
<span class="c1">;</span>

<span class="o">/*-------------------------------------------------------------------------------</span>
<span class="w">	</span>Function<span class="o">:</span><span class="w"> </span>Open
<span class="w">			  </span>Open<span class="w"> </span>remote<span class="w"> </span>buffer

<span class="w">	</span><span class="nl">Parameters:</span>
<span class="w">			</span>H<span class="w">		</span><span class="o">-</span><span class="w"> </span>Reference<span class="w"> </span>to<span class="w"> </span>variable<span class="w"> </span>to<span class="w"> </span>receive<span class="w"> </span>remote<span class="w"> </span>buffer<span class="w"> </span>handle
<span class="w">			</span>hwnd<span class="w">    </span><span class="o">-</span><span class="w"> </span>HWND<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>window<span class="w"> </span>that<span class="w"> </span>belongs<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>process
<span class="w">			</span>size<span class="w">    </span><span class="o">-</span><span class="w"> </span>Size<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>buffer

<span class="w">	</span><span class="nl">Returns:</span>
<span class="w">			</span>Error<span class="w"> </span>message<span class="w"> </span>on<span class="w"> </span>failure
<span class="w"> </span><span class="o">*/</span>
<span class="nf">RemoteBuf_Open</span><span class="p">(</span>ByRef<span class="w"> </span>H<span class="p">,</span><span class="w"> </span>hwnd<span class="p">,</span><span class="w"> </span>size<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="kt">static</span><span class="w"> </span>MEM_COMMIT<span class="o">=</span><span class="mh">0x1000</span><span class="p">,</span><span class="w"> </span>PAGE_READWRITE<span class="o">=</span><span class="mi">4</span>

<span class="w">	</span><span class="k">WinGet</span><span class="p">,</span><span class="w"> </span>pid<span class="p">,</span><span class="w"> </span>PID<span class="p">,</span><span class="w"> </span>ahk_id<span class="w"> </span><span class="nv">%hwnd%</span>
<span class="w">	</span>hProc<span class="w">   </span><span class="o">:=</span><span class="w"> </span>DllCall<span class="p">(</span><span class="w"> </span><span class="s">&quot;OpenProcess&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>pid<span class="p">)</span><span class="w"> </span><span class="c1">;0x38 = PROCESS_VM_OPERATION | PROCESS_VM_READ | PROCESS_VM_WRITE</span>
<span class="w">	</span>IfEqual<span class="p">,</span><span class="w"> </span>hProc<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Unable to open process (&quot;</span><span class="w"> </span><span class="nb">A_LastError</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">      </span>
<span class="w">	</span>bufAdr<span class="w">  </span><span class="o">:=</span><span class="w"> </span>DllCall<span class="p">(</span><span class="w"> </span><span class="s">&quot;VirtualAllocEx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>hProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>size<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>MEM_COMMIT<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>PAGE_READWRITE<span class="p">)</span>
<span class="w">	</span>IfEqual<span class="p">,</span><span class="w"> </span>bufAdr<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Unable to allocate memory (&quot;</span><span class="w"> </span><span class="nb">A_LastError</span><span class="w"> </span><span class="s">&quot;)&quot;</span>

<span class="w">	</span><span class="c1">; Buffer handle structure:</span>
<span class="w">	 </span><span class="c1">;	@0: hProc</span>
<span class="w">	 </span><span class="c1">;	@4: size</span>
<span class="w">	 </span><span class="c1">;	@8: bufAdr</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>H<span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span><span class="w"> </span>hProc<span class="p">,</span><span class="w">	</span>H<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span><span class="w"> </span>size<span class="p">,</span><span class="w">	</span>H<span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span><span class="w"> </span>bufAdr<span class="p">,</span><span class="w"> </span>H<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="o">/*----------------------------------------------------</span>
<span class="w">	</span>Function<span class="o">:</span><span class="w"> </span>Close
<span class="w">			  </span>Close<span class="w"> </span>the<span class="w"> </span>remote<span class="w"> </span>buffer

<span class="w">	</span><span class="nl">Parameters:</span>
<span class="w">			  </span>H<span class="w"> </span><span class="o">-</span><span class="w"> </span>Remote<span class="w"> </span>buffer<span class="w"> </span>handle
<span class="w"> </span><span class="o">*/</span>
<span class="nf">RemoteBuf_Close</span><span class="p">(</span>ByRef<span class="w"> </span>H<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="kt">static</span><span class="w"> </span>MEM_RELEASE<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x8000</span>
<span class="w">	</span>
<span class="w">	</span>handle<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>H<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span>IfEqual<span class="p">,</span><span class="w"> </span>handle<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Invalid remote buffer handle&quot;</span>
<span class="w">	</span>adr<span class="w">    </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>H<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>

<span class="w">	</span>r<span class="w"> </span><span class="o">:=</span><span class="w"> </span>DllCall<span class="p">(</span><span class="w"> </span><span class="s">&quot;VirtualFreeEx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>handle<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>adr<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>MEM_RELEASE<span class="p">)</span>
<span class="w">	</span>ifEqual<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Unable to free memory (&quot;</span><span class="w"> </span><span class="nb">A_LastError</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>handle<span class="w"> </span><span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>H<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="p">}</span>

<span class="o">/*----------------------------------------------------</span>
<span class="w">	</span>Function<span class="o">:</span><span class="w">   </span>Read<span class="w"> </span>
<span class="w">				</span>Read<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>remote<span class="w"> </span>buffer<span class="w"> </span>into<span class="w"> </span><span class="kt">local</span><span class="w"> </span>buffer

<span class="w">	</span><span class="nl">Parameters:</span><span class="w"> </span>
<span class="w">         </span>H<span class="w">			</span><span class="o">-</span><span class="w"> </span>Remote<span class="w"> </span>buffer<span class="w"> </span>handle
<span class="w">         </span>pLocal<span class="w">		</span><span class="o">-</span><span class="w"> </span>Reference<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span><span class="kt">local</span><span class="w"> </span>buffer
<span class="w">         </span>pSize<span class="w">		</span><span class="o">-</span><span class="w"> </span>Size<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="kt">local</span><span class="w"> </span>buffer
<span class="w">         </span>pOffset<span class="w">	</span><span class="o">-</span><span class="w"> </span>Optional<span class="w"> </span>reading<span class="w"> </span>offset<span class="p">,</span><span class="w"> </span>by<span class="w"> </span>default<span class="w"> </span><span class="mi">0</span>

<span class="nl">Returns:</span>
<span class="w">         </span>TRUE<span class="w"> </span>on<span class="w"> </span>success<span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="k">FALSE</span><span class="w"> </span>on<span class="w"> </span>failure<span class="p">.</span><span class="w"> </span>ErrorMessage<span class="w"> </span>on<span class="w"> </span>bad<span class="w"> </span>remote<span class="w"> </span>buffer<span class="w"> </span>handle
<span class="w"> </span><span class="o">*/</span>
<span class="nf">RemoteBuf_Read</span><span class="p">(</span>ByRef<span class="w"> </span>H<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>pLocal<span class="p">,</span><span class="w"> </span>pSize<span class="p">,</span><span class="w"> </span>pOffset<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">	</span>handle<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span><span class="w"> </span>H<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w">   </span>size<span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span><span class="w"> </span>H<span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w">   </span>adr<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span><span class="w"> </span>H<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">	</span>IfEqual<span class="p">,</span><span class="w"> </span>handle<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Invalid remote buffer handle&quot;</span><span class="w">	</span>
<span class="w">	</span><span class="k">IfGreaterOrEqual</span><span class="p">,</span><span class="w"> </span>offset<span class="p">,</span><span class="w"> </span><span class="nv">%size%</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Offset is bigger then size&quot;</span>

<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="w"> </span>pLocal<span class="p">,</span><span class="w"> </span>pSize<span class="w"> </span><span class="p">)</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nf">DllCall</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>handle<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>adr<span class="w"> </span><span class="o">+</span><span class="w"> </span>pOffset<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>pLocal<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>size<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>pLocal<span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="o">/*----------------------------------------------------</span>
<span class="w">	</span>Function<span class="o">:</span><span class="w">   </span>Write<span class="w"> </span>
<span class="w">				</span>Write<span class="w"> </span><span class="kt">local</span><span class="w"> </span>buffer<span class="w"> </span>into<span class="w"> </span>remote<span class="w"> </span>buffer

<span class="w">	</span><span class="nl">Parameters:</span><span class="w"> </span>
<span class="w">         </span>H<span class="w">			</span><span class="o">-</span><span class="w"> </span>Remote<span class="w"> </span>buffer<span class="w"> </span>handle
<span class="w">         </span>pLocal<span class="w">		</span><span class="o">-</span><span class="w"> </span>Reference<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span><span class="kt">local</span><span class="w"> </span>buffer
<span class="w">         </span>pSize<span class="w">		</span><span class="o">-</span><span class="w"> </span>Size<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="kt">local</span><span class="w"> </span>buffer
<span class="w">         </span>pOffset<span class="w">	</span><span class="o">-</span><span class="w"> </span>Optional<span class="w"> </span>writting<span class="w"> </span>offset<span class="p">,</span><span class="w"> </span>by<span class="w"> </span>default<span class="w"> </span><span class="mi">0</span>

<span class="w">	</span><span class="nl">Returns:</span>
<span class="w">         </span>TRUE<span class="w"> </span>on<span class="w"> </span>success<span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="k">FALSE</span><span class="w"> </span>on<span class="w"> </span>failure<span class="p">.</span><span class="w"> </span>ErrorMessage<span class="w"> </span>on<span class="w"> </span>bad<span class="w"> </span>remote<span class="w"> </span>buffer<span class="w"> </span>handle
<span class="w"> </span><span class="o">*/</span>

<span class="nf">RemoteBuf_Write</span><span class="p">(</span>Byref<span class="w"> </span>H<span class="p">,</span><span class="w"> </span>byref<span class="w"> </span>pLocal<span class="p">,</span><span class="w"> </span>pSize<span class="p">,</span><span class="w"> </span>pOffset<span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span>handle<span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span><span class="w"> </span>H<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w">   </span>size<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span><span class="w"> </span>H<span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w">   </span>adr<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span><span class="w"> </span>H<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">	</span>IfEqual<span class="p">,</span><span class="w"> </span>handle<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Invalid remote buffer handle&quot;</span><span class="w">	</span>
<span class="w">	</span><span class="k">IfGreaterOrEqual</span><span class="p">,</span><span class="w"> </span>offset<span class="p">,</span><span class="w"> </span><span class="nv">%size%</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">A_ThisFunc</span><span class="w"> </span><span class="s">&quot;&gt;   Offset is bigger then size&quot;</span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nf">DllCall</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;WriteProcessMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>handle<span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>adr<span class="w"> </span><span class="o">+</span><span class="w"> </span>pOffset<span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>pLocal<span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>pSize<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="p">}</span>

<span class="o">/*----------------------------------------------------</span>
<span class="w">	</span>Function<span class="o">:</span><span class="w">   </span>Get
<span class="w">				</span>Get<span class="w"> </span>address<span class="w"> </span><span class="kr">or</span><span class="w"> </span>size<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>remote<span class="w"> </span>buffer

<span class="w">	</span><span class="nl">Parameters:</span><span class="w"> </span>
<span class="w">         </span>H<span class="w">		</span><span class="o">-</span><span class="w"> </span>Remote<span class="w"> </span>buffer<span class="w"> </span>handle
<span class="w">         </span>pQ<span class="w">     </span><span class="o">-</span><span class="w"> </span>Query<span class="w"> </span>parameter<span class="o">:</span><span class="w"> </span>set<span class="w"> </span>to<span class="w"> </span><span class="s">&quot;adr&quot;</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>address<span class="w"> </span><span class="p">(</span>default<span class="p">),</span><span class="w"> </span>to<span class="w"> </span><span class="s">&quot;size&quot;</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>size<span class="w"> </span><span class="kr">or</span><span class="w"> </span>to<span class="w"> </span><span class="s">&quot;handle&quot;</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>Windows<span class="w"> </span>API<span class="w"> </span>handle<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>remote<span class="w"> </span>buffer<span class="p">.</span>

<span class="w">	</span><span class="nl">Returns:</span>
<span class="w">         </span>Address<span class="w"> </span><span class="kr">or</span><span class="w"> </span>size<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>remote<span class="w"> </span>buffer
<span class="w"> </span><span class="o">*/</span>
<span class="nf">RemoteBuf_Get</span><span class="p">(</span>ByRef<span class="w"> </span>H<span class="p">,</span><span class="w"> </span>pQ<span class="o">=</span><span class="s">&quot;adr&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span>pQ<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;adr&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>NumGet<span class="p">(</span>H<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>pQ<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;size&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>NumGet<span class="p">(</span>H<span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>NumGet<span class="p">(</span>H<span class="p">)</span>
<span class="p">}</span>

<span class="o">/*---------------------------------------------------------------------------------------</span>
<span class="nl">Group:</span><span class="w"> </span><span class="nf">Example</span><span class="w"></span>
<span class="p">(</span>start<span class="w"> </span>code<span class="p">)</span>
<span class="w">	</span><span class="c1">;get the handle of the Explorer window</span>
<span class="w">	   </span><span class="k">WinGet</span><span class="p">,</span><span class="w"> </span>hw<span class="p">,</span><span class="w"> </span>ID<span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>ExploreWClass

<span class="w">	</span><span class="c1">;open two buffers</span>
<span class="w">	   </span><span class="nf">RemoteBuf_Open</span><span class="p">(</span><span class="w"> </span>hBuf1<span class="p">,</span><span class="w"> </span>hw<span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="p">)</span><span class="w"> 		</span>
<span class="w">	   </span><span class="nf">RemoteBuf_Open</span><span class="p">(</span><span class="w"> </span>hBuf2<span class="p">,</span><span class="w"> </span>hw<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="w">  </span><span class="p">)</span><span class="w"> </span>

<span class="w">	</span><span class="c1">;write something</span>
<span class="w">	   </span>str<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;1234&quot;</span><span class="w"> </span>
<span class="w">	   </span><span class="nf">RemoteBuf_Write</span><span class="p">(</span><span class="w"> </span>hBuf1<span class="p">,</span><span class="w"> </span>str<span class="p">,</span><span class="w"> </span>strlen<span class="p">(</span>str<span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>

<span class="w">	   </span>str<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;_5678&quot;</span><span class="w"> </span>
<span class="w">	   </span><span class="nf">RemoteBuf_Write</span><span class="p">(</span><span class="w"> </span>hBuf1<span class="p">,</span><span class="w"> </span>str<span class="p">,</span><span class="w"> </span>strlen<span class="p">(</span>str<span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span>

<span class="w">	   </span>str<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;_testing&quot;</span><span class="w"> </span>
<span class="w">	   </span><span class="nf">RemoteBuf_Write</span><span class="p">(</span><span class="w"> </span>hBuf2<span class="p">,</span><span class="w"> </span>str<span class="p">,</span><span class="w"> </span>strlen<span class="p">(</span>str<span class="p">))</span><span class="w"> </span>


<span class="w">	</span><span class="c1">;read </span>
<span class="w">	   </span><span class="nf">RemoteBuf_Read</span><span class="p">(</span><span class="w"> </span>hBuf1<span class="p">,</span><span class="w"> </span>str<span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="w">	   </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">%str%</span><span class="w"> </span>
<span class="w">	   </span><span class="nf">RemoteBuf_Read</span><span class="p">(</span><span class="w"> </span>hBuf2<span class="p">,</span><span class="w"> </span>str<span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="w">	   </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">%out%%str%</span><span class="w"> </span>

<span class="w">	   </span><span class="k">MsgBox</span><span class="w"> </span><span class="nv">%out%</span><span class="w"> </span>

<span class="w">	</span><span class="c1">;close </span>
<span class="w">	   </span><span class="nf">RemoteBuf_Close</span><span class="p">(</span><span class="w"> </span>hBuf1<span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="w">	   </span><span class="nf">RemoteBuf_Close</span><span class="p">(</span><span class="w"> </span>hBuf2<span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="s">(</span><span class="err">end</span><span class="s"> code</span><span class="err">)</span><span class="s"></span>
<span class="s"> */</span>

<span class="o">/*-------------------------------------------------------------------------------------------------------------------</span>
<span class="w">	</span>Group<span class="o">:</span><span class="w"> </span>About
<span class="w">	</span>o<span class="w"> </span>Ver<span class="w"> </span><span class="mf">2.0</span><span class="w"> </span>by<span class="w"> </span>majkinetor<span class="p">.</span><span class="w"> </span>See<span class="w"> </span>http<span class="o">://</span>www<span class="p">.</span>autohotkey<span class="p">.</span>com<span class="o">/</span>forum<span class="o">/</span>topic12251<span class="p">.</span>html
<span class="w">	</span>o<span class="w"> </span>Code<span class="w"> </span>updates<span class="w"> </span>by<span class="w"> </span>infogulch
<span class="w">	</span>o<span class="w"> </span>Licenced<span class="w"> </span>under<span class="w"> </span>Creative<span class="w"> </span>Commons<span class="w"> </span>Attribution<span class="o">-</span>Noncommercial<span class="w"> </span><span class="o">&lt;</span>http<span class="o">://</span>creativecommons<span class="p">.</span>org<span class="o">/</span>licenses<span class="o">/</span>by<span class="o">-</span>nc<span class="o">/</span><span class="mf">3.0</span><span class="o">/&gt;</span><span class="p">.</span><span class="w">  </span>
<span class="w"> </span><span class="o">*/</span>
</pre></div>


New Lexer: 
<div class="highlight"><pre><span class="c-Singleline">;	Title:	Remote Buffer</span>
<span class="c-Singleline">;			*Read and write process memory*</span>
<span class="c-Singleline">;</span>

<span class="cm">/*-------------------------------------------------------------------------------</span>
<span class="cm">	Function: Open</span>
<span class="cm">			  Open remote buffer</span>

<span class="cm">	Parameters:</span>
<span class="cm">			H		- Reference to variable to receive remote buffer handle</span>
<span class="cm">			hwnd    - HWND of the window that belongs to the process</span>
<span class="cm">			size    - Size of the buffer</span>

<span class="cm">	Returns:</span>
<span class="cm">			Error message on failure</span>
<span class="cm"> */</span>
<span class="n">RemoteBuf_Open</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">H</span><span class="p">,</span> <span class="n">hwnd</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
<span class="w">	</span><span class="nb">static</span> <span class="n">MEM_COMMIT</span><span class="o">=</span><span class="mh">0x1000</span><span class="p">,</span> <span class="n">PAGE_READWRITE</span><span class="o">=</span><span class="mi">4</span>

<span class="w">	</span><span class="nb">WinGet</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">PID</span><span class="p">,</span> <span class="n">ahk_id</span> <span class="nv">%hwnd%</span>
	<span class="n">hProc</span>   <span class="o">:=</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;OpenProcess&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span><span class="c-Singleline"> ;0x38 = PROCESS_VM_OPERATION | PROCESS_VM_READ | PROCESS_VM_WRITE</span>
<span class="w">	</span><span class="nb">IfEqual</span><span class="p">,</span> <span class="n">hProc</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Unable to open process (&quot;</span> <span class="nv">A_LastError</span> <span class="s">&quot;)&quot;</span>
      
	<span class="n">bufAdr</span>  <span class="o">:=</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;VirtualAllocEx&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">hProc</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">MEM_COMMIT</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">PAGE_READWRITE</span><span class="p">)</span>
<span class="w">	</span><span class="nb">IfEqual</span><span class="p">,</span> <span class="n">bufAdr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Unable to allocate memory (&quot;</span> <span class="nv">A_LastError</span> <span class="s">&quot;)&quot;</span><span class="c-Singleline"></span>

<span class="c-Singleline">	; Buffer handle structure:</span>
<span class="c-Singleline">	 ;	@0: hProc</span>
<span class="c-Singleline">	 ;	@4: size</span>
<span class="c-Singleline">	 ;	@8: bufAdr</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span> <span class="n">hProc</span><span class="p">,</span>	<span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
	<span class="nf">NumPut</span><span class="p">(</span> <span class="n">size</span><span class="p">,</span>	<span class="n">H</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span> <span class="n">bufAdr</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="cm">/*----------------------------------------------------</span>
<span class="cm">	Function: Close</span>
<span class="cm">			  Close the remote buffer</span>

<span class="cm">	Parameters:</span>
<span class="cm">			  H - Remote buffer handle</span>
<span class="cm"> */</span>
<span class="n">RemoteBuf_Close</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">H</span><span class="p">)</span> <span class="p">{</span>
<span class="w">	</span><span class="nb">static</span> <span class="n">MEM_RELEASE</span> <span class="o">=</span> <span class="mh">0x8000</span>
	
	<span class="n">handle</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">IfEqual</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Invalid remote buffer handle&quot;</span>
	<span class="n">adr</span>    <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

	<span class="n">r</span> <span class="o">:=</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;VirtualFreeEx&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">adr</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">MEM_RELEASE</span><span class="p">)</span>
<span class="w">	</span><span class="nb">ifEqual</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Unable to free memory (&quot;</span> <span class="nv">A_LastError</span> <span class="s">&quot;)&quot;</span>
	<span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">handle</span> <span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
<span class="p">}</span>

<span class="cm">/*----------------------------------------------------</span>
<span class="cm">	Function:   Read </span>
<span class="cm">				Read from the remote buffer into local buffer</span>

<span class="cm">	Parameters: </span>
<span class="cm">         H			- Remote buffer handle</span>
<span class="cm">         pLocal		- Reference to the local buffer</span>
<span class="cm">         pSize		- Size of the local buffer</span>
<span class="cm">         pOffset	- Optional reading offset, by default 0</span>

<span class="cm">Returns:</span>
<span class="cm">         TRUE on success or FALSE on failure. ErrorMessage on bad remote buffer handle</span>
<span class="cm"> */</span>
<span class="n">RemoteBuf_Read</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">H</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">pLocal</span><span class="p">,</span> <span class="n">pSize</span><span class="p">,</span> <span class="n">pOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">){</span>
	<span class="n">handle</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span> <span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="n">size</span><span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span> <span class="n">H</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>   <span class="n">adr</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span> <span class="n">H</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="w">	</span><span class="nb">IfEqual</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Invalid remote buffer handle&quot;</span>	
<span class="w">	</span><span class="nb">IfGreaterOrEqual</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nv">%size%</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Offset is bigger then size&quot;</span>

	<span class="nf">VarSetCapacity</span><span class="p">(</span> <span class="n">pLocal</span><span class="p">,</span> <span class="n">pSize</span> <span class="p">)</span>
<span class="w">	</span><span class="nb">return</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">adr</span> <span class="o">+</span> <span class="n">pOffset</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pLocal</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">pLocal</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="cm">/*----------------------------------------------------</span>
<span class="cm">	Function:   Write </span>
<span class="cm">				Write local buffer into remote buffer</span>

<span class="cm">	Parameters: </span>
<span class="cm">         H			- Remote buffer handle</span>
<span class="cm">         pLocal		- Reference to the local buffer</span>
<span class="cm">         pSize		- Size of the local buffer</span>
<span class="cm">         pOffset	- Optional writting offset, by default 0</span>

<span class="cm">	Returns:</span>
<span class="cm">         TRUE on success or FALSE on failure. ErrorMessage on bad remote buffer handle</span>
<span class="cm"> */</span>

<span class="n">RemoteBuf_Write</span><span class="p">(</span><span class="n">Byref</span> <span class="n">H</span><span class="p">,</span> <span class="n">byref</span> <span class="n">pLocal</span><span class="p">,</span> <span class="n">pSize</span><span class="p">,</span> <span class="n">pOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="w">	</span><span class="nl">handle:</span><span class="o">=</span> <span class="nf">NumGet</span><span class="p">(</span> <span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="n">size</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span> <span class="n">H</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>   <span class="n">adr</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span> <span class="n">H</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="w">	</span><span class="nb">IfEqual</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Invalid remote buffer handle&quot;</span>	
<span class="w">	</span><span class="nb">IfGreaterOrEqual</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nv">%size%</span><span class="p">,</span> <span class="n">return</span> <span class="nv">A_ThisFunc</span> <span class="s">&quot;&gt;   Offset is bigger then size&quot;</span>

<span class="w">	</span><span class="nb">return</span> <span class="nf">DllCall</span><span class="p">(</span> <span class="s">&quot;WriteProcessMemory&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">adr</span> <span class="o">+</span> <span class="n">pOffset</span><span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pLocal</span><span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">pSize</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
<span class="p">}</span>

<span class="cm">/*----------------------------------------------------</span>
<span class="cm">	Function:   Get</span>
<span class="cm">				Get address or size of the remote buffer</span>

<span class="cm">	Parameters: </span>
<span class="cm">         H		- Remote buffer handle</span>
<span class="cm">         pQ     - Query parameter: set to &quot;adr&quot; to get address (default), to &quot;size&quot; to get the size or to &quot;handle&quot; to get Windows API handle of the remote buffer.</span>

<span class="cm">	Returns:</span>
<span class="cm">         Address or size of the remote buffer</span>
<span class="cm"> */</span>
<span class="n">RemoteBuf_Get</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">H</span><span class="p">,</span> <span class="n">pQ</span><span class="o">=</span><span class="s">&quot;adr&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="w">	</span><span class="nb">return</span> <span class="n">pQ</span> <span class="o">=</span> <span class="s">&quot;adr&quot;</span> <span class="o">?</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">:</span> <span class="n">pQ</span> <span class="o">=</span> <span class="s">&quot;size&quot;</span> <span class="o">?</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">:</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<span class="p">}</span>

<span class="cm">/*---------------------------------------------------------------------------------------</span>
<span class="cm">Group: Example</span>
<span class="cm">(start code)</span>
<span class="cm">	;get the handle of the Explorer window</span>
<span class="cm">	   WinGet, hw, ID, ahk_class ExploreWClass</span>

<span class="cm">	;open two buffers</span>
<span class="cm">	   RemoteBuf_Open( hBuf1, hw, 128 ) 		</span>
<span class="cm">	   RemoteBuf_Open( hBuf2, hw, 16  ) </span>

<span class="cm">	;write something</span>
<span class="cm">	   str := &quot;1234&quot; </span>
<span class="cm">	   RemoteBuf_Write( hBuf1, str, strlen(str) ) </span>

<span class="cm">	   str := &quot;_5678&quot; </span>
<span class="cm">	   RemoteBuf_Write( hBuf1, str, strlen(str), 4) </span>

<span class="cm">	   str := &quot;_testing&quot; </span>
<span class="cm">	   RemoteBuf_Write( hBuf2, str, strlen(str)) </span>


<span class="cm">	;read </span>
<span class="cm">	   RemoteBuf_Read( hBuf1, str, 10 ) </span>
<span class="cm">	   out = %str% </span>
<span class="cm">	   RemoteBuf_Read( hBuf2, str, 10 ) </span>
<span class="cm">	   out = %out%%str% </span>

<span class="cm">	   MsgBox %out% </span>

<span class="cm">	;close </span>
<span class="cm">	   RemoteBuf_Close( hBuf1 ) </span>
<span class="cm">	   RemoteBuf_Close( hBuf2 ) </span>
<span class="cm">(end code)</span>
<span class="cm"> */</span>

<span class="cm">/*-------------------------------------------------------------------------------------------------------------------</span>
<span class="cm">	Group: About</span>
<span class="cm">	o Ver 2.0 by majkinetor. See http://www.autohotkey.com/forum/topic12251.html</span>
<span class="cm">	o Code updates by infogulch</span>
<span class="cm">	o Licenced under Creative Commons Attribution-Noncommercial &lt;http://creativecommons.org/licenses/by-nc/3.0/&gt;.  </span>
<span class="cm"> */</span>
</pre></div>
