<LINK href="styles.css" rel="stylesheet" type="text/css">old lexer: 
<div class="highlight"><pre><span class="c1">; Binary AHK Array RC2</span>
<span class="c1">; (w) by DerRaphael</span>
<span class="c1">;</span>
<span class="c1">; Released under the Terms of European Public License (EUPL 1.0)</span>
<span class="c1">;    see http://ec.europa.eu/idabc/en/document/7330</span>
<span class="c1">;    for translations in your language.</span>

<span class="nf">A_Put</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>Data<span class="p">,</span><span class="w"> </span>Index<span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>dSize<span class="o">=-</span><span class="mi">1</span><span class="p">){</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="c1">; No Array ? Do an ArrayInit to get a proper Structure</span>
<span class="w">        </span><span class="nf">A_Init</span><span class="p">(</span>Array<span class="p">)</span>

<span class="w">    </span><span class="nf">if</span><span class="w"> </span><span class="p">((</span>Index<span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">=</span>Index<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">Gosub</span><span class="p">,</span><span class="w"> </span>GetArrayStats
<span class="w">    </span>
<span class="w">        </span>nSize<span class="w"> </span><span class="o">:=</span><span class="w"> </span>aSize<span class="o">+</span>dSize<span class="o">+</span><span class="mi">8</span><span class="w">                         </span><span class="c1">; calculate new size</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>tmpArray<span class="p">,</span><span class="w"> </span>nSize<span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w">            </span><span class="c1">; create tmpArray for our new data</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>tmpArray<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>Array<span class="p">,</span><span class="w"> </span>aSize<span class="p">)</span><span class="w">            </span><span class="c1">; Copy entire array to TMP</span>
<span class="w">    </span>
<span class="w">        </span><span class="nf">NumPut</span><span class="p">(</span>nSize<span class="p">,</span><span class="w">       </span>tmpArray<span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w">              </span><span class="c1">; Update size of array in total</span>
<span class="w">        </span><span class="nf">NumPut</span><span class="p">(</span>tSize<span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="w">     </span>tmpArray<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w">              </span><span class="c1">; Update tableLenght</span>
<span class="w">        </span><span class="nf">NumPut</span><span class="p">(</span>oSize<span class="o">+</span>dSize<span class="p">,</span><span class="w"> </span>tmpArray<span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w">              </span><span class="c1">; Update length of new ArrayStructure</span>
<span class="w">        </span><span class="nf">NumPut</span><span class="p">(</span>ElmCount<span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span>tmpArray<span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w">              </span><span class="c1">; Update elementcount</span>
<span class="w">    </span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span>tmpArray<span class="w"> </span><span class="o">+</span><span class="w"> </span>tSize<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="w">               </span><span class="c1">; Shift ArrayData for 8 bytes</span>
<span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>Array<span class="w"> </span><span class="o">+</span><span class="w"> </span>tSize<span class="p">,</span><span class="w"> </span>oSize<span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>tmpArray<span class="o">+</span>aSize<span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="o">&amp;</span>Data<span class="p">,</span>dSize<span class="p">)</span><span class="w">       </span><span class="c1">; copy data to tmpArray</span>
<span class="w">    </span>
<span class="w">        </span>Offset<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">28</span><span class="w">                                   </span><span class="c1">; move offsets for array contents</span>
<span class="w">        </span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>ElmCount<span class="o">+</span><span class="mi">1</span>
<span class="w">            </span><span class="nf">NumPut</span><span class="p">(</span><span class="w"> </span>NumGet<span class="p">(</span>tmpArray
<span class="w">                    </span><span class="p">,(</span>Offset<span class="o">+</span><span class="p">(</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">8</span><span class="w">         </span><span class="c1">; get last known value and </span>
<span class="w">                    </span><span class="p">,</span>tmpArray<span class="p">,(</span>Offset<span class="o">+</span><span class="p">(</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="w">  </span><span class="c1">; increment it by 8</span>

<span class="w">        </span><span class="nf">NumPut</span><span class="p">(</span>aSize<span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span>tmpArray<span class="p">,</span><span class="w"> </span>tSize<span class="p">)</span><span class="w">               </span><span class="c1">; Set offsetpointer to new data</span>
<span class="w">        </span><span class="nf">NumPut</span><span class="p">(</span>dSize<span class="p">,</span><span class="w"> </span>tmpArray<span class="p">,</span><span class="w"> </span>tSize<span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w">               </span><span class="c1">; Set size of new element</span>

<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>Array<span class="p">,</span>nSize<span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="w">                 </span><span class="c1">; Resize the array</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>Array<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>tmpArray<span class="p">,</span><span class="w"> </span>nSize<span class="p">)</span><span class="w">            </span><span class="c1">; copy tmpArray back to array</span>

<span class="w">        </span><span class="k">Return</span><span class="w"> </span>ElmCount<span class="o">+</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">((</span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)</span><span class="o">&gt;=</span>Index<span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>Index<span class="o">!=</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">Gosub</span><span class="p">,</span><span class="w"> </span>GetArrayStats
<span class="w">        </span>
<span class="w">        </span>ElmPtr<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="mi">28</span><span class="o">+</span><span class="p">(</span>Index<span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="w">        </span>ElmSize<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="mi">32</span><span class="o">+</span><span class="p">(</span>Index<span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="w">        </span>
<span class="w">        </span><span class="nf">if</span><span class="w"> </span><span class="p">((</span>dSize<span class="o">&gt;</span>ElmSize<span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>dSize<span class="o">&lt;</span>ElmSize<span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">      </span><span class="c1">; Fix table offsets to new size</span>
<span class="w">    </span>
<span class="w">            </span>OffSet<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="mi">28</span><span class="o">+</span>Index<span class="o">*</span><span class="mi">8</span><span class="w">                      </span><span class="c1">; GetStarting offset in table</span>
<span class="w">            </span>ptrDiff<span class="w"> </span><span class="o">:=</span><span class="w"> </span>dSize<span class="o">-</span>ElmSize<span class="w">                   </span><span class="c1">; Get difference</span>

<span class="w">            </span>nSize<span class="w"> </span><span class="o">:=</span><span class="w"> </span>aSize<span class="o">+</span>ptrDiff<span class="w">                     </span><span class="c1">; calculate new size</span>
<span class="w">            </span><span class="nf">VarSetCapacity</span><span class="p">(</span>tmpArray<span class="p">,</span><span class="w"> </span>nSize<span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w">        </span><span class="c1">; create tmpArray for our new data</span>
<span class="w">            </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>tmpArray<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>Array<span class="w">                </span><span class="c1">; Copy entire array to TMP</span>
<span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="p">((</span>aSize<span class="o">&gt;</span>nSize<span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">:</span><span class="w"> </span>aSize<span class="p">))</span><span class="w">     </span><span class="c1">; with a correct calculated length</span>
<span class="w">            </span><span class="nf">NumPut</span><span class="p">(</span>nSize<span class="p">,</span><span class="w"> </span>tmpArray<span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w">                </span><span class="c1">; Update size of array in total</span>
<span class="w">            </span><span class="nf">NumPut</span><span class="p">(</span>oSize<span class="o">+</span>ptrDiff<span class="p">,</span><span class="w"> </span>tmpArray<span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w">        </span><span class="c1">; Update length of new ArrayStructure</span>
<span class="w">            </span><span class="nf">NumPut</span><span class="p">(</span>dSize<span class="p">,</span><span class="w"> </span>tmpArray<span class="p">,</span><span class="w"> </span>Offset<span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="w">          </span><span class="c1">; Set size of new element</span>

<span class="w">            </span><span class="k">Loop</span><span class="p">,</span><span class="o">%</span><span class="w"> </span>ElmCount<span class="o">-</span>Index<span class="w">                      </span><span class="c1">; loop remaining elements</span>
<span class="w">                </span><span class="nf">NumPut</span><span class="p">(</span><span class="w"> </span>NumGet<span class="p">(</span>tmpArray
<span class="w">                    </span><span class="p">,(</span>Offset<span class="o">+</span><span class="p">(</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span>ptrDiff<span class="w">   </span><span class="c1">; get last known value and </span>
<span class="w">                    </span><span class="p">,</span>tmpArray<span class="p">,(</span>Offset<span class="o">+</span><span class="p">(</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="w">  </span><span class="c1">; add the difference</span>

<span class="w">            </span>Offset<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>tmpArray<span class="p">,</span>Offset<span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<span class="w">            </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>tmpArray<span class="o">+</span>Offset<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>Data<span class="p">,</span><span class="w"> </span>dSize<span class="p">)</span><span class="w">  </span><span class="c1">; Copy new data into tmpArray</span>
<span class="w">            </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>tmpArray<span class="o">+</span>Offset<span class="o">+</span>dSize<span class="w">           </span><span class="c1">; remaining ArrayData to new offset</span>
<span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>Array<span class="o">+</span>Offset<span class="o">+</span>ElmSize<span class="p">,</span><span class="w"> </span>aSize<span class="o">-</span><span class="p">(</span>OffSet<span class="o">+</span>ElmSize<span class="p">))</span>

<span class="w">            </span><span class="nf">VarSetCapacity</span><span class="p">(</span>Array<span class="p">,</span>nSize<span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="w">             </span><span class="c1">; Resize the array</span>
<span class="w">            </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>Array<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>tmpArray<span class="p">,</span><span class="w"> </span>nSize<span class="p">)</span><span class="w">        </span><span class="c1">; copy tmpArray back to array</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span>dSize<span class="o">=</span>ElmSize<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">                    </span><span class="c1">; No need to fix tableoffsets</span>
<span class="w">            </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>Array<span class="o">+</span>ElmPtr<span class="p">,</span><span class="o">&amp;</span>Data<span class="p">,</span>dSize<span class="p">)</span><span class="w">       </span><span class="c1">; speeeed!</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">                                       </span><span class="c1">; THIS SHOULD NEVER HAPPEN</span>
<span class="w">            </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Internal Binary Array Structure Error / Invalid Binary Array Object&quot;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span>ElmCount
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Binary Array Index Mismatch&quot;</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nl">GetArrayStats:</span>
<span class="w">        </span>ElmCount<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)</span><span class="w">       </span><span class="c1">; update ElementCount</span>
<span class="w">        </span>aSize<span class="w">    </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Size</span><span class="p">(</span>Array<span class="p">)</span><span class="w">        </span><span class="c1">; current ByteSize of entire Array</span>
<span class="w">        </span>oSize<span class="w">    </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Length</span><span class="p">(</span>Array<span class="p">)</span><span class="w">      </span><span class="c1">; current ByteSize of contained data in Array</span>
<span class="w">        </span>tSize<span class="w">    </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="mi">16</span><span class="p">)</span><span class="w">     </span><span class="c1">; table size</span>
<span class="w">        </span><span class="nf">If</span><span class="w"> </span><span class="p">(</span>dSize<span class="o">&lt;=-</span><span class="mi">1</span><span class="p">)</span><span class="w">                   </span><span class="c1">; No size given - assume it&#39;s a string and fix it!</span>
<span class="w">            </span><span class="nf">RegExReplace</span><span class="p">(</span>Data<span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span>dSize<span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="nf">A_Get</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>Index<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">((</span>Index<span class="o">&gt;</span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>Index<span class="o">&lt;=</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Binary Array Index mismatch - no such Index&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Offset<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="mi">28</span><span class="o">+</span><span class="p">(</span>Index<span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="w">                      </span><span class="c1">; Get starting offset in table</span>
<span class="w">        </span>ElmPtr<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span>Offset<span class="p">)</span>
<span class="w">        </span>ElmSize<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span>Offset<span class="o">+</span><span class="mi">4</span><span class="p">)</span>

<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>ArrayElement<span class="p">,</span>ElmSize<span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="w">        </span><span class="c1">; Initialise the returnbuffer</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>ArrayElement<span class="p">,</span><span class="o">&amp;</span>Array<span class="o">+</span>ElmPtr<span class="p">,</span>ElmSize<span class="p">)</span><span class="w"> </span><span class="c1">; Copy the binary data</span>
<span class="w">        </span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span>ElmSize
<span class="w">        </span><span class="k">Return</span><span class="w"> </span>ArrayElement
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; Returns a joined string of given Array and glue parameter</span>
<span class="c1">; Length is returned as ErrorLevel</span>
<span class="nf">A_Implode</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>glue<span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>lGlue<span class="w">      </span><span class="o">:=</span><span class="w"> </span>glue
<span class="w">        </span>glueLength<span class="w"> </span><span class="o">:=</span><span class="w"> </span>StrLen<span class="p">(</span>lGlue<span class="p">)</span>
<span class="w">        </span>aSize<span class="w">      </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Length</span><span class="p">(</span>Array<span class="p">)</span><span class="w">                  </span><span class="c1">; current DataSize of array</span>
<span class="w">        </span>elmCount<span class="w">   </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)</span><span class="w">                   </span><span class="c1">; get ElementCount of Array</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span>elmCount<span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span>glueLength<span class="w"> </span><span class="o">+</span><span class="w"> </span>aSize<span class="w">  </span><span class="c1">; count new Size of returnString</span>
<span class="w">        </span>Offset<span class="w">     </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="w">                                </span><span class="c1">; set Offset for A_ArrayMM Loop</span>

<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>String<span class="p">,</span>ErrorLevel<span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="w">           </span><span class="c1">; Allocate space for new return</span>

<span class="w">        </span><span class="k">Loop</span><span class="p">,</span><span class="o">%</span><span class="w"> </span>elmCount
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span>elmLength<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="mi">32</span><span class="o">+</span><span class="p">(</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="w">  </span><span class="c1">; current element&#39;s length</span>
<span class="w">            </span>elmPos<span class="w">     </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="mi">28</span><span class="o">+</span><span class="p">(</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="w">  </span><span class="c1">; current element&#39;s position in Array</span>
<span class="w">            </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>String<span class="o">+</span>Offset<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>Array<span class="o">+</span>elmPos<span class="p">,</span><span class="w"> </span>elmLength<span class="p">)</span><span class="w">  </span><span class="c1">; Move it to ReturnData</span>
<span class="w">            </span>Offset<span class="w">     </span><span class="o">+=</span><span class="w"> </span>elmLength<span class="w">                       </span><span class="c1">; calculate Offset</span>
<span class="w">            </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="nb">A_Index</span><span class="o">!=</span>elmCount<span class="p">)</span>
<span class="w">                </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>String<span class="o">+</span>Offset<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>lGlue<span class="p">,</span><span class="w"> </span>glueLength<span class="p">)</span><span class="w"> </span><span class="c1">; Move Glue to ReturnData</span>
<span class="w">            </span>Offset<span class="w">     </span><span class="o">+=</span><span class="w"> </span>glueLength<span class="w">                      </span><span class="c1">; calculate Offset again</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span>String
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; Returns an array of strings, each of which is a substring of string formed </span>
<span class="c1">; by splitting it on boundaries formed by the string delimiter. </span>
<span class="c1">; unlike Stringsplit, multiple chars are allowed in dString</span>
<span class="nf">A_Explode</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>dString<span class="p">,</span><span class="w"> </span>sString<span class="p">,</span><span class="w"> </span>Limit<span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>trimChars<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>trimCharsIsRegEx<span class="o">=</span>False<span class="p">,</span><span class="w"> </span>dStringIsRegEx<span class="o">=</span>False<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span>
<span class="w">        </span><span class="nf">A_Init</span><span class="p">(</span>Array<span class="p">)</span>

<span class="w">    </span>oIF<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_FormatInteger</span><span class="w">            </span><span class="c1">; Store current Integerformat</span>
<span class="w">    </span><span class="k">SetFormat</span><span class="p">,</span>Integer<span class="p">,</span>H

<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span>trimCharsIsRegEx<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">          </span><span class="c1">; Build RegExNeedle for trimming if non given</span>
<span class="w">        </span><span class="k">Loop</span><span class="p">,</span>Parse<span class="p">,</span>TrimChars<span class="w">          </span><span class="c1">; parse each char and build hexescaped needle</span>
<span class="w">            </span>escTrimChars<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w">  </span><span class="s">&quot;|^\&quot;</span><span class="w"> </span>SubStr<span class="p">(</span>asc<span class="p">(</span><span class="nb">A_LoopField</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;|\&quot;</span><span class="w"> </span>SubStr<span class="p">(</span>asc<span class="p">(</span><span class="nb">A_LoopField</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;$&quot;</span>
<span class="w">        </span>trimChars<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span>SubStr<span class="p">(</span>escTrimChars<span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span>gLen<span class="w"> </span><span class="o">:=</span><span class="w"> </span>StrLen<span class="p">(</span>dString<span class="p">)</span><span class="w">           </span><span class="c1">; get length of delimiterString</span>
<span class="w">    </span>sLen<span class="w"> </span><span class="o">:=</span><span class="w"> </span>StrLen<span class="p">(</span>sString<span class="p">)</span><span class="w">           </span><span class="c1">; get length of string</span>
<span class="w">                                      </span><span class="c1">; since this is not a byref parameter,</span>
<span class="w">                                      </span><span class="c1">; binary values need to be assigned direct in call such as </span>
<span class="w">                                      </span><span class="c1">; A_Explode(Array,&quot;\x0&quot;,FileGetContent(&quot;myfile.dat&quot;),&quot;&quot;,0,1)</span>

<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span>dStringIsRegEx<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">            </span><span class="c1">; Build RegExNeedle for matching if non given</span>
<span class="w">        </span><span class="k">Loop</span><span class="p">,</span>Parse<span class="p">,</span>dString<span class="w">            </span><span class="c1">; parse each char and build hexescaped needle</span>
<span class="w">            </span>escdString<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w">  </span><span class="s">&quot;|\&quot;</span><span class="w"> </span>SubStr<span class="p">(</span>asc<span class="p">(</span><span class="nb">A_LoopField</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span>dString<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span>SubStr<span class="p">(</span>escdString<span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">SetFormat</span><span class="p">,</span>Integer<span class="p">,</span><span class="o">%</span><span class="w"> </span>oIF

<span class="w">    </span><span class="k">Loop</span><span class="p">,</span>
<span class="w">        </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span>nPos<span class="w"> </span><span class="o">:=</span><span class="w"> </span>RegExMatch<span class="p">(</span>sString<span class="p">,</span>dString<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>sLen<span class="w"> </span><span class="o">-=</span><span class="w"> </span>nPos<span class="w">                                         </span><span class="c1">; calculate new length</span>
<span class="w">            </span>data<span class="w"> </span><span class="o">:=</span><span class="w"> </span>RegExReplace<span class="p">(</span>sString<span class="p">,</span><span class="s">&quot;(.{&quot;</span><span class="w"> </span>sLen<span class="o">+</span>gLen<span class="w"> </span><span class="s">&quot;}$)&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">; generate data to store in Array</span>
<span class="w">            </span>_tmp<span class="w"> </span><span class="o">:=</span><span class="w"> </span>RegExReplace<span class="p">(</span>data<span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span>dLen<span class="p">)</span><span class="w">               </span><span class="c1">; fix length for data</span>
<span class="w">            </span>sString<span class="w"> </span><span class="o">:=</span><span class="w"> </span>RegExReplace<span class="p">(</span>sString<span class="p">,</span><span class="s">&quot;(^.{&quot;</span><span class="w"> </span>nPos<span class="w"> </span><span class="s">&quot;})&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1">; generate new sourceString</span>
<span class="w">            </span>_tmp<span class="w"> </span><span class="o">:=</span><span class="w"> </span>RegExReplace<span class="p">(</span>sString<span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span>sLen<span class="p">)</span><span class="w">            </span><span class="c1">; fix length for binary Arrays</span>
<span class="w">            </span><span class="nf">A_Put</span><span class="p">(</span>Array<span class="p">,</span>Data<span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>dLen<span class="p">)</span><span class="w">                            </span><span class="c1">; store to Array</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nf">A_Put</span><span class="p">(</span>Array<span class="p">,</span>sString<span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>sLen<span class="p">)</span>
<span class="w">            </span><span class="k">Break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">A_Count</span><span class="p">(</span>Array<span class="p">)</span>
<span class="p">}</span>

<span class="c1">; Deletes ItemIndex of given Array</span>
<span class="nf">A_Del</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>Item<span class="o">=-</span><span class="mi">1</span><span class="p">){</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">((</span>Item<span class="o">+</span><span class="mi">0</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>Item<span class="o">&gt;</span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid Index&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>aSize<span class="w">      </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Size</span><span class="p">(</span>Array<span class="p">)</span><span class="w">                    </span><span class="c1">; current DataSize of Array</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>tmpArray<span class="p">,</span><span class="w"> </span>aSize<span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>tmpArray<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>Array<span class="p">,</span><span class="w"> </span>aSize<span class="p">)</span><span class="w">            </span><span class="c1">; copy Array</span>

<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>Array<span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">                        </span><span class="c1">; delete Old Array</span>
<span class="w">        </span><span class="k">Loop</span><span class="p">,</span><span class="o">%</span><span class="w"> </span><span class="nb">A_Count</span><span class="p">(</span>tmpArray<span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span>elmData<span class="w">   </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Get</span><span class="p">(</span>tmpArray<span class="p">,</span><span class="nb">A_Index</span><span class="p">)</span>
<span class="w">            </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="nb">A_Index</span><span class="o">!=</span>Item<span class="p">)</span>
<span class="w">                </span><span class="nf">A_Put</span><span class="p">(</span>Array<span class="p">,</span>elmData<span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>ErrorLevel<span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span>data<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Get</span><span class="p">(</span>tmpArray<span class="p">,</span>Item<span class="p">)</span><span class="w">                  </span><span class="c1">; Get return data</span>
<span class="w">        </span>size<span class="w">  </span><span class="o">:=</span><span class="w"> </span>ErrorLevel<span class="w">                            </span><span class="c1">; store size for reuse</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>out<span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">                          </span><span class="c1">; prepare element</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>out<span class="p">,</span>size<span class="p">,</span><span class="mi">32</span><span class="p">)</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>out<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>data<span class="p">,</span><span class="w"> </span>size<span class="p">)</span><span class="w">                   </span><span class="c1">; copy data to return var</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span>size<span class="w">                             </span><span class="c1">; update ErrorLevel</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span>out
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; Returns the element off the end of array and removes it</span>
<span class="c1">; Length is returned as ErrorLevel</span>
<span class="nf">A_Pop</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">){</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Item<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)</span>
<span class="w">        </span>data<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Del</span><span class="p">(</span>Array<span class="p">,</span>Item<span class="p">)</span><span class="w">                     </span><span class="c1">; Get return data</span>
<span class="w">        </span>size<span class="w">  </span><span class="o">:=</span><span class="w"> </span>ErrorLevel<span class="w">                            </span><span class="c1">; store size for reuse</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>out<span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">                          </span><span class="c1">; prepare element</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>out<span class="p">,</span>size<span class="p">,</span><span class="mi">32</span><span class="p">)</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>out<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>data<span class="p">,</span><span class="w"> </span>size<span class="p">)</span><span class="w">                   </span><span class="c1">; copy data to return var</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span>size<span class="w">                             </span><span class="c1">; update ErrorLevel</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span>out
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; Shift an element off the beginning of array and returns it</span>
<span class="c1">; Length is returned as ErrorLevel</span>
<span class="nf">A_Shift</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">){</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>Item<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span>data<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Del</span><span class="p">(</span>Array<span class="p">,</span>Item<span class="p">)</span><span class="w">                     </span><span class="c1">; Get return data</span>
<span class="w">        </span>size<span class="w">  </span><span class="o">:=</span><span class="w"> </span>ErrorLevel<span class="w">                            </span><span class="c1">; store size for reuse</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>out<span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">                          </span><span class="c1">; prepare element</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>out<span class="p">,</span>size<span class="p">,</span><span class="mi">32</span><span class="p">)</span>
<span class="w">        </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span>out<span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>data<span class="p">,</span><span class="w"> </span>size<span class="p">)</span><span class="w">                   </span><span class="c1">; copy data to return var</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span>size<span class="w">                             </span><span class="c1">; update ErrorLevel</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span>out
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; Swaps element IdxA with element IdxB in given Array</span>
<span class="nf">A_Swap</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>IdxA<span class="p">,</span><span class="w"> </span>IdxB<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>elmA<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Get</span><span class="p">(</span>Array<span class="p">,</span>IdxA<span class="p">),</span><span class="w"> </span>sizeA<span class="w"> </span><span class="o">:=</span><span class="w"> </span>ErrorLevel
<span class="w">        </span>elmB<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Get</span><span class="p">(</span>Array<span class="p">,</span>IdxB<span class="p">),</span><span class="w"> </span>sizeB<span class="w"> </span><span class="o">:=</span><span class="w"> </span>ErrorLevel
<span class="w">        </span><span class="nf">A_Put</span><span class="p">(</span>Array<span class="p">,</span>elmB<span class="p">,</span>idxA<span class="p">,</span>sizeB<span class="p">)</span>
<span class="w">        </span><span class="nf">A_Put</span><span class="p">(</span>Array<span class="p">,</span>elmA<span class="p">,</span>idxB<span class="p">,</span>sizeA<span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span>true
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; sArray&#39;s given intersection Elements are appended to Array, which</span>
<span class="c1">; will be created at runtime if neccessary</span>
<span class="nf">A_Slice</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>sArray<span class="p">,</span><span class="w"> </span>Start<span class="p">,</span><span class="w"> </span>End<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>sArray<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid source Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">((</span>cnt<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Count</span><span class="p">(</span>sArray<span class="p">))</span><span class="w"> </span>
<span class="w">                    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>Start<span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>cnt<span class="o">&lt;</span>Start<span class="p">)</span>
<span class="w">                    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>End<span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>cnt<span class="o">&lt;</span>End<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Wrong Start or End of sArray&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span>
<span class="w">            </span><span class="nf">A_Init</span><span class="p">(</span>Array<span class="p">)</span>
<span class="w">        </span>startIndex<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span>Start<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>End<span class="p">)</span><span class="o">?</span><span class="w"> </span>End<span class="w"> </span><span class="o">:</span><span class="w"> </span>Start
<span class="w">        </span>endIndex<span class="w">   </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span>start<span class="o">==</span>startIndex<span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>End<span class="w"> </span><span class="o">:</span><span class="w"> </span>Start
<span class="w">        </span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>endIndex<span class="w"> </span><span class="o">-</span><span class="w"> </span>StartIndex<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>elm<span class="w">  </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Get</span><span class="p">(</span>sArray<span class="p">,</span><span class="w"> </span>StartIndex<span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="nb">A_Index</span><span class="p">),</span><span class="w"> </span>size<span class="w"> </span><span class="o">:=</span><span class="w"> </span>ErrorLevel
<span class="w">            </span>cnt<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Put</span><span class="p">(</span>Array<span class="p">,</span><span class="w"> </span>elm<span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>size<span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span>cnt
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; Appends entire sArray to Array</span>
<span class="nf">A_Merge</span><span class="p">(</span>Byref<span class="w"> </span>Array<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>sArray<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">If</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>sArray<span class="p">))</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nb">A_Count</span><span class="p">(</span>sArray<span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid source Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span>
<span class="w">            </span><span class="nf">A_Init</span><span class="p">(</span>Array<span class="p">)</span>
<span class="w">        </span><span class="nf">A_Slice</span><span class="p">(</span>Array<span class="p">,</span>sArray<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">A_Count</span><span class="p">(</span>sArray<span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; Returns TRUE if Array, FALSE otherwise - Thx, Lexikos</span>
<span class="nf">A_Array</span><span class="p">(</span>byRef<span class="w"> </span>Array<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">Return</span><span class="w"> </span>Array<span class="o">=</span><span class="s">&quot;Array()&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>Array<span class="p">)</span><span class="o">&gt;=</span><span class="mi">28</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">=</span><span class="mh">0x1001</span>
<span class="p">}</span>

<span class="c1">; Returns current element count of given array or -1 if no valid binary array</span>
<span class="nf">A_Count</span><span class="p">(</span>byRef<span class="w"> </span>Array<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span><span class="nf">NumGet</span><span class="p">(</span>Array<span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; for internal use only - initialises bytestructure of array</span>
<span class="nf">A_Init</span><span class="p">(</span>byRef<span class="w"> </span>Array<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">; ATM 28 Bytes is minimum for AHK binary array structure</span>
<span class="w">    </span>ArraySize<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span>
<span class="w">    </span><span class="nf">VarSetCapacity</span><span class="p">(</span>Array<span class="p">,</span>ArraySize<span class="p">,</span><span class="mi">32</span><span class="p">)</span>

<span class="w">    </span><span class="n">Array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Array</span><span class="p">()</span>

<span class="w">    </span><span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x1001</span><span class="p">,</span><span class="w">    </span>Array<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w">   </span><span class="c1">; Array version</span>
<span class="w">    </span><span class="nf">NumPut</span><span class="p">(</span>ArraySize<span class="p">,</span><span class="w"> </span>Array<span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w">  </span><span class="c1">; ArraySize in bytes</span>
<span class="w">    </span><span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x1c</span><span class="p">,</span><span class="w">      </span>Array<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w">  </span><span class="c1">; TableLength in bytes</span>
<span class="w">    </span><span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span><span class="w">       </span>Array<span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w">  </span><span class="c1">; ArrayLength in bytes</span>
<span class="w">    </span><span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span><span class="w">       </span>Array<span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w">  </span><span class="c1">; Element count</span>
<span class="w">    </span><span class="k">Return</span><span class="w"> </span>True
<span class="p">}</span>

<span class="c1">; for internal use only - returns ArrayStructuresize</span>
<span class="nf">A_Size</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">){</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span><span class="nf">NumGet</span><span class="p">(</span>Array<span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; for internal use only - returns DataLength of Array</span>
<span class="nf">A_Length</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">){</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span><span class="nf">NumGet</span><span class="p">(</span>Array<span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nf">A_Dump</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">If</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nb">A_Array</span><span class="p">(</span>Array<span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>ErrorLevel<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>out<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Array(&quot;</span><span class="w"> </span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)</span><span class="w"> </span><span class="s">&quot;)</span><span class="se">`n</span><span class="s">{</span><span class="se">`n</span><span class="s">&quot;</span><span class="w"> </span><span class="nb">A_Implode</span><span class="p">(</span>Array<span class="p">,</span><span class="s">&quot;</span><span class="se">`n`t</span><span class="s">=&gt;</span><span class="se">`t</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">}</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">        </span><span class="k">Loop</span><span class="p">,</span>parse<span class="p">,</span>out<span class="p">,`</span>n
<span class="w">            </span><span class="nf">if</span><span class="w"> </span><span class="p">((</span><span class="nb">A_Index</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nb">A_Count</span><span class="p">(</span>Array<span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">&gt;=</span><span class="nb">A_Index</span><span class="p">))</span>
<span class="w">                </span>out<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;   [&quot;</span><span class="w"> </span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="p">((</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">2</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`t</span><span class="s">=&gt;</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nb">A_LoopField</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span>
<span class="w">                </span>out<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">((</span><span class="nb">A_Index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">A_LoopField</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>out<span class="w"> </span><span class="nb">A_LoopField</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span>out
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">; for internal use only - SyntaxSugar for RtlMoveMemory</span>
<span class="nf">A_ArrayMM</span><span class="p">(</span>Target<span class="p">,</span><span class="w"> </span>Source<span class="p">,</span><span class="w"> </span>Length<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">,</span>Target<span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">,</span>Source<span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">,</span>Length<span class="p">)</span>
<span class="p">}</span>

<span class="c1">; for debugging purposes only</span>
<span class="nf">A___ArrayBin</span><span class="p">(</span>ByRef<span class="w"> </span>Array<span class="p">,</span>offset<span class="p">,</span>length<span class="p">){</span>
<span class="w">    </span><span class="k">SetFormat</span><span class="p">,</span>Integer<span class="p">,</span>h
<span class="w">    </span>n<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">Loop</span><span class="p">,</span><span class="o">%</span><span class="w"> </span>length
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span>c<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span>offset<span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;uchar&quot;</span><span class="p">)</span>
<span class="w">        </span>o<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w"> </span>SubStr<span class="p">(</span><span class="s">&quot;0&quot;</span><span class="w"> </span>SubStr<span class="p">(</span>c<span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="p">((</span>n<span class="o">=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span>chars<span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span>chars<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">((</span>n<span class="o">=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>chars<span class="w"> </span><span class="p">(</span>RegExMatch<span class="p">(</span>chr<span class="p">(</span>c<span class="p">),</span><span class="s">&quot;[^\x0-\x1f\x7f-\xa0]&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>chr<span class="p">(</span>c<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">))</span>
<span class="w">        </span>n<span class="o">:=</span><span class="w"> </span><span class="p">((</span>n<span class="o">=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>n<span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">SetFormat</span><span class="p">,</span>Integer<span class="p">,</span>D
<span class="w">    </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span>n<span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>n<span class="o">!=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">VarSetCapacity</span><span class="p">(</span>spc<span class="p">,(</span><span class="mi">16</span><span class="o">-</span>n<span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
<span class="w">        </span>r<span class="w"> </span><span class="o">:=</span><span class="w"> </span>spc<span class="w"> </span><span class="s">&quot;</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span>chars
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>o<span class="w"> </span>r
<span class="p">}</span>

<span class="c1">; for debugging purposes only - to dump an array use A_Dump(Array)</span>
<span class="nf">A___ArrayInsideView</span><span class="p">(</span>Array<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span>as1<span class="o">:=</span><span class="s">&quot;-------&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span>Array<span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="w">    </span>as2<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">((</span>x<span class="o">:=</span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="s">&quot;uchar&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;\0&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>x
<span class="w">    </span>av<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w">   </span><span class="c1">; Array version</span>
<span class="w">    </span>as<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w">  </span><span class="c1">; ArraySize in bytes    (Structure)</span>

<span class="w">    </span>tl<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w">  </span><span class="c1">; TableLength in bytes</span>
<span class="w">    </span>al<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w">  </span><span class="c1">; ArrayLength in bytes  (Data)</span>
<span class="w">    </span>ec<span class="w">  </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>Array<span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w">  </span><span class="c1">; Element count</span>
<span class="w">    </span>
<span class="w">    </span>offset<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">28</span>
<span class="w">    </span><span class="k">Loop</span><span class="p">,</span><span class="o">%</span><span class="w"> </span><span class="p">(</span>tl<span class="o">-</span>offset<span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span>elms<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&amp;&quot;</span><span class="w"> </span>offset<span class="o">+</span><span class="p">((</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="w">   </span><span class="s">&quot; ptr elm &quot;</span><span class="w"> </span><span class="nb">a_index</span><span class="w"> </span>
<span class="w">                    </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`t</span><span class="s">-&gt;</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="p">(</span>o<span class="o">:=</span>NumGet<span class="p">(</span>Array<span class="p">,</span>offset<span class="o">+</span><span class="p">((</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)))</span><span class="w">   </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">              </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;&amp;&quot;</span><span class="w"> </span>offset<span class="o">+</span><span class="p">((</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="w"> </span><span class="s">&quot; len elm &quot;</span><span class="w"> </span><span class="nb">a_index</span><span class="w"> </span>
<span class="w">                    </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`t</span><span class="s">-&gt;</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="p">(</span>l<span class="o">:=</span>NumGet<span class="p">(</span>Array<span class="p">,</span>offset<span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="p">((</span><span class="nb">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)))</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">        </span>data<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&amp;&quot;</span><span class="w"> </span>o<span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="nb">A___ArrayBin</span><span class="p">(</span>Array<span class="p">,</span>o<span class="p">,</span>l<span class="p">)</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span>out<span class="o">=</span>
<span class="w">        </span><span class="p">(</span>LTrim<span class="w"> </span>
<span class="w">            </span>aSignature<span class="w">    </span><span class="o">&amp;</span><span class="mi">0</span><span class="w">    </span><span class="nv">%as1%</span>
<span class="w">            </span>Terminator<span class="w">    </span><span class="o">&amp;</span><span class="mi">7</span><span class="w">    </span><span class="nv">%as2%</span>
<span class="w">            </span>arrayVersion<span class="w">    </span><span class="o">&amp;</span><span class="mi">8</span><span class="w">    </span><span class="nv">%av%</span>
<span class="w">            </span>tArraySize<span class="w">    </span><span class="o">&amp;</span><span class="mi">12</span><span class="w">    </span><span class="nv">%as%</span>
<span class="w">            </span>tableLength<span class="w">    </span><span class="o">&amp;</span><span class="mi">16</span><span class="w">    </span><span class="nv">%tl%</span>
<span class="w">            </span>arrayLength<span class="w">    </span><span class="o">&amp;</span><span class="mi">20</span><span class="w">    </span><span class="nv">%al%</span>
<span class="w">            </span>elementCount<span class="w">    </span><span class="o">&amp;</span><span class="mi">24</span><span class="w">    </span><span class="nv">%ec%</span>
<span class="w">                        </span>
<span class="w">            </span><span class="nv">%elms%</span>
<span class="w">            </span><span class="nv">%data%</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span>out<span class="w"> </span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">a_array - by derRaphael - exmaple internal table layout</span>

<span class="cm">  &amp;0    (str)     Array()</span>
<span class="cm">  &amp;7    (uchar)    \0</span>
<span class="cm">  &amp;8    (uint)    AHK Array Version Major/Minor ::atm dec 4097 or 0x1001::</span>
<span class="cm"> &amp;12    (uint)    ArraySize in bytes</span>
<span class="cm"> &amp;16    (uint)    TableLength ::subject to change:: will stay reserved</span>
<span class="cm"> &amp;20    (uint)    ArrayLength</span>
<span class="cm"> &amp;24    (uint)    ElementsCount</span>
<span class="cm"> &amp;28    (uint)    Elm1Offset ::In this case &amp;36::</span>
<span class="cm"> &amp;32    (uint)    elm1Length</span>
<span class="cm"> &amp;36     rawdata</span>
<span class="cm">*/</span>
</pre></div>


New Lexer: 
<div class="highlight"><pre><span class="c-Singleline">; Binary AHK Array RC2</span>
<span class="c-Singleline">; (w) by DerRaphael</span>
<span class="c-Singleline">;</span>
<span class="c-Singleline">; Released under the Terms of European Public License (EUPL 1.0)</span>
<span class="c-Singleline">;    see http://ec.europa.eu/idabc/en/document/7330</span>
<span class="c-Singleline">;    for translations in your language.</span>

<span class="n">A_Put</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">Data</span><span class="p">,</span> <span class="n">Index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dSize</span><span class="o">=-</span><span class="mi">1</span><span class="p">){</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span><span class="c-Singleline"> ; No Array ? Do an ArrayInit to get a proper Structure</span>
        <span class="n">A_Init</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span>

    <span class="n">if</span> <span class="p">((</span><span class="n">Index</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">=</span><span class="n">Index</span><span class="p">))</span> <span class="p">{</span>
<span class="w">        </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">GetArrayStats</span>
    
        <span class="n">nSize</span> <span class="o">:=</span> <span class="n">aSize</span><span class="o">+</span><span class="n">dSize</span><span class="o">+</span><span class="mi">8</span><span class="c-Singleline">                         ; calculate new size</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">tmpArray</span><span class="p">,</span> <span class="n">nSize</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span><span class="c-Singleline">            ; create tmpArray for our new data</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmpArray</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Array</span><span class="p">,</span> <span class="n">aSize</span><span class="p">)</span><span class="c-Singleline">            ; Copy entire array to TMP</span>
    
        <span class="nf">NumPut</span><span class="p">(</span><span class="n">nSize</span><span class="p">,</span>       <span class="n">tmpArray</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span><span class="c-Singleline">              ; Update size of array in total</span>
        <span class="nf">NumPut</span><span class="p">(</span><span class="n">tSize</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span>     <span class="n">tmpArray</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="c-Singleline">              ; Update tableLenght</span>
        <span class="nf">NumPut</span><span class="p">(</span><span class="n">oSize</span><span class="o">+</span><span class="n">dSize</span><span class="p">,</span> <span class="n">tmpArray</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="c-Singleline">              ; Update length of new ArrayStructure</span>
        <span class="nf">NumPut</span><span class="p">(</span><span class="n">ElmCount</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>  <span class="n">tmpArray</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span><span class="c-Singleline">              ; Update elementcount</span>
    
        <span class="n">A_ArrayMM</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">tmpArray</span> <span class="o">+</span> <span class="n">tSize</span> <span class="o">+</span> <span class="mi">8</span><span class="c-Singleline">               ; Shift ArrayData for 8 bytes</span>
                    <span class="p">,</span> <span class="o">&amp;</span><span class="n">Array</span> <span class="o">+</span> <span class="n">tSize</span><span class="p">,</span> <span class="n">oSize</span> <span class="p">)</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmpArray</span><span class="o">+</span><span class="n">aSize</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="o">&amp;</span><span class="n">Data</span><span class="p">,</span><span class="n">dSize</span><span class="p">)</span><span class="c-Singleline">       ; copy data to tmpArray</span>
    
        <span class="n">Offset</span> <span class="o">:=</span> <span class="mi">28</span><span class="c-Singleline">                                   ; move offsets for array contents</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span> <span class="o">%</span> <span class="n">ElmCount</span><span class="o">+</span><span class="mi">1</span>
            <span class="nf">NumPut</span><span class="p">(</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">tmpArray</span>
                    <span class="p">,(</span><span class="n">Offset</span><span class="o">+</span><span class="p">(</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">8</span><span class="c-Singleline">         ; get last known value and </span>
                    <span class="p">,</span><span class="n">tmpArray</span><span class="p">,(</span><span class="n">Offset</span><span class="o">+</span><span class="p">(</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="c-Singleline">  ; increment it by 8</span>

        <span class="nf">NumPut</span><span class="p">(</span><span class="n">aSize</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">tmpArray</span><span class="p">,</span> <span class="n">tSize</span><span class="p">)</span><span class="c-Singleline">               ; Set offsetpointer to new data</span>
        <span class="nf">NumPut</span><span class="p">(</span><span class="n">dSize</span><span class="p">,</span> <span class="n">tmpArray</span><span class="p">,</span> <span class="n">tSize</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="c-Singleline">               ; Set size of new element</span>

        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">nSize</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="c-Singleline">                 ; Resize the array</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Array</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmpArray</span><span class="p">,</span> <span class="n">nSize</span><span class="p">)</span><span class="c-Singleline">            ; copy tmpArray back to array</span>

<span class="w">        </span><span class="nb">Return</span> <span class="n">ElmCount</span><span class="o">+</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="n">if</span> <span class="p">((</span><span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">Index</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">Index</span><span class="o">!=</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
<span class="w">        </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">GetArrayStats</span>
        
        <span class="n">ElmPtr</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">28</span><span class="o">+</span><span class="p">(</span><span class="n">Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">ElmSize</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">32</span><span class="o">+</span><span class="p">(</span><span class="n">Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="n">if</span> <span class="p">((</span><span class="n">dSize</span><span class="o">&gt;</span><span class="n">ElmSize</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">dSize</span><span class="o">&lt;</span><span class="n">ElmSize</span><span class="p">))</span> <span class="p">{</span><span class="c-Singleline">      ; Fix table offsets to new size</span>
    
            <span class="n">OffSet</span>  <span class="o">:=</span> <span class="mi">28</span><span class="o">+</span><span class="n">Index</span><span class="o">*</span><span class="mi">8</span><span class="c-Singleline">                      ; GetStarting offset in table</span>
            <span class="n">ptrDiff</span> <span class="o">:=</span> <span class="n">dSize</span><span class="o">-</span><span class="n">ElmSize</span><span class="c-Singleline">                   ; Get difference</span>

            <span class="n">nSize</span> <span class="o">:=</span> <span class="n">aSize</span><span class="o">+</span><span class="n">ptrDiff</span><span class="c-Singleline">                     ; calculate new size</span>
            <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">tmpArray</span><span class="p">,</span> <span class="n">nSize</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span><span class="c-Singleline">        ; create tmpArray for our new data</span>
            <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmpArray</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Array</span><span class="c-Singleline">                ; Copy entire array to TMP</span>
                <span class="p">,</span> <span class="p">((</span><span class="n">aSize</span><span class="o">&gt;</span><span class="n">nSize</span><span class="p">)</span> <span class="o">?</span> <span class="n">nSize</span> <span class="o">:</span> <span class="n">aSize</span><span class="p">))</span><span class="c-Singleline">     ; with a correct calculated length</span>
            <span class="nf">NumPut</span><span class="p">(</span><span class="n">nSize</span><span class="p">,</span> <span class="n">tmpArray</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span><span class="c-Singleline">                ; Update size of array in total</span>
            <span class="nf">NumPut</span><span class="p">(</span><span class="n">oSize</span><span class="o">+</span><span class="n">ptrDiff</span><span class="p">,</span> <span class="n">tmpArray</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="c-Singleline">        ; Update length of new ArrayStructure</span>
            <span class="nf">NumPut</span><span class="p">(</span><span class="n">dSize</span><span class="p">,</span> <span class="n">tmpArray</span><span class="p">,</span> <span class="n">Offset</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="c-Singleline">          ; Set size of new element</span>

<span class="w">            </span><span class="nb">Loop</span><span class="p">,</span><span class="o">%</span> <span class="n">ElmCount</span><span class="o">-</span><span class="n">Index</span><span class="c-Singleline">                      ; loop remaining elements</span>
                <span class="nf">NumPut</span><span class="p">(</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">tmpArray</span>
                    <span class="p">,(</span><span class="n">Offset</span><span class="o">+</span><span class="p">(</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="n">ptrDiff</span><span class="c-Singleline">   ; get last known value and </span>
                    <span class="p">,</span><span class="n">tmpArray</span><span class="p">,(</span><span class="n">Offset</span><span class="o">+</span><span class="p">(</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span><span class="c-Singleline">  ; add the difference</span>

            <span class="n">Offset</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">tmpArray</span><span class="p">,</span><span class="n">Offset</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmpArray</span><span class="o">+</span><span class="n">Offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Data</span><span class="p">,</span> <span class="n">dSize</span><span class="p">)</span><span class="c-Singleline">  ; Copy new data into tmpArray</span>
            <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmpArray</span><span class="o">+</span><span class="n">Offset</span><span class="o">+</span><span class="n">dSize</span><span class="c-Singleline">           ; remaining ArrayData to new offset</span>
                    <span class="p">,</span> <span class="o">&amp;</span><span class="n">Array</span><span class="o">+</span><span class="n">Offset</span><span class="o">+</span><span class="n">ElmSize</span><span class="p">,</span> <span class="n">aSize</span><span class="o">-</span><span class="p">(</span><span class="n">OffSet</span><span class="o">+</span><span class="n">ElmSize</span><span class="p">))</span>

            <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">nSize</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="c-Singleline">             ; Resize the array</span>
            <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Array</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmpArray</span><span class="p">,</span> <span class="n">nSize</span><span class="p">)</span><span class="c-Singleline">        ; copy tmpArray back to array</span>

        <span class="p">}</span> <span class="n">else</span> <span class="n">if</span> <span class="p">(</span><span class="n">dSize</span><span class="o">=</span><span class="n">ElmSize</span><span class="p">)</span> <span class="p">{</span><span class="c-Singleline">                    ; No need to fix tableoffsets</span>
            <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Array</span><span class="o">+</span><span class="n">ElmPtr</span><span class="p">,</span><span class="o">&amp;</span><span class="n">Data</span><span class="p">,</span><span class="n">dSize</span><span class="p">)</span><span class="c-Singleline">       ; speeeed!</span>
        <span class="p">}</span> <span class="n">else</span> <span class="p">{</span><span class="c-Singleline">                                       ; THIS SHOULD NEVER HAPPEN</span>
            <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;Internal Binary Array Structure Error / Invalid Binary Array Object&quot;</span>
<span class="w">            </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Return</span> <span class="n">ElmCount</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;Binary Array Index Mismatch&quot;</span>
<span class="w">        </span><span class="nb">Return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span>

<span class="w">    </span><span class="nl">GetArrayStats:</span>
        <span class="n">ElmCount</span> <span class="o">:=</span> <span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="c-Singleline">       ; update ElementCount</span>
        <span class="n">aSize</span>    <span class="o">:=</span> <span class="n">A_Size</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="c-Singleline">        ; current ByteSize of entire Array</span>
        <span class="n">oSize</span>    <span class="o">:=</span> <span class="n">A_Length</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="c-Singleline">      ; current ByteSize of contained data in Array</span>
        <span class="n">tSize</span>    <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span><span class="c-Singleline">     ; table size</span>
        <span class="n">If</span> <span class="p">(</span><span class="n">dSize</span><span class="o">&lt;=-</span><span class="mi">1</span><span class="p">)</span><span class="c-Singleline">                   ; No size given - assume it&#39;s a string and fix it!</span>
            <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">dSize</span><span class="p">)</span>
<span class="w">    </span><span class="nb">return</span>
<span class="p">}</span>

<span class="n">A_Get</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span> <span class="n">Index</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="n">if</span> <span class="p">((</span><span class="n">Index</span><span class="o">&gt;</span><span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">Index</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;Binary Array Index mismatch - no such Index&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">Offset</span>  <span class="o">:=</span> <span class="mi">28</span><span class="o">+</span><span class="p">(</span><span class="n">Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="c-Singleline">                      ; Get starting offset in table</span>
        <span class="n">ElmPtr</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">Offset</span><span class="p">)</span>
        <span class="n">ElmSize</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">Offset</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>

        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">ArrayElement</span><span class="p">,</span><span class="n">ElmSize</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="c-Singleline">        ; Initialise the returnbuffer</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ArrayElement</span><span class="p">,</span><span class="o">&amp;</span><span class="n">Array</span><span class="o">+</span><span class="n">ElmPtr</span><span class="p">,</span><span class="n">ElmSize</span><span class="p">)</span><span class="c-Singleline"> ; Copy the binary data</span>
        
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">ElmSize</span>
<span class="w">        </span><span class="nb">Return</span> <span class="n">ArrayElement</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Returns a joined string of given Array and glue parameter</span>
<span class="c-Singleline">; Length is returned as ErrorLevel</span>
<span class="n">A_Implode</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span> <span class="n">glue</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">lGlue</span>      <span class="o">:=</span> <span class="n">glue</span>
        <span class="n">glueLength</span> <span class="o">:=</span> <span class="nf">StrLen</span><span class="p">(</span><span class="n">lGlue</span><span class="p">)</span>
        <span class="n">aSize</span>      <span class="o">:=</span> <span class="n">A_Length</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="c-Singleline">                  ; current DataSize of array</span>
        <span class="n">elmCount</span>   <span class="o">:=</span> <span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="c-Singleline">                   ; get ElementCount of Array</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="p">(</span><span class="n">elmCount</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">glueLength</span> <span class="o">+</span> <span class="n">aSize</span><span class="c-Singleline">  ; count new Size of returnString</span>
        <span class="n">Offset</span>     <span class="o">:=</span> <span class="mi">0</span><span class="c-Singleline">                                ; set Offset for A_ArrayMM Loop</span>

        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">String</span><span class="p">,</span><span class="nv">ErrorLevel</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="c-Singleline">           ; Allocate space for new return</span>

<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span><span class="o">%</span> <span class="n">elmCount</span>
        <span class="p">{</span>
            <span class="n">elmLength</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">32</span><span class="o">+</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="c-Singleline">  ; current element&#39;s length</span>
            <span class="n">elmPos</span>     <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">28</span><span class="o">+</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="c-Singleline">  ; current element&#39;s position in Array</span>
            <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">String</span><span class="o">+</span><span class="n">Offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Array</span><span class="o">+</span><span class="n">elmPos</span><span class="p">,</span> <span class="n">elmLength</span><span class="p">)</span><span class="c-Singleline">  ; Move it to ReturnData</span>
            <span class="n">Offset</span>     <span class="o">+=</span> <span class="n">elmLength</span><span class="c-Singleline">                       ; calculate Offset</span>
            <span class="n">if</span> <span class="p">(</span><span class="nv">A_Index</span><span class="o">!=</span><span class="n">elmCount</span><span class="p">)</span>
                <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">String</span><span class="o">+</span><span class="n">Offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lGlue</span><span class="p">,</span> <span class="n">glueLength</span><span class="p">)</span><span class="c-Singleline"> ; Move Glue to ReturnData</span>
            <span class="n">Offset</span>     <span class="o">+=</span> <span class="n">glueLength</span><span class="c-Singleline">                      ; calculate Offset again</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">return</span> <span class="n">String</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Returns an array of strings, each of which is a substring of string formed </span>
<span class="c-Singleline">; by splitting it on boundaries formed by the string delimiter. </span>
<span class="c-Singleline">; unlike Stringsplit, multiple chars are allowed in dString</span>
<span class="n">A_Explode</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span> <span class="n">dString</span><span class="p">,</span> <span class="n">sString</span><span class="p">,</span> <span class="n">Limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trimChars</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">trimCharsIsRegEx</span><span class="o">=</span><span class="nv">False</span><span class="p">,</span> <span class="n">dStringIsRegEx</span><span class="o">=</span><span class="nv">False</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">if</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span>
        <span class="n">A_Init</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span>

    <span class="n">oIF</span> <span class="o">:=</span> <span class="nv">A_FormatInteger</span><span class="c-Singleline">            ; Store current Integerformat</span>
<span class="w">    </span><span class="nb">SetFormat</span><span class="p">,</span><span class="n">Integer</span><span class="p">,</span><span class="n">H</span>

    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">trimCharsIsRegEx</span><span class="p">)</span> <span class="p">{</span><span class="c-Singleline">          ; Build RegExNeedle for trimming if non given</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span><span class="n">Parse</span><span class="p">,</span><span class="n">TrimChars</span><span class="c-Singleline">          ; parse each char and build hexescaped needle</span>
            <span class="n">escTrimChars</span> <span class="o">.=</span>  <span class="s">&quot;|^\&quot;</span> <span class="nf">SubStr</span><span class="p">(</span><span class="nf">asc</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="s">&quot;|\&quot;</span> <span class="nf">SubStr</span><span class="p">(</span><span class="nf">asc</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="s">&quot;$&quot;</span>
        <span class="n">trimChars</span> <span class="o">:=</span> <span class="s">&quot;(&quot;</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">escTrimChars</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="s">&quot;)&quot;</span>
    <span class="p">}</span>

    <span class="n">gLen</span> <span class="o">:=</span> <span class="nf">StrLen</span><span class="p">(</span><span class="n">dString</span><span class="p">)</span><span class="c-Singleline">           ; get length of delimiterString</span>
    <span class="n">sLen</span> <span class="o">:=</span> <span class="nf">StrLen</span><span class="p">(</span><span class="n">sString</span><span class="p">)</span><span class="c-Singleline">           ; get length of string</span>
<span class="c-Singleline">                                      ; since this is not a byref parameter,</span>
<span class="c-Singleline">                                      ; binary values need to be assigned direct in call such as </span>
<span class="c-Singleline">                                      ; A_Explode(Array,&quot;\x0&quot;,FileGetContent(&quot;myfile.dat&quot;),&quot;&quot;,0,1)</span>

    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">dStringIsRegEx</span><span class="p">)</span> <span class="p">{</span><span class="c-Singleline">            ; Build RegExNeedle for matching if non given</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span><span class="n">Parse</span><span class="p">,</span><span class="n">dString</span><span class="c-Singleline">            ; parse each char and build hexescaped needle</span>
            <span class="n">escdString</span> <span class="o">.=</span>  <span class="s">&quot;|\&quot;</span> <span class="nf">SubStr</span><span class="p">(</span><span class="nf">asc</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dString</span> <span class="o">:=</span> <span class="s">&quot;(&quot;</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">escdString</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="s">&quot;)&quot;</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">SetFormat</span><span class="p">,</span><span class="n">Integer</span><span class="p">,</span><span class="o">%</span> <span class="n">oIF</span>

<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span>
        <span class="n">if</span> <span class="p">(</span><span class="n">nPos</span> <span class="o">:=</span> <span class="nf">RegExMatch</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span><span class="n">dString</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">sLen</span> <span class="o">-=</span> <span class="n">nPos</span><span class="c-Singleline">                                         ; calculate new length</span>
            <span class="n">data</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span><span class="s">&quot;(.{&quot;</span> <span class="n">sLen</span><span class="o">+</span><span class="n">gLen</span> <span class="s">&quot;}$)&quot;</span><span class="p">)</span><span class="c-Singleline">  ; generate data to store in Array</span>
            <span class="n">_tmp</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">dLen</span><span class="p">)</span><span class="c-Singleline">               ; fix length for data</span>
            <span class="n">sString</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span><span class="s">&quot;(^.{&quot;</span> <span class="n">nPos</span> <span class="s">&quot;})&quot;</span><span class="p">)</span><span class="c-Singleline">    ; generate new sourceString</span>
            <span class="n">_tmp</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">sLen</span><span class="p">)</span><span class="c-Singleline">            ; fix length for binary Arrays</span>
            <span class="n">A_Put</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dLen</span><span class="p">)</span><span class="c-Singleline">                            ; store to Array</span>
        <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
            <span class="n">A_Put</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">sString</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">sLen</span><span class="p">)</span>
<span class="w">            </span><span class="nb">Break</span>
        <span class="p">}</span>
<span class="w">    </span><span class="nb">return</span> <span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Deletes ItemIndex of given Array</span>
<span class="n">A_Del</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span> <span class="n">Item</span><span class="o">=-</span><span class="mi">1</span><span class="p">){</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="n">if</span> <span class="p">((</span><span class="n">Item</span><span class="o">+</span><span class="mi">0</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">Item</span><span class="o">&gt;</span><span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid Index&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">aSize</span>      <span class="o">:=</span> <span class="n">A_Size</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="c-Singleline">                    ; current DataSize of Array</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">tmpArray</span><span class="p">,</span> <span class="n">aSize</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmpArray</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Array</span><span class="p">,</span> <span class="n">aSize</span><span class="p">)</span><span class="c-Singleline">            ; copy Array</span>

        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="c-Singleline">                        ; delete Old Array</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span><span class="o">%</span> <span class="n">A_Count</span><span class="p">(</span><span class="n">tmpArray</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">elmData</span>   <span class="o">:=</span> <span class="n">A_Get</span><span class="p">(</span><span class="n">tmpArray</span><span class="p">,</span><span class="nv">A_Index</span><span class="p">)</span>
            <span class="n">if</span> <span class="p">(</span><span class="nv">A_Index</span><span class="o">!=</span><span class="n">Item</span><span class="p">)</span>
                <span class="n">A_Put</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">elmData</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">ErrorLevel</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">data</span>  <span class="o">:=</span> <span class="n">A_Get</span><span class="p">(</span><span class="n">tmpArray</span><span class="p">,</span><span class="n">Item</span><span class="p">)</span><span class="c-Singleline">                  ; Get return data</span>
        <span class="n">size</span>  <span class="o">:=</span> <span class="nv">ErrorLevel</span><span class="c-Singleline">                            ; store size for reuse</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="c-Singleline">                          ; prepare element</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span><span class="c-Singleline">                   ; copy data to return var</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">size</span><span class="c-Singleline">                             ; update ErrorLevel</span>
<span class="w">        </span><span class="nb">Return</span> <span class="n">out</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Returns the element off the end of array and removes it</span>
<span class="c-Singleline">; Length is returned as ErrorLevel</span>
<span class="n">A_Pop</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">){</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">Item</span> <span class="o">:=</span> <span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span>
        <span class="n">data</span>  <span class="o">:=</span> <span class="n">A_Del</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">Item</span><span class="p">)</span><span class="c-Singleline">                     ; Get return data</span>
        <span class="n">size</span>  <span class="o">:=</span> <span class="nv">ErrorLevel</span><span class="c-Singleline">                            ; store size for reuse</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="c-Singleline">                          ; prepare element</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span><span class="c-Singleline">                   ; copy data to return var</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">size</span><span class="c-Singleline">                             ; update ErrorLevel</span>
<span class="w">        </span><span class="nb">Return</span> <span class="n">out</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Shift an element off the beginning of array and returns it</span>
<span class="c-Singleline">; Length is returned as ErrorLevel</span>
<span class="n">A_Shift</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">){</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">Item</span> <span class="o">:=</span> <span class="mi">1</span>
        <span class="n">data</span>  <span class="o">:=</span> <span class="n">A_Del</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">Item</span><span class="p">)</span><span class="c-Singleline">                     ; Get return data</span>
        <span class="n">size</span>  <span class="o">:=</span> <span class="nv">ErrorLevel</span><span class="c-Singleline">                            ; store size for reuse</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="c-Singleline">                          ; prepare element</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
        <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span><span class="c-Singleline">                   ; copy data to return var</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">size</span><span class="c-Singleline">                             ; update ErrorLevel</span>
<span class="w">        </span><span class="nb">Return</span> <span class="n">out</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Swaps element IdxA with element IdxB in given Array</span>
<span class="n">A_Swap</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span> <span class="n">IdxA</span><span class="p">,</span> <span class="n">IdxB</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">elmA</span>  <span class="o">:=</span> <span class="n">A_Get</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">IdxA</span><span class="p">),</span> <span class="n">sizeA</span> <span class="o">:=</span> <span class="nv">ErrorLevel</span>
        <span class="n">elmB</span>  <span class="o">:=</span> <span class="n">A_Get</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">IdxB</span><span class="p">),</span> <span class="n">sizeB</span> <span class="o">:=</span> <span class="nv">ErrorLevel</span>
        <span class="n">A_Put</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">elmB</span><span class="p">,</span><span class="n">idxA</span><span class="p">,</span><span class="n">sizeB</span><span class="p">)</span>
        <span class="n">A_Put</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">elmA</span><span class="p">,</span><span class="n">idxB</span><span class="p">,</span><span class="n">sizeA</span><span class="p">)</span>
<span class="w">        </span><span class="nb">return</span> <span class="nv">true</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; sArray&#39;s given intersection Elements are appended to Array, which</span>
<span class="c-Singleline">; will be created at runtime if neccessary</span>
<span class="n">A_Slice</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">sArray</span><span class="p">,</span> <span class="n">Start</span><span class="p">,</span> <span class="n">End</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">sArray</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid source Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="n">if</span> <span class="p">((</span><span class="n">cnt</span> <span class="o">:=</span> <span class="n">A_Count</span><span class="p">(</span><span class="n">sArray</span><span class="p">))</span> 
                    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">Start</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cnt</span><span class="o">&lt;</span><span class="n">Start</span><span class="p">)</span>
                    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">End</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cnt</span><span class="o">&lt;</span><span class="n">End</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;Wrong Start or End of sArray&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span>
            <span class="n">A_Init</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span>
        <span class="n">startIndex</span> <span class="o">:=</span> <span class="p">(</span><span class="n">Start</span> <span class="o">&gt;</span> <span class="n">End</span><span class="p">)</span><span class="o">?</span> <span class="n">End</span> <span class="o">:</span> <span class="n">Start</span>
        <span class="n">endIndex</span>   <span class="o">:=</span> <span class="p">(</span><span class="n">start</span><span class="o">==</span><span class="n">startIndex</span><span class="p">)</span> <span class="o">?</span> <span class="n">End</span> <span class="o">:</span> <span class="n">Start</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span> <span class="o">%</span> <span class="n">endIndex</span> <span class="o">-</span> <span class="n">StartIndex</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="n">elm</span>  <span class="o">:=</span> <span class="n">A_Get</span><span class="p">(</span><span class="n">sArray</span><span class="p">,</span> <span class="n">StartIndex</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="nv">A_Index</span><span class="p">),</span> <span class="n">size</span> <span class="o">:=</span> <span class="nv">ErrorLevel</span>
            <span class="n">cnt</span> <span class="o">:=</span> <span class="n">A_Put</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">elm</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">cnt</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Appends entire sArray to Array</span>
<span class="n">A_Merge</span><span class="p">(</span><span class="n">Byref</span> <span class="n">Array</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">sArray</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">sArray</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">A_Count</span><span class="p">(</span><span class="n">sArray</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid source Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span>
            <span class="n">A_Init</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span>
        <span class="n">A_Slice</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">sArray</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A_Count</span><span class="p">(</span><span class="n">sArray</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Returns TRUE if Array, FALSE otherwise - Thx, Lexikos</span>
<span class="n">A_Array</span><span class="p">(</span><span class="n">byRef</span> <span class="n">Array</span><span class="p">)</span> <span class="p">{</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">Array</span><span class="o">=</span><span class="s">&quot;Array()&quot;</span> <span class="o">&amp;&amp;</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">28</span> <span class="o">&amp;&amp;</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">=</span><span class="mh">0x1001</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Returns current element count of given array or -1 if no valid binary array</span>
<span class="n">A_Count</span><span class="p">(</span><span class="n">byRef</span> <span class="n">Array</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="w">        </span><span class="nb">Return</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; for internal use only - initialises bytestructure of array</span>
<span class="n">A_Init</span><span class="p">(</span><span class="n">byRef</span> <span class="n">Array</span><span class="p">)</span> <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">    ; ATM 28 Bytes is minimum for AHK binary array structure</span>
    <span class="n">ArraySize</span> <span class="o">:=</span> <span class="mi">28</span> 
    <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">ArraySize</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>

    <span class="n">Array</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>

    <span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x1001</span><span class="p">,</span>    <span class="n">Array</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="c-Singleline">   ; Array version</span>
    <span class="nf">NumPut</span><span class="p">(</span><span class="n">ArraySize</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span><span class="c-Singleline">  ; ArraySize in bytes</span>
    <span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x1c</span><span class="p">,</span>      <span class="n">Array</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="c-Singleline">  ; TableLength in bytes</span>
    <span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span>       <span class="n">Array</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="c-Singleline">  ; ArrayLength in bytes</span>
    <span class="nf">NumPut</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span>       <span class="n">Array</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span><span class="c-Singleline">  ; Element count</span>
<span class="w">    </span><span class="nb">Return</span> <span class="nv">True</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; for internal use only - returns ArrayStructuresize</span>
<span class="n">A_Size</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">){</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="w">        </span><span class="nb">Return</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; for internal use only - returns DataLength of Array</span>
<span class="n">A_Length</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">){</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="w">        </span><span class="nb">Return</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">A_Dump</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">A_Array</span><span class="p">(</span><span class="n">Array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="s">&quot;No valid binary Array&quot;</span>
<span class="w">        </span><span class="nb">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">out</span> <span class="o">:=</span> <span class="s">&quot;Array(&quot;</span> <span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span> <span class="s">&quot;)`n{`n&quot;</span> <span class="n">A_Implode</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="s">&quot;</span><span class="se">`n`t</span><span class="s">=&gt;`t&quot;</span><span class="p">)</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">}`n&quot;</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span><span class="n">parse</span><span class="p">,</span><span class="n">out</span><span class="p">,</span><span class="se">`n</span>
            <span class="n">if</span> <span class="p">((</span><span class="nv">A_Index</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">A_Count</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">&gt;=</span><span class="nv">A_Index</span><span class="p">))</span>
                <span class="n">out</span> <span class="o">.=</span> <span class="s">&quot;   [&quot;</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">2</span> <span class="s">&quot;]&quot;</span> <span class="p">((</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">2</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;</span><span class="se">`t</span><span class="s">=&gt;`t&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="nv">A_LoopField</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">            </span><span class="nb">else</span> 
                <span class="n">out</span> <span class="o">:=</span> <span class="p">((</span><span class="nv">A_Index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nv">A_LoopField</span> <span class="o">:</span> <span class="n">out</span> <span class="nv">A_LoopField</span><span class="p">)</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">        </span><span class="nb">Return</span> <span class="n">out</span>
    <span class="p">}</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; for internal use only - SyntaxSugar for RtlMoveMemory</span>
<span class="n">A_ArrayMM</span><span class="p">(</span><span class="n">Target</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">,</span><span class="n">Target</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">,</span><span class="n">Source</span><span class="p">,</span><span class="s">&quot;uInt&quot;</span><span class="p">,</span><span class="n">Length</span><span class="p">)</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; for debugging purposes only</span>
<span class="n">A___ArrayBin</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">Array</span><span class="p">,</span><span class="n">offset</span><span class="p">,</span><span class="n">length</span><span class="p">){</span>
<span class="w">    </span><span class="nb">SetFormat</span><span class="p">,</span><span class="n">Integer</span><span class="p">,</span><span class="n">h</span>
    <span class="n">n</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span><span class="o">%</span> <span class="n">length</span>
    <span class="p">{</span>
        <span class="n">c</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">offset</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;uchar&quot;</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">.=</span> <span class="nf">SubStr</span><span class="p">(</span><span class="s">&quot;0&quot;</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="s">&quot; &quot;</span> <span class="p">((</span><span class="n">n</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;</span><span class="se">`t</span><span class="s">&quot;</span> <span class="n">chars</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span> <span class="p">)</span>
        <span class="n">chars</span> <span class="o">:=</span> <span class="p">((</span><span class="n">n</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="n">chars</span> <span class="p">(</span><span class="nf">RegExMatch</span><span class="p">(</span><span class="nf">chr</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="s">&quot;[^\x0-\x1f\x7f-\xa0]&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nf">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;.&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="nl">n:</span><span class="o">=</span> <span class="p">((</span><span class="n">n</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">SetFormat</span><span class="p">,</span><span class="n">Integer</span><span class="p">,</span><span class="n">D</span>
    <span class="n">if</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">spc</span><span class="p">,(</span><span class="mi">16</span><span class="o">-</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">:=</span> <span class="n">spc</span> <span class="s">&quot;</span><span class="se">`t</span><span class="s">&quot;</span> <span class="n">chars</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">return</span> <span class="n">o</span> <span class="n">r</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; for debugging purposes only - to dump an array use A_Dump(Array)</span>
<span class="n">A___ArrayInsideView</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">A_ArrayMM</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">as1</span><span class="o">:=</span><span class="s">&quot;-------&quot;</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Array</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">as2</span> <span class="o">:=</span> <span class="p">((</span><span class="n">x</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span><span class="s">&quot;uchar&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;\0&quot;</span> <span class="o">:</span> <span class="n">x</span>
    <span class="n">av</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="c-Singleline">   ; Array version</span>
    <span class="n">as</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span><span class="c-Singleline">  ; ArraySize in bytes    (Structure)</span>

    <span class="n">tl</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="c-Singleline">  ; TableLength in bytes</span>
    <span class="n">al</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="c-Singleline">  ; ArrayLength in bytes  (Data)</span>
    <span class="n">ec</span>  <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span><span class="c-Singleline">  ; Element count</span>
    
    <span class="n">offset</span> <span class="o">:=</span> <span class="mi">28</span>
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span><span class="o">%</span> <span class="p">(</span><span class="n">tl</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>
    <span class="p">{</span>
        <span class="n">elms</span> <span class="o">.=</span> <span class="s">&quot;&amp;&quot;</span> <span class="n">offset</span><span class="o">+</span><span class="p">((</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>   <span class="s">&quot; ptr elm &quot;</span> <span class="nv">a_index</span> 
                    <span class="o">.</span> <span class="s">&quot;</span><span class="se">`t</span><span class="s">-&gt;`t&quot;</span> <span class="p">(</span><span class="n">o</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">offset</span><span class="o">+</span><span class="p">((</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)))</span>   <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
              <span class="o">.</span> <span class="s">&quot;&amp;&quot;</span> <span class="n">offset</span><span class="o">+</span><span class="p">((</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span> <span class="s">&quot; len elm &quot;</span> <span class="nv">a_index</span> 
                    <span class="o">.</span> <span class="s">&quot;</span><span class="se">`t</span><span class="s">-&gt;`t&quot;</span> <span class="p">(</span><span class="n">l</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">offset</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="p">((</span><span class="nv">A_index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">)))</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
        <span class="n">data</span> <span class="o">.=</span> <span class="s">&quot;&amp;&quot;</span> <span class="n">o</span> <span class="s">&quot;: &quot;</span> <span class="n">A___ArrayBin</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
    <span class="p">}</span>
    
    <span class="n">out</span><span class="o">=</span>
<span class="w">        </span><span class="g">(LTrim </span>
<span class="g">            aSignature    &amp;0    %as1%</span>
<span class="g">            Terminator    &amp;7    %as2%</span>
<span class="g">            arrayVersion    &amp;8    %av%</span>
<span class="g">            tArraySize    &amp;12    %as%</span>
<span class="g">            tableLength    &amp;16    %tl%</span>
<span class="g">            arrayLength    &amp;20    %al%</span>
<span class="g">            elementCount    &amp;24    %ec%</span>
<span class="g">                        </span>
<span class="g">            %elms%</span>
<span class="g">            %data%</span>
<span class="g">        )</span>

<span class="w">    </span><span class="nb">return</span> <span class="n">out</span> 
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">a_array - by derRaphael - exmaple internal table layout</span>

<span class="cm">  &amp;0    (str)     Array()</span>
<span class="cm">  &amp;7    (uchar)    \0</span>
<span class="cm">  &amp;8    (uint)    AHK Array Version Major/Minor ::atm dec 4097 or 0x1001::</span>
<span class="cm"> &amp;12    (uint)    ArraySize in bytes</span>
<span class="cm"> &amp;16    (uint)    TableLength ::subject to change:: will stay reserved</span>
<span class="cm"> &amp;20    (uint)    ArrayLength</span>
<span class="cm"> &amp;24    (uint)    ElementsCount</span>
<span class="cm"> &amp;28    (uint)    Elm1Offset ::In this case &amp;36::</span>
<span class="cm"> &amp;32    (uint)    elm1Length</span>
<span class="cm"> &amp;36     rawdata</span>
<span class="cm">*/</span>
</pre></div>
