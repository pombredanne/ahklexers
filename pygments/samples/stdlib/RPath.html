<LINK href="styles.css" rel="stylesheet" type="text/css"><div class="highlight"><pre><span class="c-Singleline">; RelativePath &amp; AbsolutePath by toralf and Titan</span>
<span class="c-Singleline">; http://www.autohotkey.com/forum/topic19489.html</span>

<span class="c-Singleline">; Original: RelativePath</span>
<span class="n">RPath_Relative</span><span class="p">(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="n">SlavePath</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s">&quot;\&quot;</span><span class="p">){</span>
    <span class="n">len</span> <span class="o">:=</span> <span class="nf">InStr(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nf">InStr(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="n">s</span> <span class="o">.</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="c-Singleline"> ;get server or drive string length</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">SubStr(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">len</span> <span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="nf">SubStr(</span><span class="n">SlavePath</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">len</span> <span class="p">)</span><span class="c-Singleline">  ;different server or drive</span>
<span class="w">        </span><span class="nb">Return</span> <span class="n">SlavePath</span><span class="c-Singleline">                                              ;return absolut path</span>
    <span class="n">MasterPath</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span><span class="c-Singleline">                    ;remove server or drive from MasterPath</span>
    <span class="n">SlavePath</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">SlavePath</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span><span class="c-Singleline">                      ;remove server or drive from SlavePath</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">InStr(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="nf">StrLen(</span><span class="n">MasterPath</span><span class="p">)</span><span class="c-Singleline">           ;remove last \ from MasterPath if any</span>
<span class="w">        </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">MasterPath</span><span class="p">,</span> <span class="n">MasterPath</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">InStr(</span><span class="n">SlavePath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="nf">StrLen(</span><span class="n">SlavePath</span><span class="p">)</span><span class="c-Singleline">             ;remove last \ from SlavePath if any</span>
<span class="w">        </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">SlavePath</span><span class="p">,</span> <span class="n">SlavePath</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">Loop</span><span class="p">{</span>
        <span class="n">If</span> <span class="o">!</span><span class="n">MasterPath</span><span class="c-Singleline">                                            ;when there is nothing didentical</span>
<span class="w">            </span><span class="nb">Return</span> <span class="n">s</span> <span class="n">SlavePath</span><span class="c-Singleline">                                         ;return SlavePath in root</span>
<span class="w">        </span><span class="nb">If </span><span class="nf">InStr(</span><span class="n">SlavePath</span> <span class="n">s</span><span class="p">,</span> <span class="n">MasterPath</span> <span class="n">s</span><span class="p">){</span><span class="c-Singleline">                      ;when parts of paths match</span>
            <span class="n">If</span> <span class="o">!</span><span class="n">r</span><span class="c-Singleline">                                                      ;no relative part yet</span>
                <span class="n">r</span> <span class="o">=</span> <span class="o">.</span><span class="nv">%s%</span><span class="c-Singleline">                                                   ;SlavePath is in the MasterPath</span>
<span class="w">            </span><span class="nb">Return</span> <span class="n">r</span> <span class="o">.</span> <span class="nf">SubStr(</span><span class="n">SlavePath</span><span class="p">,</span><span class="nf">StrLen(</span><span class="n">MasterPath</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="c-Singleline">        ;return relative path</span>
        <span class="p">}</span><span class="n">Else</span><span class="p">{</span><span class="c-Singleline">                                                    ;otherwise</span>
            <span class="n">r</span> <span class="o">.=</span> <span class="s">&quot;..&quot;</span> <span class="n">s</span><span class="c-Singleline">                                                ;add relative part</span>
            <span class="n">MasterPath</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nf">InStr(</span><span class="n">MasterPath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="c-Singleline">   ;remove one folder from MasterPath</span>
          <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; Original: AbsolutePath</span>
<span class="n">RPath_Absolute</span><span class="p">(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="n">RelativePath</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s">&quot;\&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">len</span> <span class="o">:=</span> <span class="nf">InStr(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nf">InStr(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="n">s</span> <span class="o">.</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="c-Singleline">   ;get server or drive string length</span>
    <span class="n">pr</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">len</span><span class="p">)</span><span class="c-Singleline">                                     ;get server or drive name</span>
    <span class="n">AbsolutPath</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="c-Singleline">                           ;remove server or drive from AbsolutPath</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">InStr(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="nf">StrLen(</span><span class="n">AbsolutPath</span><span class="p">)</span><span class="c-Singleline">                 ;remove last \ from AbsolutPath if any</span>
<span class="w">        </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">AbsolutPath</span><span class="p">,</span> <span class="n">AbsolutPath</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">InStr(</span><span class="n">RelativePath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="nf">StrLen(</span><span class="n">RelativePath</span><span class="p">)</span><span class="c-Singleline">               ;remove last \ from RelativePath if any</span>
<span class="w">        </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">RelativePath</span><span class="p">,</span> <span class="n">RelativePath</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">InStr(</span><span class="n">RelativePath</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="c-Singleline">                                         ;when first char is \ go to AbsolutPath of server or drive</span>
        <span class="n">AbsolutPath</span> <span class="o">:=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">RelativePath</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">RelativePath</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="c-Singleline">            ;set AbsolutPath to nothing and remove one char from RelativePath</span>
<span class="w">    </span><span class="nb">Else</span> <span class="n">If</span> <span class="nf">InStr(</span><span class="n">RelativePath</span><span class="p">,</span><span class="s">&quot;.&quot;</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="c-Singleline">                                 ;when first two chars are .\ add to current AbsolutPath directory</span>
        <span class="n">RelativePath</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">RelativePath</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="c-Singleline">                               ;remove two chars from RelativePath</span>
<span class="w">    </span><span class="nb">Else</span> <span class="p">{</span><span class="c-Singleline">                                                                ;otherwise</span>
<span class="w">        </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">RelativePath</span><span class="p">,</span> <span class="n">RelativePath</span><span class="p">,</span> <span class="o">..</span><span class="nv">%s%</span><span class="p">,</span> <span class="p">,</span> <span class="n">UseErrorLevel</span><span class="c-Singleline">     ;remove all ..\ from RelativePath</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span> <span class="nv">%ErrorLevel%</span><span class="c-Singleline">                                                    ;for all ..\</span>
            <span class="n">AbsolutPath</span> <span class="o">:=</span> <span class="nf">SubStr(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nf">InStr(</span><span class="n">AbsolutPath</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="c-Singleline">  ;remove one folder from AbsolutPath</span>
      <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span><span class="p">,</span> <span class="n">pr</span> <span class="o">.</span> <span class="n">AbsolutPath</span> <span class="o">.</span> <span class="n">s</span> <span class="o">.</span> <span class="n">RelativePath</span><span class="c-Singleline">                             ;concatenate server + AbsolutPath + separator + RelativePath</span>
  <span class="p">}</span>
</pre></div>
