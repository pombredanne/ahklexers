<LINK href="styles.css" rel="stylesheet" type="text/css"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>

<span class="cm">Title: Basic ini string functions</span>
<span class="cm">    Operate on variables instead of files. An easy to use ini parser.</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>

<span class="cm">License:</span>

<span class="cm">(C) Copyright 2009, 2010 Tuncay</span>
<span class="cm">    </span>
<span class="cm">This program is free software; you can redistribute it and/or modify</span>
<span class="cm">it under the terms of the GNU Lesser General Public License as published by</span>
<span class="cm">the Free Software Foundation; either version 3 of the License, or</span>
<span class="cm">(at your option) any later version.</span>

<span class="cm">This program is distributed in the hope that it will be useful,</span>
<span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">GNU Lesser General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU Lesser General Public License</span>
<span class="cm">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="cm">(see lgplv3.png)</span>

<span class="cm">See the file COPYING.txt and COPYING.LESSER.txt for license and copying conditions.</span>

<span class="cm">About: Introduction</span>

<span class="cm">    Ini files are used mostly as configuration files. In general, they have the</span>
<span class="cm">    &quot;.ini&quot;-extension. It is a simple standardized organization of text data. </span>
<span class="cm">    Many other simple programs use them for storing text.    </span>
<span class="cm">    </span>
<span class="cm">    AutoHotkey provides three commands IniDelete, IniRead and IniWrite. These</span>
<span class="cm">    commands are stable, but they have some disadvantages. First disadvantage</span>
<span class="cm">    is, that they access the file directly. The file on the disk is opened, </span>
<span class="cm">    load into memory and then read or manipulated and then saved with every </span>
<span class="cm">    single command.    </span>

<span class="cm">    With the custom functions I wrote here, the user accessess on variables </span>
<span class="cm">    instead of files. This is super fast, in comparison to disk access. Ini </span>
<span class="cm">    files can be created by Ahk just like any other variable. But Ahk itself </span>
<span class="cm">    does not have any function to operate on ini strings (variables). If you </span>
<span class="cm">    read often from ini file, then this might for you. </span>
<span class="cm">    </span>
<span class="cm">    No other framework or library is required, no special object files are </span>
<span class="cm">    created; just work on ordinary ini file contents or variables. The load</span>
<span class="cm">    and save functions are added for comfort reason and are not really needed.</span>
<span class="cm">    </span>
<span class="cm">    * *First do this:*</span>
<span class="cm">    </span>
<span class="cm">    &gt; FileRead, ini, config.ini</span>
<span class="cm">    </span>
<span class="cm">    * *or load default file with:*</span>
<span class="cm">    </span>
<span class="cm">    &gt; ini_load(ini)</span>
<span class="cm">    </span>
<span class="cm">    * *or create the content yourself:*</span>
<span class="cm">    </span>
<span class="cm">    (Start Code)</span>
<span class="cm">    ini =</span>
<span class="cm">    (</span>
<span class="cm">    [Tip]</span>
<span class="cm">    TimeStamp = 20090716194758</span>
<span class="cm">    [Recent File List]</span>
<span class="cm">    File1=F:\testfile.ahk</span>
<span class="cm">    File2=Z:\tempfile.tmp</span>
<span class="cm">    )</span>
<span class="cm">    (End Code)</span>
<span class="cm">    </span>
<span class="cm">    In this example &quot;Tip&quot; and &quot;Recent File List&quot; are name of the sections. The</span>
<span class="cm">    file consist in this example of 2 sections. Every section contains variables,</span>
<span class="cm">    so called &quot;keys&quot;. Every key is a part of a section. In this example, the </span>
<span class="cm">    section &quot;Tip&quot; have one key &quot;TimeStamp&quot;. And every key has a content, </span>
<span class="cm">    called value. The &quot;TimeStamp&quot; key have the value &quot;20090716194758&quot;.</span>
<span class="cm">    </span>
<span class="cm">    After that, you can access and modify the content of the ini variable with </span>
<span class="cm">    the following functions. But the modifications are only temporary and must </span>
<span class="cm">    me saved to disk. This should be done by overwriting the source (not </span>
<span class="cm">    appending).</span>
<span class="cm">    </span>
<span class="cm">    *Notes*: A keys content (the value) goes until end of line. Any space </span>
<span class="cm">    surroounding the value is at default lost. For best compatibility, the</span>
<span class="cm">    names of section and key should consist of alpha (a-z), num (0-9) and the</span>
<span class="cm">    underscore only. In general, the names are case insensitiv.</span>

<span class="cm">Links:</span>
<span class="cm">    * Discussion: [http://www.autohotkey.com/forum/viewtopic.php?t=46226]</span>
<span class="cm">    * License: [http://www.gnu.org/licenses/lgpl-3.0.html]</span>

<span class="cm">Date:</span>
<span class="cm">    2010-02-05</span>

<span class="cm">Revision:</span>
<span class="cm">    0.15.1</span>
<span class="cm">    </span>
<span class="cm">Status:</span>
<span class="cm">    Stable</span>

<span class="cm">Developers:</span>
<span class="cm">    * Tuncay, [tuncay.d@gmx.de] (Author)</span>
<span class="cm">    * Mystiq (Tester and Co-Author of an important regex)</span>
<span class="cm">    * Fry (Tester)</span>

<span class="cm">License:</span>
<span class="cm">    GNU Lesser General Public License 3.0 or higher [http://www.gnu.org/licenses/lgpl-3.0.html]</span>
<span class="cm">    </span>
<span class="cm">Category:</span>
<span class="cm">    String Manipulation</span>

<span class="cm">Type:</span>
<span class="cm">    Library</span>

<span class="cm">Tested AutoHotkey Version:</span>
<span class="cm">    1.0.48.05</span>

<span class="cm">Tested Platform:</span>
<span class="cm">    2000/XP</span>

<span class="cm">Standalone (such as no need for extern file or library):</span>
<span class="cm">    Yes</span>

<span class="cm">StdLibConform (such as use of prefix and no globals use):</span>
<span class="cm">    Yes</span>

<span class="cm">Related:</span>
<span class="cm">    *Format Specifications (not strictly implemented)*</span>
<span class="cm">    * Wikipedia - INI file [http://en.wikipedia.org/wiki/INI_file]</span>
<span class="cm">    * Cloanto Implementation of INI File Format [http://www.cloanto.com/specs/ini.html]</span>
<span class="cm">    </span>
<span class="cm">    *AutoHotkey Commands*</span>
<span class="cm">    * IniRead: [http://www.autohotkey.com/docs/commands/IniRead.htm]</span>
<span class="cm">    * IniWrite: [http://www.autohotkey.com/docs/commands/IniWrite.htm]</span>
<span class="cm">    * IniDelete: [http://www.autohotkey.com/docs/commands/IniDelete.htm]</span>
<span class="cm">    </span>
<span class="cm">    *Other Community Solutions*</span>
<span class="cm">    * INI Library by Titan: [http://www.autohotkey.com/forum/viewtopic.php?t=26141]</span>
<span class="cm">    * [Class] IniFile by bmcclure: [http://www.autohotkey.com/forum/viewtopic.php?t=41506]</span>
<span class="cm">    * [module] Ini by majkinetor: [http://www.autohotkey.com/forum/viewtopic.php?t=22495]</span>
<span class="cm">    * Auto read,load and save by Superfraggle: [http://www.autohotkey.com/forum/viewtopic.php?t=21346]</span>
<span class="cm">    * globalsFromIni by Tuncay: [http://www.autohotkey.com/forum/viewtopic.php?t=27928]</span>
<span class="cm">    * Read .INI file in one go by Smurth: [http://www.autohotkey.com/forum/viewtopic.php?t=36601]</span>

<span class="cm">About: Examples</span>
<span class="cm">    </span>
<span class="cm">Usage:</span>
<span class="cm">    </span>
<span class="cm">    (Code)</span>
<span class="cm">    value := ini_getValue(ini, &quot;Section&quot;, &quot;Key&quot;)                    ; &lt;- Get value of a key.</span>
<span class="cm">    value := ini_getValue(ini, &quot;&quot;, &quot;Key&quot;)                           ; &lt;- Get value of first found key.</span>
<span class="cm">    key := ini_getKey(ini, &quot;Section&quot;, &quot;Key&quot;)                        ; &lt;- Get key/value pair.</span>
<span class="cm">    section := ini_getSection(ini, &quot;Section&quot;)                       ; &lt;- Get full section with all keys.</span>
<span class="cm">    </span>
<span class="cm">    ini_replaceValue(ini, &quot;Section&quot;, &quot;Key&quot;, A_Now)                  ; -&gt; Update value of a key.</span>
<span class="cm">    ini_replaceKey(ini, &quot;Section&quot;, &quot;Key&quot;)                           ; -&gt; Delete a key.</span>
<span class="cm">    ini_replaceSection(ini, &quot;Section&quot;, &quot;[Section1]Key1=0`nKey2=1&quot;)  ; -&gt; Replace a section with all its keys.</span>
<span class="cm">    </span>
<span class="cm">    ini_insertValue(ini, &quot;Section&quot;, &quot;Key&quot; &quot;,ListItem&quot;)              ; -&gt; Add a value to existing value.</span>
<span class="cm">    ini_insertKey(ini, &quot;Section&quot;, &quot;Key=&quot; . A_Now)                   ; -&gt; Add a key/value pair.</span>
<span class="cm">    ini_insertSection(ini, &quot;Section&quot;, &quot;Key1=ini`nKey2=Tuncay&quot;)      ; -&gt; Add a section.</span>
<span class="cm">    </span>
<span class="cm">    keys := ini_getAllKeyNames(ini, &quot;Section&quot;)                      ; &lt;- Get a list of all key names.</span>
<span class="cm">    sections := ini_getAllSectionNames(ini)                         ; &lt;- Get a list of all section names.</span>
<span class="cm">    (End Code)</span>
<span class="cm">    </span>
<span class="cm">Sample Script:</span>

<span class="cm">    Simple script for storing and showing how often it was executed.</span>
<span class="cm">    </span>
<span class="cm">    (Code)</span>
<span class="cm">    #NoEnv</span>
<span class="cm">    SendMode Input</span>
<span class="cm">    SetWorkingDir %A_ScriptDir%</span>

<span class="cm">    ; ----- User Configuration -----</span>
<span class="cm">    #Include ini/ini.ahk</span>
<span class="cm">    ConfigFilePath := &quot;settings.ini&quot;</span>


<span class="cm">    ; ----- Main -----</span>
<span class="cm">    IfNotExist, %ConfigFilePath%</span>
<span class="cm">        createConfigFile(ConfigFilePath)</span>
<span class="cm">        </span>
<span class="cm">    FileRead, ini, %ConfigFilePath%</span>
<span class="cm">    value := ini_getValue(ini, &quot;Config&quot;, &quot;Started&quot;)</span>
<span class="cm">    value++</span>
<span class="cm">    ini_replaceValue(ini, &quot;Config&quot;, &quot;Started&quot;, value)</span>
<span class="cm">    updateConfigFile(ConfigFilePath, ini)</span>

<span class="cm">    FileRead, ini, %ConfigFilePath%</span>
<span class="cm">    value := ini_getValue(ini, &quot;Config&quot;, &quot;Started&quot;)</span>
<span class="cm">    MsgBox This script was started %value% time/s.</span>


<span class="cm">    RETURN ; End of AutoExec-section</span>


<span class="cm">    createConfigFile(Path)</span>
<span class="cm">    {</span>
<span class="cm">        Template =</span>
<span class="cm">        (LTrim</span>
<span class="cm">        [Config]</span>
<span class="cm">        Started=0</span>
<span class="cm">        )</span>
<span class="cm">        FileAppend, %Template%, %Path%</span>
<span class="cm">        Return</span>
<span class="cm">    }</span>


<span class="cm">    updateConfigFile(Path, ByRef Content)</span>
<span class="cm">    {</span>
<span class="cm">        FileDelete, %Path%</span>
<span class="cm">        FileAppend, %Content%, %Path%</span>
<span class="cm">        Return</span>
<span class="cm">    }</span>
<span class="cm">    (End Code)</span>

<span class="cm">About: Functions</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - Content of an ini file (also this can be one section</span>
<span class="cm">                        only).</span>
<span class="cm">    Section         - Unique name of the section. Some functions support the</span>
<span class="cm">                        default empty string &quot;&quot;. This leads to look up at </span>
<span class="cm">                        first found section. </span>
<span class="cm">    Key             - Name of the variable under the section.</span>
<span class="cm">    Replacement     - New content to use.</span>
<span class="cm">    PreserveSpace   - Should be set to 1 if spaces around the value of a key</span>
<span class="cm">                        should be saved, otherwise they are lost. The</span>
<span class="cm">                        surrounding single or double quotes are also lost.</span>

<span class="cm">    The &#39;get&#39; functions returns the desired contents without touching the </span>
<span class="cm">    variable.</span>
<span class="cm">    </span>
<span class="cm">    The &#39;replace&#39; and &#39;insert&#39; functions changes the desired content directly</span>
<span class="cm">    and returns 1 for success and 0 otherwise.</span>
<span class="cm">    </span>
<span class="cm">    There are some more type of functions and parameters. But these are not listed</span>
<span class="cm">    here.</span>

<span class="cm">Remarks:</span>
<span class="cm">    On success, ErrorLevel is set to &#39;0&#39;. Otherwise ErrorLevel is set to &#39;1&#39; if</span>
<span class="cm">    key under desired section is not found.</span>
<span class="cm">    </span>
<span class="cm">    The functions are not designed to be used in all situations. On rare </span>
<span class="cm">    conditions, the result could be corrupt or not usable. In example, there </span>
<span class="cm">    is no handling of commas inside the key or section names.</span>
<span class="cm">    Any &quot;\E&quot; would end the literal sequence and switch back to regex. The</span>
<span class="cm">    &quot;\E&quot; sequence is not escaped, because its very uncommon to use backslashes</span>
<span class="cm">    inside key and section names. To workaround this, replace at every key or</span>
<span class="cm">    section name the &quot;\E&quot; part with &quot;\E\\E\Q&quot;:</span>
<span class="cm">    </span>
<span class="cm">    &gt; Name := &quot;Folder\Edit\Test1&quot;</span>
<span class="cm">    &gt; IfInString, Name, \</span>
<span class="cm">    &gt; {</span>
<span class="cm">    &gt;     StringReplace, Name, Name, \E, \E\\E\Q, All</span>
<span class="cm">    &gt; }</span>
<span class="cm">    &gt; MsgBox % ini_getValue(ini, &quot;paths&quot;, Name)</span>

<span class="cm">    This allows us to work with regex, but then at the end it should be closed </span>
<span class="cm">    with &quot;\Q&quot; again.</span>
<span class="cm">    &gt; ; Used regex at keyname: &quot;Time.*&quot;</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Tip&quot;, &quot;\ETime.*\Q&quot;)</span>
<span class="cm">*/</span>


<span class="cm">/*</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>

<span class="cm">Section: Parse</span>

<span class="cm">About: About</span>

<span class="cm">Brief:</span>
<span class="cm">    Main functions for getting, setting and updating section or key.</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">*/</span><span class="c-Singleline"></span>


<span class="c-Singleline">; .............................................................................</span>
<span class="c-Singleline">; Group: Get</span>
<span class="c-Singleline">;   Functions for reading data.</span>
<span class="c-Singleline">; .............................................................................</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_getValue</span>
<span class="cm">    Read and return a value from a key</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. If it is specified to &quot;&quot;, </span>
<span class="cm">                        then section is ignored and first found key is get.</span>
<span class="cm">    Key             - Name of the variable under the section.</span>
<span class="cm">    PreserveSpace   - *Optional* Should be set to 1 if spaces around the value </span>
<span class="cm">                        of a key should be saved, otherwise they are lost. The</span>
<span class="cm">                        surrounding single or double quotes are also lost.</span>
<span class="cm">                        Default is deleting surrounding spaces and quotes.</span>

<span class="cm">Returns:</span>
<span class="cm">    On success the content of desired key is returned, otherwise an empty string.</span>

<span class="cm">Examples:</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Tip&quot;, &quot;TimeStamp&quot;)</span>
<span class="cm">    &gt; MsgBox %value%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; 20090716194758</span>
<span class="cm">*/</span>
<span class="n">ini_getValue</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_PreserveSpace</span> <span class="o">=</span> <span class="nv">False</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">_Section</span> <span class="o">=</span> <span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*</span><span class="p">])</span><span class="o">?</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
         <span class="n">_Section</span> <span class="o">=</span> \<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>
    <span class="p">}</span><span class="c-Singleline"></span>
<span class="c-Singleline">    ; Note: The regex of this function was rewritten by Mystiq.</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">iU</span><span class="p">)(</span><span class="o">?:</span>\<span class="n">R</span><span class="o">|^</span><span class="p">)</span>\<span class="n">s</span><span class="o">*</span><span class="nv">%_Section%</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?:</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*.+</span>\<span class="n">s</span><span class="o">*=</span>\<span class="n">s</span><span class="o">*.*?</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">)</span><span class="o">|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span><span class="p">[;</span><span class="n">#</span><span class="p">]</span><span class="o">.*?</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">))</span><span class="o">*</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">Q</span><span class="nv">%_Key%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*=</span><span class="p">(</span><span class="o">.*</span><span class="p">)(</span><span class="o">?=</span>\<span class="n">R</span><span class="o">|</span><span class="n">$</span><span class="p">)</span>
<span class="cm">/*</span>
<span class="cm">    RegEx := &quot;`aiU)&quot;</span>
<span class="cm">      . &quot;(?:\R|^)\s*&quot; . _Section . &quot;\s*&quot;         ;-- section</span>
<span class="cm">      . &quot;(?:&quot;</span>
<span class="cm">      . &quot;\R\s*&quot;                           ;-- empty lines</span>
<span class="cm">      . &quot;|\R\s*[\w\s]+\s*=\s*.*?\s*(?=\R)&quot;      ;-- OR other key=value pairs</span>
<span class="cm">      . &quot;|\R\s*[;#].*?(?=\R)&quot;                  ;-- OR commented lines</span>
<span class="cm">      . &quot;)*&quot;</span>
<span class="cm">      . &quot;\R\s*\Q&quot; . _Key . &quot;\E\s*=(.*)(?=\R|$)&quot;   ;-- match</span>
<span class="cm">*/</span>
<span class="w">   </span>
<span class="w">    </span><span class="nb">If </span><span class="nf">RegExMatch</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="n">Value</span><span class="p">)</span>
    <span class="p">{</span>
<span class="w">        </span><span class="nb">If </span><span class="n">Not</span> <span class="n">_PreserveSpace</span>
        <span class="p">{</span>
            <span class="n">Value1</span> <span class="o">=</span> <span class="nv">%Value1%</span><span class="c-Singleline"> ; Trim spaces.</span>
            <span class="n">FirstChar</span> <span class="o">:=</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">Value1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">Value1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span>
                <span class="n">OR</span> <span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">Value1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="p">{</span>
<span class="w">                </span><span class="nb">StringTrimLeft</span><span class="p">,</span> <span class="n">Value1</span><span class="p">,</span> <span class="n">Value1</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">                </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">Value1</span><span class="p">,</span> <span class="n">Value1</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">Value1</span> <span class="o">=</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">Value1</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_getKey</span>
<span class="cm">    Read and return a complete key with key name and content.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. If it is specified to &quot;&quot;, </span>
<span class="cm">                        then section is ignored and first found key is get.</span>
<span class="cm">    Key             - Name of the variable under the section.</span>

<span class="cm">Returns:</span>
<span class="cm">    On success the key and value pair in one string is returned, otherwise an empty string.</span>

<span class="cm">Examples:</span>
<span class="cm">    &gt; key := ini_getKey(ini, &quot;Tip&quot;, &quot;TimeStamp&quot;)</span>
<span class="cm">    &gt; MsgBox %key%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; TimeStamp = 20090716194758</span>
<span class="cm">*/</span>
<span class="n">ini_getKey</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">_Section</span> <span class="o">=</span> <span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*</span><span class="p">])</span><span class="o">?</span>
<span class="w">    </span><span class="nb">Else</span>
         <span class="n">_Section</span> <span class="o">=</span> \<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span><span class="c-Singleline"></span>
<span class="c-Singleline">   </span>
<span class="c-Singleline">    ; Note: The regex of this function was rewritten by Mystiq.</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">iU</span><span class="p">)(</span><span class="o">?:</span>\<span class="n">R</span><span class="o">|^</span><span class="p">)</span>\<span class="n">s</span><span class="o">*</span><span class="nv">%_Section%</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?:</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*.+</span>\<span class="n">s</span><span class="o">*=</span>\<span class="n">s</span><span class="o">*.*?</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">)</span><span class="o">|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span><span class="p">[;</span><span class="n">#</span><span class="p">]</span><span class="o">.*?</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">))</span><span class="o">*</span>\<span class="n">R</span><span class="p">(</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">Q</span><span class="nv">%_Key%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*=.*</span><span class="p">)(</span><span class="o">?=</span>\<span class="n">R</span><span class="o">|</span><span class="n">$</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">RegExMatch</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="n">Value</span><span class="p">)</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">Value1</span> <span class="o">=</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">Value1</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_getSection</span>
<span class="cm">    Read and return a complete section with section name.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. (An enmpty string &quot;&quot; is not</span>
<span class="cm">                        working.)</span>

<span class="cm">Returns:</span>
<span class="cm">    On success the entire section in one string is returned, otherwise an empty string.</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; section := ini_getSection(ini, &quot;Tip&quot;)</span>
<span class="cm">    &gt; MsgBox %section% </span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; [Tip]</span>
<span class="cm">    &gt; TimeStamp = 20090716194758</span>
<span class="cm">*/</span>
<span class="n">ini_getSection</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">_Section</span> <span class="o">=</span> <span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*</span><span class="p">])</span><span class="o">?</span>
<span class="w">    </span><span class="nb">Else</span>
         <span class="n">_Section</span> <span class="o">=</span> \<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">isUS</span><span class="p">)</span><span class="o">^.*</span><span class="p">(</span><span class="nv">%_Section%</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">R</span><span class="o">?.*</span><span class="p">)(</span><span class="o">?:</span>\<span class="n">R</span><span class="o">*</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*?|</span>\<span class="n">R</span><span class="p">))</span><span class="o">?</span><span class="n">$</span>
<span class="w">    </span><span class="nb">If </span><span class="nf">RegExMatch</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="n">Value</span><span class="p">)</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">Value1</span> <span class="o">=</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">Value1</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">Func: ini_getAllValues</span>
<span class="cm">    Read and get a new line separated list of all values in one go.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - *Optional* Unique name of the section.</span>
<span class="cm">    Count           - *Variable Optional* The number of found values/keys.</span>

<span class="cm">Returns:</span>
<span class="cm">    On success a comma separated list with all name of keys is returned, </span>
<span class="cm">    otherwise an empty string. If section is specified, only those from that</span>
<span class="cm">    section is returned, otherwise from all sections.</span>

<span class="cm">Remarks:</span>
<span class="cm">    Other than the other getAll-functions list separator, this function uses</span>
<span class="cm">    the new line &quot;`n&quot; character instead the comma &quot;,&quot; for separating values.</span>
<span class="cm">    Also other than the other getValue functions, this does not provide any</span>
<span class="cm">    preserveSpaces option, as it allways preserves surrounding spaces and</span>
<span class="cm">    quotes.</span>

<span class="cm">Examples:</span>
<span class="cm">    &gt; values := ini_getAllValues(ini, &quot;Recent File List&quot;)</span>
<span class="cm">    &gt; MsgBox %values%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; F:\testfile.ahk</span>
<span class="cm">    &gt; Z:\tempfile.tmp</span>
<span class="cm">*/</span>
<span class="n">ini_getAllValues</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_count</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">isUmS</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="o">?=.*</span><span class="p">)(</span><span class="o">?:</span>\<span class="n">s</span><span class="o">*</span>\<span class="p">[</span>\<span class="n">s</span><span class="o">*?.*</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>\<span class="n">s</span><span class="o">*|</span>\<span class="n">s</span><span class="o">*?.+</span>\<span class="n">s</span><span class="o">*?=</span><span class="p">(</span><span class="o">.*</span><span class="p">))(</span><span class="o">?=.*</span><span class="p">)</span><span class="n">$</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">Values</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">ini_getSection</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">),</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1`n&quot;</span><span class="p">,</span> <span class="n">Match</span><span class="p">)</span>
<span class="w">    </span><span class="nb">Else</span>
        <span class="n">Values</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1`n&quot;</span><span class="p">,</span> <span class="n">Match</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="n">Match</span>
    <span class="p">{</span>
        <span class="n">Values</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">Values</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">`a</span><span class="s">S)\R+&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span><span class="p">)</span><span class="c-Singleline"></span>
<span class="c-Singleline">        ; Workaround, sometimes it catches sections. Whitespaces only should be eliminated also.</span>
        <span class="n">Values</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">Values</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">`a</span><span class="s">S)\[.*?]\R+|\R+$|\R+ +$&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> 
<span class="w">        </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">Values</span><span class="p">,</span> <span class="n">Values</span><span class="p">,</span> <span class="se">`n</span><span class="p">,</span> <span class="se">`n</span><span class="p">,</span> <span class="n">UseErrorLevel</span>
        <span class="n">_count</span> <span class="o">:=</span> <span class="nv">ErrorLevel</span> <span class="o">?</span> <span class="nv">ErrorLevel</span> <span class="o">:</span> <span class="mi">0</span>
<span class="w">        </span><span class="nb">StringTrimLeft</span><span class="p">,</span> <span class="n">Values</span><span class="p">,</span> <span class="n">Values</span><span class="p">,</span> <span class="mi">1</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Values</span> <span class="o">=</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">Values</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_getAllKeyNames</span>
<span class="cm">    Read and get a comma separated list of all key names in one go.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - *Optional* Unique name of the section.</span>
<span class="cm">    Count           - *Variable Optional* The number of found keys.</span>

<span class="cm">Returns:</span>
<span class="cm">    On success a comma separated list with all name of keys is returned, </span>
<span class="cm">    otherwise an empty string. If section is specified, only those from that</span>
<span class="cm">    section is returned, otherwise from all sections.</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; keys := ini_getAllKeyNames(ini, &quot;Recent File List&quot;)</span>
<span class="cm">    &gt; MsgBox %keys%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; File1,File2</span>
<span class="cm">*/</span>
<span class="n">ini_getAllKeyNames</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_count</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">isUmS</span><span class="p">)</span><span class="o">^.*</span><span class="p">(</span><span class="o">?:</span>\<span class="n">s</span><span class="o">*</span>\<span class="p">[</span>\<span class="n">s</span><span class="o">*?.*</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>\<span class="n">s</span><span class="o">*|</span>\<span class="n">s</span><span class="o">*?</span><span class="p">(</span><span class="o">.+</span><span class="p">)</span>\<span class="n">s</span><span class="o">*?=.*</span><span class="p">)</span><span class="o">.*</span><span class="n">$</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">KeyNames</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">ini_getSection</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">),</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span><span class="p">,</span> <span class="n">Match</span><span class="p">)</span>
<span class="w">    </span><span class="nb">Else</span>
        <span class="n">KeyNames</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span><span class="p">,</span> <span class="n">Match</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="n">Match</span>
    <span class="p">{</span>
        <span class="n">KeyNames</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">KeyNames</span><span class="p">,</span> <span class="s">&quot;S)\R+&quot;</span><span class="p">,</span> <span class="s">&quot;,&quot;</span><span class="p">)</span><span class="c-Singleline"></span>
<span class="c-Singleline">        ; Workaround, sometimes it catches sections. Whitespaces only should be eliminated also.</span>
        <span class="n">KeyNames</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">KeyNames</span><span class="p">,</span> <span class="s">&quot;S)\[.*?],+|,+$|,+ +&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> 
<span class="w">        </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">KeyNames</span><span class="p">,</span> <span class="n">KeyNames</span><span class="p">,</span> <span class="se">`,</span><span class="p">,</span> <span class="se">`,</span><span class="p">,</span> <span class="n">UseErrorLevel</span>
        <span class="n">_count</span> <span class="o">:=</span> <span class="nv">ErrorLevel</span> <span class="o">?</span> <span class="nv">ErrorLevel</span> <span class="o">:</span> <span class="mi">0</span>
<span class="w">        </span><span class="nb">StringTrimLeft</span><span class="p">,</span> <span class="n">KeyNames</span><span class="p">,</span> <span class="n">KeyNames</span><span class="p">,</span> <span class="mi">1</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">KeyNames</span> <span class="o">=</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">KeyNames</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_getAllSectionNames</span>
<span class="cm">    Read and get a comma separated list of all section names in one go.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Count           - *Variable Optional* The number of found sections.</span>

<span class="cm">Returns:</span>
<span class="cm">    On success a comma separated list with all name of sections is returned, </span>
<span class="cm">    otherwise an empty string.</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; sections := ini_getAllSectionNames(ini)</span>
<span class="cm">    &gt; MsgBox %sections%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; Tip,Recent File List</span>
<span class="cm">*/</span>
<span class="n">ini_getAllSectionNames</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_count</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">isUmS</span><span class="p">)</span><span class="o">^.*</span><span class="p">(</span><span class="o">?:</span>\<span class="n">s</span><span class="o">*</span>\<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span><span class="p">(</span><span class="o">.*</span><span class="p">)</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>\<span class="n">s</span><span class="o">*|.+=.*</span><span class="p">)</span><span class="o">.*</span><span class="n">$</span>
    <span class="n">SectionNames</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span><span class="p">,</span> <span class="n">MatchNum</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="n">MatchNum</span>
    <span class="p">{</span>
        <span class="n">SectionNames</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">SectionNames</span><span class="p">,</span> <span class="s">&quot;S)\R+&quot;</span><span class="p">,</span> <span class="s">&quot;,&quot;</span><span class="p">,</span> <span class="n">_count</span><span class="p">)</span><span class="c-Singleline"></span>
<span class="c-Singleline">        ; Workaround, whitespaces only should be eliminated.</span>
        <span class="n">SectionNames</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">SectionNames</span><span class="p">,</span> <span class="s">&quot;S),+ +&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> 
<span class="w">        </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">SectionNames</span><span class="p">,</span> <span class="n">SectionNames</span><span class="p">,</span> <span class="se">`,</span><span class="p">,</span> <span class="se">`,</span><span class="p">,</span> <span class="n">UseErrorLevel</span>
        <span class="n">_count</span> <span class="o">:=</span> <span class="nv">ErrorLevel</span> <span class="o">?</span> <span class="nv">ErrorLevel</span> <span class="o">:</span> <span class="mi">0</span>
        <span class="n">_count</span> <span class="o">:=</span> <span class="n">_count</span> <span class="o">?</span> <span class="n">_count</span> <span class="o">:</span> <span class="mi">0</span>
<span class="w">        </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">SectionNames</span><span class="p">,</span> <span class="n">SectionNames</span><span class="p">,</span> <span class="mi">1</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">SectionNames</span> <span class="o">=</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">SectionNames</span>
<span class="p">}</span><span class="c-Singleline"></span>


<span class="c-Singleline">; .............................................................................</span>
<span class="c-Singleline">; Group: Replace</span>
<span class="c-Singleline">;   Functions for replacing existing data.</span>
<span class="c-Singleline">; .............................................................................</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_replaceValue</span>
<span class="cm">    Updates the value of a key.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. If it is specified to &quot;&quot;, </span>
<span class="cm">                        then section is ignored and first found key is get.</span>
<span class="cm">    Key             - Name of the variable under the section. </span>
<span class="cm">    Replacement     - *Optional* New content to use. If not specified, the </span>
<span class="cm">                        content will be replaced with no content. That means</span>
<span class="cm">                        it is deleted/set to empty string.</span>
<span class="cm">    PreserveSpace   - *Optional* Should be set to 1 if spaces around the value </span>
<span class="cm">                        of a key should be saved, otherwise they are lost. The</span>
<span class="cm">                        surrounding single or double quotes are also lost.</span>
<span class="cm">                        Default is deleting surrounding spaces.</span>

<span class="cm">Returns:</span>
<span class="cm">    Returns 1 if key is updated to new value, and 0 otherwise (opposite of </span>
<span class="cm">    ErrorLevel). </span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; ini_replaceValue(ini, &quot;Tip&quot;, &quot;TimeStamp&quot;, 2009)</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Tip&quot;, &quot;TimeStamp&quot;)</span>
<span class="cm">    &gt; MsgBox %value%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; 2009</span>
<span class="cm">*/</span>
<span class="n">ini_replaceValue</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Replacement</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">_PreserveSpace</span> <span class="o">=</span> <span class="nv">False</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">_Section</span> <span class="o">=</span> <span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*</span><span class="p">])</span><span class="o">?</span>
<span class="w">    </span><span class="nb">Else</span>
         <span class="n">_Section</span> <span class="o">=</span> \<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>
<span class="w">    </span><span class="nb">If </span><span class="n">Not</span> <span class="n">_PreserveSpace</span>
    <span class="p">{</span>
        <span class="n">_Replacement</span> <span class="o">=</span> <span class="nv">%_Replacement%</span><span class="c-Singleline"> ; Trim spaces.</span>
        <span class="n">FirstChar</span> <span class="o">:=</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">_Replacement</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">If</span> <span class="p">(</span><span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">_Replacement</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span>
            <span class="n">OR</span> <span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">_Replacement</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="p">{</span>
<span class="w">            </span><span class="nb">StringTrimLeft</span><span class="p">,</span> <span class="n">_Replacement</span><span class="p">,</span> <span class="n">_Replacement</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">            </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">_Replacement</span><span class="p">,</span> <span class="n">_Replacement</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="c-Singleline"></span>
<span class="c-Singleline">    ; Note: The regex of this function was written by Mystiq.</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">iU</span><span class="p">)((</span><span class="o">?:</span>\<span class="n">R</span><span class="o">|^</span><span class="p">)</span>\<span class="n">s</span><span class="o">*</span><span class="nv">%_Section%</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?:</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*.+</span>\<span class="n">s</span><span class="o">*=</span>\<span class="n">s</span><span class="o">*.*?</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">)</span><span class="o">|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span><span class="p">[;</span><span class="n">#</span><span class="p">]</span><span class="o">.*?</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">))</span><span class="o">*</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">Q</span><span class="nv">%_Key%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*=</span><span class="p">)</span><span class="o">.*</span><span class="p">((</span><span class="o">?=</span>\<span class="n">R</span><span class="o">|</span><span class="n">$</span><span class="p">))</span>
    <span class="n">_Content</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span> <span class="o">.</span> <span class="n">_Replacement</span> <span class="o">.</span> <span class="s">&quot;$2&quot;</span><span class="p">,</span> <span class="n">isReplaced</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="n">isReplaced</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">Else</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">isReplaced</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_replaceKey</span>
<span class="cm">    Changes complete key with its name and value.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. If it is specified to &quot;&quot;, </span>
<span class="cm">                        then section is ignored and first found key is get.</span>
<span class="cm">    Key             - Name of the variable under the section.</span>
<span class="cm">    Replacement     - *Optional* New content to use. If not specified, the </span>
<span class="cm">                        content will be replaced with no content. That means</span>
<span class="cm">                        it is deleted/set to empty string.</span>
<span class="cm">                      The replacement should contain an equality sign.</span>
<span class="cm">                      (Expected form: &quot;keyName=value&quot;)</span>

<span class="cm">Returns:</span>
<span class="cm">    Returns 1 if key is updated to new value, and 0 otherwise (opposite of </span>
<span class="cm">    ErrorLevel). </span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; ini_replaceKey(ini, &quot;Tip&quot;, &quot;TimeStamp&quot;, &quot;TimeStamp=1980&quot;)</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Tip&quot;, &quot;TimeStamp&quot;)</span>
<span class="cm">    &gt; MsgBox %value%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; 1980</span>
<span class="cm">*/</span>
<span class="n">ini_replaceKey</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Replacement</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">_Section</span> <span class="o">=</span> <span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*</span><span class="p">])</span><span class="o">?</span>
<span class="w">    </span><span class="nb">Else</span>
         <span class="n">_Section</span> <span class="o">=</span> \<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>
<span class="w">    </span><span class="nb">If </span><span class="n">_Replacement</span> <span class="o">!=</span>
    <span class="p">{</span>
        <span class="n">_Replacement</span> <span class="o">=</span> <span class="nv">%_Replacement%</span>
        <span class="n">_Replacement</span> <span class="o">=</span> <span class="se">`n</span><span class="nv">%_Replacement%</span>
    <span class="p">}</span><span class="c-Singleline"></span>
<span class="c-Singleline">    ; Note: The regex of this function was written by Mystiq.</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">iU</span><span class="p">)((</span><span class="o">?:</span>\<span class="n">R</span><span class="o">|^</span><span class="p">)</span>\<span class="n">s</span><span class="o">*</span><span class="nv">%_Section%</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?:</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*.+</span>\<span class="n">s</span><span class="o">*=</span>\<span class="n">s</span><span class="o">*.*?</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">)</span><span class="o">|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span><span class="p">[;</span><span class="n">#</span><span class="p">]</span><span class="o">.*?</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">))</span><span class="o">*</span><span class="p">)</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">Q</span><span class="nv">%_Key%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*=.*</span><span class="p">((</span><span class="o">?=</span>\<span class="n">R</span><span class="o">|</span><span class="n">$</span><span class="p">))</span>
    <span class="n">_Content</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span> <span class="o">.</span> <span class="n">_Replacement</span> <span class="o">.</span> <span class="s">&quot;$2&quot;</span><span class="p">,</span> <span class="n">isReplaced</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="n">isReplaced</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">Else</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">isReplaced</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">Func: ini_replaceSection</span>
<span class="cm">    Changes complete section with all its keys and contents.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. If it is specified to &quot;&quot;, </span>
<span class="cm">                        then section is ignored and first found key is get.</span>
<span class="cm">    Replacement     - *Optional* New content to use. If not specified, the </span>
<span class="cm">                        content will be replaced with no content. That means</span>
<span class="cm">                        it is deleted/set to empty string.</span>
<span class="cm">                      The replacement should contain everything what a section</span>
<span class="cm">                      contains, like the &quot;[&quot; and &quot;]&quot; before and after section</span>
<span class="cm">                      name and all keys with its equality sign and value.</span>
<span class="cm">                      (Expected form: &quot;[sectionName]`nkeyName=value&quot;)</span>

<span class="cm">Returns:</span>
<span class="cm">    Returns 1 if key is updated to new value, and 0 otherwise (opposite of </span>
<span class="cm">    ErrorLevel). </span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; ini_replaceSection(ini, &quot;Tip&quot;, &quot;TimeStamp&quot;, &quot;[Section1]`nKey1=Hello`nKey2=You!&quot;)</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Section1&quot;, &quot;Key1&quot;)</span>
<span class="cm">    &gt; MsgBox %value%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; Hello</span>
<span class="cm">*/</span>
<span class="n">ini_replaceSection</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Replacement</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">_Section</span> <span class="o">=</span> <span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*</span><span class="p">])</span><span class="o">?</span>
<span class="w">    </span><span class="nb">Else</span>
         <span class="n">_Section</span> <span class="o">=</span> \<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">isU</span><span class="p">)</span><span class="o">^</span><span class="p">(</span>\<span class="n">s</span><span class="o">*?.*</span><span class="p">)</span><span class="nv">%_Section%</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">R</span><span class="o">?.*</span><span class="p">(</span>\<span class="n">R</span><span class="o">*</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*|</span>\<span class="n">R</span><span class="p">))</span><span class="o">?</span><span class="n">$</span> 
    <span class="n">_Content</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span> <span class="o">.</span> <span class="n">_Replacement</span> <span class="o">.</span> <span class="s">&quot;$2&quot;</span><span class="p">,</span> <span class="n">isReplaced</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="n">isReplaced</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">Else</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">isReplaced</span>
<span class="p">}</span><span class="c-Singleline"></span>


<span class="c-Singleline">; .............................................................................</span>
<span class="c-Singleline">; Group: Insert</span>
<span class="c-Singleline">;   Functions for adding new data.</span>
<span class="c-Singleline">; .............................................................................</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_insertValue</span>
<span class="cm">    Adds value to the end of existing value of specified key.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. If it is specified to &quot;&quot;, </span>
<span class="cm">                        then section is ignored and first found key is get.</span>
<span class="cm">    Key             - Name of the variable under the section.</span>
<span class="cm">    Value           - Value to be inserted at end of currently existing value.</span>
<span class="cm">    PreserveSpace   - *Optional* Should be set to 1 if spaces around the value </span>
<span class="cm">                        of a key should be saved, otherwise they are lost. The</span>
<span class="cm">                        surrounding single or double quotes are also lost.</span>
<span class="cm">                        Default is deleting surrounding spaces.</span>

<span class="cm">Returns:</span>
<span class="cm">    Returns 1 if value is inserted, and 0 otherwise (opposite of ErrorLevel).</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; ini_insertValue(ini, &quot;Recent File List&quot;, &quot;File1&quot;, &quot;, &quot; . A_ScriptName)</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Recent File List&quot;, &quot;File1&quot;)</span>
<span class="cm">    &gt; MsgBox %value%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; F:\testfile.ahk, ini.ahk</span>
<span class="cm">*/</span>
<span class="n">ini_insertValue</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">,</span> <span class="n">_PreserveSpace</span> <span class="o">=</span> <span class="nv">False</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">_Section</span> <span class="o">=</span> <span class="p">(</span><span class="o">?:</span>\<span class="p">[</span><span class="o">.*</span><span class="p">])</span><span class="o">?</span>
<span class="w">    </span><span class="nb">Else</span>
         <span class="n">_Section</span> <span class="o">=</span> \<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>
<span class="w">    </span><span class="nb">If </span><span class="n">Not</span> <span class="n">_PreserveSpace</span>
    <span class="p">{</span>
        <span class="n">_Value</span> <span class="o">=</span> <span class="nv">%_Value%</span><span class="c-Singleline"> ; Trim spaces.</span>
        <span class="n">FirstChar</span> <span class="o">:=</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">_Value</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">If</span> <span class="p">(</span><span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">_Value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span>
            <span class="n">OR</span> <span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">_Value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="p">{</span>
<span class="w">            </span><span class="nb">StringTrimLeft</span><span class="p">,</span> <span class="n">_Value</span><span class="p">,</span> <span class="n">_Value</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">            </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">_Value</span><span class="p">,</span> <span class="n">_Value</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="c-Singleline"></span>
<span class="c-Singleline">    ; Note: The regex of this function was written by Mystiq.</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="n">S</span><span class="se">`a</span><span class="n">iU</span><span class="p">)((</span><span class="o">?:</span>\<span class="n">R</span><span class="o">|^</span><span class="p">)</span>\<span class="n">s</span><span class="o">*</span><span class="nv">%_Section%</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?:</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*.+</span>\<span class="n">s</span><span class="o">*=</span>\<span class="n">s</span><span class="o">*.*?</span>\<span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">)</span><span class="o">|</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span><span class="p">[;</span><span class="n">#</span><span class="p">]</span><span class="o">.*?</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">))</span><span class="o">*</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">Q</span><span class="nv">%_Key%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*=.*?</span><span class="p">)((</span><span class="o">?=</span>\<span class="n">R</span><span class="o">|</span><span class="n">$</span><span class="p">))</span>
    <span class="n">_Content</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span> <span class="o">.</span> <span class="n">_Value</span> <span class="o">.</span> <span class="s">&quot;$2&quot;</span><span class="p">,</span> <span class="n">isInserted</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nb">If </span><span class="n">isInserted</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">Else</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">isInserted</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_insertKey</span>
<span class="cm">    Adds a key pair with its name and value, if key does not already exists.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section. (An enmpty string &quot;&quot; is not</span>
<span class="cm">                        working.)</span>
<span class="cm">    Key             - Key and value pair splitted by an equality sign.</span>

<span class="cm">Returns:</span>
<span class="cm">    Returns 1 if key is inserted, and 0 otherwise (opposite of ErrorLevel).</span>

<span class="cm">Remarks:</span>
<span class="cm">    Currently, it works as a workaround with different function calls instead </span>
<span class="cm">    of one regex call. This makes it slower against the other functions.</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; ini_insertKey(ini, &quot;Tip&quot;, &quot;TimeNow=&quot; . 20090925195317)</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Tip&quot;, &quot;TimeNow&quot;)</span>
<span class="cm">    &gt; MsgBox %value%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; 20090925195317</span>
<span class="cm">*/</span>
<span class="n">ini_insertKey</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">StringLeft</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="o">%</span> <span class="nf">InStr</span><span class="p">(</span><span class="n">_Key</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">sectionCopy</span> <span class="o">:=</span> <span class="n">ini_getSection</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">)</span>
    <span class="n">keyList</span> <span class="o">:=</span> <span class="n">ini_getAllKeyNames</span><span class="p">(</span><span class="n">sectionCopy</span><span class="p">)</span>
    <span class="n">isInserted</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="nb">If </span><span class="n">K</span> <span class="n">Not</span> <span class="n">In</span> <span class="nv">%keyList%</span>
    <span class="p">{</span>
        <span class="n">sectionCopy</span> <span class="o">.=</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span> <span class="o">.</span> <span class="n">_Key</span>
        <span class="n">isInserted</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">If </span><span class="n">isInserted</span>
    <span class="p">{</span>
        <span class="n">ini_replaceSection</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">sectionCopy</span><span class="p">)</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span> 
<span class="w">    </span><span class="nb">Return</span> <span class="n">isInserted</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">Func: ini_insertSection</span>
<span class="cm">    Adds a section and its keys, if section does not exist already.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section to be added and checked if</span>
<span class="cm">                        it is already existing.</span>
<span class="cm">    Keys            - *Optional* Set of key value pairs. Every key and value </span>
<span class="cm">                        pair should be at its own line divided by a new line </span>
<span class="cm">                        character.</span>

<span class="cm">Returns:</span>
<span class="cm">    Returns 1 if section and the keys are inserted, and 0 otherwise (opposite </span>
<span class="cm">    of ErrorLevel).</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; ini_insertSection(ini, &quot;Tip&quot;, &quot;Files&quot;, &quot;Name1=Programs`nPath1=C:\Program Files&quot;)</span>
<span class="cm">    &gt; value := ini_getValue(ini, &quot;Files&quot;, &quot;Name1&quot;)</span>
<span class="cm">    &gt; MsgBox %value%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; Programs</span>
<span class="cm">*/</span>
<span class="n">ini_insertSection</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Keys</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">RegEx</span> <span class="o">=</span> <span class="se">`a</span><span class="n">isU</span><span class="p">)</span><span class="o">^.*</span>\<span class="n">R</span><span class="o">*</span>\<span class="p">[</span>\<span class="n">s</span><span class="o">*?</span>\<span class="n">Q</span><span class="nv">%_Section%</span>\<span class="n">E</span>\<span class="n">s</span><span class="o">*?</span><span class="p">]</span>\<span class="n">s</span><span class="o">*</span>\<span class="n">R</span><span class="o">+.*</span><span class="n">$</span>
<span class="w">    </span><span class="nb">If </span><span class="n">Not</span> <span class="nf">RegExMatch</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">RegEx</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_Content</span> <span class="o">=</span> <span class="nv">%_Content%</span><span class="se">`n</span><span class="p">[</span><span class="nv">%_Section%</span><span class="p">]</span><span class="se">`n</span><span class="nv">%_Keys%</span>
        <span class="n">isInserted</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="n">isInserted</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">isInserted</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>

<span class="cm">Section: Additional</span>

<span class="cm">About: About</span>

<span class="cm">Brief:</span>
<span class="cm">    Other functions besides the core ones.</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>

<span class="cm">*/</span><span class="c-Singleline"></span>

<span class="c-Singleline">; .............................................................................</span>
<span class="c-Singleline">; Group: File</span>
<span class="c-Singleline">;   Related routines about file handling with some comfort.</span>
<span class="c-Singleline">; .............................................................................</span>

<span class="cm">/*</span>
<span class="cm">Func: ini_load</span>
<span class="cm">    Reads an ini file into a variable and resolves any part of the path.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* On success, the file is loaded into this </span>
<span class="cm">                        variable.</span>
<span class="cm">    Path            - *Optional* Source filename or -path to look for. It</span>
<span class="cm">                        can contain wildcards. If this is an existing directory </span>
<span class="cm">                        (or contains backslash at the end), then default </span>
<span class="cm">                        filename is appended. Default filename is ScriptName </span>
<span class="cm">                        with &quot;.ini&quot; extension (in example &quot;script.ini&quot;).</span>
<span class="cm">                        Relative Pathes are solved to current WorkingDir. </span>
<span class="cm">                        Every part of the path (like filename and -extension) </span>
<span class="cm">                        are optional. Default extension is logically &quot;.ini&quot;. </span>
<span class="cm">                        Binary files are not loaded. Empty string is resolved </span>
<span class="cm">                        to &quot;ScriptPathNoExt + .ini&quot;.</span>
<span class="cm">    convertNewLine  - *Optional* If this is true, all &quot;`r`n&quot; (CRLF) new line</span>
<span class="cm">                        sequence of files content will be replaced with &quot;`n&quot; </span>
<span class="cm">                        (LF) only. Normally this is not necessary.</span>

<span class="cm">Returns:</span>
<span class="cm">    The resolved full path which was searched for. If file exists, the full </span>
<span class="cm">    path with correct case from the disk is get.</span>

<span class="cm">Remarks:</span>
<span class="cm">    This function is not necessary to work with the ini-library. In fact, in </span>
<span class="cm">    the heart, it does nothing else than FileRead. The filled variable is an</span>
<span class="cm">    ordinary string. You can work with custom functions other from this library</span>
<span class="cm">    on these variables, as if you would do allways.</span>
<span class="cm">    </span>
<span class="cm">    If file is not found or content is binary, or at any other reason ErrorLevel</span>
<span class="cm">    is set to 1 and Content is set to &quot;&quot; (empty).</span>

<span class="cm">Examples:</span>
<span class="cm">    &gt; ; Load content of default file into variable &quot;ini&quot;.</span>
<span class="cm">    &gt; path := ini_load(ini)</span>
<span class="cm">    &gt; MsgBox %path%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; E:\Tuncay\AutoHotkey\scriptname.ini</span>
<span class="cm">*/</span>
<span class="n">ini_load</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">_convertNewLine</span> <span class="o">=</span> <span class="nv">false</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ini_buildPath</span><span class="p">(</span><span class="n">_Path</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">:=</span> <span class="nv">true</span><span class="c-Singleline"> ; If file is found next, then its set to false.</span>
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span> <span class="nv">%_Path%</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="p">{</span>
        <span class="n">_Path</span> <span class="o">:=</span> <span class="nv">A_LoopFileLongPath</span>
        <span class="n">error</span> <span class="o">:=</span> <span class="nv">false</span>
<span class="w">        </span><span class="nb">Break</span>
    <span class="p">}</span>    
    <span class="n">If</span> <span class="p">(</span><span class="n">error</span> <span class="o">=</span> <span class="nv">false</span><span class="p">)</span>
    <span class="p">{</span>
<span class="w">        </span><span class="nb">FileRead</span><span class="p">,</span> <span class="n">_Content</span><span class="p">,</span> <span class="nv">%_Path%</span>
        <span class="n">If</span> <span class="p">(</span><span class="nv">ErrorLevel</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">error</span> <span class="o">:=</span> <span class="nv">true</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Else</span>
        <span class="p">{</span>
<span class="w">            </span><span class="nb">FileGetSize</span><span class="p">,</span> <span class="n">fileSize</span><span class="p">,</span> <span class="nv">%_Path%</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">fileSize</span> <span class="o">!=</span> <span class="nf">StrLen</span><span class="p">(</span><span class="n">_Content</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">error</span> <span class="o">:=</span> <span class="nv">true</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_Content</span> <span class="o">:=</span> <span class="s">&quot;&quot;</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span> <span class="n">If</span> <span class="p">(</span><span class="n">_convertNewLine</span><span class="p">)</span>
    <span class="p">{</span>
<span class="w">        </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Content</span><span class="p">,</span> <span class="se">`r`n</span><span class="p">,</span> <span class="se">`n</span><span class="p">,</span> <span class="n">All</span>
    <span class="p">}</span>
    <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">error</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">_Path</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_save</span>
<span class="cm">    Writes an ini file from variable to disk.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Ini content to save at given path on disk.</span>
<span class="cm">    Path            - *Optional* Source filename or -path to look for. It</span>
<span class="cm">                        can contain wildcards. If this is an existing directory </span>
<span class="cm">                        (or contains backslash at the end), then default </span>
<span class="cm">                        filename is appended. Default filename is ScriptName </span>
<span class="cm">                        with &quot;.ini&quot; extension (in example &quot;script.ini&quot;).</span>
<span class="cm">                        Relative Pathes are solved to current WorkingDir. </span>
<span class="cm">                        Every part of the path (like filename and -extension) </span>
<span class="cm">                        are optional. Default extension is logically &quot;.ini&quot;. </span>
<span class="cm">                        Binary files are not loaded. Empty string is resolved </span>
<span class="cm">                        to &quot;ScriptPathNoExt + .ini&quot;.</span>
<span class="cm">    convertNewLine  - *Optional* If this is true, all &quot;`n&quot; (LF) new line</span>
<span class="cm">                        sequence of files content will be replaced with &quot;`r`n&quot;</span>
<span class="cm">                        (CRLF). Normally, Windows default new line sequence is</span>
<span class="cm">                        &quot;`r`n&quot;. (Source is not changed with this option.)</span>
<span class="cm">    overwrite       - *Optional* If this mode is enabled (true at default), </span>
<span class="cm">                        the source file will be updated. Otherwise, the</span>
<span class="cm">                        file is saved to disk only if source does not exist</span>
<span class="cm">                        already.</span>

<span class="cm">Returns:</span>
<span class="cm">    The resolved full path which was searched for.</span>

<span class="cm">Remarks:</span>
<span class="cm">    If overwrite mode is enabled and file could not be deleted, then ErrorLevel </span>
<span class="cm">    is set to 1. Otherwise, if overwriting an existing file is not allowed </span>
<span class="cm">    (overwrite = false) and file is existing, then ErrorLevel will be set to 1 </span>
<span class="cm">    also.</span>

<span class="cm">Examples:</span>
<span class="cm">    &gt; ; Write and update content of ini variable to default file.</span>
<span class="cm">    &gt; path := ini_save(ini)</span>
<span class="cm">    &gt; MsgBox %path%</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; E:\Tuncay\AutoHotkey\scriptname.ini</span>
<span class="cm">*/</span>
<span class="n">ini_save</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">_convertNewLine</span> <span class="o">=</span> <span class="nv">true</span><span class="p">,</span> <span class="n">_overwrite</span> <span class="o">=</span> <span class="nv">true</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ini_buildPath</span><span class="p">(</span><span class="n">_Path</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">:=</span> <span class="nv">false</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_overwrite</span><span class="p">)</span>
    <span class="p">{</span>
<span class="w">        </span><span class="nb">Loop</span><span class="p">,</span> <span class="nv">%_Path%</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="p">{</span>
            <span class="n">_Path</span> <span class="o">:=</span> <span class="nv">A_LoopFileLongPath</span>
<span class="w">            </span><span class="nb">Break</span>
        <span class="p">}</span>    
<span class="w">        </span><span class="nb">If </span><span class="nf">FileExist</span><span class="p">(</span><span class="n">_Path</span><span class="p">)</span>
        <span class="p">{</span>
<span class="w">            </span><span class="nb">FileDelete</span><span class="p">,</span> <span class="nv">%_Path%</span>
            <span class="n">If</span> <span class="p">(</span><span class="nv">ErrorLevel</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">error</span> <span class="o">:=</span> <span class="nv">true</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span> <span class="n">If</span> <span class="nf">FileExist</span><span class="p">(</span><span class="n">_Path</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">error</span> <span class="o">:=</span> <span class="nv">true</span>
    <span class="p">}</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">error</span> <span class="o">=</span> <span class="nv">false</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">If</span> <span class="p">(</span><span class="n">_convertNewLine</span><span class="p">)</span>
        <span class="p">{</span>
<span class="w">            </span><span class="nb">FileAppend</span><span class="p">,</span> <span class="nv">%_Content%</span><span class="p">,</span> <span class="nv">%_Path%</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Else</span>
        <span class="p">{</span>
<span class="w">            </span><span class="nb">FileAppend</span><span class="p">,</span> <span class="nv">%_Content%</span><span class="p">,</span> <span class="o">*</span><span class="nv">%_Path%</span>
        <span class="p">}</span>
        <span class="n">If</span> <span class="p">(</span><span class="nv">ErrorLevel</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">error</span> <span class="o">:=</span> <span class="nv">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">error</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">_Path</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; An internally used function, made not for public.</span>
<span class="n">ini_buildPath</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_path</span><span class="p">)</span>
<span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">    ; Set to default wildcard if filename or exension are not set.</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_Path</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="nv">A_ScriptFullPath</span><span class="p">,</span> <span class="s">&quot;S)\..*?$&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;.ini&quot;</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span> <span class="n">If</span> <span class="p">(</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">_Path</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;\&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_Path</span> <span class="o">.=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="nv">A_ScriptName</span><span class="p">,</span> <span class="s">&quot;S)\..*?$&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;.ini&quot;</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="n">If</span> <span class="p">(</span><span class="nf">InStr</span><span class="p">(</span><span class="nf">FileExist</span><span class="p">(</span><span class="n">_Path</span><span class="p">),</span> <span class="s">&quot;D&quot;</span><span class="p">))</span>
        <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">            ; If the current path is a directory, then add default file pattern to the directory.</span>
            <span class="n">_Path</span> <span class="o">.=</span> <span class="s">&quot;\&quot;</span> <span class="o">.</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="nv">A_ScriptName</span><span class="p">,</span> <span class="s">&quot;S)\..*?$&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;.ini&quot;</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Else</span>
        <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">            ; Check all parts of path and use defaults, if any part is not specified.</span>
<span class="w">            </span><span class="nb">SplitPath</span><span class="p">,</span> <span class="n">_Path</span><span class="p">,,</span> <span class="n">fileDir</span><span class="p">,</span> <span class="n">fileExtension</span><span class="p">,</span> <span class="n">fileNameNoExt</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">fileDir</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">fileDir</span> <span class="o">:=</span> <span class="nv">A_WorkingDir</span>
            <span class="p">}</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">fileExtension</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">fileExtension</span> <span class="o">:=</span> <span class="s">&quot;ini&quot;</span>
            <span class="p">}</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">fileNameNoExt</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">fileNameNoExt</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="nv">A_ScriptName</span><span class="p">,</span> <span class="s">&quot;S)\..*?$&quot;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">_Path</span> <span class="o">:=</span> <span class="n">fileDir</span> <span class="o">.</span> <span class="s">&quot;\&quot;</span> <span class="o">.</span> <span class="n">fileNameNoExt</span> <span class="o">.</span> <span class="s">&quot;.&quot;</span> <span class="o">.</span> <span class="n">fileExtension</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="mi">0</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; .............................................................................</span>
<span class="c-Singleline">; Group: Edit</span>
<span class="c-Singleline">;   These manipulates the whole ini structure (or an extracted section only).</span>
<span class="c-Singleline">; .............................................................................</span>

<span class="cm">/*</span>
<span class="cm">Func: ini_repair</span>
<span class="cm">    Repair and build an ini from scratch. Leave out comments and trim unneeded </span>
<span class="cm">    whitespaces.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    PreserveSpace   - *Optional* Should be set to 1 if spaces around the value </span>
<span class="cm">                        of a key should be saved, otherwise they are lost. </span>
<span class="cm">                        Default is deleting surrounding spaces.</span>
<span class="cm">    CommentSymbols  - *Optional* List of characters which are should be treated </span>
<span class="cm">                        as comment symbols. Every single character in list is </span>
<span class="cm">                        a symbol. Default are &quot;;&quot; and &quot;#&quot;, in example defined </span>
<span class="cm">                        as &quot;;#&quot;. </span>
<span class="cm">    LineDelim       - *Optional* A sequence of characters which should be the</span>
<span class="cm">                        delimiter as the line end symbol. Default is &quot;`n&quot;, a</span>
<span class="cm">                        new line.</span>

<span class="cm">Returns:</span>
<span class="cm">    The new formatted ini string with trimmed whitespaces and without comments.</span>

<span class="cm">Remarks:</span>
<span class="cm">    Other than the most other functions here, the ini Content variable is not</span>
<span class="cm">    a byref and will not manipulated directly. The return value is the new ini.</span>
<span class="cm">    The LineDelim option can be leaved as is. Internally all commands of </span>
<span class="cm">    AutoHotkey like MsgBox or FileAppend are working correctly with this.</span>
<span class="cm">    </span>
<span class="cm">    What it does is, building a new ini content string from an existing one.</span>
<span class="cm">    The reason to use this function is, if anyone have problems with the </span>
<span class="cm">    source ini because of whitespaces or comments and formatting. The new</span>
<span class="cm">    resulting ini is consistently reduced to standard ini format (at least,</span>
<span class="cm">    it should).</span>
<span class="cm">    Dublicate key entries in same section are merged into one key. The last</span>
<span class="cm">    instance overwrites just the one before.</span>

<span class="cm">Examples:</span>
<span class="cm">    (code)</span>
<span class="cm">    ini =</span>
<span class="cm">    (</span>
<span class="cm">    </span>
<span class="cm">        [ malformed section  ]</span>
<span class="cm">city   =  Berlin&#39;</span>
<span class="cm">whatever=&#39;this ; is nasty&#39;</span>

<span class="cm">     [bad]</span>
<span class="cm">cat    =     &#39;miao&#39;</span>

<span class="cm">    )</span>
<span class="cm">    ini := ini_repair(ini, true)</span>
<span class="cm">    MsgBox %ini%</span>
<span class="cm">    (end)</span>

<span class="cm">    *Output:*</span>
<span class="cm">    (code)</span>
<span class="cm">[malformed section]</span>
<span class="cm">city=  Berlin&#39;</span>
<span class="cm">whatever=&#39;this </span>
<span class="cm">[bad]</span>
<span class="cm">cat=     &#39;miao&#39;</span>
<span class="cm">    (end)</span>
<span class="cm">*/</span>
<span class="n">ini_repair</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_PreserveSpace</span> <span class="o">=</span> <span class="nv">False</span><span class="p">,</span> <span class="n">_CommentSymbols</span> <span class="o">=</span> <span class="s">&quot;;#&quot;</span><span class="p">,</span> <span class="n">_LineDelim</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_CommentSymbols</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="se">`a</span><span class="n">iUSm</span><span class="p">)(</span><span class="o">?:</span>\<span class="n">R</span>\<span class="n">s</span><span class="o">*|</span><span class="p">(</span><span class="n">s</span><span class="o">*|</span>\<span class="n">t</span><span class="o">*</span><span class="p">))[</span><span class="nv">%_CommentSymbols%</span><span class="p">]</span><span class="o">.*?</span><span class="p">(</span><span class="o">?=</span>\<span class="n">R</span><span class="p">)</span>
        <span class="n">_Content</span> <span class="o">:=</span> <span class="nf">RegExReplace</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span> <span class="n">_Content</span><span class="p">,</span> <span class="se">`n</span><span class="p">,</span> <span class="se">`r</span>
    <span class="p">{</span>
        <span class="n">If</span> <span class="p">(</span><span class="nf">RegExMatch</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">`a</span><span class="s">iSm)\[\s*(.+?)\s*]&quot;</span><span class="p">,</span> <span class="n">Match</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">newIni</span> <span class="o">.=</span> <span class="n">_LineDelim</span> <span class="o">.</span> <span class="s">&quot;[&quot;</span> <span class="o">.</span> <span class="n">Match1</span> <span class="o">.</span> <span class="s">&quot;]&quot;</span>
            <span class="n">section</span> <span class="o">:=</span> <span class="n">Match1</span>
            <span class="n">KeyList</span> <span class="o">:=</span> <span class="s">&quot;&quot;</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Else</span> <span class="n">If</span> <span class="p">(</span><span class="nf">RegExMatch</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">`a</span><span class="s">iSm)\s*(\b(?:.+?|\s?)\b)\s*=(.*)&quot;</span><span class="p">,</span> <span class="n">Match</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">_PreserveSpace</span> <span class="o">=</span> <span class="nv">false</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Match2</span> <span class="o">=</span> <span class="nv">%Match2%</span>
            <span class="p">}</span>
<span class="w">            </span><span class="nb">If </span><span class="n">Match1</span> <span class="n">Not</span> <span class="ow">in</span> <span class="nv">%KeyList%</span><span class="c-Singleline"> ; Disallowes dublicate.</span>
            <span class="p">{</span>
                <span class="n">KeyList</span> <span class="o">.=</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="n">Match1</span>
            <span class="p">}</span>
<span class="w">            </span><span class="nb">Else</span>
            <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">                ; As a workaround it should be just deleted, because if set </span>
<span class="c-Singleline">                ; here the surrounding whitespaces are lost.</span>
                <span class="n">ini_replaceKey</span><span class="p">(</span><span class="n">newIni</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">Match1</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">newIni</span> <span class="o">.=</span> <span class="n">_LineDelim</span> <span class="o">.</span> <span class="n">Match1</span> <span class="o">.</span> <span class="s">&quot;=&quot;</span> <span class="o">.</span> <span class="n">Match2</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">newIni</span><span class="p">,</span> <span class="n">newIni</span><span class="p">,</span> <span class="nv">%_LineDelim%</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">newIni</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">newIni</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_mergeKeys</span>
<span class="cm">    Merge two ini sources into first one. Adds new sections and keys and </span>
<span class="cm">    processess existing keys.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only). This is the destination where new </span>
<span class="cm">                        sections and keys are added into.</span>
<span class="cm">    source          - *Variable* This is also an ini content from which to </span>
<span class="cm">                        retrieve the new data. These will be added into Content </span>
<span class="cm">                        variable.</span>
<span class="cm">    updateMode      - *Optional* Defines how existing keys should be processed.</span>
<span class="cm">                        Default is (&#39;1&#39;) overwriting last instance with newest </span>
<span class="cm">                        one. </span>

<span class="cm">        updateMode: &#39;1&#39; - (&quot;Default&quot;) Replace existng key with newest/last one</span>
<span class="cm">                    from source.</span>
<span class="cm">        </span>
<span class="cm">        updateMode: &#39;2&#39; - Append everything to existing key in Content.</span>
<span class="cm">        </span>
<span class="cm">        updateMode: &#39;3&#39; - Replace only if source is higher than destination key</span>
<span class="cm">                    in Content.</span>
<span class="cm">        </span>
<span class="cm">        updateMode: &#39;4&#39; - Exclude keys in Content, which exists in both sources.</span>
<span class="cm">        </span>
<span class="cm">        updateMode: &#39;0&#39; - (&quot;Or any other value&quot;) Does not manipulate existing keys</span>
<span class="cm">                    in Content, leaving them in their orginal state. Just add </span>
<span class="cm">                    new unknown keys to Content.</span>
<span class="cm">                        </span>
<span class="cm">Returns:</span>
<span class="cm">    Returns the steps taken to manipulate the destination Content. Every added or </span>
<span class="cm">    manipulated key and section are rising by 1 the return value. 0 if nothing is</span>
<span class="cm">    changed.</span>

<span class="cm">Remarks:    </span>
<span class="cm">    ErrorLevel is set to &#39;1&#39; if something is changed in Content, &#39;0&#39; otherwise.</span>
<span class="cm">    </span>
<span class="cm">    The Content variable is updated with the content from source. This means, new</span>
<span class="cm">    sections and keys are added allways. In a conflict where same key was found </span>
<span class="cm">    in source again, in case it is existing in Content already, then the variable</span>
<span class="cm">    updateMode defines how they should be processed. Default is, to use last found</span>
<span class="cm">    key.</span>

<span class="cm">Examples:</span>
<span class="cm">    (code)</span>
<span class="cm">    ini1=</span>
<span class="cm">    (LTrim</span>
<span class="cm">        [vasara]</span>
<span class="cm">        tuni=1232</span>
<span class="cm">        edg=94545</span>
<span class="cm">        k=1</span>
<span class="cm">    )</span>
<span class="cm">    ini2=</span>
<span class="cm">    (LTrim</span>
<span class="cm">        [vasara]</span>
<span class="cm">        tuni=9999</span>
<span class="cm">        c=</span>
<span class="cm">        edg=5</span>
<span class="cm">        [taitos]</span>
<span class="cm">        isa=17</span>
<span class="cm">    )</span>
<span class="cm">    ini_mergeKeys(ini1, ini2)</span>
<span class="cm">    MsgBox %ini1%</span>
<span class="cm">    (end)</span>
<span class="cm">    *Output:*</span>
<span class="cm">    (code)</span>
<span class="cm">        [vasara]</span>
<span class="cm">        tuni=9999</span>
<span class="cm">        edg=5</span>
<span class="cm">        k1</span>
<span class="cm">        c=</span>
<span class="cm">        [taitos]</span>
<span class="cm">        isa=17</span>
<span class="cm">    (end)</span>
<span class="cm">*/</span>
<span class="n">ini_mergeKeys</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_source</span><span class="p">,</span> <span class="n">_updateMode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">steps</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="n">laststep</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="n">destSectionNames</span> <span class="o">:=</span> <span class="n">ini_getAllSectionNames</span><span class="p">(</span><span class="n">_Content</span><span class="p">),</span> <span class="n">sourceSectionNames</span> <span class="o">:=</span> <span class="n">ini_getAllSectionNames</span><span class="p">(</span><span class="n">_source</span><span class="p">)</span>
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span> <span class="n">sourceSectionNames</span><span class="p">,</span> <span class="se">`,</span>
    <span class="p">{</span>
        <span class="n">sectionName</span> <span class="o">:=</span> <span class="nv">A_LoopField</span>
        <span class="n">sourceSection</span> <span class="o">:=</span> <span class="n">ini_getSection</span><span class="p">(</span><span class="n">_source</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">)</span>
<span class="w">        </span><span class="nb">If </span><span class="n">sectionName</span> <span class="n">Not</span> <span class="n">In</span> <span class="nv">%destSectionNames%</span>
        <span class="p">{</span>
            <span class="n">_Content</span> <span class="o">.=</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span> <span class="o">.</span> <span class="n">sourceSection</span>
            <span class="n">steps</span><span class="o">++</span>
<span class="w">            </span><span class="nb">Continue</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Else</span>
        <span class="p">{</span>
            <span class="n">destSection</span> <span class="o">:=</span> <span class="n">ini_getSection</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">),</span> <span class="n">destKeyNames</span> <span class="o">:=</span> <span class="n">ini_getAllKeyNames</span><span class="p">(</span><span class="n">destSection</span><span class="p">),</span> <span class="n">sourceKeyNames</span> <span class="o">:=</span> <span class="n">ini_getAllKeyNames</span><span class="p">(</span><span class="n">sourceSection</span><span class="p">)</span>
<span class="w">            </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span> <span class="n">sourceKeyNames</span><span class="p">,</span> <span class="se">`,</span>
            <span class="p">{</span>
                <span class="n">keyName</span> <span class="o">:=</span> <span class="nv">A_LoopField</span>
<span class="w">                </span><span class="nb">If </span><span class="n">keyName</span> <span class="n">Not</span> <span class="n">In</span> <span class="nv">%destKeyNames%</span>
                <span class="p">{</span>
                    <span class="n">destSection</span> <span class="o">.=</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span> <span class="o">.</span> <span class="n">ini_getKey</span><span class="p">(</span><span class="n">sourceSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">)</span>
                    <span class="n">steps</span><span class="o">++</span>
<span class="w">                    </span><span class="nb">Continue</span>
                <span class="p">}</span>
<span class="w">                </span><span class="nb">Else</span> <span class="n">If</span> <span class="p">(</span><span class="n">_updateMode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ini_replaceValue</span><span class="p">(</span><span class="n">destSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">,</span> <span class="n">ini_getValue</span><span class="p">(</span><span class="n">sourceSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">))</span>
                    <span class="n">steps</span><span class="o">++</span>
                <span class="p">}</span>
<span class="w">                </span><span class="nb">Else</span> <span class="n">If</span> <span class="p">(</span><span class="n">_updateMode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ini_replaceValue</span><span class="p">(</span><span class="n">destSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">,</span> <span class="n">ini_getValue</span><span class="p">(</span><span class="n">destSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">)</span> <span class="o">.</span> <span class="n">ini_getValue</span><span class="p">(</span><span class="n">sourceSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">))</span>
                    <span class="n">steps</span><span class="o">++</span>
                <span class="p">}</span>
<span class="w">                </span><span class="nb">Else</span> <span class="n">If</span> <span class="p">(</span><span class="n">_updateMode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">If</span> <span class="p">((</span><span class="n">sourceValue</span> <span class="o">:=</span> <span class="n">ini_getValue</span><span class="p">(</span><span class="n">sourceSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">ini_getValue</span><span class="p">(</span><span class="n">destSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="n">ini_replaceValue</span><span class="p">(</span><span class="n">destSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">,</span> <span class="n">sourceValue</span><span class="p">)</span>
                        <span class="n">steps</span><span class="o">++</span>
                    <span class="p">}</span>
                <span class="p">}</span>
<span class="w">                </span><span class="nb">Else</span> <span class="n">If</span> <span class="p">(</span><span class="n">_updateMode</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ini_replaceKey</span><span class="p">(</span><span class="n">destSection</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">keyName</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">steps</span><span class="o">++</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">laststep</span> <span class="o">!=</span> <span class="n">steps</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">laststep</span> <span class="o">:=</span> <span class="n">steps</span>
                <span class="n">ini_replaceSection</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">sectionName</span><span class="p">,</span> <span class="n">destSection</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">steps</span>
<span class="p">}</span><span class="c-Singleline"></span>


<span class="c-Singleline">; .............................................................................</span>
<span class="c-Singleline">; Group: Convert</span>
<span class="c-Singleline">;   Export and import functions to convert ini structure.</span>
<span class="c-Singleline">; .............................................................................</span>


<span class="cm">/*</span>
<span class="cm">Func: ini_exportToGlobals</span>
<span class="cm">    Creates global variables from the ini structure.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    CreateIndexVars - *Optional* If this is set to &#39;true&#39;, some additional </span>
<span class="cm">                        variables are created. These are variables for indexed</span>
<span class="cm">                        access of sections and keys. The scheme how the variables</span>
<span class="cm">                        named are described below under Remarks.</span>
<span class="cm">    Prefix          - *Optional* This is the leading part of all created variable</span>
<span class="cm">                        names. (Default: &quot;ini&quot;)</span>
<span class="cm">    Seperator       - *Optional* This is part of all created variable names. It</span>
<span class="cm">                        is added between every section and key part and the </span>
<span class="cm">                        leading part to separate them. (Default: &quot;_&quot;)</span>
<span class="cm">    SectionSpaces   - *Optional* Every space inside section name will be replaced</span>
<span class="cm">                        by this character or string. This is needed for creating</span>
<span class="cm">                        AutoHotkey variables, which cannot hold spaces at name.</span>
<span class="cm">                        Default is to delete any space with empty value: &quot;&quot;.</span>
<span class="cm">    PreserveSpace   - *Optional* Should be set to 1 if spaces around the value </span>
<span class="cm">                        of a key should be saved, otherwise they are lost.</span>
<span class="cm">                        Surrounding quotes (&quot; or &#39;) are also lost, if not set</span>
<span class="cm">                        to 1. Default is deleting surrounding spaces and quotes.</span>

<span class="cm">Returns:</span>
<span class="cm">    Gets count of all created keys (attention, keys in sense of ini keys, not variables). </span>

<span class="cm">Remarks:</span>
<span class="cm">    Creates global variables from ini source. The scheme for building the variables is</span>
<span class="cm">    following: </span>
<span class="cm">    </span>
<span class="cm">    &gt; Prefix  +  Seperator  +  SectionName  + Seperator  +  KeyName</span>
<span class="cm">    &gt;   ini   +      _      +      Tip      +     _      + TimeStamp</span>
<span class="cm">    &gt; --------------------------------------------------------------</span>
<span class="cm">    &gt; ini_Tip_TimeStamp := &quot;20090716194758&quot;</span>
<span class="cm">    </span>
<span class="cm">    Standard prefix to every variable is &quot;ini&quot; and all parts are delimited by the </span>
<span class="cm">    separator &quot;_&quot;. The SectionSpaces parameter deletes at default every space from </span>
<span class="cm">    name of section, because spaces inside ahk variable names are not allowed.</span>

<span class="cm">CreateIndexVars:    </span>
<span class="cm">    These variables are created additionally to the other variables, if option </span>
<span class="cm">    CreateIndexVars is set to true (or 1 or any other value evaluating to true).</span>
<span class="cm">    </span>
<span class="cm">    Scheme for sections</span>
<span class="cm">    &gt; Prefix  +  Seperator  +  Index</span>
<span class="cm">    &gt;   ini   +      _      +    1</span>
<span class="cm">    &gt; ------------------------------</span>
<span class="cm">    &gt; ini_1 := &quot;Tip&quot;</span>
<span class="cm">    </span>
<span class="cm">    Scheme for keys</span>
<span class="cm">    &gt; Prefix  +  Seperator  +  SectionName  + Index</span>
<span class="cm">    &gt;   ini   +      _      +      Tip      +   1</span>
<span class="cm">    &gt; ---------------------------------------------</span>
<span class="cm">    &gt; ini_Tip1 := &quot;20090716194758&quot;</span>
<span class="cm">    </span>
<span class="cm">    The index &quot;0&quot; contains number of all elements.</span>

<span class="cm">Examples:</span>
<span class="cm">    &gt; ini_exportToGlobals(ini, 0)</span>
<span class="cm">    &gt; ListVars</span>
<span class="cm">    &gt; Msgbox % ini_RecentFileList_File2</span>
<span class="cm">    *Output:*</span>
<span class="cm">    &gt; Z:\tempfile.tmp</span>
<span class="cm">    </span>
<span class="cm">    The example would create all these variables with following </span>
<span class="cm">    values:</span>
<span class="cm">    &gt; ini_RecentFileList_File1 := &quot;F:\testfile.ahk&quot;</span>
<span class="cm">    &gt; ini_RecentFileList_File2 := &quot;Z:\tempfile.tmp&quot;</span>
<span class="cm">    &gt; ini_Tip_TimeStamp := &quot;20090716194758&quot;</span>
<span class="cm">    </span>
<span class="cm">    These variables would be created in addition to the above ones, if </span>
<span class="cm">    CreateIndexVars option was set to true:</span>
<span class="cm">    &gt; ini_0 := &quot;2&quot;</span>
<span class="cm">    &gt; ini_1 := &quot;Tip&quot;</span>
<span class="cm">    &gt; ini_2 := &quot;RecentFileList&quot;</span>
<span class="cm">    &gt; ini_RecentFileList0 := &quot;2&quot;</span>
<span class="cm">    &gt; ini_RecentFileList1 := &quot;File1&quot;</span>
<span class="cm">    &gt; ini_RecentFileList2 := &quot;File2&quot;</span>
<span class="cm">    &gt; ini_Tip0 := &quot;1&quot;</span>
<span class="cm">    &gt; ini_Tip1 := &quot;TimeStamp&quot;</span>
<span class="cm">*/</span>
<span class="n">ini_exportToGlobals</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_CreateIndexVars</span> <span class="o">=</span> <span class="nv">false</span><span class="p">,</span> <span class="n">_Prefix</span> <span class="o">=</span> <span class="s">&quot;ini&quot;</span><span class="p">,</span> <span class="n">_Seperator</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">_SectionSpaces</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">_PreserveSpace</span> <span class="o">=</span> <span class="nv">False</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">Global</span>
<span class="w">    </span><span class="nb">Local</span> <span class="n">secCount</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">keyCount</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Section</span><span class="p">,</span> <span class="n">Section1</span><span class="p">,</span> <span class="n">currSection</span><span class="p">,</span> <span class="n">Pair</span><span class="p">,</span> <span class="n">Pair1</span><span class="p">,</span> <span class="n">Pair2</span><span class="p">,</span> <span class="n">FirstChar</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Prefix</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_Prefix</span> <span class="o">.=</span> <span class="n">_Seperator</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span> <span class="n">_Content</span><span class="p">,</span> <span class="se">`n</span><span class="p">,</span> <span class="se">`r</span>
    <span class="p">{</span>
        <span class="n">If</span> <span class="p">(</span><span class="n">Not</span> <span class="nf">RegExMatch</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">`a</span><span class="s">iSm)\[\s*(.+?)\s*]&quot;</span><span class="p">,</span> <span class="n">Section</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">If</span> <span class="p">(</span><span class="nf">RegExMatch</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">`a</span><span class="s">iSm)\s*(\b(?:.+?|\s?)\b)\s*=(.*)&quot;</span><span class="p">,</span> <span class="n">Pair</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">If</span> <span class="p">(</span><span class="o">!</span><span class="n">_PreserveSpace</span><span class="p">)</span>
                <span class="p">{</span>
<span class="w">                    </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">Pair1</span><span class="p">,</span> <span class="n">Pair1</span><span class="p">,</span> <span class="nv">%A_Space%</span><span class="p">,</span> <span class="p">,</span> <span class="n">All</span>
                    <span class="n">Pair2</span> <span class="o">=</span> <span class="nv">%Pair2%</span><span class="c-Singleline"> ; Trim spaces.</span>
                    <span class="n">FirstChar</span> <span class="o">:=</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">Pair2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">If</span> <span class="p">(</span><span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">Pair2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span>
                        <span class="n">OR</span> <span class="n">FirstChar</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="n">AND</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">Pair2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
                    <span class="p">{</span>
<span class="w">                        </span><span class="nb">StringTrimLeft</span><span class="p">,</span> <span class="n">Pair2</span><span class="p">,</span> <span class="n">Pair2</span><span class="p">,</span> <span class="mi">1</span>
<span class="w">                        </span><span class="nb">StringTrimRight</span><span class="p">,</span> <span class="n">Pair2</span><span class="p">,</span> <span class="n">Pair2</span><span class="p">,</span> <span class="mi">1</span>
                    <span class="p">}</span>
                <span class="p">}</span>
<span class="w">                </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">currSection</span><span class="p">,</span> <span class="n">currSection</span><span class="p">,</span> <span class="nv">%A_Space%</span><span class="p">,</span> <span class="nv">%_SectionSpaces%</span><span class="p">,</span> <span class="n">All</span>
                <span class="nv">%_Prefix%%currSection%%_Seperator%%Pair1%</span> <span class="o">:=</span> <span class="n">Pair2</span><span class="c-Singleline"> ; ini_section_key := value</span>
                <span class="n">keyCount</span><span class="o">++</span>
                <span class="n">If</span> <span class="p">(</span><span class="n">_CreateIndexVars</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="nv">%_Prefix%%currSection%</span><span class="mi">0</span><span class="o">++</span>
                    <span class="n">i</span> <span class="o">:=</span> <span class="nv">%_Prefix%%currSection%</span><span class="mi">0</span>
                    <span class="nv">%_Prefix%%currSection%%i%</span> <span class="o">:=</span> <span class="n">Pair1</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Else</span>
        <span class="p">{</span>
            <span class="n">currSection</span> <span class="o">:=</span> <span class="n">Section1</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">_CreateIndexVars</span><span class="p">)</span>
            <span class="p">{</span>
<span class="w">                </span><span class="nb">StringReplace</span><span class="p">,</span> <span class="n">currSection</span><span class="p">,</span> <span class="n">currSection</span><span class="p">,</span> <span class="nv">%A_Space%</span><span class="p">,</span> <span class="nv">%_SectionSpaces%</span><span class="p">,</span> <span class="n">All</span>
                <span class="n">secCount</span><span class="o">++</span>
                <span class="nv">%_Prefix%%secCount%</span> <span class="o">:=</span> <span class="n">currSection</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_CreateIndexVars</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">%_Prefix%</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">secCount</span>
    <span class="p">}</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">secCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">AND</span> <span class="n">keyCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> <span class="n">keyCount</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>

<span class="cm">Section: Aliases</span>

<span class="cm">About: About</span>

<span class="cm">Brief:</span>
<span class="cm">    Function wrappers to work with existing commands or functions via &quot;Basic </span>
<span class="cm">    ini string functions&quot;. They try to mimic the interface for look and feel of</span>
<span class="cm">    original. This can help to migrate others to this library with lesser</span>
<span class="cm">    possible work.</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">_______________________________________________________________________________</span>
<span class="cm">*/</span><span class="c-Singleline"></span>

<span class="c-Singleline">; .............................................................................</span>
<span class="c-Singleline">; Group: AutoHotkey</span>
<span class="c-Singleline">;   Built-in Commands of AutoHotkey.</span>
<span class="c-Singleline">; .............................................................................</span>

<span class="cm">/*</span>
<span class="cm">Func: Ini_Read</span>
<span class="cm">    Reads a value. Alias of IniRead.</span>

<span class="cm">Parameters:</span>
<span class="cm">    OutputVar       - *Variable* The name of the variable in which to store the retrieved </span>
<span class="cm">                        value. If the value cannot be retrieved, the variable </span>
<span class="cm">                        is set to the value indicated by the Default parameter </span>
<span class="cm">                        (described below). </span>
<span class="cm">    Content         - *Variable* Content of an ini file (also this can be one </span>
<span class="cm">                        section only).</span>
<span class="cm">    Section         - Unique name of the section.</span>
<span class="cm">    Key             - Name of the variable under the section.</span>
<span class="cm">    Default         - *Optional* The value to store in OutputVar if the </span>
<span class="cm">                        requested key is not found. If omitted, it defaults to </span>
<span class="cm">                        the word ERROR.</span>

<span class="cm">Returns:</span>
<span class="cm">    Does not return anything.</span>
<span class="cm">    </span>
<span class="cm">Remarks:</span>
<span class="cm">    ErrorLevel is not set by this function (backed up and restored).</span>

<span class="cm">    In Ahk you had to specify the filename of the ini file. Here you need to </span>
<span class="cm">    give the content, instead of.</span>
<span class="cm">    Compared to &quot;Basic ini string functions&quot; the parameter section is not </span>
<span class="cm">    allowed to be set to an empty string anymore.</span>

<span class="cm">Related:</span>
<span class="cm">    * IniRead: [http://www.autohotkey.com/docs/commands/IniRead.htm]</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; FileRead, ini, C:\Temp\myfile.ini</span>
<span class="cm">    &gt; Ini_Read(OutputVar, ini, &quot;section2&quot;, &quot;key&quot;)</span>
<span class="cm">    &gt; MsgBox %OutputVar%</span>
<span class="cm">*/</span>
<span class="n">Ini_Read</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_OutputVar</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Default</span> <span class="o">=</span> <span class="s">&quot;ERROR&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">BackupErrorLevel</span> <span class="o">:=</span> <span class="nv">ErrorLevel</span>
        <span class="n">_OutputVar</span> <span class="o">:=</span> <span class="n">ini_getValue</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">)</span>
<span class="w">        </span><span class="nb">If </span><span class="nv">ErrorLevel</span>
        <span class="p">{</span>
            <span class="n">_OutputVar</span> <span class="o">:=</span> <span class="n">_Default</span>
        <span class="p">}</span>
        <span class="nv">ErrorLevel</span> <span class="o">:=</span> <span class="n">BackupErrorLevel</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="n">_OutputVar</span> <span class="o">:=</span> <span class="n">_Default</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> 
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: Ini_Write</span>
<span class="cm">    Writes a value. Alias of IniWrite.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Value           - The string or number that will be written to the right </span>
<span class="cm">                        of Key&#39;s equal sign (=).</span>
<span class="cm">    Content         - *Variable* Content of an ini file .</span>
<span class="cm">    Section         - Unique name of the section.</span>
<span class="cm">    Key             - Name of the variable under the section.</span>

<span class="cm">Returns:</span>
<span class="cm">    Does not return anything.</span>
<span class="cm">    </span>
<span class="cm">Remarks:</span>
<span class="cm">    ErrorLevel is set to 1 if there was a problem or 0 otherwise.</span>

<span class="cm">    In Ahk you had to specify the filename of the ini file. Here you need to </span>
<span class="cm">    give the content, instead of.</span>
<span class="cm">    Compared to &quot;Basic ini string functions&quot; the parameter section is not </span>
<span class="cm">    allowed to be set to an empty string anymore.</span>

<span class="cm">Related:</span>
<span class="cm">    * IniWrite: [http://www.autohotkey.com/docs/commands/IniWrite.htm]</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; FileRead, ini, C:\Temp\myfile.ini</span>
<span class="cm">    &gt; Ini_Write(&quot;this is a new value&quot;, ini, &quot;section2&quot;, &quot;key&quot;)</span>
<span class="cm">    &gt; FileDelete, C:\Temp\myfile.ini</span>
<span class="cm">    &gt; FileAppend, %ini%, C:\Temp\myfile.ini</span>
<span class="cm">*/</span>
<span class="n">Ini_Write</span><span class="p">(</span><span class="n">_Value</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="n">ini_replaceValue</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">)</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> 
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">Func: Ini_Delete</span>
<span class="cm">    Deletes a value or section. Alias of IniDelete.</span>

<span class="cm">Parameters:</span>
<span class="cm">    Content         - *Variable* Content of an ini file.</span>
<span class="cm">    Section         - Unique name of the section.</span>
<span class="cm">    Key             - *Optional* Name of the variable under the section.</span>

<span class="cm">Returns:</span>
<span class="cm">    Does not return anything.</span>
<span class="cm">    </span>
<span class="cm">Remarks:</span>
<span class="cm">    ErrorLevel is set to 1 if there was a problem or 0 otherwise.</span>

<span class="cm">    In Ahk you had to specify the filename of the ini file. Here you need to </span>
<span class="cm">    give the content, instead of.</span>
<span class="cm">    Compared to &quot;Basic ini string functions&quot; the parameter section is not </span>
<span class="cm">    allowed to be set to an empty string anymore.</span>

<span class="cm">Related:</span>
<span class="cm">    * IniDelete: [http://www.autohotkey.com/docs/commands/IniDelete.htm]</span>
<span class="cm">    </span>
<span class="cm">Examples:</span>
<span class="cm">    &gt; FileRead, ini, C:\Temp\myfile.ini</span>
<span class="cm">    &gt; Ini_Delete(ini, &quot;section2&quot;, &quot;key&quot;)</span>
<span class="cm">    &gt; FileDelete, C:\Temp\myfile.ini</span>
<span class="cm">    &gt; FileAppend, %ini%, C:\Temp\myfile.ini</span>
<span class="cm">*/</span>
<span class="n">Ini_Delete</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">If</span> <span class="p">(</span><span class="n">_Section</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">ErrorLevel</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Else</span>
    <span class="p">{</span>
        <span class="n">If</span> <span class="p">(</span><span class="n">_Key</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ini_replaceKey</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="n">_Key</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="p">}</span>
<span class="w">        </span><span class="nb">Else</span>
        <span class="p">{</span>
            <span class="n">ini_replaceSection</span><span class="p">(</span><span class="n">_Content</span><span class="p">,</span> <span class="n">_Section</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="w">    </span><span class="nb">Return</span> 
<span class="p">}</span>
</pre></div>
