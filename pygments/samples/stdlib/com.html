<LINK href="styles.css" rel="stylesheet" type="text/css">

New Lexer: 
<div class="highlight"><pre><span class="c-Singleline">;------------------------------------------------------------------------------</span>
<span class="c-Singleline">; COM.ahk Standard Library</span>
<span class="c-Singleline">; by Sean</span>
<span class="c-Singleline">; http://www.autohotkey.com/forum/topic22923.html</span>
<span class="c-Singleline">;------------------------------------------------------------------------------</span><span class="w"></span>

<span class="n">COM_Init</span><span class="p">()</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\OleInitialize&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Term</span><span class="p">()</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\OleUninitialize&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_VTable</span><span class="p">(</span><span class="n">ppv</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">idx</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">ppv</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(NumGet(NumGet(1*ppv)+0)</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> ppv</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> COM_GUID4String(IID</span><span class="p">,</span><span class="s">IID ? IID : IID=0 ? &quot;{00000000-0000-0000-C000-000000000046}&quot; : &quot;{00020400-0000-0000-C000-000000000046}&quot;)</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> ppv)=0</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">ppv</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AddRef</span><span class="p">(</span><span class="n">ppv</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Release</span><span class="p">(</span><span class="n">ppv</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_QueryService</span><span class="p">(</span><span class="n">ppv</span><span class="p">,</span> <span class="n">SID</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IServiceProvider</span><span class="p">,</span><span class="s">&quot;{6D5140C1-7436-11CE-8034-00AA006009FA}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">psp</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">psp</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">SID</span><span class="p">,</span><span class="n">SID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">IID</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span><span class="n">IID</span><span class="p">)</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">SID</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="o">:=</span><span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">psp</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psp</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">ppv</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_FindConnectionPoint</span><span class="p">(</span><span class="n">pdp</span><span class="p">,</span> <span class="n">DIID</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdp</span><span class="p">)</span><span class="o">+</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IConnectionPointContainer</span><span class="p">,</span> <span class="s">&quot;{B196B284-BAB4-101A-B69C-00AA00341D07}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pcc</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcc</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">DIID</span><span class="p">,</span><span class="n">DIID</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcc</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcc</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">pcp</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetConnectionInterface</span><span class="p">(</span><span class="n">pcp</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">DIID</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcp</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">DIID</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_String4GUID</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DIID</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Advise</span><span class="p">(</span><span class="n">pcp</span><span class="p">,</span> <span class="n">psink</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcp</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psink</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">nCookie</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">nCookie</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Unadvise</span><span class="p">(</span><span class="n">pcp</span><span class="p">,</span> <span class="n">nCookie</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nCookie</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Enumerate</span><span class="p">(</span><span class="n">penum</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">Result</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">vt</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p"> (</span><span class="mi">0</span> <span class="o">=</span>	<span class="n">hr</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">penum</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">penum</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="w">		</span><span class="nl">Result:</span><span class="o">=</span><span class="p">(</span><span class="n">vt</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">9</span><span class="o">||</span><span class="n">vt</span><span class="o">=</span><span class="mi">13</span> <span class="o">?</span><span class="nf"> NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="n">vt</span><span class="o">=</span><span class="mi">8</span><span class="o">||</span><span class="n">vt</span><span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span><span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">hr</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm0</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm1</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm2</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm3</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm4</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm5</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm6</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm7</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm8</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm9</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">name=</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">name contains .</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span><span class="nf"></span>
<span class="nf">		SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s">&quot;.&quot;</span> <span class="o">?</span> <span class="n">name</span><span class="o">.=</span><span class="s">&quot;.&quot;</span><span class="o">:</span><span class="n">name</span><span class="o">:=</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;.&quot;</span><span class="p">,</span><span class="n">COM_AddRef</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	name</span><span class="p">,</span><span class="s"> .</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">A_Index=1</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span>
<span class="w">		</span><span class="n">name</span><span class="p"> </span><span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span><span class="w"></span>
<span class="w">	</span>	<span class="p">}</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	name not contains [</span><span class="p">,</span><span class="s">(</span><span class="w"></span>
<span class="w">		</span>	<span class="n">prmn</span> <span class="o">:=</span>	<span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	InStr(&quot;])&quot;</span><span class="p">,</span><span class="s">SubStr(name</span><span class="p">,</span><span class="s">0))</span><span class="w"></span>
<span class="w">		</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	name</span><span class="p">,</span><span class="s"> [(</span><span class="p">,</span><span class="s">&#39;&quot;)]</span><span class="w"></span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="s">A_Index=1</span><span class="w"></span>
<span class="w">		</span>	<span class="n">name</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span><span class="w">	</span><span class="s">prmn :=	A_LoopField</span><span class="w"></span>
<span class="w">		</span><span class="nb">Else</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span>
<span class="w">		</span><span class="n">name</span><span class="p"> </span><span class="o">.=</span>	<span class="s">&quot;.&quot;</span> <span class="o">.</span> <span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span><span class="w"></span>
<span class="w">	</span>	<span class="p">}</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">A_LoopField!=</span><span class="w"></span>
<span class="w">		</span>	<span class="n">pdsp</span><span class="o">:=</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">prmn</span><span class="o">!=</span><span class="s">&quot;&quot;</span> <span class="o">?</span> <span class="n">prmn</span><span class="o">:</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span><span class="n">name</span><span class="o">:=</span><span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span><span class="w">	</span><span class="s">Return	prmn!=&quot;&quot; ? COM_Invoke(pdsp</span><span class="p">,</span><span class="s">name</span><span class="p">,</span><span class="s">prmn</span><span class="p">,</span><span class="s">prm0</span><span class="p">,</span><span class="s">prm1</span><span class="p">,</span><span class="s">prm2</span><span class="p">,</span><span class="s">prm3</span><span class="p">,</span><span class="s">prm4</span><span class="p">,</span><span class="s">prm5</span><span class="p">,</span><span class="s">prm6</span><span class="p">,</span><span class="s">prm7</span><span class="p">,</span><span class="s">prm8):COM_Invoke(pdsp</span><span class="p">,</span><span class="s">name</span><span class="p">,</span><span class="s">prm0</span><span class="p">,</span><span class="s">prm1</span><span class="p">,</span><span class="s">prm2</span><span class="p">,</span><span class="s">prm3</span><span class="p">,</span><span class="s">prm4</span><span class="p">,</span><span class="s">prm5</span><span class="p">,</span><span class="s">prm6</span><span class="p">,</span><span class="s">prm7</span><span class="p">,</span><span class="s">prm8</span><span class="p">,</span><span class="s">prm9)</span><span class="p">,</span><span class="s">COM_Release(pdsp)</span><span class="w"></span>
<span class="w">	</span>	<span class="p">}</span>
	<span class="p">}</span>
<span class="w">	</span><span class="n">sParams</span><span class="p">	</span><span class="o">:=</span> <span class="s">&quot;0123456789&quot;</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	sParams</span><span class="w"></span>
<span class="w">		</span>	<span class="n">If</span>	<span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span> <span class="o">==</span> <span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span>
		<span class="p">{</span>
<span class="w">			</span><span class="n">sParams</span><span class="p">	</span><span class="o">:=</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">sParams</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">			</span><span class="nb">Break</span><span class="w"></span>
<span class="w">		</span>	<span class="p">}</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">varg</span><span class="p">,</span><span class="mi">16</span><span class="o">*</span><span class="n">nParams</span><span class="o">:=</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">sParams</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="nf"> VarSetCapacity</span><span class="p">(</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf"> VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf"> VarSetCapacity</span><span class="p">(</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s"> 	Parse</span><span class="p">,</span><span class="s">	sParams</span><span class="w"></span>

<span class="c-Singleline">;		If	prm%A_LoopField%+0==&quot;&quot; || InStr(prm%A_LoopField%,&quot;.&quot;) || prm%A_LoopField%&gt;=0x80000000 || prm%A_LoopField%&lt;-0x80000000</span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="s">prm%A_LoopField% is not integer</span><span class="w"></span>
<span class="w">			</span><span class="nf">	NumPut</span><span class="p">(</span><span class="n">COM_SysString</span><span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">		</span><span class="nb">Else</span><span class="w">	</span><span class="s">NumPut(SubStr(prm%A_LoopField%</span><span class="p">,</span><span class="s">1</span><span class="p">,</span><span class="s">1)=&quot;+&quot; ? 9:prm%A_LoopField%==&quot;-0&quot; ? (prm%A_LoopField%:=0x80020004)*0+10:3</span><span class="p">,</span><span class="s">NumPut(prm%A_LoopField%</span><span class="p">,</span><span class="s">varg</span><span class="p">,</span><span class="s">(nParams-A_Index)*16+8)</span><span class="p">,</span><span class="s">-12</span><span class="p">,</span><span class="s">&quot;Ushort&quot;)</span><span class="w"></span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="s">nParams</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="n">nParams</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varg</span><span class="p">,</span><span class="n">DispParams</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	(</span><span class="n">nvk</span> <span class="o">:=</span><span class="nf">	SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;=&quot;</span> <span class="o">?</span> <span class="mi">12</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">12</span>
<span class="w">		</span><span class="n">name</span><span class="p"> </span><span class="o">:=</span><span class="nf">	SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Global</span>	<span class="n">COM_HR</span><span class="p">,</span> <span class="n">COM_LR</span><span class="o">:=</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="n">If</span><span class="p">	(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="n">COM_SysString</span><span class="p">(</span><span class="n">wname</span><span class="p">,</span><span class="n">name</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;intP&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="n">nvk</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DispParams</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">nParams</span><span class="o">&amp;&amp;</span><span class="n">nvk</span><span class="o">!=</span><span class="mi">12</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_LR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span><span class="nl">COM_HR:</span><span class="o">=</span><span class="mi">0</span><span class="nf"></span>
<span class="nf">	Global</span>	<span class="n">COM_VT</span> <span class="o">:=</span><span class="nf"> NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_HR</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">&gt;</span><span class="mi">1</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">=</span><span class="mi">9</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">13</span> <span class="o">?</span><span class="nf"> NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">8</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span><span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">:</span><span class="n">COM_Error</span><span class="p">(</span><span class="n">COM_HR</span><span class="p">,</span><span class="n">COM_LR</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Invoke_</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">typ0</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm0</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ2</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm2</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ3</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm3</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ4</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm4</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ5</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm5</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ6</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm6</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ7</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm7</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ8</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm8</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ9</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm9</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">name contains .</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span><span class="nf"></span>
<span class="nf">		SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s">&quot;.&quot;</span> <span class="o">?</span> <span class="n">name</span><span class="o">.=</span><span class="s">&quot;.&quot;</span><span class="o">:</span><span class="n">name</span><span class="o">:=</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="n">COM_AddRef</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	name</span><span class="p">,</span><span class="s"> .</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">A_Index=1</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span>
<span class="w">		</span><span class="n">name</span><span class="p"> </span><span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span><span class="w"></span>
<span class="w">	</span>	<span class="p">}</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	name not contains [</span><span class="p">,</span><span class="s">(</span><span class="w"></span>
<span class="w">		</span>	<span class="n">prmn</span> <span class="o">:=</span>	<span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	InStr(&quot;])&quot;</span><span class="p">,</span><span class="s">SubStr(name</span><span class="p">,</span><span class="s">0))</span><span class="w"></span>
<span class="w">		</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	name</span><span class="p">,</span><span class="s"> [(</span><span class="p">,</span><span class="s">&#39;&quot;)]</span><span class="w"></span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="s">A_Index=1</span><span class="w"></span>
<span class="w">		</span>	<span class="n">name</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span><span class="w">	</span><span class="s">prmn :=	A_LoopField</span><span class="w"></span>
<span class="w">		</span><span class="nb">Else</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span>
<span class="w">		</span><span class="n">name</span><span class="p"> </span><span class="o">.=</span>	<span class="s">&quot;.&quot;</span> <span class="o">.</span> <span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span><span class="w"></span>
<span class="w">	</span>	<span class="p">}</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">A_LoopField!=</span><span class="w"></span>
<span class="w">		</span>	<span class="n">pdsp</span><span class="o">:=</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">prmn</span><span class="o">!=</span><span class="s">&quot;&quot;</span> <span class="o">?</span> <span class="n">prmn</span><span class="o">:</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span><span class="n">name</span><span class="o">:=</span><span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span><span class="w">	</span><span class="s">Return	COM_Invoke_(pdsp</span><span class="p">,</span><span class="s">name</span><span class="p">,</span><span class="s">typ0</span><span class="p">,</span><span class="s">prm0</span><span class="p">,</span><span class="s">typ1</span><span class="p">,</span><span class="s">prm1</span><span class="p">,</span><span class="s">typ2</span><span class="p">,</span><span class="s">prm2</span><span class="p">,</span><span class="s">typ3</span><span class="p">,</span><span class="s">prm3</span><span class="p">,</span><span class="s">typ4</span><span class="p">,</span><span class="s">prm4</span><span class="p">,</span><span class="s">typ5</span><span class="p">,</span><span class="s">prm5</span><span class="p">,</span><span class="s">typ6</span><span class="p">,</span><span class="s">prm6</span><span class="p">,</span><span class="s">typ7</span><span class="p">,</span><span class="s">prm7</span><span class="p">,</span><span class="s">typ8</span><span class="p">,</span><span class="s">prm8</span><span class="p">,</span><span class="s">typ9</span><span class="p">,</span><span class="s">prm9)</span><span class="p">,</span><span class="s">COM_Release(pdsp)</span><span class="w"></span>
<span class="w">	</span>	<span class="p">}</span>
	<span class="p">}</span>
<span class="w">	</span><span class="n">sParams</span><span class="p">	</span><span class="o">:=</span> <span class="s">&quot;0123456789&quot;</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	sParams</span><span class="w"></span>
<span class="w">		</span>	<span class="n">If</span>	<span class="p">(</span><span class="n">typ</span><span class="nv">%A_LoopField%</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="p">{</span>
<span class="w">			</span><span class="n">sParams</span><span class="p">	</span><span class="o">:=</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">sParams</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">			</span><span class="nb">Break</span><span class="w"></span>
<span class="w">		</span>	<span class="p">}</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">varg</span><span class="p">,</span><span class="mi">16</span><span class="o">*</span><span class="n">nParams</span><span class="o">:=</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">sParams</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="nf"> VarSetCapacity</span><span class="p">(</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf"> VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf"> VarSetCapacity</span><span class="p">(</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	sParams</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">),</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">&amp;</span><span class="mh">0x4000</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span><span class="nf"> NumPut</span><span class="p">(</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mi">8</span> <span class="o">?</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">)</span><span class="o">:</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mi">5</span> <span class="o">?</span> <span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">((</span><span class="n">prmx</span><span class="o">:=</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4008</span> <span class="o">?</span> <span class="n">COM_SysAllocString</span><span class="p">(</span><span class="nv">%prmx%</span><span class="p">)</span><span class="o">:</span><span class="nv">%prmx%</span><span class="p">,</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4005</span> <span class="o">?</span> <span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">))</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">nParams</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="n">nParams</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varg</span><span class="p">,</span><span class="n">DispParams</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	(</span><span class="n">nvk</span> <span class="o">:=</span><span class="nf">	SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;=&quot;</span> <span class="o">?</span> <span class="mi">12</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">12</span>
<span class="w">		</span><span class="n">name</span><span class="p"> </span><span class="o">:=</span><span class="nf">	SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Global</span>	<span class="n">COM_HR</span><span class="p">,</span> <span class="n">COM_LR</span><span class="o">:=</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="n">If</span><span class="p">	(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="n">COM_SysString</span><span class="p">(</span><span class="n">wname</span><span class="p">,</span><span class="n">name</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;intP&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="n">nvk</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DispParams</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">nParams</span><span class="o">&amp;&amp;</span><span class="n">nvk</span><span class="o">!=</span><span class="mi">12</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_LR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span><span class="nl">COM_HR:</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s">	Parse</span><span class="p">,</span><span class="s">	sParams</span><span class="w"></span>
<span class="w">		</span>	<span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">&amp;</span><span class="mh">0x4000</span> <span class="o">?</span> <span class="p">(</span><span class="n">prmx</span><span class="o">:=</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="nv">%prmx%</span><span class="o">:=</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4008</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="n">prmx</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_SysFreeString</span><span class="p">(</span><span class="n">prmx</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4005</span> <span class="o">?</span> <span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">))</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="nf"></span>
<span class="nf">	Global</span>	<span class="n">COM_VT</span> <span class="o">:=</span><span class="nf"> NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_HR</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">&gt;</span><span class="mi">1</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">=</span><span class="mi">9</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">13</span> <span class="o">?</span><span class="nf"> NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">8</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span><span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">:</span><span class="n">COM_Error</span><span class="p">(</span><span class="n">COM_HR</span><span class="p">,</span><span class="n">COM_LR</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_DispInterface</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">prm1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm2</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm3</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm4</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm5</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm6</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm7</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm8</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Critical</span><span class="w"></span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="s">A_EventInfo = 6</span><span class="w"></span>
<span class="w">		</span>	<span class="n">hr</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="n">p</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">28</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm1</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="n">pname</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">hr</span><span class="o">==</span><span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sfn</span><span class="p">,</span><span class="mi">63</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">sfn</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;%s%S&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">40</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pname</span><span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">),</span><span class="n">COM_SysFreeString</span><span class="p">(</span><span class="n">pname</span><span class="p">),</span><span class="nv">%sfn%</span><span class="p">(</span><span class="n">prm5</span><span class="p">,</span><span class="n">this</span><span class="p">,</span><span class="n">prm6</span><span class="p">))</span><span class="o">:</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	A_EventInfo = 5</span><span class="w"></span>
<span class="w">		</span>	<span class="n">hr</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="n">p</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm2</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm3</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm5</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	A_EventInfo = 4</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">hr</span><span class="o">:=</span><span class="mh">0x80004001</span><span class="p">,</span><span class="n">prm3</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	A_EventInfo = 3</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">prm1</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	A_EventInfo = 2</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	A_EventInfo = 1</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	A_EventInfo = 0</span><span class="w"></span>
<span class="w">		</span>	<span class="n">COM_IsEqualGUID</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span><span class="n">prm1</span><span class="p">)</span><span class="o">||</span><span class="nf">InStr</span><span class="p">(</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}{00000000-0000-0000-C000-000000000046}&quot;</span><span class="p">,</span><span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">prm1</span><span class="p">))</span> <span class="o">?</span><span class="nf"> NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="n">prm2</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">hr</span><span class="o">:=</span><span class="mh">0x80004002</span><span class="p">,</span><span class="n">prm2</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">hr</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_DispGetParam</span><span class="p">(</span><span class="n">pDispParams</span><span class="p">,</span> <span class="n">Position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vt</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\DispGetParam&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pDispParams</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">Position</span><span class="p">,</span> <span class="s">&quot;Ushort&quot;</span><span class="p">,</span> <span class="n">vt</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">nArgErr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return	NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="o">=</span><span class="mi">8</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_DispSetParam</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pDispParams</span><span class="p">,</span> <span class="n">Position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vt</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	NumPut</span><span class="p">(</span><span class="n">vt</span><span class="o">=</span><span class="mi">8</span> <span class="o">?</span> <span class="n">COM_SysAllocString</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">:</span><span class="n">val</span><span class="p">,</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pDispParams</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pDispParams</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="n">Position</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">-</span><span class="mi">8</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">vt</span><span class="o">=</span><span class="mi">11</span><span class="o">||</span><span class="n">vt</span><span class="o">=</span><span class="mi">2</span> <span class="o">?</span> <span class="s">&quot;short&quot;</span><span class="o">:</span><span class="s">&quot;int&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Error</span><span class="p">(</span><span class="n">hr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">pei</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Static</span>	<span class="n">bDebug</span><span class="o">:=</span><span class="mi">1</span><span class="nf"></span>
<span class="nf">	If </span><span class="n">Not</span>	<span class="n">pei</span>
	<span class="p">{</span>
<span class="w">	</span><span class="nl">bDebug:</span><span class="o">=</span><span class="n">hr</span><span class="nf"></span>
<span class="nf">	Global</span>	<span class="n">COM_HR</span><span class="p">,</span> <span class="n">COM_LR</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_HR</span><span class="o">&amp;&amp;</span><span class="n">COM_LR</span> <span class="o">?</span> <span class="n">COM_LR</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="o">|</span><span class="n">COM_HR</span><span class="o">:</span><span class="n">COM_HR</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nb">Else</span><span class="w"> </span><span class="s">If	!bDebug</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>
<span class="w">	</span><span class="n">hr</span><span class="p"> </span><span class="o">?</span> <span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sError</span><span class="p">,</span><span class="mi">1023</span><span class="p">),</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">nError</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\FormatMessageA&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">hr</span><span class="o">&lt;&gt;</span><span class="mh">0x80020009</span> <span class="o">?</span> <span class="n">hr</span> <span class="o">:</span> <span class="p">(</span><span class="n">bExcep</span><span class="o">:=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">28</span><span class="p">))</span> <span class="o">?</span> <span class="n">hr</span> <span class="o">:</span> <span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="o">+</span><span class="mh">0x80040200</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">sError</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">nError</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;0x%08X&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">hr</span><span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">))</span> <span class="o">:</span> <span class="n">sError</span><span class="o">:=</span><span class="s">&quot;The COM Object may not be a valid Dispatch Object!`n`tFirst ensure that COM Library has been initialized through COM_Init().`n&quot;</span><span class="p">,</span> <span class="n">lr</span> <span class="o">?</span> <span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sError2</span><span class="p">,</span><span class="mi">1023</span><span class="p">),</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">nError2</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\FormatMessageA&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">lr</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">sError2</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">nError2</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;0x%08X&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">lr</span><span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">))</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">MsgBox</span><span class="p">,</span><span class="s"> 260</span><span class="p">,</span><span class="s"> COM Error Notification</span><span class="p">, % </span><span class="s">&quot;Function Name:`t&quot;&quot;&quot; . name . &quot;&quot;&quot;`nERROR:`t&quot; . sError . &quot;`t(&quot; . nError . &quot;)&quot; . (bExcep ? SubStr(NumGet(pei+24) ? DllCall(NumGet(pei+24)</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="s">pei) : &quot;&quot;</span><span class="p">,</span><span class="s">1</span><span class="p">,</span><span class="s">0) . &quot;`nPROG:`t&quot; . COM_Ansi4Unicode(NumGet(pei+4)) . COM_SysFreeString(NumGet(pei+4)) . &quot;`nDESC:`t&quot; . COM_Ansi4Unicode(NumGet(pei+8)) . COM_SysFreeString(NumGet(pei+8)) . &quot;`nHELP:`t&quot; . COM_Ansi4Unicode(NumGet(pei+12)) . COM_SysFreeString(NumGet(pei+12)) . &quot;</span><span class="p">,</span><span class="s">&quot; . NumGet(pei+16) : &quot;&quot;) . (lr ? &quot;`n`nERROR2:`t&quot; . sError2 . &quot;`t(&quot; . nError2 . &quot;)&quot; : &quot;&quot;) . &quot;`n`nWill Continue?&quot;</span><span class="w"></span>
<span class="w">	</span><span class="nf">	IfMsgBox</span><span class="p">,</span> <span class="n">No</span><span class="p">,</span> <span class="n">Exit</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CreateIDispatch</span><span class="p">()</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Static</span>	<span class="n">IDispatch</span><span class="nf"></span>
<span class="nf">	If </span><span class="n">Not</span><span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">IDispatch</span><span class="p">)</span>
	<span class="p">{</span><span class="nf"></span>
<span class="nf">		VarSetCapacity</span><span class="p">(</span><span class="n">IDispatch</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>   <span class="n">nParams</span><span class="o">=</span><span class="mi">3112469</span>
<span class="w">		</span><span class="nb">Loop</span><span class="p">,</span><span class="s">   Parse</span><span class="p">,</span><span class="s">   nParams</span><span class="w"></span>
<span class="w">		</span><span class="nf">	NumPut</span><span class="p">(</span><span class="nf">RegisterCallback</span><span class="p">(</span><span class="s">&quot;COM_DispInterface&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="nv">A_LoopField</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">IDispatch</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
	<span class="p">}</span><span class="nf"></span>
<span class="nf">	Return</span> <span class="o">&amp;</span><span class="n">IDispatch</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span> <span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span> <span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ctinf</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">ctinf</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">ppv</span><span class="w"></span>
<span class="w">	</span><span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">),</span>	<span class="n">pdisp</span> <span class="o">:=</span> <span class="n">ppv</span>
	<span class="p">}</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">pdisp</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetDefaultEvents</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">IID</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span><span class="s"> %	DllCall(NumGet(NumGet(1*ptlib)+12)</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> ptlib)</span><span class="w"></span>
<span class="w">	</span>	<span class="p">{</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">TKind</span><span class="p">)</span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="s">TKind &lt;&gt; 5</span><span class="w"></span>
<span class="w">			</span>	<span class="n">Continue</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
<span class="w">		</span><span class="nl">nCount:</span><span class="o">=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pattr</span><span class="o">+</span><span class="mi">48</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
<span class="w">		</span><span class="nb">Loop</span><span class="p">,</span><span class="s"> %	nCount</span><span class="w"></span>
<span class="w">		</span>	<span class="p">{</span><span class="nf"></span>
<span class="nf">			DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">36</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">nFlags</span><span class="p">)</span>
<span class="w">			</span><span class="n">If</span><span class="p">	</span><span class="o">!</span><span class="p">(</span><span class="n">nFlags</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">				</span><span class="nb">Continue</span><span class="w"></span>
<span class="w">			</span><span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">32</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">hRefType</span><span class="p">)</span><span class="nf"></span>
<span class="nf">			DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">56</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hRefType</span> <span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">			DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">prinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
<span class="w">			</span><span class="n">nFlags</span><span class="p"> </span><span class="o">&amp;</span> <span class="mi">2</span> <span class="o">?</span> <span class="n">DIID</span><span class="o">:=</span><span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">pattr</span><span class="p">)</span> <span class="o">:</span> <span class="n">bFind</span><span class="o">:=</span><span class="n">COM_IsEqualGUID</span><span class="p">(</span><span class="n">pattr</span><span class="p">,</span><span class="o">&amp;</span><span class="n">IID</span><span class="p">)</span><span class="nf"></span>
<span class="nf">			DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">prinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">			DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">prinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">)</span>
		<span class="p">}</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="s">bFind</span><span class="w"></span>
<span class="w">			</span>	<span class="n">Break</span>
	<span class="p">}</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">bFind</span> <span class="o">?</span> <span class="n">DIID</span> <span class="o">:</span> <span class="s">&quot;{00000000-0000-0000-0000-000000000000}&quot;</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetGuidOfName</span><span class="p">(</span><span class="n">pdisp</span><span class="p">,</span> <span class="n">Name</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">),</span> <span class="n">ptinf</span><span class="o">:=</span><span class="mi">0</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">44</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span><span class="n">Name</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">memID</span><span class="p">,</span> <span class="s">&quot;UshortP&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
<span class="w">	</span><span class="n">GUID</span><span class="p"> </span><span class="o">:=</span> <span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">pattr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">GUID</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetTypeInfoOfGuid</span><span class="p">(</span><span class="n">pdisp</span><span class="p">,</span> <span class="n">GUID</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">),</span> <span class="n">ptinf</span> <span class="o">:=</span> <span class="mi">0</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">GUID</span><span class="p">,</span><span class="n">GUID</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">ptinf</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; A Function Name including Prefix is limited to 63 bytes!</span>
<span class="n">COM_ConnectObject</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">DIID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	If </span><span class="n">Not</span>	<span class="n">DIID</span>
		<span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">pconn</span><span class="o">:=</span><span class="n">COM_FindConnectionPoint</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">))</span> <span class="o">?</span> <span class="p">(</span><span class="n">DIID</span><span class="o">:=</span><span class="n">COM_GetConnectionInterface</span><span class="p">(</span><span class="n">pconn</span><span class="p">))</span><span class="o">=</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span> <span class="o">?</span> <span class="n">DIID</span><span class="o">:=</span><span class="n">COM_GetDefaultEvents</span><span class="p">(</span><span class="n">psource</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="n">pconn</span><span class="o">:=</span><span class="n">COM_FindConnectionPoint</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="n">DIID</span><span class="o">:=</span><span class="n">COM_GetDefaultEvents</span><span class="p">(</span><span class="n">psource</span><span class="p">))</span>
<span class="w">	</span><span class="nb">Else</span><span class="w">	</span><span class="s">pconn:=COM_FindConnectionPoint(psource</span><span class="p">,</span><span class="s">SubStr(DIID</span><span class="p">,</span><span class="s">1</span><span class="p">,</span><span class="s">1)=&quot;{&quot; ? DIID : DIID:=COM_GetGuidOfName(psource</span><span class="p">,</span><span class="s">DIID))</span><span class="w"></span>
<span class="w">		</span><span class="n">If</span><span class="p">	</span><span class="o">!</span><span class="n">pconn</span> <span class="o">||</span> <span class="o">!</span><span class="n">ptinf</span><span class="o">:=</span><span class="n">COM_GetTypeInfoOfGuid</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="n">DIID</span><span class="p">)</span>
	<span class="p">{</span>
<span class="w">		</span><span class="nb">MsgBox</span><span class="p">,</span><span class="s"> No Event Interface Exists!</span><span class="w"></span>
<span class="w">		</span><span class="nf">	Return</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nl">psink:</span><span class="o">=</span><span class="n">COM_CoTaskMemAlloc</span><span class="p">(</span><span class="mi">40</span><span class="o">+</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nf"> NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="n">COM_CreateIDispatch</span><span class="p">(),</span><span class="n">psink</span><span class="o">+</span><span class="mi">0</span><span class="p">)),</span><span class="nf"> NumPut</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="n">ptinf</span><span class="p">,</span><span class="n">psink</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psink</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">DIID</span><span class="p">,</span><span class="n">DIID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psink</span><span class="o">+</span><span class="mi">40</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf"> StrLen</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	NumPut</span><span class="p">(</span><span class="n">COM_Advise</span><span class="p">(</span><span class="n">pconn</span><span class="p">,</span><span class="n">psink</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="n">pconn</span><span class="p">,</span><span class="n">psink</span><span class="o">+</span><span class="mi">16</span><span class="p">))</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">psink</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_DisconnectObject</span><span class="p">(</span><span class="n">psink</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_Unadvise</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">20</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">COM_Release</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">16</span><span class="p">)),</span><span class="n">COM_Release</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">8</span><span class="p">)),</span><span class="n">COM_CoTaskMemFree</span><span class="p">(</span><span class="n">psink</span><span class="p">))</span> <span class="o">:</span> <span class="mi">1</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CreateObject</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">CLSCTX</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateInstance&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span><span class="n">CLSID</span><span class="p">)</span> <span class="o">:</span> <span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span><span class="n">CLSID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">CLSCTX</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span><span class="n">IID</span> <span class="o">?</span> <span class="n">IID</span> <span class="o">:</span> <span class="n">IID</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;{00000000-0000-0000-C000-000000000046}&quot;</span> <span class="o">:</span> <span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">ppv</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_ActiveXObject</span><span class="p">(</span><span class="n">ProgID</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateInstance&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">)</span> <span class="o">:</span> <span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IDispatch</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetObject</span><span class="p">(</span><span class="n">Moniker</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoGetObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">Moniker</span><span class="p">,</span><span class="n">Moniker</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IDispatch</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetActiveObject</span><span class="p">(</span><span class="n">ProgID</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\GetActiveObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf"> SubStr</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">)</span> <span class="o">:</span> <span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">punk</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IDispatch</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">punk</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">CLSID</span><span class="p">,</span> <span class="n">ProgID</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CLSIDFromProgID&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CLSID</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="o">&amp;</span><span class="n">CLSID</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">CLSID</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CLSIDFromString&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CLSID</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="o">&amp;</span><span class="n">CLSID</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_ProgID4CLSID</span><span class="p">(</span><span class="n">pCLSID</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\ProgIDFromCLSID&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pCLSID</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pProgID</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="n">pProgID</span><span class="p">)</span> <span class="o">.</span> <span class="n">COM_CoTaskMemFree</span><span class="p">(</span><span class="n">pProgID</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">pGUID</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="mi">38</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\StringFromGUID2&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pGUID</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">String</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">39</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">String</span><span class="p">,</span> <span class="mi">38</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_IsEqualGUID</span><span class="p">(</span><span class="n">pGUID1</span><span class="p">,</span> <span class="n">pGUID2</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\IsEqualGUID&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pGUID1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pGUID2</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CoCreateGuid</span><span class="p">()</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">GUID</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateGuid&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">GUID</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">COM_String4GUID</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GUID</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CoTaskMemAlloc</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoTaskMemAlloc&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CoTaskMemFree</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoTaskMemFree&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CoInitialize</span><span class="p">()</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoInitialize&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_CoUninitialize</span><span class="p">()</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoUninitialize&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_SysAllocString</span><span class="p">(</span><span class="n">astr</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysAllocString&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">astr</span><span class="p">,</span><span class="n">astr</span><span class="p">))</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_SysFreeString</span><span class="p">(</span><span class="n">bstr</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysFreeString&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">bstr</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_SysStringLen</span><span class="p">(</span><span class="n">bstr</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysStringLen&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">bstr</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_SafeArrayDestroy</span><span class="p">(</span><span class="n">psar</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SafeArrayDestroy&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psar</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_VariantClear</span><span class="p">(</span><span class="n">pvar</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\VariantClear&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pvar</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="n">pvarDst</span><span class="p">,</span> <span class="n">pvarSrc</span><span class="p">,</span> <span class="n">vt</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\VariantChangeTypeEx&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pvarDst</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pvarSrc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;Ushort&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Ushort&quot;</span><span class="p">,</span> <span class="n">vt</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_SysString</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">sString</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">wString</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nLen</span><span class="o">:=</span><span class="mi">1</span><span class="o">+</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">sString</span><span class="p">))</span><span class="nf"></span>
<span class="nf">	Return	NumPut</span><span class="p">(</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">nLen</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">wString</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">nLen</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">wString</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AccInit</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">COM_Init</span><span class="p">()</span><span class="nf"></span>
<span class="nf">	If </span><span class="n">Not</span><span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;oleacc&quot;</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;LoadLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;oleacc&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AccTerm</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">COM_Term</span><span class="p">()</span><span class="nf"></span>
<span class="nf">	If </span><span class="n">h</span><span class="o">:=</span><span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;oleacc&quot;</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;FreeLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AccessibleChildren</span><span class="p">(</span><span class="n">pacc</span><span class="p">,</span> <span class="n">cChildren</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">varChildren</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">varChildren</span><span class="p">,</span><span class="n">cChildren</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;oleacc\AccessibleChildren&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> pacc</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> 0</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> cChildren+0</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> &amp;varChildren</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> cChildren:=0)=0</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">cChildren</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AccessibleObjectFromEvent</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">idObject</span><span class="p">,</span> <span class="n">idChild</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_idChild_</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;oleacc\AccessibleObjectFromEvent&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> hWnd</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> idObject</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> idChild</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> pacc</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> &amp;varChild)=0</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">pacc</span><span class="p">,</span> <span class="n">_idChild_</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AccessibleObjectFromPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_idChild_</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;oleacc\AccessibleObjectFromPoint&quot;</span><span class="p">,</span><span class="s"> &quot;int&quot;</span><span class="p">,</span><span class="s"> x</span><span class="p">,</span><span class="s"> &quot;int&quot;</span><span class="p">,</span><span class="s"> y</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> pacc</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> &amp;varChild)=0</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">pacc</span><span class="p">,</span> <span class="n">_idChild_</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AccessibleObjectFromWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">idObject</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;oleacc\AccessibleObjectFromWindow&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> hWnd</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> idObject</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> COM_GUID4String(IID</span><span class="p">,</span><span class="s"> IID ? IID : idObject&amp;0xFFFFFFFF==0xFFFFFFF0 ? &quot;{00020400-0000-0000-C000-000000000046}&quot;:&quot;{618736E0-3C3D-11CF-810C-00AA00389B71}&quot;)</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> pacc)=0</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">pacc</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_WindowFromAccessibleObject</span><span class="p">(</span><span class="n">pacc</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;oleacc\WindowFromAccessibleObject&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> pacc</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> hWnd)=0</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">hWnd</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetRoleText</span><span class="p">(</span><span class="n">nRole</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetRoleTextA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nRole</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">sRole</span><span class="p">,</span><span class="n">nSize</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;oleacc\GetRoleTextA&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> nRole</span><span class="p">,</span><span class="s"> &quot;str&quot;</span><span class="p">,</span><span class="s"> sRole</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> nSize+1)</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">sRole</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_GetStateText</span><span class="p">(</span><span class="n">nState</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetStateTextA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nState</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">sState</span><span class="p">,</span><span class="n">nSize</span><span class="p">)</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;oleacc\GetStateTextA&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> nState</span><span class="p">,</span><span class="s"> &quot;str&quot;</span><span class="p">,</span><span class="s"> sState</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> nSize+1)</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">sState</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxWinInit</span><span class="p">(</span><span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">COM_Init</span><span class="p">()</span><span class="nf"></span>
<span class="nf">	If </span><span class="n">Not</span><span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">)</span><span class="nf"></span>
<span class="nf">		DllCall</span><span class="p">(</span><span class="s">&quot;LoadLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span> <span class="o">.</span> <span class="s">&quot;\AtlAxWinInit&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxWinTerm</span><span class="p">(</span><span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">COM_Term</span><span class="p">()</span><span class="nf"></span>
<span class="nf">	If </span><span class="n">h</span><span class="o">:=</span><span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;FreeLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxAttachControl</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span> <span class="o">.</span> <span class="s">&quot;\AtlAxAttachControl&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="o">:=</span><span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">COM_Release</span><span class="p">(</span><span class="n">punk</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxCreateControl</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;atl&quot; . Version . &quot;\AtlAxCreateControl&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> COM_SysString(Name</span><span class="p">,</span><span class="s">Name)</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> hWnd</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> 0</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> 0)=0</span><span class="w"></span>
<span class="w">	</span><span class="nf">	Return</span>	<span class="n">COM_AtlAxGetControl</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxGetControl</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;atl&quot; . Version . &quot;\AtlAxGetControl&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> hWnd</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> punk)=0</span><span class="w"></span>
<span class="w">		</span>	<span class="n">pdsp</span><span class="o">:=</span><span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">punk</span><span class="p">),</span> <span class="n">COM_Release</span><span class="p">(</span><span class="n">punk</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">pdsp</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxGetHost</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p">	</span><span class="s">DllCall(&quot;atl&quot; . Version . &quot;\AtlAxGetHost&quot;</span><span class="p">,</span><span class="s"> &quot;Uint&quot;</span><span class="p">,</span><span class="s"> hWnd</span><span class="p">,</span><span class="s"> &quot;UintP&quot;</span><span class="p">,</span><span class="s"> punk)=0</span><span class="w"></span>
<span class="w">		</span>	<span class="n">pdsp</span><span class="o">:=</span><span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">punk</span><span class="p">),</span> <span class="n">COM_Release</span><span class="p">(</span><span class="n">punk</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">pdsp</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxCreateContainer</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	Return	DllCall</span><span class="p">(</span><span class="s">&quot;CreateWindowEx&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x200</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;AtlAxWin&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">Name</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">Name</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x54000000</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_AtlAxGetContainer</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span> <span class="n">bCtrl</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdsp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IOleWindow</span><span class="p">,</span><span class="s">&quot;{00000114-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pwin</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pwin</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pwin</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">hCtrl</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pwin</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pwin</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">bCtrl</span> <span class="o">?</span> <span class="n">hCtrl</span> <span class="o">:</span><span class="nf"> DllCall</span><span class="p">(</span><span class="s">&quot;GetParent&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hCtrl</span><span class="p">)</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="n">pString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p"> (</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">sString</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Unicode4Ansi</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p"> (</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">wString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="o">&amp;</span><span class="n">wString</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Ansi2Unicode</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">sString</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">If</span><span class="p"> (</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">wString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="o">&amp;</span><span class="n">wString</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_Unicode2Ansi</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">pString</span><span class="p"> </span><span class="o">:=</span> <span class="n">wString</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="mi">65535</span> <span class="o">?</span> <span class="n">wString</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">wString</span>
<span class="w">	</span><span class="n">If</span><span class="p"> (</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	VarSetCapacity</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="o">&amp;</span><span class="n">sString</span>
<span class="p">}</span><span class="w"></span>

<span class="n">COM_ScriptControl</span><span class="p">(</span><span class="n">sCode</span><span class="p">,</span> <span class="n">sLang</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">bEval</span> <span class="o">=</span> <span class="nv">False</span><span class="p">,</span> <span class="n">sFunc</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">sName</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">pdisp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bGlobal</span> <span class="o">=</span> <span class="nv">False</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">COM_Init</span><span class="p">()</span>
<span class="w">	</span><span class="n">psc</span><span class="p"> </span><span class="w"> </span><span class="o">:=</span>	<span class="n">COM_CreateObject</span><span class="p">(</span><span class="s">&quot;MSScriptControl.ScriptControl&quot;</span><span class="p">)</span>
		<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="s">&quot;Language&quot;</span><span class="p">,</span> <span class="n">sLang</span> <span class="o">?</span> <span class="n">sLang</span> <span class="o">:</span> <span class="s">&quot;VBScript&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="n">sName</span><span class="p"> </span><span class="o">?</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="s">&quot;AddObject&quot;</span><span class="p">,</span> <span class="n">sName</span><span class="p">,</span> <span class="s">&quot;+&quot;</span> <span class="o">.</span> <span class="n">pdisp</span><span class="p">,</span> <span class="n">bGlobal</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="n">sFunc</span><span class="p"> </span><span class="o">?</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="s">&quot;AddCode&quot;</span><span class="p">,</span> <span class="n">sCode</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="n">ret</span><span class="p"> </span><span class="w"> </span><span class="o">:=</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="n">bEval</span> <span class="o">?</span> <span class="s">&quot;Eval&quot;</span> <span class="o">:</span> <span class="s">&quot;ExecuteStatement&quot;</span><span class="p">,</span> <span class="n">sFunc</span> <span class="o">?</span> <span class="n">sFunc</span> <span class="o">:</span> <span class="n">sCode</span><span class="p">)</span>
	<span class="n">COM_Release</span><span class="p">(</span><span class="n">psc</span><span class="p">)</span>
	<span class="n">COM_Term</span><span class="p">()</span><span class="nf"></span>
<span class="nf">	Return</span>	<span class="n">ret</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
