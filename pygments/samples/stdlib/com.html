<LINK href="styles.css" rel="stylesheet" type="text/css">old lexer: 
<div class="highlight"><pre><span class="c1">;------------------------------------------------------------------------------</span>
<span class="c1">; COM.ahk Standard Library</span>
<span class="c1">; by Sean</span>
<span class="c1">; http://www.autohotkey.com/forum/topic22923.html</span>
<span class="c1">;------------------------------------------------------------------------------</span>

<span class="nf">COM_Init</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\OleInitialize&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_Term</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\OleUninitialize&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_VTable</span><span class="p">(</span>ppv<span class="p">,</span><span class="w"> </span>idx<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">NumGet</span><span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ppv<span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span>idx<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_QueryInterface</span><span class="p">(</span>ppv<span class="p">,</span><span class="w"> </span>IID<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ppv<span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID<span class="p">,</span>IID<span class="w"> </span><span class="o">?</span><span class="w"> </span>IID<span class="w"> </span><span class="o">:</span><span class="w"> </span>IID<span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;{00000000-0000-0000-C000-000000000046}&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>ppv
<span class="p">}</span>

<span class="nf">COM_AddRef</span><span class="p">(</span>ppv<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ppv<span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_Release</span><span class="p">(</span>ppv<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ppv<span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_QueryService</span><span class="p">(</span>ppv<span class="p">,</span><span class="w"> </span>SID<span class="p">,</span><span class="w"> </span>IID<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ppv<span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID_IServiceProvider<span class="p">,</span><span class="s">&quot;{6D5140C1-7436-11CE-8034-00AA006009FA}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>psp<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>psp<span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>psp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>SID<span class="p">,</span>SID<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>IID<span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID<span class="p">,</span>IID<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span>SID<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="o">:=</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>psp<span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>psp<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>ppv
<span class="p">}</span>

<span class="nf">COM_FindConnectionPoint</span><span class="p">(</span>pdp<span class="p">,</span><span class="w"> </span>DIID<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdp<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID_IConnectionPointContainer<span class="p">,</span><span class="w"> </span><span class="s">&quot;{B196B284-BAB4-101A-B69C-00AA00341D07}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pcc<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pcc<span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pcc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>DIID<span class="p">,</span>DIID<span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pcp<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pcc<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pcc<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>pcp
<span class="p">}</span>

<span class="nf">COM_GetConnectionInterface</span><span class="p">(</span>pcp<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>DIID<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pcp<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pcp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>DIID<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_String4GUID</span><span class="p">(</span><span class="o">&amp;</span>DIID<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_Advise</span><span class="p">(</span>pcp<span class="p">,</span><span class="w"> </span>psink<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pcp<span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pcp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>psink<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>nCookie<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>nCookie
<span class="p">}</span>

<span class="nf">COM_Unadvise</span><span class="p">(</span>pcp<span class="p">,</span><span class="w"> </span>nCookie<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pcp<span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pcp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nCookie<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_Enumerate</span><span class="p">(</span>penum<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>Result<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>vt<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>varResult<span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">If</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w">	</span>hr<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>penum<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>penum<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>varResult<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">		</span>Result<span class="o">:=</span><span class="p">(</span>vt<span class="o">:=</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">9</span><span class="o">||</span>vt<span class="o">=</span><span class="mi">13</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span>vt<span class="o">=</span><span class="mi">8</span><span class="o">||</span>vt<span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span>COM_VariantChangeType<span class="p">(</span><span class="o">&amp;</span>varResult<span class="p">,</span><span class="o">&amp;</span>varResult<span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_VariantClear<span class="p">(</span><span class="o">&amp;</span>varResult<span class="p">)</span><span class="o">:</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>hr
<span class="p">}</span>

<span class="nf">COM_Invoke</span><span class="p">(</span>pdsp<span class="p">,</span>name<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm0<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm1<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm2<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm3<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm4<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm5<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm6<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm7<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm8<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span>prm9<span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span>name<span class="o">=</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_Release</span><span class="p">(</span>pdsp<span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span>name<span class="w"> </span>contains<span class="w"> </span><span class="p">.</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="nf">SubStr</span><span class="p">(</span>name<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>name<span class="p">.</span><span class="o">=</span><span class="s">&quot;.&quot;</span><span class="o">:</span>name<span class="o">:=</span>SubStr<span class="p">(</span>name<span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">,</span>COM_AddRef<span class="p">(</span>pdsp<span class="p">)</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>name<span class="p">,</span><span class="w"> </span><span class="p">.</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nb">A_Index</span><span class="o">=</span><span class="mi">1</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span>name<span class="w"> </span><span class="o">:=</span><span class="w">	</span><span class="nb">A_LoopField</span>
<span class="w">		</span><span class="k">Continue</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span>name<span class="w"> </span>not<span class="w"> </span>contains<span class="w"> </span><span class="k">[,(</span>
<span class="k">		prmn :=	&quot;&quot;</span>
<span class="k">	Else If	InStr(&quot;]</span><span class="err">)&quot;,SubStr(name,0))</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>name<span class="p">,</span><span class="w"> </span><span class="nf">[</span><span class="p">(,</span><span class="err">&#39;</span><span class="s">&quot;)]</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nb">A_Index</span><span class="o">=</span><span class="mi">1</span>
<span class="w">		</span>name<span class="w"> </span><span class="o">:=</span><span class="w">	</span><span class="nb">A_LoopField</span>
<span class="w">	</span><span class="k">Else</span><span class="w">	</span>prmn<span class="w"> </span><span class="o">:=</span><span class="w">	</span><span class="nb">A_LoopField</span>
<span class="w">	</span><span class="k">Else</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span>name<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w">	</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="nb">A_LoopField</span>
<span class="w">		</span><span class="k">Continue</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nb">A_LoopField</span><span class="o">!=</span>
<span class="w">		</span>pdsp<span class="o">:=</span><span class="w">	</span>COM_Invoke<span class="p">(</span>pdsp<span class="p">,</span>name<span class="p">,</span>prmn<span class="o">!=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>prmn<span class="o">:</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span><span class="o">+</span>COM_Release<span class="p">(</span>pdsp<span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span>name<span class="o">:=</span><span class="nb">A_LoopField</span>
<span class="w">	</span><span class="k">Else</span><span class="w">	</span><span class="k">Return</span><span class="w">	</span>prmn<span class="o">!=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_Invoke<span class="p">(</span>pdsp<span class="p">,</span>name<span class="p">,</span>prmn<span class="p">,</span>prm0<span class="p">,</span>prm1<span class="p">,</span>prm2<span class="p">,</span>prm3<span class="p">,</span>prm4<span class="p">,</span>prm5<span class="p">,</span>prm6<span class="p">,</span>prm7<span class="p">,</span>prm8<span class="p">)</span><span class="o">:</span>COM_Invoke<span class="p">(</span>pdsp<span class="p">,</span>name<span class="p">,</span>prm0<span class="p">,</span>prm1<span class="p">,</span>prm2<span class="p">,</span>prm3<span class="p">,</span>prm4<span class="p">,</span>prm5<span class="p">,</span>prm6<span class="p">,</span>prm7<span class="p">,</span>prm8<span class="p">,</span>prm9<span class="p">),</span>COM_Release<span class="p">(</span>pdsp<span class="p">)</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span>sParams<span class="w">	</span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;0123456789&quot;</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>sParams
<span class="w">		</span><span class="nf">If</span><span class="w">	</span><span class="p">(</span>prm<span class="nv">%A_LoopField%</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span>
<span class="w">		</span><span class="p">{</span>
<span class="w">			</span>sParams<span class="w">	</span><span class="o">:=</span><span class="w"> </span>SubStr<span class="p">(</span>sParams<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">			</span><span class="k">Break</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>varg<span class="p">,</span><span class="mi">16</span><span class="o">*</span>nParams<span class="o">:=</span>StrLen<span class="p">(</span>sParams<span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>DispParams<span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>varResult<span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>ExcepInfo<span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w"> 	</span>Parse<span class="p">,</span><span class="w">	</span>sParams
<span class="c1">;		If	prm%A_LoopField%+0==&quot;&quot; || InStr(prm%A_LoopField%,&quot;.&quot;) || prm%A_LoopField%&gt;=0x80000000 || prm%A_LoopField%&lt;-0x80000000</span>
<span class="w">		</span><span class="kr">If</span><span class="w">	</span>prm<span class="nv">%A_LoopField%</span><span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>integer
<span class="w">			</span><span class="nf">NumPut</span><span class="p">(</span>COM_SysString<span class="p">(</span>prm<span class="nv">%A_LoopField%</span><span class="p">,</span>prm<span class="nv">%A_LoopField%</span><span class="p">),</span>NumPut<span class="p">(</span><span class="mi">8</span><span class="p">,</span>varg<span class="p">,(</span>nParams<span class="o">-</span><span class="nb">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">		</span><span class="k">Else</span><span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>SubStr<span class="p">(</span>prm<span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;+&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">9</span><span class="o">:</span>prm<span class="nv">%A_LoopField%</span><span class="o">==</span><span class="s">&quot;-0&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>prm<span class="nv">%A_LoopField%</span><span class="o">:=</span><span class="mh">0x80020004</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="mi">10</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span>NumPut<span class="p">(</span>prm<span class="nv">%A_LoopField%</span><span class="p">,</span>varg<span class="p">,(</span>nParams<span class="o">-</span><span class="nb">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span>nParams
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span>nParams<span class="p">,</span>NumPut<span class="p">(</span><span class="o">&amp;</span>varg<span class="p">,</span>DispParams<span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nf">If</span><span class="w">	</span><span class="p">(</span>nvk<span class="w"> </span><span class="o">:=</span><span class="w">	</span>SubStr<span class="p">(</span>name<span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;=&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">12</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">12</span>
<span class="w">		</span>name<span class="w"> </span><span class="o">:=</span><span class="w">	</span>SubStr<span class="p">(</span>name<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>NumPut<span class="p">(</span><span class="mi">1</span><span class="p">,</span>NumPut<span class="p">(</span>NumPut<span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>varResult<span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>DispParams<span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="kt">Global</span><span class="w">	</span>COM_HR<span class="p">,</span><span class="w"> </span>COM_LR<span class="o">:=</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nf">If</span><span class="w">	</span><span class="p">(</span>COM_HR<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdsp<span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pdsp<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span>COM_SysString<span class="p">(</span>wname<span class="p">,</span>name<span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;intP&quot;</span><span class="p">,</span>dispID<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span>COM_HR<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdsp<span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pdsp<span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span>dispID<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span>nvk<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>DispParams<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>ExcepInfo<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="o">&amp;&amp;</span>nParams<span class="o">&amp;&amp;</span>nvk<span class="o">!=</span><span class="mi">12</span><span class="o">&amp;&amp;</span><span class="p">(</span>COM_LR<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdsp<span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pdsp<span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span>dispID<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>NumPut<span class="p">(</span><span class="mi">1</span><span class="p">,</span>NumPut<span class="p">(</span>NumPut<span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>varResult<span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>DispParams<span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span>COM_HR<span class="o">:=</span><span class="mi">0</span>
<span class="w">	</span><span class="kt">Global</span><span class="w">	</span>COM_VT<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>COM_HR<span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_VT<span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_VT<span class="o">=</span><span class="mi">9</span><span class="o">||</span>COM_VT<span class="o">=</span><span class="mi">13</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span>COM_VT<span class="o">=</span><span class="mi">8</span><span class="o">||</span>COM_VT<span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span>COM_VariantChangeType<span class="p">(</span><span class="o">&amp;</span>varResult<span class="p">,</span><span class="o">&amp;</span>varResult<span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_VariantClear<span class="p">(</span><span class="o">&amp;</span>varResult<span class="p">)</span><span class="o">:</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">:</span>COM_Error<span class="p">(</span>COM_HR<span class="p">,</span>COM_LR<span class="p">,</span><span class="o">&amp;</span>ExcepInfo<span class="p">,</span>name<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_Invoke_</span><span class="p">(</span>pdsp<span class="p">,</span>name<span class="p">,</span>typ0<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm0<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ1<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm1<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ2<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm2<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ3<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm3<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ4<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm4<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ5<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm5<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ6<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm6<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ7<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm7<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ8<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm8<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>typ9<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>prm9<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span>name<span class="w"> </span>contains<span class="w"> </span><span class="p">.</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="nf">SubStr</span><span class="p">(</span>name<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>name<span class="p">.</span><span class="o">=</span><span class="s">&quot;.&quot;</span><span class="o">:</span>name<span class="o">:=</span>SubStr<span class="p">(</span>name<span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span>COM_AddRef<span class="p">(</span>pdsp<span class="p">)</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>name<span class="p">,</span><span class="w"> </span><span class="p">.</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nb">A_Index</span><span class="o">=</span><span class="mi">1</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span>name<span class="w"> </span><span class="o">:=</span><span class="w">	</span><span class="nb">A_LoopField</span>
<span class="w">		</span><span class="k">Continue</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span>name<span class="w"> </span>not<span class="w"> </span>contains<span class="w"> </span><span class="k">[,(</span>
<span class="k">		prmn :=	&quot;&quot;</span>
<span class="k">	Else If	InStr(&quot;]</span><span class="err">)&quot;,SubStr(name,0))</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>name<span class="p">,</span><span class="w"> </span><span class="nf">[</span><span class="p">(,</span><span class="err">&#39;</span><span class="s">&quot;)]</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nb">A_Index</span><span class="o">=</span><span class="mi">1</span>
<span class="w">		</span>name<span class="w"> </span><span class="o">:=</span><span class="w">	</span><span class="nb">A_LoopField</span>
<span class="w">	</span><span class="k">Else</span><span class="w">	</span>prmn<span class="w"> </span><span class="o">:=</span><span class="w">	</span><span class="nb">A_LoopField</span>
<span class="w">	</span><span class="k">Else</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span>name<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w">	</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="nb">A_LoopField</span>
<span class="w">		</span><span class="k">Continue</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nb">A_LoopField</span><span class="o">!=</span>
<span class="w">		</span>pdsp<span class="o">:=</span><span class="w">	</span>COM_Invoke<span class="p">(</span>pdsp<span class="p">,</span>name<span class="p">,</span>prmn<span class="o">!=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>prmn<span class="o">:</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span><span class="o">+</span>COM_Release<span class="p">(</span>pdsp<span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span>name<span class="o">:=</span><span class="nb">A_LoopField</span>
<span class="w">	</span><span class="k">Else</span><span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_Invoke_</span><span class="p">(</span>pdsp<span class="p">,</span>name<span class="p">,</span>typ0<span class="p">,</span>prm0<span class="p">,</span>typ1<span class="p">,</span>prm1<span class="p">,</span>typ2<span class="p">,</span>prm2<span class="p">,</span>typ3<span class="p">,</span>prm3<span class="p">,</span>typ4<span class="p">,</span>prm4<span class="p">,</span>typ5<span class="p">,</span>prm5<span class="p">,</span>typ6<span class="p">,</span>prm6<span class="p">,</span>typ7<span class="p">,</span>prm7<span class="p">,</span>typ8<span class="p">,</span>prm8<span class="p">,</span>typ9<span class="p">,</span>prm9<span class="p">),</span><span class="nf">COM_Release</span><span class="p">(</span>pdsp<span class="p">)</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span>sParams<span class="w">	</span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;0123456789&quot;</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>sParams
<span class="w">		</span><span class="nf">If</span><span class="w">	</span><span class="p">(</span>typ<span class="nv">%A_LoopField%</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">		</span><span class="p">{</span>
<span class="w">			</span>sParams<span class="w">	</span><span class="o">:=</span><span class="w"> </span>SubStr<span class="p">(</span>sParams<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">			</span><span class="k">Break</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>varg<span class="p">,</span><span class="mi">16</span><span class="o">*</span>nParams<span class="o">:=</span>StrLen<span class="p">(</span>sParams<span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>DispParams<span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>varResult<span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>VarSetCapacity<span class="p">(</span>ExcepInfo<span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>sParams
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span>typ<span class="nv">%A_LoopField%</span><span class="p">,</span>varg<span class="p">,(</span>nParams<span class="o">-</span><span class="nb">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">),</span>typ<span class="nv">%A_LoopField%</span><span class="o">&amp;</span><span class="mh">0x4000</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>NumPut<span class="p">(</span>typ<span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mi">8</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_SysString<span class="p">(</span>prm<span class="nv">%A_LoopField%</span><span class="p">,</span>prm<span class="nv">%A_LoopField%</span><span class="p">)</span><span class="o">:</span>prm<span class="nv">%A_LoopField%</span><span class="p">,</span>varg<span class="p">,(</span>nParams<span class="o">-</span><span class="nb">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span>typ<span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">)</span><span class="o">:</span><span class="p">(</span>VarSetCapacity<span class="p">(</span>_ref_<span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>NumPut<span class="p">(</span><span class="o">&amp;</span>_ref_<span class="nv">%A_LoopField%</span><span class="p">,</span>varg<span class="p">,(</span>nParams<span class="o">-</span><span class="nb">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span>NumPut<span class="p">((</span>prmx<span class="o">:=</span>prm<span class="nv">%A_LoopField%</span><span class="p">)</span><span class="o">&amp;&amp;</span>typ<span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4008</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_SysAllocString<span class="p">(</span><span class="nv">%prmx%</span><span class="p">)</span><span class="o">:</span><span class="nv">%prmx%</span><span class="p">,</span>_ref_<span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>typ<span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4005</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">))</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span>nParams
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span>nParams<span class="p">,</span>NumPut<span class="p">(</span><span class="o">&amp;</span>varg<span class="p">,</span>DispParams<span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nf">If</span><span class="w">	</span><span class="p">(</span>nvk<span class="w"> </span><span class="o">:=</span><span class="w">	</span>SubStr<span class="p">(</span>name<span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;=&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">12</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">12</span>
<span class="w">		</span>name<span class="w"> </span><span class="o">:=</span><span class="w">	</span>SubStr<span class="p">(</span>name<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>NumPut<span class="p">(</span><span class="mi">1</span><span class="p">,</span>NumPut<span class="p">(</span>NumPut<span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>varResult<span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>DispParams<span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="kt">Global</span><span class="w">	</span>COM_HR<span class="p">,</span><span class="w"> </span>COM_LR<span class="o">:=</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nf">If</span><span class="w">	</span><span class="p">(</span>COM_HR<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdsp<span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pdsp<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span>COM_SysString<span class="p">(</span>wname<span class="p">,</span>name<span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;intP&quot;</span><span class="p">,</span>dispID<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span>COM_HR<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdsp<span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pdsp<span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span>dispID<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span>nvk<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>DispParams<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>ExcepInfo<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="o">&amp;&amp;</span>nParams<span class="o">&amp;&amp;</span>nvk<span class="o">!=</span><span class="mi">12</span><span class="o">&amp;&amp;</span><span class="p">(</span>COM_LR<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdsp<span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pdsp<span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span>dispID<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>varResult<span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>NumPut<span class="p">(</span><span class="mi">1</span><span class="p">,</span>NumPut<span class="p">(</span>NumPut<span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>varResult<span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>DispParams<span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span>COM_HR<span class="o">:=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span>Parse<span class="p">,</span><span class="w">	</span>sParams
<span class="w">		</span>typ<span class="nv">%A_LoopField%</span><span class="o">&amp;</span><span class="mh">0x4000</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>prmx<span class="o">:=</span>prm<span class="nv">%A_LoopField%</span><span class="p">,</span><span class="nv">%prmx%</span><span class="o">:=</span>typ<span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4008</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>prmx<span class="o">:=</span>NumGet<span class="p">(</span>_ref_<span class="nv">%A_LoopField%</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_SysFreeString<span class="p">(</span>prmx<span class="p">)</span><span class="o">:</span>NumGet<span class="p">(</span>_ref_<span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>typ<span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4005</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">))</span><span class="o">:</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="kt">Global</span><span class="w">	</span>COM_VT<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>COM_HR<span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_VT<span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_VT<span class="o">=</span><span class="mi">9</span><span class="o">||</span>COM_VT<span class="o">=</span><span class="mi">13</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span>COM_VT<span class="o">=</span><span class="mi">8</span><span class="o">||</span>COM_VT<span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span>COM_VariantChangeType<span class="p">(</span><span class="o">&amp;</span>varResult<span class="p">,</span><span class="o">&amp;</span>varResult<span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_VariantClear<span class="p">(</span><span class="o">&amp;</span>varResult<span class="p">)</span><span class="o">:</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">:</span>COM_Error<span class="p">(</span>COM_HR<span class="p">,</span>COM_LR<span class="p">,</span><span class="o">&amp;</span>ExcepInfo<span class="p">,</span>name<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_DispInterface</span><span class="p">(</span>this<span class="p">,</span><span class="w"> </span>prm1<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>prm2<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>prm3<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>prm4<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>prm5<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>prm6<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>prm7<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>prm8<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Critical</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nb">A_EventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
<span class="w">		</span>hr<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">0</span><span class="o">+</span>p<span class="o">:=</span>NumGet<span class="p">(</span>this<span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">28</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>p<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>prm1<span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span>pname<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>hr<span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>VarSetCapacity<span class="p">(</span>sfn<span class="p">,</span><span class="mi">63</span><span class="p">),</span>DllCall<span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span>sfn<span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;%s%S&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>this<span class="o">+</span><span class="mi">40</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pname<span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">),</span>COM_SysFreeString<span class="p">(</span>pname<span class="p">),</span><span class="nv">%sfn%</span><span class="p">(</span>prm5<span class="p">,</span>this<span class="p">,</span>prm6<span class="p">))</span><span class="o">:</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span><span class="nb">A_EventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">		</span>hr<span class="o">:=</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">0</span><span class="o">+</span>p<span class="o">:=</span>NumGet<span class="p">(</span>this<span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>p<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>prm2<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>prm3<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>prm5<span class="p">)</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span><span class="nb">A_EventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span>hr<span class="o">:=</span><span class="mh">0x80004001</span><span class="p">,</span>prm3<span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span><span class="nb">A_EventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>prm1<span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span><span class="nb">A_EventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span>hr<span class="o">:=</span>NumGet<span class="p">(</span>this<span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>this<span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span><span class="nb">A_EventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span>hr<span class="o">:=</span>NumGet<span class="p">(</span>this<span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>this<span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span><span class="nb">A_EventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">		</span><span class="nf">COM_IsEqualGUID</span><span class="p">(</span>this<span class="o">+</span><span class="mi">24</span><span class="p">,</span>prm1<span class="p">)</span><span class="o">||</span>InStr<span class="p">(</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}{00000000-0000-0000-C000-000000000046}&quot;</span><span class="p">,</span>COM_String4GUID<span class="p">(</span>prm1<span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>NumPut<span class="p">(</span>NumPut<span class="p">(</span>NumGet<span class="p">(</span>this<span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>this<span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span>prm2<span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span>NumPut<span class="p">(</span><span class="mi">0</span><span class="o">*</span>hr<span class="o">:=</span><span class="mh">0x80004002</span><span class="p">,</span>prm2<span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>hr
<span class="p">}</span>

<span class="nf">COM_DispGetParam</span><span class="p">(</span>pDispParams<span class="p">,</span><span class="w"> </span>Position<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>vt<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>varResult<span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\DispGetParam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pDispParams<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>Position<span class="p">,</span><span class="w"> </span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="w"> </span>vt<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>varResult<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>nArgErr<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">NumGet</span><span class="p">(</span>varResult<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="o">=</span><span class="mi">8</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_VariantClear<span class="p">(</span><span class="o">&amp;</span>varResult<span class="p">)</span><span class="o">:</span>NumGet<span class="p">(</span>varResult<span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_DispSetParam</span><span class="p">(</span>val<span class="p">,</span><span class="w"> </span>pDispParams<span class="p">,</span><span class="w"> </span>Position<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>vt<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>vt<span class="o">=</span><span class="mi">8</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_SysAllocString<span class="p">(</span>val<span class="p">)</span><span class="o">:</span>val<span class="p">,</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span>pDispParams<span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span>NumGet<span class="p">(</span>pDispParams<span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span>Position<span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">-</span><span class="mi">8</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span>vt<span class="o">=</span><span class="mi">11</span><span class="o">||</span>vt<span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;short&quot;</span><span class="o">:</span><span class="s">&quot;int&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_Error</span><span class="p">(</span>hr<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>lr<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>pei<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>name<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">Static</span><span class="w">	</span>bDebug<span class="o">:=</span><span class="mi">1</span>
<span class="w">	</span><span class="kr">If</span><span class="w"> </span>Not<span class="w">	</span>pei
<span class="w">	</span><span class="p">{</span>
<span class="w">	</span>bDebug<span class="o">:=</span>hr
<span class="w">	</span><span class="kt">Global</span><span class="w">	</span>COM_HR<span class="p">,</span><span class="w"> </span>COM_LR
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>COM_HR<span class="o">&amp;&amp;</span>COM_LR<span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_LR<span class="o">&lt;&lt;</span><span class="mi">32</span><span class="o">|</span>COM_HR<span class="o">:</span>COM_HR
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span><span class="o">!</span>bDebug
<span class="w">	</span><span class="k">Return</span>
<span class="w">	</span>hr<span class="w"> </span><span class="nf">?</span><span class="w"> </span><span class="p">(</span>VarSetCapacity<span class="p">(</span>sError<span class="p">,</span><span class="mi">1023</span><span class="p">),</span>VarSetCapacity<span class="p">(</span>nError<span class="p">,</span><span class="mi">10</span><span class="p">),</span>DllCall<span class="p">(</span><span class="s">&quot;kernel32\FormatMessageA&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>hr<span class="o">&lt;&gt;</span><span class="mh">0x80020009</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>hr<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span>bExcep<span class="o">:=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>hr<span class="o">:=</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">28</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>hr<span class="w"> </span><span class="o">:</span><span class="w"> </span>hr<span class="o">:=</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="o">+</span><span class="mh">0x80040200</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span>sError<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>DllCall<span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span>nError<span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;0x%08X&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>hr<span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>sError<span class="o">:=</span><span class="s">&quot;The COM Object may not be a valid Dispatch Object!</span><span class="se">`n`t</span><span class="s">First ensure that COM Library has been initialized through COM_Init().</span><span class="se">`n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>lr<span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>VarSetCapacity<span class="p">(</span>sError2<span class="p">,</span><span class="mi">1023</span><span class="p">),</span>VarSetCapacity<span class="p">(</span>nError2<span class="p">,</span><span class="mi">10</span><span class="p">),</span>DllCall<span class="p">(</span><span class="s">&quot;kernel32\FormatMessageA&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>lr<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span>sError2<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>DllCall<span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span>nError2<span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;0x%08X&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>lr<span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="k">MsgBox</span><span class="p">,</span><span class="w"> </span><span class="mi">260</span><span class="p">,</span><span class="w"> </span>COM<span class="w"> </span>Error<span class="w"> </span>Notification<span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;Function Name:</span><span class="se">`t</span><span class="s">&quot;&quot;&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>name<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span><span class="se">`n</span><span class="s">ERROR:</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>sError<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`t</span><span class="s">(&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>nError<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">(</span>bExcep<span class="w"> </span><span class="o">?</span><span class="w"> </span>SubStr<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span>pei<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">PROG:</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">4</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_SysFreeString<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">4</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">DESC:</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_SysFreeString<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">HELP:</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_Ansi4Unicode<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">12</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>COM_SysFreeString<span class="p">(</span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">12</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>NumGet<span class="p">(</span>pei<span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">(</span>lr<span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n`n</span><span class="s">ERROR2:</span><span class="se">`t</span><span class="s">&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>sError2<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`t</span><span class="s">(&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>nError2<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n`n</span><span class="s">Will Continue?&quot;</span>
<span class="w">	</span><span class="k">IfMsgBox</span><span class="p">,</span><span class="w"> </span>No<span class="p">,</span><span class="w"> </span><span class="k">Exit</span>
<span class="p">}</span>

<span class="nf">COM_CreateIDispatch</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">Static</span><span class="w">	</span>IDispatch
<span class="w">	</span><span class="kr">If</span><span class="w"> </span>Not<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>IDispatch<span class="p">)</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="nf">VarSetCapacity</span><span class="p">(</span>IDispatch<span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w">   </span>nParams<span class="o">=</span><span class="mi">3112469</span>
<span class="w">		</span><span class="k">Loop</span><span class="p">,</span><span class="w">   </span>Parse<span class="p">,</span><span class="w">   </span>nParams
<span class="w">		</span><span class="nf">NumPut</span><span class="p">(</span>RegisterCallback<span class="p">(</span><span class="s">&quot;COM_DispInterface&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="nb">A_LoopField</span><span class="p">,</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>IDispatch<span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">Return</span><span class="w"> </span><span class="o">&amp;</span>IDispatch
<span class="p">}</span>

<span class="nf">COM_GetDefaultInterface</span><span class="p">(</span>pdisp<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdisp<span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ctinf<span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span>ctinf
<span class="w">	</span><span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdisp<span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdisp<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>pattr<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span>ppv
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdisp<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">),</span><span class="w">	</span>pdisp<span class="w"> </span><span class="o">:=</span><span class="w"> </span>ppv
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>pdisp
<span class="p">}</span>

<span class="nf">COM_GetDefaultEvents</span><span class="p">(</span>pdisp<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdisp<span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>IID<span class="p">,</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>IID<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pattr<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>idx<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w">	</span>DllCall<span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">)</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>TKind<span class="p">)</span>
<span class="w">		</span><span class="kr">If</span><span class="w">	</span>TKind<span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">5</span>
<span class="w">			</span><span class="k">Continue</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">		</span>nCount<span class="o">:=</span>NumGet<span class="p">(</span>pattr<span class="o">+</span><span class="mi">48</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">		</span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w">	</span>nCount
<span class="w">		</span><span class="p">{</span>
<span class="w">			</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">36</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>nFlags<span class="p">)</span>
<span class="w">			</span><span class="kr">If</span><span class="w">	</span><span class="o">!</span><span class="p">(</span>nFlags<span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">				</span><span class="k">Continue</span>
<span class="w">			</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">32</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>hRefType<span class="p">)</span>
<span class="w">			</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">56</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hRefType<span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>prinf<span class="p">)</span>
<span class="w">			</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>prinf<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>prinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">			</span>nFlags<span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>DIID<span class="o">:=</span>COM_String4GUID<span class="p">(</span>pattr<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>bFind<span class="o">:=</span>COM_IsEqualGUID<span class="p">(</span>pattr<span class="p">,</span><span class="o">&amp;</span>IID<span class="p">)</span>
<span class="w">			</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>prinf<span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>prinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">			</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>prinf<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>prinf<span class="p">)</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">		</span><span class="kr">If</span><span class="w">	</span>bFind
<span class="w">			</span><span class="k">Break</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>bFind<span class="w"> </span><span class="o">?</span><span class="w"> </span>DIID<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;{00000000-0000-0000-0000-000000000000}&quot;</span>
<span class="p">}</span>

<span class="nf">COM_GetGuidOfName</span><span class="p">(</span>pdisp<span class="p">,</span><span class="w"> </span>Name<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdisp<span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>idx<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">),</span><span class="w"> </span>ptinf<span class="o">:=</span><span class="mi">0</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="mi">44</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_SysString<span class="p">(</span>Name<span class="p">,</span>Name<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>memID<span class="p">,</span><span class="w"> </span><span class="s">&quot;UshortP&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">	</span>GUID<span class="w"> </span><span class="o">:=</span><span class="w"> </span>COM_String4GUID<span class="p">(</span>pattr<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>pattr<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>GUID
<span class="p">}</span>

<span class="nf">COM_GetTypeInfoOfGuid</span><span class="p">(</span>pdisp<span class="p">,</span><span class="w"> </span>GUID<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdisp<span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>idx<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptinf<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">),</span><span class="w"> </span>ptinf<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>GUID<span class="p">,</span>GUID<span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ptinf<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>ptlib<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>ptlib<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>ptinf
<span class="p">}</span>

<span class="c1">; A Function Name including Prefix is limited to 63 bytes!</span>
<span class="nf">COM_ConnectObject</span><span class="p">(</span>psource<span class="p">,</span><span class="w"> </span>prefix<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>DIID<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w"> </span>Not<span class="w">	</span>DIID
<span class="w">		</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span>pconn<span class="o">:=</span>COM_FindConnectionPoint<span class="p">(</span>psource<span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>DIID<span class="o">:=</span>COM_GetConnectionInterface<span class="p">(</span>pconn<span class="p">))</span><span class="o">=</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>DIID<span class="o">:=</span>COM_GetDefaultEvents<span class="p">(</span>psource<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>pconn<span class="o">:=</span>COM_FindConnectionPoint<span class="p">(</span>psource<span class="p">,</span>DIID<span class="o">:=</span>COM_GetDefaultEvents<span class="p">(</span>psource<span class="p">))</span>
<span class="w">	</span><span class="k">Else</span><span class="w">	</span>pconn<span class="o">:=</span>COM_FindConnectionPoint<span class="p">(</span>psource<span class="p">,</span>SubStr<span class="p">(</span>DIID<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>DIID<span class="w"> </span><span class="o">:</span><span class="w"> </span>DIID<span class="o">:=</span>COM_GetGuidOfName<span class="p">(</span>psource<span class="p">,</span>DIID<span class="p">))</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="o">!</span>pconn<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span>ptinf<span class="o">:=</span>COM_GetTypeInfoOfGuid<span class="p">(</span>psource<span class="p">,</span>DIID<span class="p">)</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="k">MsgBox</span><span class="p">,</span><span class="w"> </span>No<span class="w"> </span>Event<span class="w"> </span>Interface<span class="w"> </span>Exists<span class="o">!</span>
<span class="w">		</span><span class="k">Return</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span>psink<span class="o">:=</span>COM_CoTaskMemAlloc<span class="p">(</span><span class="mi">40</span><span class="o">+</span>StrLen<span class="p">(</span>prefix<span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span>NumPut<span class="p">(</span><span class="mi">1</span><span class="p">,</span>NumPut<span class="p">(</span>COM_CreateIDispatch<span class="p">(),</span>psink<span class="o">+</span><span class="mi">0</span><span class="p">)),</span><span class="w"> </span>NumPut<span class="p">(</span>psource<span class="p">,</span>NumPut<span class="p">(</span>ptinf<span class="p">,</span>psink<span class="o">+</span><span class="mi">8</span><span class="p">))</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>psink<span class="o">+</span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>DIID<span class="p">,</span>DIID<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>psink<span class="o">+</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>prefix<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>StrLen<span class="p">(</span>prefix<span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>COM_Advise<span class="p">(</span>pconn<span class="p">,</span>psink<span class="p">),</span>NumPut<span class="p">(</span>pconn<span class="p">,</span>psink<span class="o">+</span><span class="mi">16</span><span class="p">))</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>psink
<span class="p">}</span>

<span class="nf">COM_DisconnectObject</span><span class="p">(</span>psink<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_Unadvise</span><span class="p">(</span>NumGet<span class="p">(</span>psink<span class="o">+</span><span class="mi">16</span><span class="p">),</span>NumGet<span class="p">(</span>psink<span class="o">+</span><span class="mi">20</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>COM_Release<span class="p">(</span>NumGet<span class="p">(</span>psink<span class="o">+</span><span class="mi">16</span><span class="p">)),</span>COM_Release<span class="p">(</span>NumGet<span class="p">(</span>psink<span class="o">+</span><span class="mi">8</span><span class="p">)),</span>COM_CoTaskMemFree<span class="p">(</span>psink<span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">}</span>

<span class="nf">COM_CreateObject</span><span class="p">(</span>CLSID<span class="p">,</span><span class="w"> </span>IID<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>CLSCTX<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateInstance&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>SubStr<span class="p">(</span>CLSID<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>CLSID<span class="p">,</span>CLSID<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>COM_CLSID4ProgID<span class="p">(</span>CLSID<span class="p">,</span>CLSID<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>CLSCTX<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID<span class="p">,</span>IID<span class="w"> </span><span class="o">?</span><span class="w"> </span>IID<span class="w"> </span><span class="o">:</span><span class="w"> </span>IID<span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;{00000000-0000-0000-C000-000000000046}&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>ppv<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>ppv
<span class="p">}</span>

<span class="nf">COM_ActiveXObject</span><span class="p">(</span>ProgID<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateInstance&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>SubStr<span class="p">(</span>ProgID<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>ProgID<span class="p">,</span>ProgID<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>COM_CLSID4ProgID<span class="p">(</span>ProgID<span class="p">,</span>ProgID<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID_IDispatch<span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_GetDefaultInterface</span><span class="p">(</span>pdisp<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_GetObject</span><span class="p">(</span>Moniker<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoGetObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_SysString<span class="p">(</span>Moniker<span class="p">,</span>Moniker<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID_IDispatch<span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_GetDefaultInterface</span><span class="p">(</span>pdisp<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_GetActiveObject</span><span class="p">(</span>ProgID<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\GetActiveObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>SubStr<span class="p">(</span>ProgID<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>ProgID<span class="p">,</span>ProgID<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>COM_CLSID4ProgID<span class="p">(</span>ProgID<span class="p">,</span>ProgID<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>punk<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>punk<span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>punk<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID_IDispatch<span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>punk<span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>punk<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_GetDefaultInterface</span><span class="p">(</span>pdisp<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_CLSID4ProgID</span><span class="p">(</span>ByRef<span class="w"> </span>CLSID<span class="p">,</span><span class="w"> </span>ProgID<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>CLSID<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CLSIDFromProgID&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_SysString<span class="p">(</span>ProgID<span class="p">,</span>ProgID<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CLSID<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="o">&amp;</span>CLSID
<span class="p">}</span>

<span class="nf">COM_GUID4String</span><span class="p">(</span>ByRef<span class="w"> </span>CLSID<span class="p">,</span><span class="w"> </span>String<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>CLSID<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CLSIDFromString&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_SysString<span class="p">(</span>String<span class="p">,</span>String<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CLSID<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="o">&amp;</span>CLSID
<span class="p">}</span>

<span class="nf">COM_ProgID4CLSID</span><span class="p">(</span>pCLSID<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\ProgIDFromCLSID&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pCLSID<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pProgID<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_Ansi4Unicode</span><span class="p">(</span>pProgID<span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="nf">COM_CoTaskMemFree</span><span class="p">(</span>pProgID<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_String4GUID</span><span class="p">(</span>pGUID<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>String<span class="p">,</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\StringFromGUID2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pGUID<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>String<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">39</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_Ansi4Unicode</span><span class="p">(</span><span class="o">&amp;</span>String<span class="p">,</span><span class="w"> </span><span class="mi">38</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_IsEqualGUID</span><span class="p">(</span>pGUID1<span class="p">,</span><span class="w"> </span>pGUID2<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\IsEqualGUID&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pGUID1<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pGUID2<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_CoCreateGuid</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>GUID<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateGuid&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>GUID<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_String4GUID</span><span class="p">(</span><span class="o">&amp;</span>GUID<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_CoTaskMemAlloc</span><span class="p">(</span>cb<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoTaskMemAlloc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>cb<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_CoTaskMemFree</span><span class="p">(</span>pv<span class="p">)</span>
<span class="p">{</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoTaskMemFree&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pv<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_CoInitialize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoInitialize&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_CoUninitialize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoUninitialize&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_SysAllocString</span><span class="p">(</span>astr<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysAllocString&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_SysString<span class="p">(</span>astr<span class="p">,</span>astr<span class="p">))</span>
<span class="p">}</span>

<span class="nf">COM_SysFreeString</span><span class="p">(</span>bstr<span class="p">)</span>
<span class="p">{</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysFreeString&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>bstr<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_SysStringLen</span><span class="p">(</span>bstr<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysStringLen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>bstr<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_SafeArrayDestroy</span><span class="p">(</span>psar<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SafeArrayDestroy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>psar<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_VariantClear</span><span class="p">(</span>pvar<span class="p">)</span>
<span class="p">{</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\VariantClear&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pvar<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_VariantChangeType</span><span class="p">(</span>pvarDst<span class="p">,</span><span class="w"> </span>pvarSrc<span class="p">,</span><span class="w"> </span>vt<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\VariantChangeTypeEx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pvarDst<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pvarSrc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="w"> </span>vt<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_SysString</span><span class="p">(</span>ByRef<span class="w"> </span>wString<span class="p">,</span><span class="w"> </span>sString<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>wString<span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span>nLen<span class="o">:=</span><span class="mi">1</span><span class="o">+</span>StrLen<span class="p">(</span>sString<span class="p">))</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>DllCall<span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>sString<span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span>nLen<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span>wString<span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span>nLen<span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span>wString<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AccInit</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">COM_Init</span><span class="p">()</span>
<span class="w">	</span><span class="kr">If</span><span class="w"> </span>Not<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;oleacc&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;LoadLibrary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;oleacc&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AccTerm</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">COM_Term</span><span class="p">()</span>
<span class="w">	</span><span class="kr">If</span><span class="w"> </span>h<span class="o">:=</span><span class="w">	</span>DllCall<span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;oleacc&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;FreeLibrary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>h<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AccessibleChildren</span><span class="p">(</span>pacc<span class="p">,</span><span class="w"> </span>cChildren<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>varChildren<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>varChildren<span class="p">,</span>cChildren<span class="o">*</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleChildren&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pacc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>cChildren<span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>varChildren<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>cChildren<span class="o">:=</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>cChildren
<span class="p">}</span>

<span class="nf">COM_AccessibleObjectFromEvent</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>idObject<span class="p">,</span><span class="w"> </span>idChild<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>_idChild_<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>varChild<span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleObjectFromEvent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>idObject<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>idChild<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pacc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>varChild<span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>pacc<span class="p">,</span><span class="w"> </span>_idChild_<span class="o">:=</span>NumGet<span class="p">(</span>varChild<span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AccessibleObjectFromPoint</span><span class="p">(</span>x<span class="p">,</span><span class="w"> </span>y<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>_idChild_<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>varChild<span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleObjectFromPoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>x<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>y<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pacc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>varChild<span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>pacc<span class="p">,</span><span class="w"> </span>_idChild_<span class="o">:=</span>NumGet<span class="p">(</span>varChild<span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AccessibleObjectFromWindow</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>idObject<span class="o">=-</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span>IID<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleObjectFromWindow&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>idObject<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID<span class="p">,</span><span class="w"> </span>IID<span class="w"> </span><span class="o">?</span><span class="w"> </span>IID<span class="w"> </span><span class="o">:</span><span class="w"> </span>idObject<span class="o">&amp;</span><span class="mh">0xFFFFFFFF</span><span class="o">==</span><span class="mh">0xFFFFFFF0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="o">:</span><span class="s">&quot;{618736E0-3C3D-11CF-810C-00AA00389B71}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pacc<span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>pacc
<span class="p">}</span>

<span class="nf">COM_WindowFromAccessibleObject</span><span class="p">(</span>pacc<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\WindowFromAccessibleObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pacc<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>hWnd
<span class="p">}</span>

<span class="nf">COM_GetRoleText</span><span class="p">(</span>nRole<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span>nSize<span class="o">:=</span><span class="w">	</span>DllCall<span class="p">(</span><span class="s">&quot;oleacc\GetRoleTextA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nRole<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>sRole<span class="p">,</span>nSize<span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetRoleTextA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nRole<span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span>sRole<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nSize<span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>sRole
<span class="p">}</span>

<span class="nf">COM_GetStateText</span><span class="p">(</span>nState<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span>nSize<span class="o">:=</span><span class="w">	</span>DllCall<span class="p">(</span><span class="s">&quot;oleacc\GetStateTextA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nState<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>sState<span class="p">,</span>nSize<span class="p">)</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetStateTextA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nState<span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span>sState<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nSize<span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>sState
<span class="p">}</span>

<span class="nf">COM_AtlAxWinInit</span><span class="p">(</span>Version<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">COM_Init</span><span class="p">()</span>
<span class="w">	</span><span class="kr">If</span><span class="w"> </span>Not<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="p">)</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;LoadLibrary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;\AtlAxWinInit&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AtlAxWinTerm</span><span class="p">(</span>Version<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">COM_Term</span><span class="p">()</span>
<span class="w">	</span><span class="kr">If</span><span class="w"> </span>h<span class="o">:=</span><span class="w">	</span>DllCall<span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;FreeLibrary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>h<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AtlAxAttachControl</span><span class="p">(</span>pdsp<span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span>Version<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;\AtlAxAttachControl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>punk<span class="o">:=</span>COM_QueryInterface<span class="p">(</span>pdsp<span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>COM_Release<span class="p">(</span>punk<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AtlAxCreateControl</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>Name<span class="p">,</span><span class="w"> </span>Version<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;\AtlAxCreateControl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_SysString<span class="p">(</span>Name<span class="p">,</span>Name<span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">COM_AtlAxGetControl</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>Version<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AtlAxGetControl</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>Version<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;\AtlAxGetControl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>punk<span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span>pdsp<span class="o">:=</span>COM_QueryInterface<span class="p">(</span>punk<span class="p">),</span><span class="w"> </span>COM_Release<span class="p">(</span>punk<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>pdsp
<span class="p">}</span>

<span class="nf">COM_AtlAxGetHost</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>Version<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kr">If</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;\AtlAxGetHost&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>punk<span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span>pdsp<span class="o">:=</span>COM_QueryInterface<span class="p">(</span>punk<span class="p">),</span><span class="w"> </span>COM_Release<span class="p">(</span>punk<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>pdsp
<span class="p">}</span>

<span class="nf">COM_AtlAxCreateContainer</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>l<span class="p">,</span><span class="w"> </span>t<span class="p">,</span><span class="w"> </span>w<span class="p">,</span><span class="w"> </span>h<span class="p">,</span><span class="w"> </span>Name<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>Version<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CreateWindowEx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AtlAxWin&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>Version<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>Name<span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&amp;</span>Name<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54000000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>l<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>t<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>w<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>h<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_AtlAxGetContainer</span><span class="p">(</span>pdsp<span class="p">,</span><span class="w"> </span>bCtrl<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pdsp<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pdsp<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>COM_GUID4String<span class="p">(</span>IID_IOleWindow<span class="p">,</span><span class="s">&quot;{00000114-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>pwin<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pwin<span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pwin<span class="p">,</span><span class="w"> </span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="w"> </span>hCtrl<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span>NumGet<span class="p">(</span>NumGet<span class="p">(</span><span class="mi">1</span><span class="o">*</span>pwin<span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pwin<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>bCtrl<span class="w"> </span><span class="o">?</span><span class="w"> </span>hCtrl<span class="w"> </span><span class="o">:</span><span class="w"> </span>DllCall<span class="p">(</span><span class="s">&quot;GetParent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hCtrl<span class="p">)</span>
<span class="p">}</span>

<span class="nf">COM_Ansi4Unicode</span><span class="p">(</span>pString<span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">If</span><span class="w"> </span><span class="p">(</span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span>nSize<span class="o">:=</span>DllCall<span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>sString<span class="p">,</span><span class="w"> </span>nSize<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span>sString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>sString
<span class="p">}</span>

<span class="nf">COM_Unicode4Ansi</span><span class="p">(</span>ByRef<span class="w"> </span>wString<span class="p">,</span><span class="w"> </span>sString<span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">If</span><span class="w"> </span><span class="p">(</span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span>nSize<span class="o">:=</span>DllCall<span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>sString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>wString<span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>sString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>wString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="o">&amp;</span>wString
<span class="p">}</span>

<span class="nf">COM_Ansi2Unicode</span><span class="p">(</span>ByRef<span class="w"> </span>sString<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>wString<span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">If</span><span class="w"> </span><span class="p">(</span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span>nSize<span class="o">:=</span>DllCall<span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>sString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>wString<span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>sString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>wString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="o">&amp;</span>wString
<span class="p">}</span>

<span class="nf">COM_Unicode2Ansi</span><span class="p">(</span>ByRef<span class="w"> </span>wString<span class="p">,</span><span class="w"> </span>ByRef<span class="w"> </span>sString<span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span>pString<span class="w"> </span><span class="o">:=</span><span class="w"> </span>wString<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">65535</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>wString<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span>wString
<span class="w">	</span><span class="nf">If</span><span class="w"> </span><span class="p">(</span>nSize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span>nSize<span class="o">:=</span>DllCall<span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>sString<span class="p">,</span><span class="w"> </span>nSize<span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span>sString<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>nSize<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="o">&amp;</span>sString
<span class="p">}</span>

<span class="nf">COM_ScriptControl</span><span class="p">(</span>sCode<span class="p">,</span><span class="w"> </span>sLang<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>bEval<span class="w"> </span><span class="o">=</span><span class="w"> </span>False<span class="p">,</span><span class="w"> </span>sFunc<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>sName<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>pdisp<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>bGlobal<span class="w"> </span><span class="o">=</span><span class="w"> </span>False<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">COM_Init</span><span class="p">()</span>
<span class="w">	</span>psc<span class="w">  </span><span class="o">:=</span><span class="w">	</span>COM_CreateObject<span class="p">(</span><span class="s">&quot;MSScriptControl.ScriptControl&quot;</span><span class="p">)</span>
<span class="w">		</span><span class="nf">COM_Invoke</span><span class="p">(</span>psc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Language&quot;</span><span class="p">,</span><span class="w"> </span>sLang<span class="w"> </span><span class="o">?</span><span class="w"> </span>sLang<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;VBScript&quot;</span><span class="p">)</span>
<span class="w">	</span>sName<span class="w"> </span><span class="o">?</span><span class="w">	</span>COM_Invoke<span class="p">(</span>psc<span class="p">,</span><span class="w"> </span><span class="s">&quot;AddObject&quot;</span><span class="p">,</span><span class="w"> </span>sName<span class="p">,</span><span class="w"> </span><span class="s">&quot;+&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>pdisp<span class="p">,</span><span class="w"> </span>bGlobal<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">	</span>sFunc<span class="w"> </span><span class="o">?</span><span class="w">	</span>COM_Invoke<span class="p">(</span>psc<span class="p">,</span><span class="w"> </span><span class="s">&quot;AddCode&quot;</span><span class="p">,</span><span class="w"> </span>sCode<span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">	</span>ret<span class="w">  </span><span class="o">:=</span><span class="w">	</span>COM_Invoke<span class="p">(</span>psc<span class="p">,</span><span class="w"> </span>bEval<span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;Eval&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;ExecuteStatement&quot;</span><span class="p">,</span><span class="w"> </span>sFunc<span class="w"> </span><span class="o">?</span><span class="w"> </span>sFunc<span class="w"> </span><span class="o">:</span><span class="w"> </span>sCode<span class="p">)</span>
<span class="w">	</span><span class="nf">COM_Release</span><span class="p">(</span>psc<span class="p">)</span>
<span class="w">	</span><span class="nf">COM_Term</span><span class="p">()</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>ret
<span class="p">}</span>
</pre></div>


New Lexer: 
<div class="highlight"><pre><span class="c-Singleline">;------------------------------------------------------------------------------</span>
<span class="c-Singleline">; COM.ahk Standard Library</span>
<span class="c-Singleline">; by Sean</span>
<span class="c-Singleline">; http://www.autohotkey.com/forum/topic22923.html</span>
<span class="c-Singleline">;------------------------------------------------------------------------------</span>

<span class="n">COM_Init</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\OleInitialize&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_Term</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\OleUninitialize&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_VTable</span><span class="p">(</span><span class="n">ppv</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">idx</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">ppv</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span><span class="n">IID</span> <span class="o">?</span> <span class="n">IID</span> <span class="o">:</span> <span class="n">IID</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;{00000000-0000-0000-C000-000000000046}&quot;</span> <span class="o">:</span> <span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">ppv</span>
<span class="p">}</span>

<span class="n">COM_AddRef</span><span class="p">(</span><span class="n">ppv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_Release</span><span class="p">(</span><span class="n">ppv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_QueryService</span><span class="p">(</span><span class="n">ppv</span><span class="p">,</span> <span class="n">SID</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ppv</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IServiceProvider</span><span class="p">,</span><span class="s">&quot;{6D5140C1-7436-11CE-8034-00AA006009FA}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">psp</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">psp</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">SID</span><span class="p">,</span><span class="n">SID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">IID</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span><span class="n">IID</span><span class="p">)</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">SID</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="o">:=</span><span class="mi">0</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">psp</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psp</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">ppv</span>
<span class="p">}</span>

<span class="n">COM_FindConnectionPoint</span><span class="p">(</span><span class="n">pdp</span><span class="p">,</span> <span class="n">DIID</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdp</span><span class="p">)</span><span class="o">+</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IConnectionPointContainer</span><span class="p">,</span> <span class="s">&quot;{B196B284-BAB4-101A-B69C-00AA00341D07}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pcc</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcc</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">DIID</span><span class="p">,</span><span class="n">DIID</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcc</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcc</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">pcp</span>
<span class="p">}</span>

<span class="n">COM_GetConnectionInterface</span><span class="p">(</span><span class="n">pcp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">DIID</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcp</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">DIID</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_String4GUID</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DIID</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_Advise</span><span class="p">(</span><span class="n">pcp</span><span class="p">,</span> <span class="n">psink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcp</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psink</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">nCookie</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">nCookie</span>
<span class="p">}</span>

<span class="n">COM_Unadvise</span><span class="p">(</span><span class="n">pcp</span><span class="p">,</span> <span class="n">nCookie</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pcp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pcp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nCookie</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_Enumerate</span><span class="p">(</span><span class="n">penum</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">Result</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">vt</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">If</span> <span class="p">(</span><span class="mi">0</span> <span class="o">=</span>	<span class="n">hr</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">penum</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">penum</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="w">		</span><span class="nl">Result:</span><span class="o">=</span><span class="p">(</span><span class="n">vt</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">9</span><span class="o">||</span><span class="n">vt</span><span class="o">=</span><span class="mi">13</span> <span class="o">?</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="n">vt</span><span class="o">=</span><span class="mi">8</span><span class="o">||</span><span class="n">vt</span><span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span><span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">hr</span>
<span class="p">}</span>

<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm0</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm1</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm2</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm3</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm4</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm5</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm6</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm7</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm8</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">,</span><span class="n">prm9</span><span class="o">=</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="n">name</span><span class="o">=</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
	<span class="n">If</span>	<span class="n">name</span> <span class="n">contains</span> <span class="o">.</span>
	<span class="p">{</span>
		<span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s">&quot;.&quot;</span> <span class="o">?</span> <span class="n">name</span><span class="o">.=</span><span class="s">&quot;.&quot;</span><span class="o">:</span><span class="n">name</span><span class="o">:=</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;.&quot;</span><span class="p">,</span><span class="n">COM_AddRef</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">name</span><span class="p">,</span> <span class="o">.</span>
	<span class="p">{</span>
	<span class="n">If</span>	<span class="nv">A_Index</span><span class="o">=</span><span class="mi">1</span>
	<span class="p">{</span>
		<span class="n">name</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="n">name</span> <span class="ow">not</span> <span class="n">contains</span> <span class="p">[,(</span>
		<span class="n">prmn</span> <span class="o">:=</span>	<span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nf">InStr</span><span class="p">(</span><span class="s">&quot;])&quot;</span><span class="p">,</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">name</span><span class="p">,</span> <span class="p">[(,</span>&#39;<span class="s">&quot;)]</span>
	<span class="n">If</span>	<span class="nv">A_Index</span><span class="o">=</span><span class="mi">1</span>
		<span class="n">name</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span>	<span class="n">prmn</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span>
	<span class="p">{</span>
		<span class="n">name</span> <span class="o">.=</span>	<span class="s">&quot;.&quot;</span> <span class="o">.</span> <span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span>
	<span class="p">}</span>
	<span class="n">If</span>	<span class="nv">A_LoopField</span><span class="o">!=</span>
<span class="w">		</span><span class="nl">pdsp:</span><span class="o">=</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">prmn</span><span class="o">!=</span><span class="s">&quot;&quot;</span> <span class="o">?</span> <span class="n">prmn</span><span class="o">:</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span><span class="n">name</span><span class="o">:=</span><span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span>	<span class="n">Return</span>	<span class="n">prmn</span><span class="o">!=</span><span class="s">&quot;&quot;</span> <span class="o">?</span> <span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">prmn</span><span class="p">,</span><span class="n">prm0</span><span class="p">,</span><span class="n">prm1</span><span class="p">,</span><span class="n">prm2</span><span class="p">,</span><span class="n">prm3</span><span class="p">,</span><span class="n">prm4</span><span class="p">,</span><span class="n">prm5</span><span class="p">,</span><span class="n">prm6</span><span class="p">,</span><span class="n">prm7</span><span class="p">,</span><span class="n">prm8</span><span class="p">)</span><span class="o">:</span><span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">prm0</span><span class="p">,</span><span class="n">prm1</span><span class="p">,</span><span class="n">prm2</span><span class="p">,</span><span class="n">prm3</span><span class="p">,</span><span class="n">prm4</span><span class="p">,</span><span class="n">prm5</span><span class="p">,</span><span class="n">prm6</span><span class="p">,</span><span class="n">prm7</span><span class="p">,</span><span class="n">prm8</span><span class="p">,</span><span class="n">prm9</span><span class="p">),</span><span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">sParams</span>	<span class="o">:=</span> <span class="s">&quot;0123456789&quot;</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">sParams</span>
		<span class="n">If</span>	<span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span> <span class="o">==</span> <span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">sParams</span>	<span class="o">:=</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">sParams</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">			</span><span class="nb">Break</span>
		<span class="p">}</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varg</span><span class="p">,</span><span class="mi">16</span><span class="o">*</span><span class="n">nParams</span><span class="o">:=</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">sParams</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span> 	<span class="n">Parse</span><span class="p">,</span>	<span class="n">sParams</span><span class="c-Singleline"></span>
<span class="c-Singleline">;		If	prm%A_LoopField%+0==&quot;&quot; || InStr(prm%A_LoopField%,&quot;.&quot;) || prm%A_LoopField%&gt;=0x80000000 || prm%A_LoopField%&lt;-0x80000000</span>
		<span class="n">If</span>	<span class="n">prm</span><span class="nv">%A_LoopField%</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">integer</span>
			<span class="nf">NumPut</span><span class="p">(</span><span class="n">COM_SysString</span><span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">		</span><span class="nb">Else</span>	<span class="nf">NumPut</span><span class="p">(</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;+&quot;</span> <span class="o">?</span> <span class="mi">9</span><span class="o">:</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="o">==</span><span class="s">&quot;-0&quot;</span> <span class="o">?</span> <span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="o">:=</span><span class="mh">0x80020004</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="mi">10</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
	<span class="n">If</span>	<span class="n">nParams</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="n">nParams</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varg</span><span class="p">,</span><span class="n">DispParams</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
	<span class="n">If</span>	<span class="p">(</span><span class="n">nvk</span> <span class="o">:=</span>	<span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;=&quot;</span> <span class="o">?</span> <span class="mi">12</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">12</span>
		<span class="n">name</span> <span class="o">:=</span>	<span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Global</span>	<span class="n">COM_HR</span><span class="p">,</span> <span class="n">COM_LR</span><span class="o">:=</span><span class="s">&quot;&quot;</span>
	<span class="n">If</span>	<span class="p">(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="n">COM_SysString</span><span class="p">(</span><span class="n">wname</span><span class="p">,</span><span class="n">name</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;intP&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="n">nvk</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DispParams</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">nParams</span><span class="o">&amp;&amp;</span><span class="n">nvk</span><span class="o">!=</span><span class="mi">12</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_LR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span><span class="nl">COM_HR:</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Global</span>	<span class="n">COM_VT</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_HR</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">&gt;</span><span class="mi">1</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">=</span><span class="mi">9</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">13</span> <span class="o">?</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">8</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span><span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">:</span><span class="n">COM_Error</span><span class="p">(</span><span class="n">COM_HR</span><span class="p">,</span><span class="n">COM_LR</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_Invoke_</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">typ0</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm0</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ2</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm2</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ3</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm3</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ4</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm4</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ5</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm5</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ6</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm6</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ7</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm7</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ8</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm8</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">typ9</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">prm9</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="n">name</span> <span class="n">contains</span> <span class="o">.</span>
	<span class="p">{</span>
		<span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s">&quot;.&quot;</span> <span class="o">?</span> <span class="n">name</span><span class="o">.=</span><span class="s">&quot;.&quot;</span><span class="o">:</span><span class="n">name</span><span class="o">:=</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="n">COM_AddRef</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">name</span><span class="p">,</span> <span class="o">.</span>
	<span class="p">{</span>
	<span class="n">If</span>	<span class="nv">A_Index</span><span class="o">=</span><span class="mi">1</span>
	<span class="p">{</span>
		<span class="n">name</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="n">name</span> <span class="ow">not</span> <span class="n">contains</span> <span class="p">[,(</span>
		<span class="n">prmn</span> <span class="o">:=</span>	<span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nf">InStr</span><span class="p">(</span><span class="s">&quot;])&quot;</span><span class="p">,</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">name</span><span class="p">,</span> <span class="p">[(,</span>&#39;<span class="s">&quot;)]</span>
	<span class="n">If</span>	<span class="nv">A_Index</span><span class="o">=</span><span class="mi">1</span>
		<span class="n">name</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span>	<span class="n">prmn</span> <span class="o">:=</span>	<span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span>
	<span class="p">{</span>
		<span class="n">name</span> <span class="o">.=</span>	<span class="s">&quot;.&quot;</span> <span class="o">.</span> <span class="nv">A_LoopField</span>
<span class="w">		</span><span class="nb">Continue</span>
	<span class="p">}</span>
	<span class="n">If</span>	<span class="nv">A_LoopField</span><span class="o">!=</span>
<span class="w">		</span><span class="nl">pdsp:</span><span class="o">=</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">prmn</span><span class="o">!=</span><span class="s">&quot;&quot;</span> <span class="o">?</span> <span class="n">prmn</span><span class="o">:</span><span class="s">&quot;vT_NoNe&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span><span class="n">name</span><span class="o">:=</span><span class="nv">A_LoopField</span>
<span class="w">	</span><span class="nb">Else</span>	<span class="n">Return</span>	<span class="n">COM_Invoke_</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">typ0</span><span class="p">,</span><span class="n">prm0</span><span class="p">,</span><span class="n">typ1</span><span class="p">,</span><span class="n">prm1</span><span class="p">,</span><span class="n">typ2</span><span class="p">,</span><span class="n">prm2</span><span class="p">,</span><span class="n">typ3</span><span class="p">,</span><span class="n">prm3</span><span class="p">,</span><span class="n">typ4</span><span class="p">,</span><span class="n">prm4</span><span class="p">,</span><span class="n">typ5</span><span class="p">,</span><span class="n">prm5</span><span class="p">,</span><span class="n">typ6</span><span class="p">,</span><span class="n">prm6</span><span class="p">,</span><span class="n">typ7</span><span class="p">,</span><span class="n">prm7</span><span class="p">,</span><span class="n">typ8</span><span class="p">,</span><span class="n">prm8</span><span class="p">,</span><span class="n">typ9</span><span class="p">,</span><span class="n">prm9</span><span class="p">),</span><span class="n">COM_Release</span><span class="p">(</span><span class="n">pdsp</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">sParams</span>	<span class="o">:=</span> <span class="s">&quot;0123456789&quot;</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">sParams</span>
		<span class="n">If</span>	<span class="p">(</span><span class="n">typ</span><span class="nv">%A_LoopField%</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">sParams</span>	<span class="o">:=</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">sParams</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">			</span><span class="nb">Break</span>
		<span class="p">}</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varg</span><span class="p">,</span><span class="mi">16</span><span class="o">*</span><span class="n">nParams</span><span class="o">:=</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">sParams</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">sParams</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">),</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">&amp;</span><span class="mh">0x4000</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="nf">NumPut</span><span class="p">(</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mi">8</span> <span class="o">?</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">)</span><span class="o">:</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mi">5</span> <span class="o">?</span> <span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="n">varg</span><span class="p">,(</span><span class="n">nParams</span><span class="o">-</span><span class="nv">A_Index</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">((</span><span class="n">prmx</span><span class="o">:=</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4008</span> <span class="o">?</span> <span class="n">COM_SysAllocString</span><span class="p">(</span><span class="nv">%prmx%</span><span class="p">)</span><span class="o">:</span><span class="nv">%prmx%</span><span class="p">,</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4005</span> <span class="o">?</span> <span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">))</span>
	<span class="n">If</span>	<span class="n">nParams</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="n">nParams</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varg</span><span class="p">,</span><span class="n">DispParams</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
	<span class="n">If</span>	<span class="p">(</span><span class="n">nvk</span> <span class="o">:=</span>	<span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;=&quot;</span> <span class="o">?</span> <span class="mi">12</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">12</span>
		<span class="n">name</span> <span class="o">:=</span>	<span class="nf">SubStr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Global</span>	<span class="n">COM_HR</span><span class="p">,</span> <span class="n">COM_LR</span><span class="o">:=</span><span class="s">&quot;&quot;</span>
	<span class="n">If</span>	<span class="p">(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="n">COM_SysString</span><span class="p">(</span><span class="n">wname</span><span class="p">,</span><span class="n">name</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;intP&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_HR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="n">nvk</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DispParams</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">nParams</span><span class="o">&amp;&amp;</span><span class="n">nvk</span><span class="o">!=</span><span class="mi">12</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">COM_LR</span><span class="o">:=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pdsp</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">dispID</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">varResult</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">DispParams</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span><span class="nl">COM_HR:</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="n">Parse</span><span class="p">,</span>	<span class="n">sParams</span>
		<span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">&amp;</span><span class="mh">0x4000</span> <span class="o">?</span> <span class="p">(</span><span class="n">prmx</span><span class="o">:=</span><span class="n">prm</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="nv">%prmx%</span><span class="o">:=</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4008</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="n">prmx</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_SysFreeString</span><span class="p">(</span><span class="n">prmx</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">_ref_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">typ</span><span class="nv">%A_LoopField%</span><span class="o">=</span><span class="mh">0x4005</span> <span class="o">?</span> <span class="s">&quot;double&quot;</span><span class="o">:</span><span class="s">&quot;int64&quot;</span><span class="p">))</span><span class="o">:</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">Global</span>	<span class="n">COM_VT</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_HR</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">&gt;</span><span class="mi">1</span> <span class="o">?</span> <span class="n">COM_VT</span><span class="o">=</span><span class="mi">9</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">13</span> <span class="o">?</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="n">COM_VT</span><span class="o">=</span><span class="mi">8</span><span class="o">||</span><span class="n">COM_VT</span><span class="o">&lt;</span><span class="mh">0x1000</span><span class="o">&amp;&amp;</span><span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">:</span><span class="n">COM_Error</span><span class="p">(</span><span class="n">COM_HR</span><span class="p">,</span><span class="n">COM_LR</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ExcepInfo</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_DispInterface</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">prm1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm2</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm3</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm4</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm5</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm6</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm7</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">prm8</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Critical</span>
	<span class="n">If</span>	<span class="nv">A_EventInfo</span> <span class="o">=</span> <span class="mi">6</span>
<span class="w">		</span><span class="nl">hr:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="n">p</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">28</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm1</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="n">pname</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;UintP&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">hr</span><span class="o">==</span><span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sfn</span><span class="p">,</span><span class="mi">63</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">sfn</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;%s%S&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">40</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pname</span><span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">),</span><span class="n">COM_SysFreeString</span><span class="p">(</span><span class="n">pname</span><span class="p">),</span><span class="nv">%sfn%</span><span class="p">(</span><span class="n">prm5</span><span class="p">,</span><span class="n">this</span><span class="p">,</span><span class="n">prm6</span><span class="p">))</span><span class="o">:</span><span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nv">A_EventInfo</span> <span class="o">=</span> <span class="mi">5</span>
<span class="w">		</span><span class="nl">hr:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="n">p</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm2</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm3</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">prm5</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nv">A_EventInfo</span> <span class="o">=</span> <span class="mi">4</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">hr</span><span class="o">:=</span><span class="mh">0x80004001</span><span class="p">,</span><span class="n">prm3</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nv">A_EventInfo</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">prm1</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nv">A_EventInfo</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nv">A_EventInfo</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="nv">A_EventInfo</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">COM_IsEqualGUID</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span><span class="n">prm1</span><span class="p">)</span><span class="o">||</span><span class="nf">InStr</span><span class="p">(</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}{00000000-0000-0000-C000-000000000046}&quot;</span><span class="p">,</span><span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">prm1</span><span class="p">))</span> <span class="o">?</span> <span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumPut</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">this</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="n">prm2</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">hr</span><span class="o">:=</span><span class="mh">0x80004002</span><span class="p">,</span><span class="n">prm2</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">hr</span>
<span class="p">}</span>

<span class="n">COM_DispGetParam</span><span class="p">(</span><span class="n">pDispParams</span><span class="p">,</span> <span class="n">Position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vt</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\DispGetParam&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pDispParams</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">Position</span><span class="p">,</span> <span class="s">&quot;Ushort&quot;</span><span class="p">,</span> <span class="n">vt</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">varResult</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">nArgErr</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="o">=</span><span class="mi">8</span> <span class="o">?</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_VariantClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">varResult</span><span class="p">)</span><span class="o">:</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varResult</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_DispSetParam</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pDispParams</span><span class="p">,</span> <span class="n">Position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vt</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">NumPut</span><span class="p">(</span><span class="n">vt</span><span class="o">=</span><span class="mi">8</span> <span class="o">?</span> <span class="n">COM_SysAllocString</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">:</span><span class="n">val</span><span class="p">,</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pDispParams</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pDispParams</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="n">Position</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="o">-</span><span class="mi">8</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">vt</span><span class="o">=</span><span class="mi">11</span><span class="o">||</span><span class="n">vt</span><span class="o">=</span><span class="mi">2</span> <span class="o">?</span> <span class="s">&quot;short&quot;</span><span class="o">:</span><span class="s">&quot;int&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_Error</span><span class="p">(</span><span class="n">hr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">pei</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Static</span>	<span class="n">bDebug</span><span class="o">:=</span><span class="mi">1</span>
<span class="w">	</span><span class="nb">If </span><span class="n">Not</span>	<span class="n">pei</span>
	<span class="p">{</span>
<span class="w">	</span><span class="nl">bDebug:</span><span class="o">=</span><span class="n">hr</span>
<span class="w">	</span><span class="nb">Global</span>	<span class="n">COM_HR</span><span class="p">,</span> <span class="n">COM_LR</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_HR</span><span class="o">&amp;&amp;</span><span class="n">COM_LR</span> <span class="o">?</span> <span class="n">COM_LR</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="o">|</span><span class="n">COM_HR</span><span class="o">:</span><span class="n">COM_HR</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nb">Else</span> <span class="n">If</span>	<span class="o">!</span><span class="n">bDebug</span>
<span class="w">	</span><span class="nb">Return</span>
	<span class="n">hr</span> <span class="o">?</span> <span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sError</span><span class="p">,</span><span class="mi">1023</span><span class="p">),</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">nError</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\FormatMessageA&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">hr</span><span class="o">&lt;&gt;</span><span class="mh">0x80020009</span> <span class="o">?</span> <span class="n">hr</span> <span class="o">:</span> <span class="p">(</span><span class="n">bExcep</span><span class="o">:=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">28</span><span class="p">))</span> <span class="o">?</span> <span class="n">hr</span> <span class="o">:</span> <span class="n">hr</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span><span class="o">+</span><span class="mh">0x80040200</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">sError</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">nError</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;0x%08X&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">hr</span><span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">))</span> <span class="o">:</span> <span class="n">sError</span><span class="o">:=</span><span class="s">&quot;The COM Object may not be a valid Dispatch Object!`n`tFirst ensure that COM Library has been initialized through COM_Init().`n&quot;</span><span class="p">,</span> <span class="n">lr</span> <span class="o">?</span> <span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sError2</span><span class="p">,</span><span class="mi">1023</span><span class="p">),</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">nError2</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\FormatMessageA&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">lr</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">sError2</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;user32\wsprintfA&quot;</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">nError2</span><span class="p">,</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="s">&quot;0x%08X&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">lr</span><span class="p">,</span><span class="s">&quot;Cdecl&quot;</span><span class="p">))</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
<span class="w">	</span><span class="nb">MsgBox</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="n">COM</span> <span class="n">Error</span> <span class="n">Notification</span><span class="p">,</span> <span class="o">%</span> <span class="s">&quot;Function Name:`t</span><span class="se">&quot;&quot;</span><span class="s">&quot;</span> <span class="o">.</span> <span class="n">name</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">&quot;&quot;`n</span><span class="s">ERROR:`t&quot;</span> <span class="o">.</span> <span class="n">sError</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`t</span><span class="s">(&quot;</span> <span class="o">.</span> <span class="n">nError</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span> <span class="o">.</span> <span class="p">(</span><span class="n">bExcep</span> <span class="o">?</span> <span class="nf">SubStr</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">24</span><span class="p">)</span> <span class="o">?</span> <span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">pei</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">PROG:`t&quot;</span> <span class="o">.</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_SysFreeString</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">DESC:`t&quot;</span> <span class="o">.</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_SysFreeString</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">HELP:`t&quot;</span> <span class="o">.</span> <span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">12</span><span class="p">))</span> <span class="o">.</span> <span class="n">COM_SysFreeString</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">12</span><span class="p">))</span> <span class="o">.</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">pei</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="n">lr</span> <span class="o">?</span> <span class="s">&quot;</span><span class="se">`n`n</span><span class="s">ERROR2:`t&quot;</span> <span class="o">.</span> <span class="n">sError2</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`t</span><span class="s">(&quot;</span> <span class="o">.</span> <span class="n">nError2</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`n`n</span><span class="s">Will Continue?&quot;</span>
<span class="w">	</span><span class="nb">IfMsgBox</span><span class="p">,</span> <span class="n">No</span><span class="p">,</span> <span class="n">Exit</span>
<span class="p">}</span>

<span class="n">COM_CreateIDispatch</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Static</span>	<span class="n">IDispatch</span>
<span class="w">	</span><span class="nb">If </span><span class="n">Not</span>	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">IDispatch</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">IDispatch</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>   <span class="n">nParams</span><span class="o">=</span><span class="mi">3112469</span>
<span class="w">		</span><span class="nb">Loop</span><span class="p">,</span>   <span class="n">Parse</span><span class="p">,</span>   <span class="n">nParams</span>
		<span class="nf">NumPut</span><span class="p">(</span><span class="nf">RegisterCallback</span><span class="p">(</span><span class="s">&quot;COM_DispInterface&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="nv">A_LoopField</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">IDispatch</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nb">Return</span> <span class="o">&amp;</span><span class="n">IDispatch</span>
<span class="p">}</span>

<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span> <span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span> <span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ctinf</span><span class="p">)</span>
	<span class="n">If</span>	<span class="n">ctinf</span>
	<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
	<span class="n">If</span>	<span class="n">ppv</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">),</span>	<span class="n">pdisp</span> <span class="o">:=</span> <span class="n">ppv</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">pdisp</span>
<span class="p">}</span>

<span class="n">COM_GetDefaultEvents</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">IID</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span> <span class="o">%</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">TKind</span><span class="p">)</span>
		<span class="n">If</span>	<span class="n">TKind</span> <span class="o">&lt;&gt;</span> <span class="mi">5</span>
<span class="w">			</span><span class="nb">Continue</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
<span class="w">		</span><span class="nl">nCount:</span><span class="o">=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">pattr</span><span class="o">+</span><span class="mi">48</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Ushort&quot;</span><span class="p">)</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
<span class="w">		</span><span class="nb">Loop</span><span class="p">,</span> <span class="o">%</span>	<span class="n">nCount</span>
		<span class="p">{</span>
			<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">36</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">nFlags</span><span class="p">)</span>
			<span class="n">If</span>	<span class="o">!</span><span class="p">(</span><span class="n">nFlags</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">				</span><span class="nb">Continue</span>
			<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">32</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">hRefType</span><span class="p">)</span>
			<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">56</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hRefType</span> <span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">)</span>
			<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">prinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
			<span class="n">nFlags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">?</span> <span class="n">DIID</span><span class="o">:=</span><span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">pattr</span><span class="p">)</span> <span class="o">:</span> <span class="n">bFind</span><span class="o">:=</span><span class="n">COM_IsEqualGUID</span><span class="p">(</span><span class="n">pattr</span><span class="p">,</span><span class="o">&amp;</span><span class="n">IID</span><span class="p">)</span>
			<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">prinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
			<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">prinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">prinf</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
		<span class="n">If</span>	<span class="n">bFind</span>
<span class="w">			</span><span class="nb">Break</span>
	<span class="p">}</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">bFind</span> <span class="o">?</span> <span class="n">DIID</span> <span class="o">:</span> <span class="s">&quot;{00000000-0000-0000-0000-000000000000}&quot;</span>
<span class="p">}</span>

<span class="n">COM_GetGuidOfName</span><span class="p">(</span><span class="n">pdisp</span><span class="p">,</span> <span class="n">Name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">),</span> <span class="n">ptinf</span><span class="o">:=</span><span class="mi">0</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">44</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span><span class="n">Name</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">memID</span><span class="p">,</span> <span class="s">&quot;UshortP&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
	<span class="n">GUID</span> <span class="o">:=</span> <span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">pattr</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span> <span class="p">,</span> <span class="n">pattr</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">GUID</span>
<span class="p">}</span>

<span class="n">COM_GetTypeInfoOfGuid</span><span class="p">(</span><span class="n">pdisp</span><span class="p">,</span> <span class="n">GUID</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdisp</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span><span class="mi">72</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptinf</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">),</span> <span class="n">ptinf</span> <span class="o">:=</span> <span class="mi">0</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">GUID</span><span class="p">,</span><span class="n">GUID</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ptinf</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">ptlib</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">ptlib</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">ptinf</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">; A Function Name including Prefix is limited to 63 bytes!</span>
<span class="n">COM_ConnectObject</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">DIID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">If </span><span class="n">Not</span>	<span class="n">DIID</span>
		<span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">pconn</span><span class="o">:=</span><span class="n">COM_FindConnectionPoint</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">))</span> <span class="o">?</span> <span class="p">(</span><span class="n">DIID</span><span class="o">:=</span><span class="n">COM_GetConnectionInterface</span><span class="p">(</span><span class="n">pconn</span><span class="p">))</span><span class="o">=</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span> <span class="o">?</span> <span class="n">DIID</span><span class="o">:=</span><span class="n">COM_GetDefaultEvents</span><span class="p">(</span><span class="n">psource</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="n">pconn</span><span class="o">:=</span><span class="n">COM_FindConnectionPoint</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="n">DIID</span><span class="o">:=</span><span class="n">COM_GetDefaultEvents</span><span class="p">(</span><span class="n">psource</span><span class="p">))</span>
<span class="w">	</span><span class="nb">Else</span>	<span class="n">pconn</span><span class="o">:=</span><span class="n">COM_FindConnectionPoint</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="nf">SubStr</span><span class="p">(</span><span class="n">DIID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span> <span class="o">?</span> <span class="n">DIID</span> <span class="o">:</span> <span class="n">DIID</span><span class="o">:=</span><span class="n">COM_GetGuidOfName</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="n">DIID</span><span class="p">))</span>
	<span class="n">If</span>	<span class="o">!</span><span class="n">pconn</span> <span class="o">||</span> <span class="o">!</span><span class="n">ptinf</span><span class="o">:=</span><span class="n">COM_GetTypeInfoOfGuid</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="n">DIID</span><span class="p">)</span>
	<span class="p">{</span>
<span class="w">		</span><span class="nb">MsgBox</span><span class="p">,</span> <span class="n">No</span> <span class="n">Event</span> <span class="n">Interface</span> <span class="n">Exists</span><span class="o">!</span>
<span class="w">		</span><span class="nb">Return</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nl">psink:</span><span class="o">=</span><span class="n">COM_CoTaskMemAlloc</span><span class="p">(</span><span class="mi">40</span><span class="o">+</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="n">COM_CreateIDispatch</span><span class="p">(),</span><span class="n">psink</span><span class="o">+</span><span class="mi">0</span><span class="p">)),</span> <span class="nf">NumPut</span><span class="p">(</span><span class="n">psource</span><span class="p">,</span><span class="nf">NumPut</span><span class="p">(</span><span class="n">ptinf</span><span class="p">,</span><span class="n">psink</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psink</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">DIID</span><span class="p">,</span><span class="n">DIID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psink</span><span class="o">+</span><span class="mi">40</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nf">StrLen</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span><span class="n">COM_Advise</span><span class="p">(</span><span class="n">pconn</span><span class="p">,</span><span class="n">psink</span><span class="p">),</span><span class="nf">NumPut</span><span class="p">(</span><span class="n">pconn</span><span class="p">,</span><span class="n">psink</span><span class="o">+</span><span class="mi">16</span><span class="p">))</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">psink</span>
<span class="p">}</span>

<span class="n">COM_DisconnectObject</span><span class="p">(</span><span class="n">psink</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_Unadvise</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">16</span><span class="p">),</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">20</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">COM_Release</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">16</span><span class="p">)),</span><span class="n">COM_Release</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">psink</span><span class="o">+</span><span class="mi">8</span><span class="p">)),</span><span class="n">COM_CoTaskMemFree</span><span class="p">(</span><span class="n">psink</span><span class="p">))</span> <span class="o">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="n">COM_CreateObject</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">CLSCTX</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateInstance&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span><span class="n">CLSID</span><span class="p">)</span> <span class="o">:</span> <span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span><span class="n">CLSID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">CLSCTX</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span><span class="n">IID</span> <span class="o">?</span> <span class="n">IID</span> <span class="o">:</span> <span class="n">IID</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;{00000000-0000-0000-C000-000000000046}&quot;</span> <span class="o">:</span> <span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">ppv</span>
<span class="p">}</span>

<span class="n">COM_ActiveXObject</span><span class="p">(</span><span class="n">ProgID</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateInstance&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">)</span> <span class="o">:</span> <span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IDispatch</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_GetObject</span><span class="p">(</span><span class="n">Moniker</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoGetObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">Moniker</span><span class="p">,</span><span class="n">Moniker</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IDispatch</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_GetActiveObject</span><span class="p">(</span><span class="n">ProgID</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\GetActiveObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nf">SubStr</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;{&quot;</span> <span class="o">?</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">)</span> <span class="o">:</span> <span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">punk</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IDispatch</span><span class="p">,</span><span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pdisp</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">punk</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_GetDefaultInterface</span><span class="p">(</span><span class="n">pdisp</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_CLSID4ProgID</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">CLSID</span><span class="p">,</span> <span class="n">ProgID</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CLSIDFromProgID&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">ProgID</span><span class="p">,</span><span class="n">ProgID</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CLSID</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="o">&amp;</span><span class="n">CLSID</span>
<span class="p">}</span>

<span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">CLSID</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">CLSID</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CLSIDFromString&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CLSID</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="o">&amp;</span><span class="n">CLSID</span>
<span class="p">}</span>

<span class="n">COM_ProgID4CLSID</span><span class="p">(</span><span class="n">pCLSID</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\ProgIDFromCLSID&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pCLSID</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pProgID</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="n">pProgID</span><span class="p">)</span> <span class="o">.</span> <span class="n">COM_CoTaskMemFree</span><span class="p">(</span><span class="n">pProgID</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_String4GUID</span><span class="p">(</span><span class="n">pGUID</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="mi">38</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\StringFromGUID2&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pGUID</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">String</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">39</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">String</span><span class="p">,</span> <span class="mi">38</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_IsEqualGUID</span><span class="p">(</span><span class="n">pGUID1</span><span class="p">,</span> <span class="n">pGUID2</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\IsEqualGUID&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pGUID1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pGUID2</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_CoCreateGuid</span><span class="p">()</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">GUID</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoCreateGuid&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">GUID</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_String4GUID</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GUID</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_CoTaskMemAlloc</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoTaskMemAlloc&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_CoTaskMemFree</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
<span class="p">{</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoTaskMemFree&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_CoInitialize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoInitialize&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_CoUninitialize</span><span class="p">()</span>
<span class="p">{</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ole32\CoUninitialize&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_SysAllocString</span><span class="p">(</span><span class="n">astr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysAllocString&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">astr</span><span class="p">,</span><span class="n">astr</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">COM_SysFreeString</span><span class="p">(</span><span class="n">bstr</span><span class="p">)</span>
<span class="p">{</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysFreeString&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">bstr</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_SysStringLen</span><span class="p">(</span><span class="n">bstr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SysStringLen&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">bstr</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_SafeArrayDestroy</span><span class="p">(</span><span class="n">psar</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\SafeArrayDestroy&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">psar</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_VariantClear</span><span class="p">(</span><span class="n">pvar</span><span class="p">)</span>
<span class="p">{</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\VariantClear&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pvar</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_VariantChangeType</span><span class="p">(</span><span class="n">pvarDst</span><span class="p">,</span> <span class="n">pvarSrc</span><span class="p">,</span> <span class="n">vt</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleaut32\VariantChangeTypeEx&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pvarDst</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pvarSrc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">&quot;Ushort&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Ushort&quot;</span><span class="p">,</span> <span class="n">vt</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_SysString</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">sString</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">wString</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nLen</span><span class="o">:=</span><span class="mi">1</span><span class="o">+</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">sString</span><span class="p">))</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">NumPut</span><span class="p">(</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">nLen</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">wString</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="n">nLen</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">wString</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AccInit</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">COM_Init</span><span class="p">()</span>
<span class="w">	</span><span class="nb">If </span><span class="n">Not</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;oleacc&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;LoadLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;oleacc&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AccTerm</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">COM_Term</span><span class="p">()</span>
<span class="w">	</span><span class="nb">If </span><span class="n">h</span><span class="o">:=</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;oleacc&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;FreeLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AccessibleChildren</span><span class="p">(</span><span class="n">pacc</span><span class="p">,</span> <span class="n">cChildren</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">varChildren</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varChildren</span><span class="p">,</span><span class="n">cChildren</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleChildren&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pacc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">cChildren</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">varChildren</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">cChildren</span><span class="o">:=</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">cChildren</span>
<span class="p">}</span>

<span class="n">COM_AccessibleObjectFromEvent</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">idObject</span><span class="p">,</span> <span class="n">idChild</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_idChild_</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleObjectFromEvent&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">idObject</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">idChild</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pacc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">varChild</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">pacc</span><span class="p">,</span> <span class="n">_idChild_</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AccessibleObjectFromPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">_idChild_</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleObjectFromPoint&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pacc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">varChild</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">pacc</span><span class="p">,</span> <span class="n">_idChild_</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">varChild</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AccessibleObjectFromWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">idObject</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span> <span class="n">IID</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\AccessibleObjectFromWindow&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">idObject</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID</span><span class="p">,</span> <span class="n">IID</span> <span class="o">?</span> <span class="n">IID</span> <span class="o">:</span> <span class="n">idObject</span><span class="o">&amp;</span><span class="mh">0xFFFFFFFF</span><span class="o">==</span><span class="mh">0xFFFFFFF0</span> <span class="o">?</span> <span class="s">&quot;{00020400-0000-0000-C000-000000000046}&quot;</span><span class="o">:</span><span class="s">&quot;{618736E0-3C3D-11CF-810C-00AA00389B71}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pacc</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">pacc</span>
<span class="p">}</span>

<span class="n">COM_WindowFromAccessibleObject</span><span class="p">(</span><span class="n">pacc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\WindowFromAccessibleObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pacc</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">hWnd</span>
<span class="p">}</span>

<span class="n">COM_GetRoleText</span><span class="p">(</span><span class="n">nRole</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nl">nSize:</span><span class="o">=</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetRoleTextA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nRole</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sRole</span><span class="p">,</span><span class="n">nSize</span><span class="p">)</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetRoleTextA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nRole</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">sRole</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nSize</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">sRole</span>
<span class="p">}</span>

<span class="n">COM_GetStateText</span><span class="p">(</span><span class="n">nState</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nl">nSize:</span><span class="o">=</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetStateTextA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nState</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sState</span><span class="p">,</span><span class="n">nSize</span><span class="p">)</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;oleacc\GetStateTextA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nState</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">sState</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nSize</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">sState</span>
<span class="p">}</span>

<span class="n">COM_AtlAxWinInit</span><span class="p">(</span><span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">COM_Init</span><span class="p">()</span>
<span class="w">	</span><span class="nb">If </span><span class="n">Not</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">)</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;LoadLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span> <span class="o">.</span> <span class="s">&quot;\AtlAxWinInit&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AtlAxWinTerm</span><span class="p">(</span><span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">COM_Term</span><span class="p">()</span>
<span class="w">	</span><span class="nb">If </span><span class="n">h</span><span class="o">:=</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetModuleHandle&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;FreeLibrary&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AtlAxAttachControl</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span> <span class="o">.</span> <span class="s">&quot;\AtlAxAttachControl&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="o">:=</span><span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">COM_Release</span><span class="p">(</span><span class="n">punk</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AtlAxCreateControl</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span> <span class="o">.</span> <span class="s">&quot;\AtlAxCreateControl&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_SysString</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span><span class="n">Name</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">COM_AtlAxGetControl</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AtlAxGetControl</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span> <span class="o">.</span> <span class="s">&quot;\AtlAxGetControl&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span><span class="nl">pdsp:</span><span class="o">=</span><span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">punk</span><span class="p">),</span> <span class="n">COM_Release</span><span class="p">(</span><span class="n">punk</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">pdsp</span>
<span class="p">}</span>

<span class="n">COM_AtlAxGetHost</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;atl&quot;</span> <span class="o">.</span> <span class="n">Version</span> <span class="o">.</span> <span class="s">&quot;\AtlAxGetHost&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">punk</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<span class="w">		</span><span class="nl">pdsp:</span><span class="o">=</span><span class="n">COM_QueryInterface</span><span class="p">(</span><span class="n">punk</span><span class="p">),</span> <span class="n">COM_Release</span><span class="p">(</span><span class="n">punk</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">pdsp</span>
<span class="p">}</span>

<span class="n">COM_AtlAxCreateContainer</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CreateWindowEx&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="mh">0x200</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;AtlAxWin&quot;</span> <span class="o">.</span> <span class="n">Version</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">Name</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">Name</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x54000000</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_AtlAxGetContainer</span><span class="p">(</span><span class="n">pdsp</span><span class="p">,</span> <span class="n">bCtrl</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pdsp</span><span class="p">)</span><span class="o">+</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pdsp</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">COM_GUID4String</span><span class="p">(</span><span class="n">IID_IOleWindow</span><span class="p">,</span><span class="s">&quot;{00000114-0000-0000-C000-000000000046}&quot;</span><span class="p">),</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">pwin</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pwin</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pwin</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="n">hCtrl</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="nf">NumGet</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">pwin</span><span class="p">)</span><span class="o">+</span> <span class="mi">8</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pwin</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">bCtrl</span> <span class="o">?</span> <span class="n">hCtrl</span> <span class="o">:</span> <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetParent&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hCtrl</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">COM_Ansi4Unicode</span><span class="p">(</span><span class="n">pString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span> <span class="p">(</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">sString</span>
<span class="p">}</span>

<span class="n">COM_Unicode4Ansi</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span> <span class="p">(</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">wString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="o">&amp;</span><span class="n">wString</span>
<span class="p">}</span>

<span class="n">COM_Ansi2Unicode</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">sString</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">If</span> <span class="p">(</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">wString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\MultiByteToWideChar&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="o">&amp;</span><span class="n">wString</span>
<span class="p">}</span>

<span class="n">COM_Unicode2Ansi</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">wString</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pString</span> <span class="o">:=</span> <span class="n">wString</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="mi">65535</span> <span class="o">?</span> <span class="n">wString</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">wString</span>
	<span class="n">If</span> <span class="p">(</span><span class="n">nSize</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">	    </span><span class="nl">nSize:</span><span class="o">=</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sString</span><span class="p">,</span> <span class="n">nSize</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;kernel32\WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">sString</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">nSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="o">&amp;</span><span class="n">sString</span>
<span class="p">}</span>

<span class="n">COM_ScriptControl</span><span class="p">(</span><span class="n">sCode</span><span class="p">,</span> <span class="n">sLang</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">bEval</span> <span class="o">=</span> <span class="nv">False</span><span class="p">,</span> <span class="n">sFunc</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">sName</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">pdisp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bGlobal</span> <span class="o">=</span> <span class="nv">False</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">COM_Init</span><span class="p">()</span>
	<span class="n">psc</span>  <span class="o">:=</span>	<span class="n">COM_CreateObject</span><span class="p">(</span><span class="s">&quot;MSScriptControl.ScriptControl&quot;</span><span class="p">)</span>
		<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="s">&quot;Language&quot;</span><span class="p">,</span> <span class="n">sLang</span> <span class="o">?</span> <span class="n">sLang</span> <span class="o">:</span> <span class="s">&quot;VBScript&quot;</span><span class="p">)</span>
	<span class="n">sName</span> <span class="o">?</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="s">&quot;AddObject&quot;</span><span class="p">,</span> <span class="n">sName</span><span class="p">,</span> <span class="s">&quot;+&quot;</span> <span class="o">.</span> <span class="n">pdisp</span><span class="p">,</span> <span class="n">bGlobal</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
	<span class="n">sFunc</span> <span class="o">?</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="s">&quot;AddCode&quot;</span><span class="p">,</span> <span class="n">sCode</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
	<span class="n">ret</span>  <span class="o">:=</span>	<span class="n">COM_Invoke</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="n">bEval</span> <span class="o">?</span> <span class="s">&quot;Eval&quot;</span> <span class="o">:</span> <span class="s">&quot;ExecuteStatement&quot;</span><span class="p">,</span> <span class="n">sFunc</span> <span class="o">?</span> <span class="n">sFunc</span> <span class="o">:</span> <span class="n">sCode</span><span class="p">)</span>
	<span class="n">COM_Release</span><span class="p">(</span><span class="n">psc</span><span class="p">)</span>
	<span class="n">COM_Term</span><span class="p">()</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">ret</span>
<span class="p">}</span>
</pre></div>
