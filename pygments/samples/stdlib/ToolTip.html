<LINK href="styles.css" rel="stylesheet" type="text/css"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">ToolTip() by HotKeyIt http://www.autohotkey.com/forum/viewtopic.php?t=40165</span>

<span class="cm">Syntax: ToolTip(Number,Text,Title,Options)</span>

<span class="cm">Return Value: ToolTip returns hWnd of the ToolTip</span>

<span class="cm">|         Options can include any of following parameters separated by space</span>
<span class="cm">| Option   |      Meaning</span>
<span class="cm">| A      |   Aim ConrolId or ClassNN (Button1, Edit2, ListBox1, SysListView321...)</span>
<span class="cm">|         |   - using this, ToolTip will be shown when you point mouse on a control</span>
<span class="cm">|         |   - D (delay) can be used to change how long ToolTip is shown</span>
<span class="cm">|         |   - W (wait) can wait for specified seconds before ToolTip will be shown</span>
<span class="cm">|         |   - Some controls like Static require a subroutine to have a ToolTip!!!</span>
<span class="cm">| B + F   |   Specify here the color for ToolTip in 6-digit hexadecimal RGB code</span>
<span class="cm">|         |   - B = Background color, F = Foreground color (text color)</span>
<span class="cm">|         |   - this can be 0x00FF00 or 00FF00 or Blue, Lime, Black, White...</span>
<span class="cm">| C      |   Close button for ToolTip/BalloonTip. See ToolTip actions how to use it</span>
<span class="cm">| D      |   Delay. This option will determine how long ToolTip should be shown.30 sec. is maximum</span>
<span class="cm">|         |   - this option is also available when assigning the ToolTip to a control.</span>
<span class="cm">| E      |   Edges for ToolTip, Use this to set margin of ToolTip window (space between text and border)</span>
<span class="cm">|         |   - Supply Etop.left.bottom.right in pixels, for example: E10.0.10.5</span>
<span class="cm">| G      |   Execute one or more internal Labels of ToolTip function only.</span>
<span class="cm">|         |   For example:</span>
<span class="cm">|         |   - Track the position only, use ToolTip(1,&quot;&quot;,&quot;&quot;,&quot;Xcaret Ycaret gTTM_TRACKPOSITION&quot;)</span>
<span class="cm">|         |      - When X+Y are empty (= display near mouse position) you can use TTM_UPDATE</span>
<span class="cm">|         |   - Update text only, use ToolTip(1,&quot;text&quot;,&quot;&quot;,&quot;G1&quot;). Note specify L1 if links are used.</span>
<span class="cm">|         |   - Update title only, use ToolTip(1,&quot;&quot;,&quot;Title&quot;,&quot;G1&quot;)</span>
<span class="cm">|         |   - Hide ToolTip, use ToolTip(1,&quot;&quot;,&quot;&quot;,&quot;gTTM_POP&quot;)</span>
<span class="cm">|         |      - To show ToolTip again use ToolTip(1,&quot;&quot;,&quot;&quot;,&quot;gTTM_TRACKPOSITION.TTM_TRACKACTIVATE&quot;)</span>
<span class="cm">|         |   - Update background color + text color, specify . between gLabels to execute several:</span>
<span class="cm">|         |      - ToolTip(1,&quot;&quot;,&quot;&quot;,&quot;BBlue FWhite gTTM_SETTIPBKCOLOR.TTM_SETTIPTEXTCOLOR&quot;)</span>
<span class="cm">|         |   - Following labels can be used: TTM_SETTITLEA + TTM_SETTITLEW (title+I), TTM_POPUP, TTM_POP</span>
<span class="cm">|         |     TTM_SETTIPBKCOLOR (B), TTM_SETTIPTEXTCOLOR (F), TTM_TRACKPOSITION (N+X+Y),</span>
<span class="cm">|         |     TTM_SETMAXTIPWIDTH (R), TTM_SETMARGIN (E), TT_SETTOOLINFO (text+A+P+N+X+Y+S+L)</span>
<span class="cm">|         |     TTM_SETWINDOWTHEME (Q)</span>
<span class="cm">| H      |   Hide ToolTip after a link is clicked.See L option</span>
<span class="cm">| I      |   Icon 1-3, e.g. I1. If this option is missing no Icon will be used (same as I0)</span>
<span class="cm">|         |   - 1 = Info, 2 = Warning, 3 = Error, &gt; 3 is meant to be a hIcon (handle to an Icon)</span>
<span class="cm">|         |   Use Included MI_ExtractIcon and GetAssociatedIcon functions to get hIcon</span>
<span class="cm">| J      |   Justify ToolTip to center of control</span>
<span class="cm">| L      |   Links for ToolTips. See ToolTip actions how Links for ToolTip work.</span>
<span class="cm">| M      |   Mouse click-trough. So a click will be forwarded to the window underneath ToolTip</span>
<span class="cm">| N      |   Do NOT activate ToolTip (N1), To activate (show) call ToolTip(1,&quot;&quot;,&quot;&quot;,&quot;gTTM_TRACKACTIVATE&quot;)</span>
<span class="cm">| O      |   Oval ToolTip (BalloonTip). Specify O1 to use a BalloonTip instead of ToolTip.</span>
<span class="cm">| P      |   Parent window hWnd or GUI number. This will assign a ToolTip to a window.</span>
<span class="cm">|         |   - Reqiered to assign ToolTip to controls and actions.</span>
<span class="cm">| Q      |   Quench Style/Theme. Use this to disable Theme of ToolTip.</span>
<span class="cm">|         |   Using this option you can have for example colored ToolTips in Vista.</span>
<span class="cm">| R      |   Restrict width. This will restrict the width of the ToolTip.</span>
<span class="cm">|         |   So if Text is to long it will be shown in several lines</span>
<span class="cm">| S      |   Show at coordinates regardless of position. Specify S1 to use that feature</span>
<span class="cm">|         |   - normally it is fed automaticaly to show on screen</span>
<span class="cm">| T      |   Transparency. This option will apply Transparency to a ToolTip.</span>
<span class="cm">|         |   - this option is not available to ToolTips assigned to a control.</span>
<span class="cm">| V      |   Visible: even when the parent window is not active, a control-ToolTip will be shown</span>
<span class="cm">| W      |   Wait time in seconds (max 30) before ToolTip pops up when pointing on one of controls.</span>
<span class="cm">| X + Y   |   Coordinates where ToolTip should be displayed, e.g. X100 Y200</span>
<span class="cm">|         |   - leave empty to display ToolTip near mouse</span>
<span class="cm">|         |   - you can specify Xcaret Ycaret to display at caret coordinates</span>
<span class="cm">|</span>
<span class="cm">|          To destroy a ToolTip use ToolTip(Number), to destroy all ToolTip()</span>
<span class="cm">|</span>
<span class="cm">|               ToolTip Actions (NOTE, OPTION P MUST BE PRESENT TO USE THAT FEATURE)</span>
<span class="cm">|      Assigning an action to a ToolTip to works using OnMessage(0x4e,&quot;Function&quot;) - WM_NOTIFY</span>
<span class="cm">|      Parameter/option P must be present so ToolTip will forward messages to script</span>
<span class="cm">|      All you need to do inside this OnMessage function is to include:</span>
<span class="cm">|         - If wParam=0</span>
<span class="cm">|            ToolTip(&quot;&quot;,lParam[,Label])</span>
<span class="cm">|</span>
<span class="cm">|      Additionally you need to have one or more of following labels in your script</span>
<span class="cm">|      - ToolTip: when clicking a link</span>
<span class="cm">|      - ToolTipClose: when closing ToolTip</span>
<span class="cm">|         - You can also have a diferent label for one or all ToolTips</span>
<span class="cm">|         - Therefore enter the number of ToolTip in front of the label</span>
<span class="cm">|            - e.g. 99ToolTip: or 1ToolTipClose:</span>
<span class="cm">|</span>
<span class="cm">|      - Those labels names can be customized as well</span>
<span class="cm">|         - e.g. ToolTip(&quot;&quot;,lParam,&quot;MyTip&quot;) will use MyTip: and MyTipClose:</span>
<span class="cm">|         - you can enter the number of ToolTip in front of that label as well.</span>
<span class="cm">|</span>
<span class="cm">|      - Links have following syntax:</span>
<span class="cm">|         - &lt;a&gt;Link&lt;/a&gt; or &lt;a link&gt;LinkName&lt;/a&gt;</span>
<span class="cm">|         - When a Link is clicked, ToolTip() will jump to the label</span>
<span class="cm">|            - Variable ErrorLevel will contain clicked link</span>
<span class="cm">|</span>
<span class="cm">|         - So when only LinkName is given, e.g. &lt;a&gt;AutoHotkey&lt;/a&gt; Errorlevel will be AutoHotkey</span>
<span class="cm">|         - When using Link is given as well, e.g. &lt;a http://www.autohotkey.com&gt;AutoHotkey&lt;/a&gt;</span>
<span class="cm">|            - Errorlevel will be set to http://www.autohotkey.com</span>
<span class="cm">|</span>
<span class="cm">|      Please note some options like Close Button and Links will require Win2000++ (+version 6.0 of comctl32.dll)</span>
<span class="cm">|        AutoHotKey Version 1.0.48++ is required due to &quot;assume static mode&quot;</span>
<span class="cm">|        If you use 1 ToolTip for several controls, the only difference between those can be the text.</span>
<span class="cm">|           - Other options, like Title, color and so on, will be valid globally</span>
<span class="cm">*/</span>

<span class="nb">ToolTip</span><span class="p">(</span><span class="n">ID</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">TEXT</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">TITLE</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">OPTIONS</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">){</span>
<span class="w">   </span><span class="nb">static</span>
<span class="w">   </span><span class="nb">local</span> <span class="n">option</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span><span class="p">,</span><span class="n">RECT</span><span class="p">,</span><span class="n">#_DetectHiddenWindows</span><span class="p">,</span><span class="n">OnMessage</span>
   <span class="n">If</span> <span class="o">!</span><span class="n">Init</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_INIT</span>
<span class="w">   </span><span class="nl">OnMessage:</span><span class="o">=</span><span class="nf">OnMessage(</span><span class="mh">0x4e</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>   <span class="p">,</span><span class="n">DetectHiddenWindows</span><span class="o">:=</span><span class="nv">A_DetectHiddenWindows</span>
<span class="w">   </span><span class="nb">DetectHiddenWindows</span><span class="p">,</span> <span class="n">On</span>
   <span class="n">If</span> <span class="o">!</span><span class="n">ID</span>
   <span class="p">{</span>
<span class="w">      </span><span class="nb">If </span><span class="n">text</span>
<span class="w">         </span><span class="nb">If </span><span class="n">text</span> <span class="ow">is</span> <span class="n">Xdigit</span>
<span class="w">            </span><span class="nb">GoTo</span><span class="p">,</span> <span class="n">TTN_LINKCLICK</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span> <span class="n">hWndArray</span><span class="p">,</span> <span class="o">%</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span><span class="c-Singleline"> ;Destroy all ToolTip Windows</span>
      <span class="p">{</span>
<span class="w">         </span><span class="nb">If </span><span class="nf">WinExist(</span><span class="s">&quot;ahk_id &quot;</span> <span class="o">.</span> <span class="nv">A_LoopField</span><span class="p">)</span>
            <span class="nf">DllCall(</span><span class="s">&quot;DestroyWindow&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="nv">A_LoopField</span><span class="p">)</span>
         <span class="n">hWndArray</span><span class="nv">%A_LoopField%</span><span class="o">=</span>
      <span class="p">}</span>
      <span class="n">hWndArray</span><span class="o">=</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span> <span class="n">idArray</span><span class="p">,</span> <span class="o">%</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span><span class="c-Singleline"> ;Destroy all ToolTip Structures</span>
      <span class="p">{</span>
<span class="w">         </span><span class="nl">TT_ID:</span><span class="o">=</span><span class="nv">A_LoopField</span>
<span class="w">         </span><span class="nb">If </span><span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span>
<span class="w">            </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TT_DESTROY</span>
      <span class="p">}</span>
      <span class="n">idArray</span><span class="o">=</span>
<span class="w">      </span><span class="nb">Goto</span><span class="p">,</span> <span class="n">TT_EXITFUNC</span>
   <span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="nl">TT_ID:</span><span class="o">=</span><span class="n">ID</span>
<span class="w">   </span><span class="nl">TT_HWND:</span><span class="o">=</span><span class="n">TT_HWND_</span><span class="nv">%TT_ID%</span><span class="c-Singleline"></span>
<span class="c-Singleline">   </span>
<span class="c-Singleline">   ;___________________  Load Options Variables and Structures ___________________</span>
   
   <span class="n">If</span> <span class="p">(</span><span class="n">options</span><span class="p">){</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span><span class="n">Parse</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="nv">%A_Space%</span>
         <span class="n">If</span> <span class="p">(</span><span class="n">option</span><span class="o">:=</span> <span class="nf">SubStr(</span><span class="nv">A_LoopField</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="nl">%option%:</span><span class="o">=</span> <span class="nf">SubStr(</span><span class="nv">A_LoopField</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
   <span class="p">}</span>
   <span class="n">If</span> <span class="p">(</span><span class="n">G</span><span class="p">){</span><span class="c-Singleline"></span>
<span class="c-Singleline">      ; If (Title!=&quot;&quot;){</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_SETTITLE</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_UPDATE</span><span class="c-Singleline"></span>
<span class="c-Singleline">      ; }</span>
<span class="c-Singleline">      ; If (Text!=&quot;&quot;){</span>
         <span class="n">If</span> <span class="p">(</span><span class="nf">InStr(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&lt;a&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">TOOLLINK</span><span class="nv">%TT_ID%</span><span class="p">){</span>
<span class="w">            </span><span class="nl">TOOLTEXT_%TT_ID%:</span><span class="o">=</span><span class="n">text</span>
<span class="w">            </span><span class="nl">text:</span><span class="o">=</span><span class="nf">RegExReplace(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&lt;a\K[^&lt;]*?&gt;&quot;</span><span class="p">,</span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span>
         <span class="p">}</span> <span class="n">else</span>
<span class="w">            </span><span class="nl">TOOLTEXT_%TT_ID%:</span><span class="o">=</span>
         <span class="nf">NumPut(</span><span class="o">&amp;</span><span class="n">text</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%TT_ID%</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_UPDATETIPTEXT</span><span class="c-Singleline"></span>
<span class="c-Singleline">      ; }</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="o">.</span>
<span class="w">         </span><span class="nb">If </span><span class="nf">IsLabel(</span><span class="nv">A_LoopField</span><span class="p">)</span>
<span class="w">            </span><span class="nb">Gosub</span><span class="p">,</span> <span class="nv">%A_LoopField%</span>
<span class="w">      </span><span class="nb">Sleep</span><span class="p">,</span><span class="mi">10</span>
<span class="w">    </span><span class="nb">Goto</span><span class="p">,</span> <span class="n">TT_EXITFUNC</span>
   <span class="p">}</span><span class="c-Singleline"></span>
<span class="c-Singleline">   ;__________________________  Save TOOLINFO Structures _________________________</span>
<span class="w">   </span>
<span class="w">   </span><span class="nb">If </span><span class="n">P</span> <span class="p">{</span>
      <span class="n">If</span> <span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">100</span> <span class="ow">and</span> <span class="o">!</span><span class="nf">WinExist(</span><span class="s">&quot;ahk_id &quot;</span> <span class="n">p</span><span class="p">)){</span>
<span class="w">         </span><span class="nb">Gui</span><span class="p">,</span><span class="nv">%p%</span><span class="o">:+</span><span class="n">LastFound</span>
<span class="w">         </span><span class="nl">P:</span><span class="o">=</span><span class="nf">WinExist(</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="n">If</span> <span class="o">!</span><span class="nf">InStr(</span><span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span><span class="p">,</span><span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="nf">Abs(</span><span class="n">P</span><span class="p">)</span> <span class="o">.</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">))</span>
         <span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span>  <span class="o">.=</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="nf">Abs(</span><span class="n">P</span><span class="p">)</span> <span class="o">.</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span>
   <span class="p">}</span>
   <span class="n">If</span> <span class="o">!</span><span class="nf">InStr(</span><span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span><span class="p">,</span><span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="n">ID</span> <span class="o">.</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">))</span>
      <span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span>  <span class="o">.=</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="n">ID</span> <span class="o">.</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">   </span><span class="nb">If </span><span class="n">H</span>
<span class="w">      </span><span class="nl">TT_HIDE_%TT_ID%:</span><span class="o">=</span><span class="mi">1</span><span class="c-Singleline"></span>
<span class="c-Singleline">   ;__________________________  Create ToolTip Window  __________________________</span>
   
   <span class="n">If</span> <span class="p">(</span><span class="o">!</span><span class="n">TT_HWND</span> <span class="ow">and</span> <span class="n">text</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="n">TT_HWND</span> <span class="o">:=</span> <span class="nf">DllCall(</span><span class="s">&quot;CreateWindowEx&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;tooltips_class32&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x02</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">?</span> <span class="mh">0x1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">l</span> <span class="o">?</span> <span class="mh">0x100</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span> <span class="o">?</span> <span class="mh">0x80</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">O</span> <span class="o">?</span> <span class="mh">0x40</span> <span class="o">:</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">P</span> <span class="o">?</span> <span class="n">P</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="nl">TT_HWND_%TT_ID%:</span><span class="o">=</span><span class="n">TT_HWND</span>
      <span class="n">hWndArray</span> <span class="o">.=</span><span class="p">(</span><span class="n">hWndArray</span> <span class="o">?</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="n">TT_HWND</span>
      <span class="n">idArray</span> <span class="o">.=</span><span class="p">(</span><span class="n">idArray</span> <span class="o">?</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="n">TT_ID</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_SETMAXTIPWIDTH</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x403</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">D</span> <span class="o">?</span> <span class="n">D</span><span class="o">*</span><span class="mi">1000</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="c-Singleline"> ;TTDT_AUTOPOP</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x403</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span> <span class="o">?</span> <span class="n">W</span><span class="o">*</span><span class="mi">1000</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="c-Singleline"> ;TTDT_INITIAL</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x403</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span> <span class="o">?</span> <span class="n">W</span><span class="o">*</span><span class="mi">1000</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="c-Singleline"> ;TTDT_RESHOW</span>
   <span class="p">}</span> <span class="n">else</span> <span class="n">if</span> <span class="p">(</span><span class="o">!</span><span class="n">text</span> <span class="ow">and</span> <span class="o">!</span><span class="n">options</span><span class="p">){</span>
      <span class="nf">DllCall(</span><span class="s">&quot;DestroyWindow&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">TT_HWND</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TT_DESTROY</span>
<span class="w">      </span><span class="nb">GoTo</span><span class="p">,</span> <span class="n">TT_EXITFUNC</span>
   <span class="p">}</span><span class="c-Singleline"></span>
<span class="c-Singleline">   </span>
<span class="c-Singleline">   ;______________________  Create TOOLINFO Structure  ______________________</span>
<span class="w">   </span>
<span class="w">   </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TT_SETTOOLINFO</span>

   <span class="n">If</span> <span class="p">(</span><span class="n">Q</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_SETWINDOWTHEME</span>
   <span class="n">If</span> <span class="p">(</span><span class="n">E</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_SETMARGIN</span>
   <span class="n">If</span> <span class="p">(</span><span class="n">F</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_SETTIPTEXTCOLOR</span>
   <span class="n">If</span> <span class="p">(</span><span class="n">B</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_SETTIPBKCOLOR</span>
   <span class="n">If</span> <span class="p">(</span><span class="n">title</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_SETTITLE</span>
   
   <span class="n">If</span> <span class="p">(</span><span class="o">!</span><span class="n">A</span><span class="p">){</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_UPDATETIPTEXT</span>
<span class="w">      </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_UPDATE</span>
<span class="w">      </span><span class="nb">If </span><span class="n">D</span> <span class="p">{</span>
         <span class="n">A_Timer</span> <span class="o">:=</span> <span class="nv">A_TickCount</span><span class="p">,</span> <span class="n">D</span> <span class="o">*=</span> <span class="mi">1000</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_TRACKPOSITION</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_TRACKACTIVATE</span>
<span class="w">         </span><span class="nb">Loop</span>
         <span class="p">{</span>
<span class="w">            </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_TRACKPOSITION</span>
            <span class="n">If</span> <span class="p">(</span><span class="nv">A_TickCount</span> <span class="o">-</span> <span class="n">A_Timer</span> <span class="o">&gt;</span> <span class="n">D</span><span class="p">)</span>
<span class="w">               </span><span class="nb">Break</span>
         <span class="p">}</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TT_DESTROY</span>
         <span class="nf">DllCall(</span><span class="s">&quot;DestroyWindow&quot;</span><span class="p">,</span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">TT_HWND</span><span class="p">)</span>
         <span class="n">TT_HWND_</span><span class="nv">%TT_ID%</span><span class="o">=</span>
      <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_TRACKPOSITION</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_TRACKACTIVATE</span>
<span class="w">         </span><span class="nb">If </span><span class="n">T</span>
<span class="w">            </span><span class="nb">WinSet</span><span class="p">,</span><span class="n">Transparent</span><span class="p">,</span><span class="nv">%T%</span><span class="p">,</span><span class="n">ahk_id</span> <span class="nv">%TT_HWND%</span>
<span class="w">         </span><span class="nb">If </span><span class="n">M</span>
<span class="w">            </span><span class="nb">WinSet</span><span class="p">,</span><span class="n">ExStyle</span><span class="p">,</span><span class="o">^</span><span class="mh">0x20</span><span class="p">,</span><span class="n">ahk_id</span> <span class="nv">%TT_HWND%</span>
      <span class="p">}</span>
   <span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">   ;________  Return HWND of ToolTip  ________</span>
<span class="w">   </span>
<span class="w">   </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TT_EXITFUNC</span>
<span class="w">   </span><span class="nb">Return</span> <span class="n">TT_HWND</span><span class="c-Singleline"></span>
<span class="c-Singleline">   </span>
<span class="c-Singleline">   ;________________________  Internal Labels  ________________________</span>
<span class="w">   </span>
<span class="w">   </span><span class="nl">TT_EXITFUNC:</span>
<span class="w">      </span><span class="nb">If </span><span class="n">OnMessage</span>
         <span class="nf">OnMessage(</span><span class="mh">0x4e</span><span class="p">,</span><span class="n">OnMessage</span><span class="p">)</span>
<span class="w">      </span><span class="nb">DetectHiddenWindows</span><span class="p">,</span> <span class="nv">%#_DetectHiddenWindows%</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_POP:</span><span class="c-Singleline">    ;Hide ToolTip</span>
<span class="w">   </span><span class="nl">TTM_POPUP:</span><span class="c-Singleline">    ;Causes the ToolTip to display at the coordinates of the last mouse message.</span>
<span class="w">   </span><span class="nl">TTM_UPDATE:</span><span class="c-Singleline"> ;Forces the current tool to be redrawn.</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_TRACKACTIVATE:</span><span class="c-Singleline"> ;Activates or deactivates a tracking ToolTip.</span>
   <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_UPDATETIPTEXT:</span>
<span class="w">   </span><span class="nl">TTM_GETBUBBLESIZE:</span>
<span class="w">   </span><span class="nl">TTM_ADDTOOL:</span>
<span class="w">   </span><span class="nl">TTM_DELTOOL:</span>
<span class="w">   </span><span class="nl">TTM_SETTOOLINFO:</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_SETTITLE:</span>
      <span class="n">title</span> <span class="o">:=</span> <span class="p">(</span><span class="nf">StrLen(</span><span class="n">title</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">96</span><span class="p">)</span> <span class="o">?</span> <span class="n">title</span> <span class="o">:</span> <span class="p">(</span><span class="nf">Chr(</span><span class="mi">133</span><span class="p">)</span> <span class="nf">SubStr(</span><span class="n">title</span><span class="p">,</span> <span class="o">-</span><span class="mi">97</span><span class="p">))</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Title</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_SETWINDOWTHEME:</span>
<span class="w">      </span><span class="nb">If </span><span class="n">Q</span>
         <span class="nf">DllCall(</span><span class="s">&quot;uxtheme\SetWindowTheme&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;UintP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="nb">else</span>
         <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">K</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_SETMAXTIPWIDTH:</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">R</span> <span class="o">?</span> <span class="n">R</span> <span class="o">:</span> <span class="nv">A_ScreenWidth</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_TRACKPOSITION:</span>
      <span class="nf">VarSetCapacity(</span><span class="n">xc</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">xc</span> <span class="o">:=</span> <span class="nf">Chr(</span><span class="mi">20</span><span class="p">)</span>
      <span class="nf">DllCall(</span><span class="s">&quot;GetCursorInfo&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">xc</span><span class="p">)</span>
      <span class="n">yc</span> <span class="o">:=</span> <span class="nf">NumGet(</span><span class="n">xc</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">xc</span> <span class="o">:=</span> <span class="nf">NumGet(</span><span class="n">xc</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="w">      </span><span class="nb">SysGet</span><span class="p">,</span><span class="n">xl</span><span class="p">,</span><span class="mi">76</span>
<span class="w">      </span><span class="nb">SysGet</span><span class="p">,</span><span class="n">xr</span><span class="p">,</span><span class="mi">78</span>
<span class="w">      </span><span class="nb">SysGet</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="mi">77</span>
<span class="w">      </span><span class="nb">SysGet</span><span class="p">,</span><span class="n">yr</span><span class="p">,</span><span class="mi">79</span>
      <span class="n">xc</span><span class="o">+=</span><span class="mi">15</span><span class="p">,</span><span class="n">yc</span><span class="o">+=</span><span class="mi">15</span>
      <span class="n">If</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;caret&quot;</span> <span class="ow">or</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;caret&quot;</span><span class="p">){</span>
<span class="w">         </span><span class="nb">WinGetPos</span><span class="p">,</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span><span class="p">,,,</span><span class="n">A</span>
<span class="w">         </span><span class="nb">If </span><span class="n">x</span><span class="o">=</span><span class="n">caret</span>
         <span class="p">{</span>
<span class="w">            </span><span class="nl">xc:</span><span class="o">=</span><span class="n">xw</span><span class="o">+</span><span class="nv">A_CaretX</span> <span class="o">+</span><span class="mi">1</span>
<span class="w">            </span><span class="nl">xc:</span><span class="o">=</span><span class="p">(</span><span class="n">xl</span><span class="o">&gt;</span><span class="n">xc</span> <span class="o">?</span> <span class="n">xl</span> <span class="o">:</span> <span class="p">(</span><span class="n">xr</span><span class="o">&lt;</span><span class="n">xc</span> <span class="o">?</span> <span class="n">xr</span> <span class="o">:</span> <span class="n">xc</span><span class="p">))</span>
         <span class="p">}</span>
         <span class="n">If</span> <span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s">&quot;caret&quot;</span><span class="p">){</span>
<span class="w">            </span><span class="nl">yc:</span><span class="o">=</span><span class="n">yw</span><span class="o">+</span><span class="nv">A_CaretY</span><span class="o">+</span><span class="mi">15</span>
<span class="w">            </span><span class="nl">yc:</span><span class="o">=</span><span class="p">(</span><span class="n">yl</span><span class="o">&gt;</span><span class="n">yc</span> <span class="o">?</span> <span class="n">yl</span> <span class="o">:</span> <span class="p">(</span><span class="n">yr</span><span class="o">&lt;</span><span class="n">yc</span> <span class="o">?</span> <span class="n">yr</span> <span class="o">:</span> <span class="n">yc</span><span class="p">))</span>
         <span class="p">}</span>
   <span class="p">}</span> <span class="n">else</span> <span class="n">if</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;TrayIcon&quot;</span> <span class="ow">or</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;TrayIcon&quot;</span><span class="p">){</span>
<span class="w">         </span><span class="nb">Process</span><span class="p">,</span> <span class="n">Exist</span>
<span class="w">         </span><span class="nl">PID:</span><span class="o">=</span><span class="nv">ErrorLevel</span>
<span class="w">         </span><span class="nl">hWndTray:</span><span class="o">=</span><span class="nf">WinExist(</span><span class="s">&quot;ahk_class Shell_TrayWnd&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nb">ControlGet</span><span class="p">,</span><span class="n">hWndToolBar</span><span class="p">,</span><span class="n">Hwnd</span><span class="p">,,</span><span class="n">ToolbarWindow321</span><span class="p">,</span><span class="n">ahk_id</span> <span class="nv">%hWndTray%</span>
         <span class="n">RemoteBuf_Open</span><span class="p">(</span><span class="n">TrayH</span><span class="p">,</span><span class="n">hWndToolBar</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="w">         </span><span class="nl">DataH:</span><span class="o">=</span><span class="nf">NumGet(</span><span class="n">TrayH</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x418</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,,</span><span class="n">ahk_id</span> <span class="nv">%hWndToolBar%</span>
<span class="w">         </span><span class="nb">Loop</span> <span class="o">%</span> <span class="nv">ErrorLevel</span>
         <span class="p">{</span>
<span class="w">            </span><span class="nb">SendMessage</span><span class="p">,</span><span class="mh">0x417</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">RemoteBuf_Get</span><span class="p">(</span><span class="n">TrayH</span><span class="p">),,</span><span class="n">ahk_id</span> <span class="nv">%hWndToolBar%</span>
            <span class="n">RemoteBuf_Read</span><span class="p">(</span><span class="n">TrayH</span><span class="p">,</span><span class="n">lpData</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
            <span class="nf">VarSetCapacity(</span><span class="n">dwExtraData</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="w">            </span><span class="nl">pwData:</span><span class="o">=</span><span class="nf">NumGet(</span><span class="n">lpData</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
            <span class="nf">DllCall(</span> <span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">DataH</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">pwData</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwExtraData</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
<span class="w">            </span><span class="nl">BWID:</span><span class="o">=</span><span class="nf">NumGet(</span><span class="n">dwExtraData</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="nb">WinGet</span><span class="p">,</span><span class="n">BWPID</span><span class="p">,</span><span class="n">PID</span><span class="p">,</span> <span class="n">ahk_id</span> <span class="nv">%BWID%</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">BWPID</span><span class="o">!=</span><span class="n">PID</span> <span class="ow">and</span> <span class="n">BWPID</span><span class="o">!=</span><span class="n">#__MAIN_PID_</span><span class="p">)</span>
<span class="w">               </span><span class="nb">continue</span>
<span class="w">            </span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x41d</span><span class="p">,</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">RemoteBuf_Get</span><span class="p">(</span><span class="n">TrayH</span><span class="p">),,</span><span class="n">ahk_id</span> <span class="nv">%hWndToolBar%</span>
            <span class="n">RemoteBuf_Read</span><span class="p">(</span><span class="n">TrayH</span><span class="p">,</span><span class="n">rcPosition</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">If</span> <span class="p">(</span><span class="nf">NumGet(</span><span class="n">lpData</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">7</span><span class="p">){</span>
<span class="w">               </span><span class="nb">ControlGetPos</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span><span class="p">,</span><span class="n">Button2</span><span class="p">,</span><span class="n">ahk_id</span> <span class="nv">%hWndTray%</span>
               <span class="n">xc</span><span class="o">+=</span><span class="n">xw</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">yc</span><span class="o">+=</span><span class="n">yw</span><span class="o">/</span><span class="mi">4</span>
            <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
<span class="w">               </span><span class="nb">ControlGetPos</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,,,</span><span class="n">ToolbarWindow321</span><span class="p">,</span><span class="n">ahk_id</span> <span class="nv">%hWndTray%</span>
<span class="w">               </span><span class="nl">halfsize:</span><span class="o">=</span><span class="nf">NumGet(</span><span class="n">rcPosition</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
               <span class="n">xc</span><span class="o">+=</span><span class="nf">NumGet(</span><span class="n">rcPosition</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span> <span class="n">halfsize</span>
               <span class="n">yc</span><span class="o">+=</span><span class="nf">NumGet(</span><span class="n">rcPosition</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span> <span class="p">(</span><span class="n">halfsize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">}</span>
<span class="w">            </span><span class="nb">WinGetPos</span><span class="p">,</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span><span class="p">,,,</span><span class="n">ahk_id</span> <span class="nv">%hWndTray%</span>
            <span class="n">xc</span><span class="o">+=</span><span class="n">xw</span><span class="p">,</span><span class="n">yc</span><span class="o">+=</span><span class="n">yw</span>
<span class="w">            </span><span class="nb">break</span>
         <span class="p">}</span>
         <span class="n">RemoteBuf_close</span><span class="p">(</span><span class="n">TrayH</span><span class="p">)</span>
      <span class="p">}</span>
<span class="w">      </span><span class="nb">If </span><span class="n">xc</span> <span class="ow">not</span> <span class="n">between</span> <span class="nv">%xl%</span> <span class="ow">and</span> <span class="nv">%xr%</span>
         <span class="n">xc</span><span class="o">=</span><span class="n">xc</span><span class="o">&lt;</span><span class="n">xl</span> <span class="o">?</span> <span class="n">xl</span> <span class="o">:</span> <span class="n">xr</span>
<span class="w">      </span><span class="nb">If </span><span class="n">yc</span> <span class="ow">not</span> <span class="n">between</span> <span class="nv">%yl%</span> <span class="ow">and</span> <span class="nv">%yr%</span>
         <span class="n">yc</span><span class="o">=</span><span class="n">yc</span><span class="o">&lt;</span><span class="n">yl</span> <span class="o">?</span> <span class="n">yl</span> <span class="o">:</span> <span class="n">yr</span>
      <span class="n">If</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span> <span class="ow">and</span> <span class="o">!</span><span class="n">y</span><span class="p">)</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_UPDATE</span>
<span class="w">      </span><span class="nb">else</span> <span class="n">if</span> <span class="o">!</span><span class="nf">WinActive(</span><span class="s">&quot;ahk_id &quot;</span> <span class="o">.</span> <span class="n">TT_HWND</span><span class="p">)</span>
         <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">9999999</span> <span class="o">?</span> <span class="n">x</span> <span class="o">:</span> <span class="n">xc</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">9999999</span> <span class="o">?</span> <span class="n">y</span> <span class="o">:</span> <span class="n">yc</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_SETTIPBKCOLOR:</span>
<span class="w">      </span><span class="nb">If </span><span class="n">B</span> <span class="ow">is</span> <span class="n">alpha</span>
         <span class="n">If</span> <span class="p">(</span><span class="nv">%b%</span><span class="p">)</span>
<span class="w">            </span><span class="nl">B:</span><span class="o">=</span><span class="nv">%b%</span>
      <span class="n">B</span> <span class="o">:=</span> <span class="p">(</span><span class="nf">StrLen(</span><span class="n">B</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="o">?</span> <span class="s">&quot;0x&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="n">B</span>
      <span class="n">B</span> <span class="o">:=</span> <span class="p">((</span><span class="n">B</span><span class="o">&amp;</span><span class="mi">255</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="p">(((</span><span class="n">B</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">255</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">B</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="c-Singleline"> ; rgb -&gt; bgr</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_SETTIPTEXTCOLOR:</span>
<span class="w">      </span><span class="nb">If </span><span class="n">F</span> <span class="ow">is</span> <span class="n">alpha</span>
         <span class="n">If</span> <span class="p">(</span><span class="nv">%F%</span><span class="p">)</span>
<span class="w">            </span><span class="nl">F:</span><span class="o">=</span><span class="nv">%f%</span>
      <span class="n">F</span> <span class="o">:=</span> <span class="p">(</span><span class="nf">StrLen(</span><span class="n">F</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="o">?</span> <span class="s">&quot;0x&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="n">F</span>
      <span class="n">F</span> <span class="o">:=</span> <span class="p">((</span><span class="n">F</span><span class="o">&amp;</span><span class="mi">255</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="p">(((</span><span class="n">F</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">255</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">F</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="c-Singleline"> ; rgb -&gt; bgr</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="n">F</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFF</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTM_SETMARGIN:</span>
      <span class="nf">VarSetCapacity(</span><span class="n">RECT</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span><span class="n">Parse</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="o">.</span>
         <span class="nf">NumPut(</span><span class="nv">A_LoopField</span><span class="p">,</span><span class="n">RECT</span><span class="p">,(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
      <span class="nf">DllCall(</span><span class="s">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">TT_HWND</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="nv">%A_ThisLabel%</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">RECT</span><span class="p">)</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TT_SETTOOLINFO:</span>
<span class="w">      </span><span class="nb">If </span><span class="n">A</span> <span class="p">{</span>
<span class="w">         </span><span class="nb">If </span><span class="n">A</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Xdigit</span>
<span class="w">            </span><span class="nb">ControlGet</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Hwnd</span><span class="p">,,</span><span class="nv">%A%</span><span class="p">,</span><span class="n">ahk_id</span> <span class="nv">%P%</span>
         <span class="n">ID</span> <span class="o">:=</span><span class="nf">Abs(</span><span class="n">A</span><span class="p">)</span>
         <span class="n">If</span> <span class="o">!</span><span class="nf">InStr(</span><span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span><span class="p">,</span><span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="n">ID</span> <span class="o">.</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span>  <span class="o">.=</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="n">ID</span> <span class="o">.</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="n">ID</span><span class="o">+</span><span class="nf">Abs(</span><span class="n">P</span><span class="p">)</span> <span class="o">.</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span>
         <span class="n">If</span> <span class="o">!</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span>
            <span class="nf">VarSetCapacity(</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="o">:=</span><span class="nf">Chr(</span><span class="mi">40</span><span class="p">)</span>
<span class="w">         </span><span class="nb">else</span>
<span class="w">            </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_DELTOOL</span>
         <span class="nf">Numput(</span><span class="p">(</span><span class="n">N</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">J</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">L</span> <span class="o">?</span> <span class="mh">0x1000</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span><span class="o">|</span><span class="mi">16</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="nf">Numput(</span><span class="n">P</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="nf">Numput(</span><span class="n">ID</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
         <span class="n">If</span> <span class="p">(</span><span class="n">text</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="nf">NumPut(</span><span class="o">&amp;</span><span class="n">text</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_ADDTOOL</span>
      <span class="n">ID</span> <span class="o">:=</span><span class="n">ID</span><span class="o">+</span><span class="nf">Abs(</span><span class="n">P</span><span class="p">)</span>
         <span class="n">If</span> <span class="o">!</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span>
         <span class="p">{</span>
            <span class="nf">VarSetCapacity(</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="o">:=</span><span class="nf">Chr(</span><span class="mi">40</span><span class="p">)</span>
            <span class="nf">Numput(</span><span class="mi">0</span><span class="o">|</span><span class="mi">16</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="nf">Numput(</span><span class="n">P</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="nf">Numput(</span><span class="n">P</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
         <span class="p">}</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_ADDTOOL</span>
         <span class="n">ID</span> <span class="o">:=</span><span class="nf">Abs(</span><span class="n">A</span><span class="p">)</span>
      <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
         <span class="n">If</span> <span class="o">!</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span>
            <span class="nf">VarSetCapacity(</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="o">:=</span><span class="nf">Chr(</span><span class="mi">40</span><span class="p">)</span>
         <span class="n">If</span> <span class="p">(</span><span class="n">text</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">){</span>
<span class="w">            </span><span class="nb">If </span><span class="nf">InStr(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&lt;a&quot;</span><span class="p">){</span>
<span class="w">               </span><span class="nl">TOOLTEXT_%ID%:</span><span class="o">=</span><span class="n">text</span>
<span class="w">               </span><span class="nl">text:</span><span class="o">=</span><span class="nf">RegExReplace(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&lt;a\K[^&lt;]*?&gt;&quot;</span><span class="p">,</span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span>
            <span class="p">}</span> <span class="n">else</span>
<span class="w">               </span><span class="nl">TOOLTEXT_%ID%:</span><span class="o">=</span>
            <span class="nf">NumPut(</span><span class="o">&amp;</span><span class="n">text</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
         <span class="p">}</span>
      <span class="nf">NumPut(</span><span class="p">(</span><span class="n">J</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">x</span> <span class="o">.</span> <span class="n">y</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mh">0x20</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">S</span> <span class="o">?</span> <span class="mh">0x80</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">L</span> <span class="o">?</span> <span class="mh">0x1000</span> <span class="o">:</span> <span class="mi">0</span><span class="p">),</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="nf">Numput(</span><span class="n">P</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="nf">Numput(</span><span class="n">P</span><span class="p">,</span><span class="n">TOOLINFO_</span><span class="nv">%ID%</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="w">         </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_ADDTOOL</span>
      <span class="p">}</span>
<span class="w">    </span><span class="nl">TOOLLINK%ID%:</span><span class="o">=</span><span class="n">L</span>
<span class="w">  </span><span class="nb">Return</span>
<span class="w">   </span><span class="nl">TTN_LINKCLICK:</span>
<span class="w">      </span><span class="nb">Loop</span> <span class="mi">4</span>
         <span class="n">m</span> <span class="o">+=</span> <span class="o">*</span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">If</span> <span class="o">!</span><span class="p">(</span><span class="n">TTN_FIRST</span><span class="o">-</span><span class="mi">2</span><span class="o">=</span><span class="n">m</span> <span class="ow">or</span> <span class="n">TTN_FIRST</span><span class="o">-</span><span class="mi">3</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="w">         </span><span class="nb">Return</span><span class="p">,</span> <span class="n">OnMessage</span> <span class="o">?</span> <span class="nf">OnMessage(</span><span class="mh">0x4e</span><span class="p">,</span><span class="n">OnMessage</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span>
<span class="w">      </span><span class="nb">Loop</span> <span class="mi">4</span>
         <span class="n">p</span> <span class="o">+=</span> <span class="o">*</span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">+</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">If</span> <span class="p">(</span><span class="n">TTN_FIRST</span><span class="o">-</span><span class="mi">3</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="w">         </span><span class="nb">Loop</span> <span class="mi">4</span>
            <span class="n">option</span> <span class="o">+=</span> <span class="o">*</span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">+</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span><span class="n">Parse</span><span class="p">,</span><span class="n">hWndArray</span><span class="p">,</span><span class="o">%</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span>
         <span class="n">If</span> <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="nv">A_LoopField</span> <span class="ow">and</span> <span class="n">i</span><span class="o">:=</span><span class="nv">A_Index</span><span class="p">)</span>
<span class="w">            </span><span class="nb">break</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span><span class="n">Parse</span><span class="p">,</span><span class="n">idArray</span><span class="p">,</span><span class="o">%</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="n">If</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="nv">A_Index</span><span class="p">){</span>
<span class="w">            </span><span class="nl">text:</span><span class="o">=</span><span class="n">TOOLTEXT_</span><span class="nv">%A_LoopField%</span>
            <span class="n">If</span> <span class="p">(</span><span class="n">TTN_FIRST</span><span class="o">-</span><span class="mi">2</span><span class="o">=</span><span class="n">m</span><span class="p">){</span>
<span class="w">               </span><span class="nb">If </span><span class="n">Title</span>
               <span class="p">{</span>
<span class="w">                  </span><span class="nb">If </span><span class="nf">IsLabel(</span><span class="nv">A_LoopField</span> <span class="o">.</span> <span class="n">title</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span> <span class="o">%</span> <span class="nv">A_LoopField</span> <span class="o">.</span> <span class="n">title</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span>
<span class="w">                  </span><span class="nb">else</span> <span class="n">If</span> <span class="nf">IsLabel(</span><span class="n">title</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span> <span class="o">%</span> <span class="n">title</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span>
               <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
<span class="w">                  </span><span class="nb">If </span><span class="nf">IsLabel(</span><span class="nv">A_LoopField</span> <span class="o">.</span> <span class="nv">A_ThisFunc</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span> <span class="o">%</span> <span class="nv">A_LoopField</span> <span class="o">.</span> <span class="nv">A_ThisFunc</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span>
<span class="w">                  </span><span class="nb">else</span> <span class="n">If</span> <span class="nf">IsLabel(</span><span class="nv">A_ThisFunc</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span> <span class="o">%</span> <span class="nv">A_ThisFunc</span> <span class="o">.</span> <span class="s">&quot;Close&quot;</span>
               <span class="p">}</span>
            <span class="p">}</span> <span class="n">else</span> <span class="n">If</span> <span class="p">(</span><span class="nf">InStr(</span><span class="n">TOOLTEXT_</span><span class="nv">%A_LoopField%</span><span class="p">,</span><span class="s">&quot;&lt;a&quot;</span><span class="p">)){</span>
<span class="w">               </span><span class="nb">Loop</span> <span class="o">%</span> <span class="n">option</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                  </span><span class="nb">StringTrimLeft</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="o">%</span> <span class="nf">InStr(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&lt;a&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<span class="w">               </span><span class="nb">If </span><span class="n">TT_HIDE_</span><span class="nv">%A_LoopField%</span>
                  <span class="nv">%A_ThisFunc%</span><span class="p">(</span><span class="nv">A_LoopField</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;gTTM_POP&quot;</span><span class="p">)</span>
               <span class="n">If</span> <span class="p">((</span><span class="n">a</span><span class="o">:=</span><span class="nv">A_AutoTrim</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;Off&quot;</span><span class="p">)</span>
<span class="w">                  </span><span class="nb">AutoTrim</span><span class="p">,</span> <span class="n">On</span>
<span class="w">               </span><span class="nl">ErrorLevel:</span><span class="o">=</span><span class="nf">SubStr(</span><span class="n">text</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nf">InStr(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">               </span><span class="nb">StringTrimLeft</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="o">%</span> <span class="nf">InStr(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span>
<span class="w">               </span><span class="nl">text:</span><span class="o">=</span><span class="nf">SubStr(</span><span class="n">text</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nf">InStr(</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;&lt;/a&gt;&quot;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
               <span class="n">If</span> <span class="o">!</span><span class="nv">ErrorLevel</span>
<span class="w">                  </span><span class="nl">ErrorLevel:</span><span class="o">=</span><span class="n">text</span>
               <span class="nv">ErrorLevel</span><span class="o">=</span><span class="nv">%ErrorLevel%</span>
<span class="w">               </span><span class="nb">AutoTrim</span><span class="p">,</span> <span class="nv">%a%</span>
<span class="w">               </span><span class="nb">If </span><span class="n">Title</span>
               <span class="p">{</span>
<span class="w">                  </span><span class="nb">If </span><span class="nf">IsFunc(</span><span class="n">f</span><span class="o">:=</span><span class="p">(</span><span class="nv">A_LoopField</span> <span class="o">.</span> <span class="n">title</span><span class="p">))</span>
                     <span class="nv">%f%</span><span class="p">(</span><span class="nv">ErrorLevel</span><span class="p">)</span>
<span class="w">                  </span><span class="nb">else</span> <span class="n">if</span> <span class="nf">IsLabel(</span><span class="nv">A_LoopField</span> <span class="o">.</span> <span class="n">title</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span> <span class="o">%</span> <span class="nv">A_LoopField</span> <span class="o">.</span> <span class="n">title</span>
<span class="w">                  </span><span class="nb">else</span> <span class="n">if</span> <span class="nf">IsFunc(</span><span class="n">title</span><span class="p">)</span>
                     <span class="nv">%title%</span><span class="p">(</span><span class="nv">ErrorLevel</span><span class="p">)</span>
<span class="w">                  </span><span class="nb">else</span> <span class="n">If</span> <span class="nf">IsLabel(</span><span class="n">title</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span><span class="p">,</span> <span class="nv">%title%</span>
               <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
<span class="w">                  </span><span class="nb">if </span><span class="nf">IsFunc(</span><span class="n">f</span><span class="o">:=</span><span class="p">(</span><span class="nv">A_LoopField</span> <span class="o">.</span> <span class="nv">A_ThisFunc</span><span class="p">))</span>
                     <span class="nv">%f%</span><span class="p">(</span><span class="nv">ErrorLevel</span><span class="p">)</span>
<span class="w">                  </span><span class="nb">else</span> <span class="n">If</span> <span class="nf">IsLabel(</span><span class="nv">A_LoopField</span> <span class="o">.</span> <span class="nv">A_ThisFunc</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span> <span class="o">%</span> <span class="nv">A_LoopField</span> <span class="o">.</span> <span class="nv">A_ThisFunc</span>
<span class="w">                  </span><span class="nb">else</span> <span class="n">If</span> <span class="nf">IsLabel(</span><span class="nv">A_ThisFunc</span><span class="p">)</span>
<span class="w">                     </span><span class="nb">Gosub</span> <span class="o">%</span> <span class="nv">A_ThisFunc</span>
               <span class="p">}</span>
            <span class="p">}</span>
<span class="w">            </span><span class="nb">break</span>
         <span class="p">}</span>
      <span class="p">}</span>
<span class="w">      </span><span class="nb">DetectHiddenWindows</span><span class="p">,</span> <span class="nv">%#_DetectHiddenWindows%</span>
<span class="w">   </span><span class="nb">Return</span> <span class="n">OnMessage</span> <span class="o">?</span> <span class="nf">OnMessage(</span><span class="mh">0x4e</span><span class="p">,</span><span class="n">OnMessage</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span>
<span class="w">   </span><span class="nl">TT_DESTROY:</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span> <span class="n">Parse</span><span class="p">,</span> <span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span><span class="p">,</span><span class="o">%</span> <span class="nf">Chr(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">         </span><span class="nb">If </span><span class="nv">A_LoopField</span>
         <span class="p">{</span>
<span class="w">            </span><span class="nl">ID:</span><span class="o">=</span><span class="nv">A_LoopField</span>
<span class="w">            </span><span class="nb">Gosub</span><span class="p">,</span> <span class="n">TTM_DELTOOL</span>
<span class="w">            </span><span class="nl">TOOLINFO_%A_LoopField%:</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">TT_HWND_</span><span class="nv">%A_LoopField%</span><span class="o">:=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">TOOLTEXT_</span><span class="nv">%A_LoopField%</span><span class="o">:=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">TT_HIDE_</span><span class="nv">%A_LoopField%</span><span class="o">:=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">TOOLLINK</span><span class="nv">%A_LoopField%</span><span class="o">:=</span><span class="s">&quot;&quot;</span>
         <span class="p">}</span>
      <span class="n">TT_ALL_</span><span class="nv">%TT_ID%</span><span class="o">=</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="w">      </span>
<span class="w">   </span><span class="nl">TTM_INIT:</span>
<span class="w">   </span><span class="nl">Init:</span><span class="o">=</span><span class="mi">1</span><span class="c-Singleline"></span>
<span class="c-Singleline">   ; Messages</span>
   <span class="n">TTM_ACTIVATE</span> <span class="o">:=</span> <span class="mh">0x400</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>   <span class="n">TTM_ADDTOOL</span> <span class="o">:=</span> <span class="nv">A_IsUnicode</span> <span class="o">?</span> <span class="mh">0x432</span> <span class="o">:</span> <span class="mh">0x404</span><span class="p">,</span>   <span class="n">TTM_DELTOOL</span> <span class="o">:=</span> <span class="nv">A_IsUnicode</span> <span class="o">?</span> <span class="mh">0x433</span> <span class="o">:</span> <span class="mh">0x405</span>
   <span class="p">,</span><span class="n">TTM_POP</span> <span class="o">:=</span> <span class="mh">0x41c</span><span class="p">,</span> <span class="n">TTM_POPUP</span> <span class="o">:=</span> <span class="mh">0x422</span><span class="p">,</span>   <span class="n">TTM_UPDATETIPTEXT</span> <span class="o">:=</span> <span class="mh">0x400</span> <span class="o">+</span> <span class="p">(</span><span class="nv">A_IsUnicode</span> <span class="o">?</span> <span class="mi">57</span> <span class="o">:</span> <span class="mi">12</span><span class="p">)</span>
   <span class="p">,</span><span class="n">TTM_UPDATE</span> <span class="o">:=</span> <span class="mh">0x400</span> <span class="o">+</span> <span class="mi">29</span><span class="p">,</span> <span class="n">TTM_SETTOOLINFO</span> <span class="o">:=</span> <span class="mh">0x409</span><span class="p">,</span>   <span class="n">TTM_SETTITLE</span> <span class="o">:=</span> <span class="mh">0x400</span> <span class="o">+</span> <span class="p">(</span><span class="nv">A_IsUnicode</span> <span class="o">?</span> <span class="mi">33</span> <span class="o">:</span> <span class="mi">32</span><span class="p">)</span>
   <span class="p">,</span><span class="n">TTN_FIRST</span> <span class="o">:=</span> <span class="mh">0xfffffdf8</span><span class="p">,</span>   <span class="n">TTM_TRACKACTIVATE</span> <span class="o">:=</span> <span class="mh">0x400</span> <span class="o">+</span> <span class="mi">17</span><span class="p">,</span>   <span class="n">TTM_TRACKPOSITION</span> <span class="o">:=</span> <span class="mh">0x400</span> <span class="o">+</span> <span class="mi">18</span>
<span class="w">   </span><span class="nl">,TTM_SETMARGIN:</span><span class="o">=</span><span class="mh">0x41a</span><span class="p">,</span> <span class="n">TTM_SETWINDOWTHEME</span><span class="o">:=</span><span class="mh">0x200b</span><span class="p">,</span> <span class="n">TTM_SETMAXTIPWIDTH</span><span class="o">:=</span><span class="mh">0x418</span><span class="p">,</span><span class="n">TTM_GETBUBBLESIZE</span><span class="o">:=</span><span class="mh">0x41e</span>
<span class="w">   </span><span class="nl">,TTM_SETTIPBKCOLOR:</span><span class="o">=</span><span class="mh">0x413</span><span class="p">,</span>   <span class="n">TTM_SETTIPTEXTCOLOR</span><span class="o">:=</span><span class="mh">0x414</span><span class="c-Singleline"></span>
<span class="c-Singleline">   ;Colors</span>
<span class="w">   </span><span class="nl">,Black:</span><span class="o">=</span><span class="mh">0x000000</span><span class="p">,</span> <span class="n">Green</span><span class="o">:=</span><span class="mh">0x008000</span><span class="p">,</span><span class="n">Silver</span><span class="o">:=</span><span class="mh">0xC0C0C0</span>
<span class="w">   </span><span class="nl">,Lime:</span><span class="o">=</span><span class="mh">0x00FF00</span><span class="p">,</span> <span class="n">Gray</span><span class="o">:=</span><span class="mh">0x808080</span><span class="p">,</span> <span class="n">Olive</span><span class="o">:=</span><span class="mh">0x808000</span>
<span class="w">   </span><span class="nl">,White:</span><span class="o">=</span><span class="mh">0xFFFFFF</span><span class="p">,</span> <span class="n">Yellow</span><span class="o">:=</span><span class="mh">0xFFFF00</span><span class="p">,</span> <span class="n">Maroon</span><span class="o">:=</span><span class="mh">0x800000</span>
<span class="w">   </span><span class="nl">,Navy:</span><span class="o">=</span><span class="mh">0x000080</span><span class="p">,</span> <span class="n">Red</span><span class="o">:=</span><span class="mh">0xFF0000</span><span class="p">,</span> <span class="n">Blue</span><span class="o">:=</span><span class="mh">0x0000FF</span>
<span class="w">   </span><span class="nl">,Purple:</span><span class="o">=</span><span class="mh">0x800080</span><span class="p">,</span> <span class="n">Teal</span><span class="o">:=</span><span class="mh">0x008080</span><span class="p">,</span> <span class="n">Fuchsia</span><span class="o">:=</span><span class="mh">0xFF00FF</span>
<span class="w">   </span><span class="nl">,Aqua:</span><span class="o">=</span><span class="mh">0x00FFFF</span>
<span class="w">   </span><span class="nb">Return</span>
<span class="p">}</span>
</pre></div>
