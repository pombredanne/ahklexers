<LINK href="styles.css" rel="stylesheet" type="text/css"><div class="highlight"><pre><span class="c-Singleline">; ShellFileOperation by SKAN</span>
<span class="c-Singleline">; 2007, http://www.autohotkey.com/forum/viewtopic.php?p=133249#133249</span>
<span class="n">ShellFileOperation</span><span class="p">(</span> <span class="n">fileO</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">fSource</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">fTarget</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">ghwnd</span><span class="o">=</span><span class="mh">0x0</span> <span class="p">)</span>     <span class="p">{</span>

 <span class="n">If</span> <span class="p">(</span> <span class="nf">SubStr(</span><span class="n">fSource</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;|&quot;</span> <span class="p">)</span>
      <span class="n">fSource</span> :<span class="o">=</span> <span class="n">fSource</span> <span class="o">.</span> <span class="s">&quot;|&quot;</span>

 <span class="n">If</span> <span class="p">(</span> <span class="nf">SubStr(</span><span class="n">fTarget</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;|&quot;</span> <span class="p">)</span>
      <span class="n">fTarget</span> :<span class="o">=</span> <span class="n">fTarget</span> <span class="o">.</span> <span class="s">&quot;|&quot;</span>

 <span class="n">fsPtr</span> :<span class="o">=</span> <span class="o">&amp;</span><span class="n">fSource</span>
<span class="w"> </span><span class="nb">Loop</span><span class="p">,</span> <span class="o">%</span> <span class="nf">StrLen(</span><span class="n">fSource</span><span class="p">)</span>
  <span class="n">If</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">fsPtr</span><span class="o">+</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">124</span> <span class="p">)</span>
      <span class="nf">DllCall(</span> <span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span> <span class="n">fsPtr</span><span class="o">+</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">Int</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="mi">0</span> <span class="p">)</span>

 <span class="n">ftPtr</span> :<span class="o">=</span> <span class="o">&amp;</span><span class="n">fTarget</span>
<span class="w"> </span><span class="nb">Loop</span><span class="p">,</span> <span class="o">%</span> <span class="nf">StrLen(</span><span class="n">fTarget</span><span class="p">)</span>
  <span class="n">If</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">ftPtr</span><span class="o">+</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">124</span> <span class="p">)</span>
      <span class="nf">DllCall(</span> <span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span> <span class="n">ftPtr</span><span class="o">+</span><span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">Int</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="mi">0</span> <span class="p">)</span>

 <span class="nf">VarSetCapacity(</span> <span class="n">SHFILEOPSTRUCT</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span><span class="c-Singleline">                 ; Encoding SHFILEOPSTRUCT</span>
 <span class="n">NextOffset</span> :<span class="o">=</span> <span class="nf">NumPut(</span> <span class="n">ghwnd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">SHFILEOPSTRUCT</span> <span class="p">)</span><span class="c-Singleline">          ; hWnd of calling GUI</span>
 <span class="n">NextOffset</span> :<span class="o">=</span> <span class="nf">NumPut(</span> <span class="n">fileO</span><span class="p">,</span> <span class="n">NextOffset</span><span class="o">+</span><span class="mi">0</span>    <span class="p">)</span><span class="c-Singleline">          ; File operation</span>
 <span class="n">NextOffset</span> :<span class="o">=</span> <span class="nf">NumPut(</span> <span class="n">fsPtr</span><span class="p">,</span> <span class="n">NextOffset</span><span class="o">+</span><span class="mi">0</span>    <span class="p">)</span><span class="c-Singleline">          ; Source file / pattern</span>
 <span class="n">NextOffset</span> :<span class="o">=</span> <span class="nf">NumPut(</span> <span class="n">ftPtr</span><span class="p">,</span> <span class="n">NextOffset</span><span class="o">+</span><span class="mi">0</span>    <span class="p">)</span><span class="c-Singleline">          ; Target file / folder</span>
 <span class="n">NextOffset</span> :<span class="o">=</span> <span class="nf">NumPut(</span> <span class="n">flags</span><span class="p">,</span> <span class="n">NextOffset</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Short&quot;</span> <span class="p">)</span><span class="c-Singleline"> ; options</span>

 <span class="nf">DllCall(</span> <span class="s">&quot;Shell32\SHFileOperationA&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">SHFILEOPSTRUCT</span> <span class="p">)</span>
<span class="w"> </span>
<span class="nb">Return</span> <span class="nf">NumGet(</span> <span class="n">NextOffset</span><span class="o">+</span><span class="mi">0</span> <span class="p">)</span>
<span class="p">}</span>
</pre></div>
