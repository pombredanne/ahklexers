<LINK href="styles.css" rel="stylesheet" type="text/css">old lexer: 
<div class="highlight"><pre><span class="c1">;?add 2010 Modified by Tuncay to work with the stdlib mechanism.</span>
<span class="c1">;?add The function names are changed, mostly a prefix Tray_ is </span>
<span class="c1">;?add added and names changed: TrayIcons() becomes to TrayIcon()</span>
<span class="c1">;?add and HideTrayIcon() becomes to TrayIcon_Hide().</span>
<span class="c1">;?add All changed or added lines are commented with ;? comments.</span>
<span class="c1">;?add http://www.autohotkey.com/forum/viewtopic.php?t=17314 by Sean</span>

<span class="c1">;?out-begin</span>
<span class="cm">/*</span>
<span class="cm">#NoTrayIcon</span>
<span class="cm">DetectHiddenWindows, On</span>

<span class="cm">MsgBox % TrayIcons()</span>
<span class="cm">Return</span>
<span class="cm">*/</span>
<span class="c1">;?out-end</span>

<span class="cm">/*</span>
<span class="cm">WM_MOUSEMOVE	= 0x0200</span>
<span class="cm">WM_LBUTTONDOWN	= 0x0201</span>
<span class="cm">WM_LBUTTONUP	= 0x0202</span>
<span class="cm">WM_LBUTTONDBLCLK= 0x0203</span>
<span class="cm">WM_RBUTTONDOWN	= 0x0204</span>
<span class="cm">WM_RBUTTONUP	= 0x0205</span>
<span class="cm">WM_RBUTTONDBLCLK= 0x0206</span>
<span class="cm">WM_MBUTTONDOWN	= 0x0207</span>
<span class="cm">WM_MBUTTONUP	= 0x0208</span>
<span class="cm">WM_MBUTTONDBLCLK= 0x0209</span>

<span class="cm">PostMessage, nMsg, uID, WM_RBUTTONDOWN, , ahk_id %hWnd%</span>
<span class="cm">PostMessage, nMsg, uID, WM_RBUTTONUP  , , ahk_id %hWnd%</span>
<span class="cm">*/</span>


<span class="c1">;?out TrayIcons(sExeName = &quot;&quot;)</span>
<span class="nf">TrayIcon</span><span class="p">(</span>sExeName<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">WinGet</span><span class="p">,</span><span class="w">	</span>pidTaskbar<span class="p">,</span><span class="w"> </span>PID<span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd
<span class="w">	</span>hProc<span class="o">:=</span><span class="w">	</span>DllCall<span class="p">(</span><span class="s">&quot;OpenProcess&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pidTaskbar<span class="p">)</span>
<span class="w">	</span>pProc<span class="o">:=</span><span class="w">	</span>DllCall<span class="p">(</span><span class="s">&quot;VirtualAllocEx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4</span><span class="p">)</span>
<span class="w">	</span>idxTB<span class="o">:=</span><span class="w">	</span>TrayIcon_GetTrayBar<span class="p">()</span>
<span class="w">		</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span><span class="mh">0x418</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>ToolbarWindow32<span class="nv">%idxTB%</span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd<span class="w">   </span><span class="c1">; TB_BUTTONCOUNT</span>
<span class="w">	</span><span class="k">Loop</span><span class="p">,</span><span class="w">	</span><span class="nv">%ErrorLevel%</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span><span class="mh">0x417</span><span class="p">,</span><span class="w"> </span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>pProc<span class="p">,</span><span class="w"> </span>ToolbarWindow32<span class="nv">%idxTB%</span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd<span class="w">   </span><span class="c1">; TB_GETBUTTON</span>
<span class="w">		</span><span class="nf">VarSetCapacity</span><span class="p">(</span>btn<span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="nf">VarSetCapacity</span><span class="p">(</span>nfo<span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>btn<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">			</span>iBitmap<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>btn<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">			</span>idn<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>btn<span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">			</span>Statyle<span class="w"> </span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>btn<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">		</span><span class="kr">If</span><span class="w">	</span>dwData<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>btn<span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="w">			</span>iString<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>btn<span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<span class="w">		</span><span class="k">Else</span><span class="w">	</span>dwData<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>btn<span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;int64&quot;</span><span class="p">),</span><span class="w"> </span>iString<span class="o">:=</span>NumGet<span class="p">(</span>btn<span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="s">&quot;int64&quot;</span><span class="p">)</span>
<span class="w">		</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>dwData<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>nfo<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">		</span><span class="kr">If</span><span class="w">	</span><span class="nf">NumGet</span><span class="p">(</span>btn<span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="w">			</span>hWnd<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>nfo<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">		</span><span class="p">,</span><span class="w">	</span>uID<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>nfo<span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">		</span><span class="p">,</span><span class="w">	</span>nMsg<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>nfo<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">		</span><span class="p">,</span><span class="w">	</span>hIcon<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>nfo<span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="w">		</span><span class="k">Else</span><span class="w">	</span>hWnd<span class="w">	</span><span class="o">:=</span><span class="w"> </span>NumGet<span class="p">(</span>nfo<span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;int64&quot;</span><span class="p">),</span><span class="w"> </span>uID<span class="o">:=</span>NumGet<span class="p">(</span>nfo<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span>nMsg<span class="o">:=</span>NumGet<span class="p">(</span>nfo<span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="w">		</span><span class="k">WinGet</span><span class="p">,</span><span class="w"> </span>pid<span class="p">,</span><span class="w"> </span>PID<span class="p">,</span><span class="w">              </span>ahk_id<span class="w"> </span><span class="nv">%hWnd%</span>
<span class="w">		</span><span class="k">WinGet</span><span class="p">,</span><span class="w"> </span>sProcess<span class="p">,</span><span class="w"> </span>ProcessName<span class="p">,</span><span class="w"> </span>ahk_id<span class="w"> </span><span class="nv">%hWnd%</span>
<span class="w">		</span><span class="k">WinGetClass</span><span class="p">,</span><span class="w"> </span>sClass<span class="p">,</span><span class="w">           </span>ahk_id<span class="w"> </span><span class="nv">%hWnd%</span>
<span class="w">		</span><span class="kr">If</span><span class="w"> </span><span class="o">!</span>sExeName<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>sExeName<span class="w"> </span><span class="o">=</span><span class="w"> </span>sProcess<span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span>sExeName<span class="w"> </span><span class="o">=</span><span class="w"> </span>pid<span class="p">)</span>
<span class="w">			</span><span class="nf">VarSetCapacity</span><span class="p">(</span>sTooltip<span class="p">,</span><span class="mi">128</span><span class="p">),</span><span class="w"> </span><span class="nf">VarSetCapacity</span><span class="p">(</span>wTooltip<span class="p">,</span><span class="mi">128</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="w">		</span><span class="p">,</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>iString<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>wTooltip<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">		</span><span class="p">,</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;WideCharToMultiByte&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span>wTooltip<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span>sTooltip<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">		</span><span class="p">,</span><span class="w">	</span>sTrayIcons<span class="w"> </span><span class="p">.</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;idx: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot; | idn: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>idn<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot; | Pid: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>pid<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot; | uID: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>uID<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot; | MessageID: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>nMsg<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot; | hWnd: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>hWnd<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot; | Class: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>sClass<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot; | Process: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>sProcess<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;   | Tooltip: &quot;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>sTooltip<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;VirtualFreeEx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>pProc<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8000</span><span class="p">)</span>
<span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hProc<span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>sTrayIcons
<span class="p">}</span>

<span class="c1">;?out RemoveTrayIcon(hWnd, uID, nMsg = 0, hIcon = 0, nRemove = 2)</span>
<span class="nf">TrayIcon_Remove</span><span class="p">(</span>hWnd<span class="p">,</span><span class="w"> </span>uID<span class="p">,</span><span class="w"> </span>nMsg<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>hIcon<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>nRemove<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>VarSetCapacity<span class="p">(</span>ni<span class="p">,</span><span class="mi">444</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span>ni<span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>hWnd<span class="w"> </span><span class="p">,</span><span class="w"> </span>ni<span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>uID<span class="w">  </span><span class="p">,</span><span class="w"> </span>ni<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span>ni<span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>nMsg<span class="w"> </span><span class="p">,</span><span class="w"> </span>ni<span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<span class="w">	</span><span class="nf">NumPut</span><span class="p">(</span>hIcon<span class="p">,</span><span class="w"> </span>ni<span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;shell32\Shell_NotifyIconA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nRemove<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>ni<span class="p">)</span>
<span class="p">}</span>

<span class="c1">;?out HideTrayIcon(idn, bHide = True)</span>
<span class="nf">TrayIcon_Hide</span><span class="p">(</span>idn<span class="p">,</span><span class="w"> </span>bHide<span class="w"> </span><span class="o">=</span><span class="w"> </span>True<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span>idxTB<span class="w"> </span><span class="o">:=</span><span class="w"> </span>TrayIcon_GetTrayBar<span class="p">()</span>
<span class="w">	</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span><span class="mh">0x404</span><span class="p">,</span><span class="w"> </span>idn<span class="p">,</span><span class="w"> </span>bHide<span class="p">,</span><span class="w"> </span>ToolbarWindow32<span class="nv">%idxTB%</span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd<span class="w">   </span><span class="c1">; TB_HIDEBUTTON</span>
<span class="w">	</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1A</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd
<span class="p">}</span>

<span class="c1">;?out DeleteTrayIcon(idx)</span>
<span class="nf">TrayIcon_Delete</span><span class="p">(</span>idx<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span>idxTB<span class="w"> </span><span class="o">:=</span><span class="w"> </span>TrayIcon_GetTrayBar<span class="p">()</span>
<span class="w">	</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span><span class="mh">0x416</span><span class="p">,</span><span class="w"> </span>idx<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>ToolbarWindow32<span class="nv">%idxTB%</span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd<span class="w">   </span><span class="c1">; TB_DELETEBUTTON</span>
<span class="w">	</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1A</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd
<span class="p">}</span>

<span class="c1">;?out MoveTrayIcon(idxOld, idxNew)</span>
<span class="nf">TrayIcon_Move</span><span class="p">(</span>idxOld<span class="p">,</span><span class="w"> </span>idxNew<span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span>idxTB<span class="w"> </span><span class="o">:=</span><span class="w"> </span>TrayIcon_GetTrayBar<span class="p">()</span>
<span class="w">	</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span><span class="mh">0x452</span><span class="p">,</span><span class="w"> </span>idxOld<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>idxNew<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>ToolbarWindow32<span class="nv">%idxTB%</span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd<span class="w"> </span><span class="c1">; TB_MOVEBUTTON</span>
<span class="p">}</span>

<span class="c1">;?out GetTrayBar()</span>
<span class="nf">TrayIcon_GetTrayBar</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">ControlGet</span><span class="p">,</span><span class="w"> </span>hParent<span class="p">,</span><span class="w"> </span>hWnd<span class="p">,,</span><span class="w"> </span>TrayNotifyWnd1<span class="w">  </span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd
<span class="w">	</span><span class="k">ControlGet</span><span class="p">,</span><span class="w"> </span>hChild<span class="w"> </span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,,</span><span class="w"> </span>ToolbarWindow321<span class="p">,</span><span class="w"> </span>ahk_id<span class="w"> </span><span class="nv">%hParent%</span>
<span class="w">	</span><span class="k">Loop</span>
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="k">ControlGet</span><span class="p">,</span><span class="w"> </span>hWnd<span class="p">,</span><span class="w"> </span>hWnd<span class="p">,,</span><span class="w"> </span>ToolbarWindow32<span class="nv">%A_Index%</span><span class="p">,</span><span class="w"> </span>ahk_class<span class="w"> </span>Shell_TrayWnd
<span class="w">		</span><span class="kr">If</span><span class="w">  </span>Not<span class="w">	</span>hWnd
<span class="w">			</span><span class="k">Break</span>
<span class="w">		</span><span class="k">Else</span><span class="w"> </span><span class="kr">If</span><span class="w">	</span>hWnd<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">%hChild%</span>
<span class="w">		</span><span class="p">{</span>
<span class="w">			</span>idxTB<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_Index</span>
<span class="w">			</span><span class="k">Break</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">Return</span><span class="w">	</span>idxTB
<span class="p">}</span>
</pre></div>


New Lexer: 
<div class="highlight"><pre><span class="c-Singleline">;?add 2010 Modified by Tuncay to work with the stdlib mechanism.</span>
<span class="c-Singleline">;?add The function names are changed, mostly a prefix Tray_ is </span>
<span class="c-Singleline">;?add added and names changed: TrayIcons() becomes to TrayIcon()</span>
<span class="c-Singleline">;?add and HideTrayIcon() becomes to TrayIcon_Hide().</span>
<span class="c-Singleline">;?add All changed or added lines are commented with ;? comments.</span>
<span class="c-Singleline">;?add http://www.autohotkey.com/forum/viewtopic.php?t=17314 by Sean</span>

<span class="c-Singleline">;?out-begin</span>
<span class="cm">/*</span>
<span class="cm">#NoTrayIcon</span>
<span class="cm">DetectHiddenWindows, On</span>

<span class="cm">MsgBox % TrayIcons()</span>
<span class="cm">Return</span>
<span class="cm">*/</span><span class="c-Singleline"></span>
<span class="c-Singleline">;?out-end</span>

<span class="cm">/*</span>
<span class="cm">WM_MOUSEMOVE	= 0x0200</span>
<span class="cm">WM_LBUTTONDOWN	= 0x0201</span>
<span class="cm">WM_LBUTTONUP	= 0x0202</span>
<span class="cm">WM_LBUTTONDBLCLK= 0x0203</span>
<span class="cm">WM_RBUTTONDOWN	= 0x0204</span>
<span class="cm">WM_RBUTTONUP	= 0x0205</span>
<span class="cm">WM_RBUTTONDBLCLK= 0x0206</span>
<span class="cm">WM_MBUTTONDOWN	= 0x0207</span>
<span class="cm">WM_MBUTTONUP	= 0x0208</span>
<span class="cm">WM_MBUTTONDBLCLK= 0x0209</span>

<span class="cm">PostMessage, nMsg, uID, WM_RBUTTONDOWN, , ahk_id %hWnd%</span>
<span class="cm">PostMessage, nMsg, uID, WM_RBUTTONUP  , , ahk_id %hWnd%</span>
<span class="cm">*/</span><span class="c-Singleline"></span>


<span class="c-Singleline">;?out TrayIcons(sExeName = &quot;&quot;)</span>
<span class="n">TrayIcon</span><span class="p">(</span><span class="n">sExeName</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">WinGet</span><span class="p">,</span>	<span class="n">pidTaskbar</span><span class="p">,</span> <span class="n">PID</span><span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span>
<span class="w">	</span><span class="nl">hProc:</span><span class="o">=</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;OpenProcess&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pidTaskbar</span><span class="p">)</span>
<span class="w">	</span><span class="nl">pProc:</span><span class="o">=</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;VirtualAllocEx&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hProc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">)</span>
<span class="w">	</span><span class="nl">idxTB:</span><span class="o">=</span>	<span class="n">TrayIcon_GetTrayBar</span><span class="p">()</span>
<span class="w">		</span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x418</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ToolbarWindow32</span><span class="nv">%idxTB%</span><span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span><span class="c-Singleline">   ; TB_BUTTONCOUNT</span>
<span class="w">	</span><span class="nb">Loop</span><span class="p">,</span>	<span class="nv">%ErrorLevel%</span>
	<span class="p">{</span>
<span class="w">		</span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x417</span><span class="p">,</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pProc</span><span class="p">,</span> <span class="n">ToolbarWindow32</span><span class="nv">%idxTB%</span><span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span><span class="c-Singleline">   ; TB_GETBUTTON</span>
		<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hProc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pProc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">btn</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">iBitmap</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">idn</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
			<span class="n">Statyle</span> <span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
		<span class="n">If</span>	<span class="n">dwData</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
			<span class="n">iString</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<span class="w">		</span><span class="nb">Else</span>	<span class="n">dwData</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;int64&quot;</span><span class="p">),</span> <span class="n">iString</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="s">&quot;int64&quot;</span><span class="p">)</span>
		<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hProc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">dwData</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nfo</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">If</span>	<span class="nf">NumGet</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
			<span class="n">hWnd</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">,</span>	<span class="n">uID</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
		<span class="p">,</span>	<span class="n">nMsg</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
		<span class="p">,</span>	<span class="n">hIcon</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="w">		</span><span class="nb">Else</span>	<span class="n">hWnd</span>	<span class="o">:=</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="s">&quot;int64&quot;</span><span class="p">),</span> <span class="n">uID</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">nMsg</span><span class="o">:=</span><span class="nf">NumGet</span><span class="p">(</span><span class="n">nfo</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="w">		</span><span class="nb">WinGet</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">PID</span><span class="p">,</span>              <span class="n">ahk_id</span> <span class="nv">%hWnd%</span>
<span class="w">		</span><span class="nb">WinGet</span><span class="p">,</span> <span class="n">sProcess</span><span class="p">,</span> <span class="n">ProcessName</span><span class="p">,</span> <span class="n">ahk_id</span> <span class="nv">%hWnd%</span>
<span class="w">		</span><span class="nb">WinGetClass</span><span class="p">,</span> <span class="n">sClass</span><span class="p">,</span>           <span class="n">ahk_id</span> <span class="nv">%hWnd%</span>
		<span class="n">If</span> <span class="o">!</span><span class="n">sExeName</span> <span class="o">||</span> <span class="p">(</span><span class="n">sExeName</span> <span class="o">=</span> <span class="n">sProcess</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">sExeName</span> <span class="o">=</span> <span class="n">pid</span><span class="p">)</span>
			<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sTooltip</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">wTooltip</span><span class="p">,</span><span class="mi">128</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
		<span class="p">,</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReadProcessMemory&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hProc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">iString</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wTooltip</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">128</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">,</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;WideCharToMultiByte&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">wTooltip</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">sTooltip</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">,</span>	<span class="n">sTrayIcons</span> <span class="o">.=</span> <span class="s">&quot;idx: &quot;</span> <span class="o">.</span> <span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span> <span class="o">.</span> <span class="s">&quot; | idn: &quot;</span> <span class="o">.</span> <span class="n">idn</span> <span class="o">.</span> <span class="s">&quot; | Pid: &quot;</span> <span class="o">.</span> <span class="n">pid</span> <span class="o">.</span> <span class="s">&quot; | uID: &quot;</span> <span class="o">.</span> <span class="n">uID</span> <span class="o">.</span> <span class="s">&quot; | MessageID: &quot;</span> <span class="o">.</span> <span class="n">nMsg</span> <span class="o">.</span> <span class="s">&quot; | hWnd: &quot;</span> <span class="o">.</span> <span class="n">hWnd</span> <span class="o">.</span> <span class="s">&quot; | Class: &quot;</span> <span class="o">.</span> <span class="n">sClass</span> <span class="o">.</span> <span class="s">&quot; | Process: &quot;</span> <span class="o">.</span> <span class="n">sProcess</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span> <span class="o">.</span> <span class="s">&quot;   | Tooltip: &quot;</span> <span class="o">.</span> <span class="n">sTooltip</span> <span class="o">.</span> <span class="s">&quot;</span><span class="se">`n</span><span class="s">&quot;</span>
	<span class="p">}</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;VirtualFreeEx&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hProc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">pProc</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">)</span>
	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hProc</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">sTrayIcons</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">;?out RemoveTrayIcon(hWnd, uID, nMsg = 0, hIcon = 0, nRemove = 2)</span>
<span class="n">TrayIcon_Remove</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">uID</span><span class="p">,</span> <span class="n">nMsg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hIcon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nRemove</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nf">NumPut</span><span class="p">(</span><span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="mi">444</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">ni</span><span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span><span class="n">hWnd</span> <span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span><span class="n">uID</span>  <span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">4</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span><span class="n">nMsg</span> <span class="p">,</span> <span class="n">ni</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
	<span class="nf">NumPut</span><span class="p">(</span><span class="n">hIcon</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;shell32\Shell_NotifyIconA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nRemove</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ni</span><span class="p">)</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">;?out HideTrayIcon(idn, bHide = True)</span>
<span class="n">TrayIcon_Hide</span><span class="p">(</span><span class="n">idn</span><span class="p">,</span> <span class="n">bHide</span> <span class="o">=</span> <span class="nv">True</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">idxTB</span> <span class="o">:=</span> <span class="n">TrayIcon_GetTrayBar</span><span class="p">()</span>
<span class="w">	</span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x404</span><span class="p">,</span> <span class="n">idn</span><span class="p">,</span> <span class="n">bHide</span><span class="p">,</span> <span class="n">ToolbarWindow32</span><span class="nv">%idxTB%</span><span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span><span class="c-Singleline">   ; TB_HIDEBUTTON</span>
<span class="w">	</span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">;?out DeleteTrayIcon(idx)</span>
<span class="n">TrayIcon_Delete</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">idxTB</span> <span class="o">:=</span> <span class="n">TrayIcon_GetTrayBar</span><span class="p">()</span>
<span class="w">	</span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x416</span><span class="p">,</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ToolbarWindow32</span><span class="nv">%idxTB%</span><span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span><span class="c-Singleline">   ; TB_DELETEBUTTON</span>
<span class="w">	</span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">;?out MoveTrayIcon(idxOld, idxNew)</span>
<span class="n">TrayIcon_Move</span><span class="p">(</span><span class="n">idxOld</span><span class="p">,</span> <span class="n">idxNew</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">idxTB</span> <span class="o">:=</span> <span class="n">TrayIcon_GetTrayBar</span><span class="p">()</span>
<span class="w">	</span><span class="nb">SendMessage</span><span class="p">,</span> <span class="mh">0x452</span><span class="p">,</span> <span class="n">idxOld</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idxNew</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ToolbarWindow32</span><span class="nv">%idxTB%</span><span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span><span class="c-Singleline"> ; TB_MOVEBUTTON</span>
<span class="p">}</span><span class="c-Singleline"></span>

<span class="c-Singleline">;?out GetTrayBar()</span>
<span class="n">TrayIcon_GetTrayBar</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">	</span><span class="nb">ControlGet</span><span class="p">,</span> <span class="n">hParent</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,,</span> <span class="n">TrayNotifyWnd1</span>  <span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span>
<span class="w">	</span><span class="nb">ControlGet</span><span class="p">,</span> <span class="n">hChild</span> <span class="p">,</span> <span class="n">hWnd</span><span class="p">,,</span> <span class="n">ToolbarWindow321</span><span class="p">,</span> <span class="n">ahk_id</span> <span class="nv">%hParent%</span>
<span class="w">	</span><span class="nb">Loop</span>
	<span class="p">{</span>
<span class="w">		</span><span class="nb">ControlGet</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">hWnd</span><span class="p">,,</span> <span class="n">ToolbarWindow32</span><span class="nv">%A_Index%</span><span class="p">,</span> <span class="n">ahk_class</span> <span class="n">Shell_TrayWnd</span>
		<span class="n">If</span>  <span class="n">Not</span>	<span class="n">hWnd</span>
<span class="w">			</span><span class="nb">Break</span>
<span class="w">		</span><span class="nb">Else</span> <span class="n">If</span>	<span class="n">hWnd</span> <span class="o">=</span> <span class="nv">%hChild%</span>
		<span class="p">{</span>
			<span class="n">idxTB</span> <span class="o">:=</span> <span class="nv">A_Index</span>
<span class="w">			</span><span class="nb">Break</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="w">	</span><span class="nb">Return</span>	<span class="n">idxTB</span>
<span class="p">}</span>
</pre></div>
