<LINK href="styles.css" rel="stylesheet" type="text/css">old lexer: 
<div class="highlight"><pre><span class="c1">; ****************************************************************** </span>
<span class="c1">; CMDret-AHK functions </span>
<span class="c1">; version 1.10 beta </span>
<span class="c1">; </span>
<span class="c1">; Updated: Dec 5, 2006 </span>
<span class="c1">; by: corrupt </span>
<span class="c1">; Code modifications and/or contributions made by: </span>
<span class="c1">; Laszlo, shimanov, toralf, Wdb  </span>
<span class="c1">; ****************************************************************** </span>
<span class="c1">; Usage: </span>
<span class="c1">; CMDin - command to execute</span>
<span class="c1">; WorkingDir - full path to working directory (Optional) </span>
<span class="c1">; ****************************************************************** </span>
<span class="c1">; Known Issues: </span>
<span class="c1">; - If using dir be sure to specify a path (example: cmd /c dir c:\)</span>
<span class="c1">; or specify a working directory    </span>
<span class="c1">; - Running 16 bit console applications may not produce output. Use </span>
<span class="c1">; a 32 bit application to start the 16 bit process to receive output  </span>
<span class="c1">; ****************************************************************** </span>
<span class="c1">; Additional requirements: </span>
<span class="c1">; - none </span>
<span class="c1">; ****************************************************************** </span>
<span class="c1">; Code Start </span>
<span class="c1">; ****************************************************************** </span>

<span class="nf">CMDret_RunReturn</span><span class="p">(</span>CMDin<span class="p">,</span><span class="w"> </span>WorkingDir<span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="kt">Global</span><span class="w"> </span>cmdretPID
<span class="w">  </span>tcWrk<span class="w"> </span><span class="o">:=</span><span class="w"> </span>WorkingDir<span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Str&quot;</span>
<span class="w">  </span>idltm<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_TickCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span>
<span class="w">  </span>CMsize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">  </span><span class="nf">VarSetCapacity</span><span class="p">(</span>CMDout<span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="nf">VarSetCapacity</span><span class="p">(</span>sui<span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="nf">VarSetCapacity</span><span class="p">(</span>pi<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="nf">VarSetCapacity</span><span class="p">(</span>pa<span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>pa<span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UChar<span class="p">,</span><span class="mi">12</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>pa<span class="o">+</span><span class="mi">8</span><span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UChar<span class="p">,</span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>DllCall<span class="p">(</span><span class="s">&quot;CreatePipe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt*&quot;</span><span class="p">,</span>hRead<span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt*&quot;</span><span class="p">,</span>hWrite<span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="o">&amp;</span>pa<span class="p">,</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>sui<span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UChar<span class="p">,</span><span class="mi">68</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetStartupInfo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>sui<span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>sui<span class="o">+</span><span class="mi">44</span><span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UChar<span class="p">,</span><span class="mi">257</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>sui<span class="o">+</span><span class="mi">60</span><span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UChar<span class="p">,</span>hWrite<span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>sui<span class="o">+</span><span class="mi">64</span><span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UChar<span class="p">,</span>hWrite<span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>sui<span class="o">+</span><span class="mi">48</span><span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>UChar<span class="p">,</span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>DllCall<span class="p">(</span><span class="s">&quot;CreateProcess&quot;</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>Str<span class="p">,</span>CMDin<span class="p">,</span><span class="w"> </span>Int<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>tcWrk<span class="p">,</span><span class="w"> </span>WorkingDir<span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>sui<span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="o">&amp;</span>pi<span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">Loop</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span>
<span class="w">        </span>cmdretPID<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">&amp;</span>pi<span class="o">+</span><span class="mi">8</span><span class="o">+</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="w"> </span>
<span class="w">      </span><span class="k">Loop</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">        </span>idltm2<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_TickCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>idltm<span class="w"> </span>
<span class="w">        </span><span class="nf">If</span><span class="w"> </span><span class="p">(</span>idltm2<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">          </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;Sleep&quot;</span><span class="p">,</span><span class="w"> </span>Int<span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span>
<span class="w">          </span><span class="k">Continue</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>DllCall<span class="p">(</span><span class="s">&quot;PeekNamedPipe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>hRead<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uint*&quot;</span><span class="p">,</span><span class="w"> </span>bSize<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">          </span><span class="k">Process</span><span class="p">,</span><span class="w"> </span>Exist<span class="p">,</span><span class="w"> </span><span class="nv">%cmdretPID%</span><span class="w"> </span>
<span class="w">          </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>ErrorLevel<span class="w"> </span><span class="kr">OR</span><span class="w"> </span>bSize<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>bSize<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">              </span><span class="nf">VarSetCapacity</span><span class="p">(</span>lpBuffer<span class="p">,</span><span class="w"> </span>bSize<span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>DllCall<span class="p">(</span><span class="s">&quot;ReadFile&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span>hRead<span class="p">,</span><span class="w"> </span><span class="s">&quot;Str&quot;</span><span class="p">,</span><span class="w"> </span>lpBuffer<span class="p">,</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span>bSize<span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt*&quot;</span><span class="p">,</span>bRead<span class="p">,</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">                </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>bRead<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">                  </span>TRead<span class="w"> </span><span class="o">+=</span><span class="w"> </span>bRead<span class="w"> </span>
<span class="w">                  </span><span class="nf">VarSetCapacity</span><span class="p">(</span>CMcpy<span class="p">,</span><span class="w"> </span><span class="p">(</span>bRead<span class="o">+</span>CMsize<span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">                  </span>CMcpy<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="w"> </span>
<span class="w">                  </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMcpy<span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMDout<span class="p">,</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="w"> </span>CMsize<span class="p">)</span><span class="w"> </span>
<span class="w">                  </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMcpy<span class="o">+</span>CMsize<span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>lpBuffer<span class="p">,</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="w"> </span>bRead<span class="p">)</span><span class="w"> </span>
<span class="w">                  </span>CMsize<span class="w"> </span><span class="o">+=</span><span class="w"> </span>bRead<span class="w"> </span>
<span class="w">                  </span><span class="nf">VarSetCapacity</span><span class="p">(</span>CMDout<span class="p">,</span><span class="w"> </span><span class="p">(</span>CMsize<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">                  </span>CMDout<span class="o">=</span>a<span class="w">    </span>
<span class="w">                  </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMDout<span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMcpy<span class="p">,</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="w"> </span>CMsize<span class="p">)</span><span class="w"> </span>
<span class="w">                  </span><span class="nf">VarSetCapacity</span><span class="p">(</span>CMDout<span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">   </span><span class="c1">; fix required by change in autohotkey v1.0.44.14 </span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span>
<span class="w">              </span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span>
<span class="w">          </span><span class="k">ELSE</span><span class="w"> </span>
<span class="w">            </span><span class="k">break</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span>
<span class="w">          </span><span class="k">break</span><span class="w"> </span>
<span class="w">        </span>idltm<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">A_TickCount</span><span class="w"> </span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span>
<span class="w">      </span>cmdretPID<span class="o">=</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="w"> </span>hWrite<span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span><span class="w"> </span>UInt<span class="p">,</span><span class="w"> </span>hRead<span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>StrLen<span class="p">(</span>CMDout<span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>TRead<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nf">VarSetCapacity</span><span class="p">(</span>CMcpy<span class="p">,</span><span class="w"> </span>TRead<span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span>TRead2<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">%TRead%</span><span class="w"> </span>
<span class="w">    </span><span class="k">Loop</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlZeroMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMcpy<span class="p">,</span><span class="w"> </span>Int<span class="p">,</span><span class="w"> </span>TRead<span class="p">)</span><span class="w"> </span>
<span class="w">      </span>NULLptr<span class="w"> </span><span class="o">:=</span><span class="w"> </span>StrLen<span class="p">(</span>CMDout<span class="p">)</span><span class="w"> </span>
<span class="w">      </span>cpsize<span class="w"> </span><span class="o">:=</span><span class="w"> </span>Tread<span class="w"> </span><span class="o">-</span><span class="w"> </span>NULLptr<span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMcpy<span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span>CMDout<span class="w"> </span><span class="o">+</span><span class="w"> </span>NULLptr<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span>cpsize<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlZeroMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span>CMDout<span class="w"> </span><span class="o">+</span><span class="w"> </span>NULLptr<span class="p">),</span><span class="w"> </span>Int<span class="p">,</span><span class="w"> </span>cpsize<span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span>CMDout<span class="w"> </span><span class="o">+</span><span class="w"> </span>NULLptr<span class="p">),</span><span class="w"> </span><span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>CMcpy<span class="p">,</span><span class="w"> </span><span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="w"> </span>cpsize<span class="p">)</span><span class="w"> </span>
<span class="w">      </span>TRead2<span class="w"> </span><span class="o">--</span><span class="w"> </span>
<span class="w">      </span><span class="nf">IF</span><span class="w"> </span><span class="p">(</span>StrLen<span class="p">(</span>CMDout<span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>TRead2<span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">break</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="k">StringTrimLeft</span><span class="p">,</span><span class="w"> </span>CMDout<span class="p">,</span><span class="w"> </span>CMDout<span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">  </span><span class="k">Return</span><span class="p">,</span><span class="w"> </span>CMDout<span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</pre></div>


New Lexer: 
<div class="highlight"><pre><span class="c-Singleline">; ****************************************************************** </span>
<span class="c-Singleline">; CMDret-AHK functions </span>
<span class="c-Singleline">; version 1.10 beta </span>
<span class="c-Singleline">; </span>
<span class="c-Singleline">; Updated: Dec 5, 2006 </span>
<span class="c-Singleline">; by: corrupt </span>
<span class="c-Singleline">; Code modifications and/or contributions made by: </span>
<span class="c-Singleline">; Laszlo, shimanov, toralf, Wdb  </span>
<span class="c-Singleline">; ****************************************************************** </span>
<span class="c-Singleline">; Usage: </span>
<span class="c-Singleline">; CMDin - command to execute</span>
<span class="c-Singleline">; WorkingDir - full path to working directory (Optional) </span>
<span class="c-Singleline">; ****************************************************************** </span>
<span class="c-Singleline">; Known Issues: </span>
<span class="c-Singleline">; - If using dir be sure to specify a path (example: cmd /c dir c:\)</span>
<span class="c-Singleline">; or specify a working directory    </span>
<span class="c-Singleline">; - Running 16 bit console applications may not produce output. Use </span>
<span class="c-Singleline">; a 32 bit application to start the 16 bit process to receive output  </span>
<span class="c-Singleline">; ****************************************************************** </span>
<span class="c-Singleline">; Additional requirements: </span>
<span class="c-Singleline">; - none </span>
<span class="c-Singleline">; ****************************************************************** </span>
<span class="c-Singleline">; Code Start </span>
<span class="c-Singleline">; ****************************************************************** </span>

<span class="n">CMDret_RunReturn</span><span class="p">(</span><span class="n">CMDin</span><span class="p">,</span> <span class="n">WorkingDir</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="p">{</span> 
<span class="w">  </span><span class="nb">Global</span> <span class="n">cmdretPID</span>
  <span class="n">tcWrk</span> <span class="o">:=</span> <span class="n">WorkingDir</span><span class="o">=</span><span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;Int&quot;</span> <span class="o">:</span> <span class="s">&quot;Str&quot;</span>
  <span class="n">idltm</span> <span class="o">:=</span> <span class="nv">A_TickCount</span> <span class="o">+</span> <span class="mi">20</span> 
  <span class="n">CMsize</span> <span class="o">=</span> <span class="mi">1</span> 
  <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">CMDout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> 
  <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">sui</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
  <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
  <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
<span class="w">  </span><span class="nb">Loop</span><span class="p">,</span> <span class="mi">4</span> <span class="p">{</span> 
    <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pa</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="mi">12</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
    <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pa</span><span class="o">+</span><span class="mi">8</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
  <span class="p">}</span> 
  <span class="n">IF</span> <span class="p">(</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CreatePipe&quot;</span><span class="p">,</span> <span class="s">&quot;UInt*&quot;</span><span class="p">,</span><span class="n">hRead</span><span class="p">,</span> <span class="s">&quot;UInt*&quot;</span><span class="p">,</span><span class="n">hWrite</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pa</span><span class="p">,</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> 
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span> <span class="mi">4</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sui</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="mi">68</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
    <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetStartupInfo&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sui</span><span class="p">)</span> 
<span class="w">    </span><span class="nb">Loop</span><span class="p">,</span> <span class="mi">4</span> <span class="p">{</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sui</span><span class="o">+</span><span class="mi">44</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="mi">257</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sui</span><span class="o">+</span><span class="mi">60</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="n">hWrite</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sui</span><span class="o">+</span><span class="mi">64</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="n">hWrite</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlFillMemory&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sui</span><span class="o">+</span><span class="mi">48</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">UChar</span><span class="p">,</span><span class="mi">0</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
    <span class="p">}</span>
    <span class="n">IF</span> <span class="p">(</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CreateProcess&quot;</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Str</span><span class="p">,</span><span class="n">CMDin</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">tcWrk</span><span class="p">,</span> <span class="n">WorkingDir</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sui</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="w">      </span><span class="nb">Loop</span><span class="p">,</span> <span class="mi">4</span> 
        <span class="n">cmdretPID</span> <span class="o">+=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pi</span><span class="o">+</span><span class="mi">8</span><span class="o">+</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="o">*</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">8</span> 
<span class="w">      </span><span class="nb">Loop</span> <span class="p">{</span> 
        <span class="n">idltm2</span> <span class="o">:=</span> <span class="nv">A_TickCount</span> <span class="o">-</span> <span class="n">idltm</span> 
        <span class="n">If</span> <span class="p">(</span><span class="n">idltm2</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span> 
          <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;Sleep&quot;</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> 
<span class="w">          </span><span class="nb">Continue</span> 
        <span class="p">}</span> 
        <span class="n">IF</span> <span class="p">(</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;PeekNamedPipe&quot;</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">hRead</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;uint*&quot;</span><span class="p">,</span> <span class="n">bSize</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span> 
<span class="w">          </span><span class="nb">Process</span><span class="p">,</span> <span class="n">Exist</span><span class="p">,</span> <span class="nv">%cmdretPID%</span> 
          <span class="n">IF</span> <span class="p">(</span><span class="nv">ErrorLevel</span> <span class="n">OR</span> <span class="n">bSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> 
            <span class="n">IF</span> <span class="p">(</span><span class="n">bSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> 
              <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">lpBuffer</span><span class="p">,</span> <span class="n">bSize</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
              <span class="n">IF</span> <span class="p">(</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReadFile&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span><span class="n">hRead</span><span class="p">,</span> <span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">lpBuffer</span><span class="p">,</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="n">bSize</span><span class="p">,</span> <span class="s">&quot;UInt*&quot;</span><span class="p">,</span><span class="n">bRead</span><span class="p">,</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> 
                <span class="n">IF</span> <span class="p">(</span><span class="n">bRead</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> 
                  <span class="n">TRead</span> <span class="o">+=</span> <span class="n">bRead</span> 
                  <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">CMcpy</span><span class="p">,</span> <span class="p">(</span><span class="n">bRead</span><span class="o">+</span><span class="n">CMsize</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> 
                  <span class="n">CMcpy</span> <span class="o">=</span> <span class="n">a</span> 
                  <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMcpy</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMDout</span><span class="p">,</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span> <span class="n">CMsize</span><span class="p">)</span> 
                  <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMcpy</span><span class="o">+</span><span class="n">CMsize</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lpBuffer</span><span class="p">,</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span> <span class="n">bRead</span><span class="p">)</span> 
                  <span class="n">CMsize</span> <span class="o">+=</span> <span class="n">bRead</span> 
                  <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">CMDout</span><span class="p">,</span> <span class="p">(</span><span class="n">CMsize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> 
                  <span class="n">CMDout</span><span class="o">=</span><span class="n">a</span>    
                  <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMDout</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMcpy</span><span class="p">,</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span> <span class="n">CMsize</span><span class="p">)</span> 
                  <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">CMDout</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="c-Singleline">   ; fix required by change in autohotkey v1.0.44.14 </span>
                <span class="p">}</span> 
              <span class="p">}</span> 
            <span class="p">}</span> 
          <span class="p">}</span> 
<span class="w">          </span><span class="nb">ELSE</span> 
<span class="w">            </span><span class="nb">break</span> 
        <span class="p">}</span> 
<span class="w">        </span><span class="nb">ELSE</span> 
<span class="w">          </span><span class="nb">break</span> 
        <span class="n">idltm</span> <span class="o">:=</span> <span class="nv">A_TickCount</span> 
      <span class="p">}</span> 
      <span class="n">cmdretPID</span><span class="o">=</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span> <span class="n">hWrite</span><span class="p">)</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CloseHandle&quot;</span><span class="p">,</span> <span class="n">UInt</span><span class="p">,</span> <span class="n">hRead</span><span class="p">)</span> 
    <span class="p">}</span>
  <span class="p">}</span> 
  <span class="n">IF</span> <span class="p">(</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">CMDout</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TRead</span><span class="p">)</span> <span class="p">{</span> 
    <span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">CMcpy</span><span class="p">,</span> <span class="n">TRead</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> 
    <span class="n">TRead2</span> <span class="o">=</span> <span class="nv">%TRead%</span> 
<span class="w">    </span><span class="nb">Loop</span> <span class="p">{</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlZeroMemory&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMcpy</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">TRead</span><span class="p">)</span> 
      <span class="n">NULLptr</span> <span class="o">:=</span> <span class="nf">StrLen</span><span class="p">(</span><span class="n">CMDout</span><span class="p">)</span> 
      <span class="n">cpsize</span> <span class="o">:=</span> <span class="n">Tread</span> <span class="o">-</span> <span class="n">NULLptr</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMcpy</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">CMDout</span> <span class="o">+</span> <span class="n">NULLptr</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">cpsize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlZeroMemory&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">CMDout</span> <span class="o">+</span> <span class="n">NULLptr</span><span class="p">),</span> <span class="n">Int</span><span class="p">,</span> <span class="n">cpsize</span><span class="p">)</span> 
      <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;RtlMoveMemory&quot;</span><span class="p">,</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">CMDout</span> <span class="o">+</span> <span class="n">NULLptr</span><span class="p">),</span> <span class="s">&quot;UInt&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CMcpy</span><span class="p">,</span> <span class="s">&quot;Int&quot;</span><span class="p">,</span> <span class="n">cpsize</span><span class="p">)</span> 
      <span class="n">TRead2</span> <span class="o">--</span> 
      <span class="n">IF</span> <span class="p">(</span><span class="nf">StrLen</span><span class="p">(</span><span class="n">CMDout</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TRead2</span><span class="p">)</span> 
<span class="w">        </span><span class="nb">break</span> 
    <span class="p">}</span> 
  <span class="p">}</span> 
<span class="w">  </span><span class="nb">StringTrimLeft</span><span class="p">,</span> <span class="n">CMDout</span><span class="p">,</span> <span class="n">CMDout</span><span class="p">,</span> <span class="mi">1</span> 
<span class="w">  </span><span class="nb">Return</span><span class="p">,</span> <span class="n">CMDout</span> 
<span class="p">}</span> 
</pre></div>
