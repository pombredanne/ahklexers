<LINK href="styles.css" rel="stylesheet" type="text/css">old lexer: 
<div class="highlight"><pre><span class="o">/*</span><span class="w"> </span>Title<span class="o">:</span><span class="w">	</span>Font
<span class="w">			</span>Font<span class="w"> </span>functions<span class="p">.</span>
<span class="w"> </span><span class="o">*/</span>

<span class="o">/*</span>
<span class="w"> </span>Function<span class="o">:</span><span class="w">  </span>Font
<span class="w">			</span>Creates<span class="w"> </span>the<span class="w"> </span>font<span class="w"> </span><span class="kr">and</span><span class="w"> </span>optinally<span class="p">,</span><span class="w"> </span>sets<span class="w"> </span>it<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span><span class="k">control</span><span class="p">.</span>

<span class="w"> </span><span class="nl">Parameters:</span>
<span class="w">			</span>hCtrl<span class="w"> </span><span class="o">-</span><span class="w"> </span>Handle<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>control<span class="p">.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>omitted<span class="p">,</span><span class="w"> </span>function<span class="w"> </span>will<span class="w"> </span>create<span class="w"> </span>font<span class="w"> </span><span class="kr">and</span><span class="w"> </span>return<span class="w"> </span>its<span class="w"> </span>handle<span class="p">.</span>
<span class="w">			</span>Font<span class="w">  </span><span class="o">-</span><span class="w"> </span>AHK<span class="w"> </span>font<span class="w"> </span>defintion<span class="w"> </span><span class="p">(</span><span class="s">&quot;s10 italic, Courier New&quot;</span><span class="p">).</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>you<span class="w"> </span>already<span class="w"> </span>have<span class="w"> </span>created<span class="w"> </span>font<span class="p">,</span><span class="w"> </span>pass<span class="w"> </span>its<span class="w"> </span>handle<span class="w"> </span>here<span class="p">.</span>
<span class="w">			</span>bRedraw<span class="w">	  </span><span class="o">-</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>this<span class="w"> </span>parameter<span class="w"> </span>is<span class="w"> </span>TRUE<span class="p">,</span><span class="w"> </span>the<span class="w"> </span>control<span class="w"> </span>redraws<span class="w"> </span>itself<span class="p">.</span><span class="w"> </span>By<span class="w"> </span>default<span class="w"> </span><span class="mf">1.</span>

<span class="w"> </span><span class="nl">Returns:</span><span class="w">	</span>
<span class="w">			</span>Font<span class="w"> </span>handle<span class="p">.</span>
<span class="w"> </span><span class="o">*/</span>
<span class="nf">Font</span><span class="p">(</span>HCtrl<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>Font<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>BRedraw<span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="kt">static</span><span class="w"> </span>WM_SETFONT<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mh">0x30</span>
<span class="w">	</span>
<span class="w">	</span><span class="kr">if</span><span class="w"> </span>Font<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>integer
<span class="w">	</span><span class="p">{</span>
<span class="w">		</span><span class="k">StringSplit</span><span class="p">,</span><span class="w"> </span>Font<span class="p">,</span><span class="w"> </span>Font<span class="p">,</span><span class="w"> </span><span class="p">`,,</span><span class="nv">%A_Space%%A_Tab%</span>
<span class="w">		</span>fontStyle<span class="w"> </span><span class="o">:=</span><span class="w"> </span>Font1<span class="p">,</span><span class="w"> </span>fontFace<span class="w"> </span><span class="o">:=</span><span class="w"> </span>Font2

<span class="w">	  </span><span class="c1">;parse font </span>
<span class="w">		</span>italic<span class="w">      </span><span class="o">:=</span><span class="w"> </span>InStr<span class="p">(</span>Font1<span class="p">,</span><span class="w"> </span><span class="s">&quot;italic&quot;</span><span class="p">)</span><span class="w">    </span><span class="o">?</span><span class="w">  </span><span class="mi">1</span><span class="w">    </span><span class="o">:</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span>
<span class="w">		</span>underline<span class="w">   </span><span class="o">:=</span><span class="w"> </span>InStr<span class="p">(</span>Font1<span class="p">,</span><span class="w"> </span><span class="s">&quot;underline&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w">  </span><span class="mi">1</span><span class="w">    </span><span class="o">:</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span>
<span class="w">		</span>strikeout<span class="w">   </span><span class="o">:=</span><span class="w"> </span>InStr<span class="p">(</span>Font1<span class="p">,</span><span class="w"> </span><span class="s">&quot;strikeout&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w">  </span><span class="mi">1</span><span class="w">    </span><span class="o">:</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span>
<span class="w">		</span>weight<span class="w">      </span><span class="o">:=</span><span class="w"> </span>InStr<span class="p">(</span>Font1<span class="p">,</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">)</span><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="mi">700</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="mi">400</span><span class="w"> </span>

<span class="w">	  </span><span class="c1">;height </span>

<span class="w">		</span><span class="nf">RegExMatch</span><span class="p">(</span>Font1<span class="p">,</span><span class="w"> </span><span class="s">&quot;(?&lt;=[S|s])(\d{1,2})(?=[ ,]*)&quot;</span><span class="p">,</span><span class="w"> </span>height<span class="p">)</span><span class="w"> </span>
<span class="w">		</span>ifEqual<span class="p">,</span><span class="w"> </span>height<span class="p">,,</span><span class="w"> </span><span class="k">SetEnv</span><span class="p">,</span><span class="w"> </span>height<span class="p">,</span><span class="w"> </span><span class="mi">10</span>
<span class="w">		</span><span class="k">RegRead</span><span class="p">,</span><span class="w"> </span>LogPixels<span class="p">,</span><span class="w"> </span>HKEY_LOCAL_MACHINE<span class="p">,</span><span class="w"> </span>SOFTWARE<span class="p">\</span>Microsoft<span class="p">\</span>Windows<span class="w"> </span>NT<span class="p">\</span>CurrentVersion<span class="p">\</span>FontDPI<span class="p">,</span><span class="w"> </span>LogPixels<span class="w"> </span>
<span class="w">		</span>height<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">-</span>DllCall<span class="p">(</span><span class="s">&quot;MulDiv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>Height<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>LogPixels<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">72</span><span class="p">)</span><span class="w"> </span>
<span class="w">	</span>
<span class="w">		</span>IfEqual<span class="p">,</span><span class="w"> </span>Font2<span class="p">,,</span><span class="k">SetEnv</span><span class="w"> </span>Font2<span class="p">,</span><span class="w"> </span>MS<span class="w"> </span>Sans<span class="w"> </span>Serif
<span class="w">	 </span><span class="c1">;create font </span>
<span class="w">		</span>hFont<span class="w">   </span><span class="o">:=</span><span class="w"> </span>DllCall<span class="p">(</span><span class="s">&quot;CreateFont&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w">  </span>height<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">						  </span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w">  </span>weight<span class="p">,</span><span class="w">   </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>italic<span class="p">,</span><span class="w">   </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>underline<span class="w"> </span>
<span class="w">						  </span><span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>strikeOut<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>nCharSet<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span>Font2<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span>hFont<span class="w"> </span><span class="o">:=</span><span class="w"> </span>Font
<span class="w">	</span><span class="k">ifNotEqual</span><span class="p">,</span><span class="w"> </span>HCtrl<span class="p">,,</span><span class="k">SendMessage</span><span class="p">,</span><span class="w"> </span>WM_SETFONT<span class="p">,</span><span class="w"> </span>hFont<span class="p">,</span><span class="w"> </span>BRedraw<span class="p">,,</span>ahk_id<span class="w"> </span><span class="nv">%HCtrl%</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span>hFont
<span class="p">}</span>

<span class="o">/*</span>
<span class="w"> </span>Function<span class="o">:</span><span class="w"> </span>DrawText
<span class="w">		   </span>Draws<span class="w"> </span>text<span class="w"> </span>using<span class="w"> </span>specified<span class="w"> </span>font<span class="w"> </span>on<span class="w"> </span>device<span class="w"> </span>context<span class="w"> </span><span class="kr">or</span><span class="w"> </span>calculates<span class="w"> </span>width<span class="w"> </span><span class="kr">and</span><span class="w"> </span>height<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>text<span class="p">.</span>

<span class="w"> </span><span class="nl">Parameters:</span><span class="w"> </span>
<span class="w">		</span>Text<span class="w">	</span><span class="o">-</span><span class="w"> </span>Text<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>drawn<span class="w"> </span><span class="kr">or</span><span class="w"> </span>measured<span class="p">.</span><span class="w"> </span>
<span class="w">		</span>DC<span class="w">		</span><span class="o">-</span><span class="w"> </span>Device<span class="w"> </span>context<span class="w"> </span>to<span class="w"> </span>use<span class="p">.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>omitted<span class="p">,</span><span class="w"> </span>function<span class="w"> </span>will<span class="w"> </span>use<span class="w"> </span>Desktop<span class="err">&#39;</span>s<span class="w"> </span>DC<span class="p">.</span>
<span class="w">		</span>Font<span class="w">	</span><span class="o">-</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>string<span class="p">,</span><span class="w"> </span>font<span class="w"> </span>description<span class="w"> </span>in<span class="w"> </span>AHK<span class="w"> </span>syntax<span class="p">.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>number<span class="p">,</span><span class="w"> </span>font<span class="w"> </span>handle<span class="p">.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>omitted<span class="p">,</span><span class="w"> </span>uses<span class="w"> </span>the<span class="w"> </span>system<span class="w"> </span>font<span class="w"> </span>to<span class="w"> </span>calculate<span class="w"> </span>text<span class="w"> </span>metrics<span class="p">.</span>
<span class="w">		</span>Flags<span class="w">	</span><span class="o">-</span><span class="w"> </span>Drawing<span class="o">/</span>Calculating<span class="w"> </span>flags<span class="p">.</span><span class="w"> </span>Space<span class="w"> </span>separated<span class="w"> </span>combination<span class="w"> </span>of<span class="w"> </span>flag<span class="w"> </span>names<span class="p">.</span><span class="w"> </span>For<span class="w"> </span>the<span class="w"> </span>description<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>flags<span class="w"> </span>see<span class="w"> </span><span class="o">&lt;</span>http<span class="o">://</span>msdn<span class="p">.</span>microsoft<span class="p">.</span>com<span class="o">/</span>en<span class="o">-</span>us<span class="o">/</span>library<span class="o">/</span>ms901121<span class="p">.</span>aspx<span class="o">&gt;</span><span class="p">.</span>
<span class="w">		</span>Rect<span class="w">	</span><span class="o">-</span><span class="w"> </span>Bounding<span class="w"> </span>rectangle<span class="p">.</span><span class="w"> </span>Space<span class="w"> </span>separated<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>left<span class="p">,</span>top<span class="p">,</span>right<span class="p">,</span>bottom<span class="w"> </span>coordinates<span class="p">.</span><span class="w"> </span>
<span class="w">				  </span>Width<span class="w"> </span>could<span class="w"> </span>also<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>with<span class="w"> </span>CALCRECT<span class="w"> </span>WORDBREAK<span class="w"> </span>style<span class="w"> </span>to<span class="w"> </span>calculate<span class="w"> </span>word<span class="o">-</span>wrapped<span class="w"> </span>height<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>text<span class="w"> </span>given<span class="w"> </span>its<span class="w"> </span>width<span class="p">.</span>
<span class="w">				</span>
<span class="w"> </span>Flags<span class="o">:</span>
<span class="w">		</span>CALCRECT<span class="p">,</span><span class="w"> </span>BOTTOM<span class="p">,</span><span class="w"> </span>CALCRECT<span class="p">,</span><span class="w"> </span>CENTER<span class="p">,</span><span class="w"> </span>VCENTER<span class="p">,</span><span class="w"> </span>TABSTOP<span class="p">,</span><span class="w"> </span>SINGLELINE<span class="p">,</span><span class="w"> </span>RIGHT<span class="p">,</span><span class="w"> </span>NOPREFIX<span class="p">,</span><span class="w"> </span>NOCLIP<span class="p">,</span><span class="w"> </span>INTERNAL<span class="p">,</span><span class="w"> </span>EXPANDTABS<span class="p">,</span><span class="w"> </span>AHKSIZE<span class="p">.</span>

<span class="w"> </span><span class="nl">Returns:</span>
<span class="w">		</span>Decimal<span class="w"> </span>number<span class="p">.</span><span class="w"> </span>Width<span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span>Height<span class="w"> </span>of<span class="w"> </span>text<span class="p">.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span>AHKSIZE<span class="w"> </span>flag<span class="w"> </span>is<span class="w"> </span>set<span class="p">,</span><span class="w"> </span>the<span class="w"> </span>size<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>returned<span class="w"> </span>as<span class="w"> </span>w<span class="nv">%w%</span><span class="w"> </span>h<span class="nv">%h%</span>

<span class="w"> </span><span class="o">*/</span><span class="w">    </span>
<span class="nf">Font_DrawText</span><span class="p">(</span>Text<span class="p">,</span><span class="w"> </span>DC<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>Font<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>Flags<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>Rect<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="kt">static</span><span class="w"> </span>DT_AHKSIZE<span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>DT_CALCRECT<span class="o">=</span><span class="mh">0x400</span><span class="p">,</span><span class="w"> </span>DT_WORDBREAK<span class="o">=</span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span>DT_BOTTOM<span class="o">=</span><span class="mh">0x8</span><span class="p">,</span><span class="w"> </span>DT_CALCRECT<span class="o">=</span><span class="mh">0x400</span><span class="p">,</span><span class="w"> </span>DT_CENTER<span class="o">=</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span>DT_VCENTER<span class="o">=</span><span class="mh">0x4</span><span class="p">,</span><span class="w"> </span>DT_TABSTOP<span class="o">=</span><span class="mh">0x80</span><span class="p">,</span><span class="w"> </span>DT_SINGLELINE<span class="o">=</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span>DT_RIGHT<span class="o">=</span><span class="mh">0x2</span><span class="p">,</span><span class="w"> </span>DT_NOPREFIX<span class="o">=</span><span class="mh">0x800</span><span class="p">,</span><span class="w"> </span>DT_NOCLIP<span class="o">=</span><span class="mh">0x100</span><span class="p">,</span><span class="w"> </span>DT_INTERNAL<span class="o">=</span><span class="mh">0x1000</span><span class="p">,</span><span class="w"> </span>DT_EXPANDTABS<span class="o">=</span><span class="mh">0x40</span>

<span class="w">	</span>hFlag<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span>Rect<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>DT_NOCLIP<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>

<span class="w">	</span><span class="k">StringSplit</span><span class="p">,</span><span class="w"> </span>Rect<span class="p">,</span><span class="w"> </span>Rect<span class="p">,</span><span class="w"> </span><span class="nv">%A_Space%</span>
<span class="w">	</span><span class="k">loop</span><span class="p">,</span><span class="w"> </span>parse<span class="p">,</span><span class="w"> </span>Flags<span class="p">,</span><span class="w"> </span><span class="nv">%A_Space%</span>
<span class="w">		</span>ifEqual<span class="p">,</span><span class="w"> </span><span class="nb">A_LoopField</span><span class="p">,,</span><span class="k">continue</span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span>hFlag<span class="w"> </span><span class="o">|=</span><span class="w"> </span>DT_<span class="nv">%A_LoopField%</span>

<span class="w">	</span><span class="kr">if</span><span class="w"> </span>Font<span class="w"> </span>is<span class="w"> </span>integer
<span class="w">		</span>hFont<span class="w"> </span><span class="o">:=</span><span class="w"> </span>Font<span class="p">,</span><span class="w"> </span>bUserHandle<span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">	</span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span>Font<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">		</span>hFont<span class="w"> </span><span class="o">:=</span><span class="w"> </span>Font<span class="p">(</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span>Font<span class="p">)</span><span class="w"> </span>
<span class="w">	</span><span class="k">else</span><span class="w"> </span>hFlag<span class="w"> </span><span class="o">|=</span><span class="w"> </span>DT_INTERNAL

<span class="w">	</span>IfEqual<span class="p">,</span><span class="w"> </span>hDC<span class="p">,,</span><span class="k">SetEnv</span><span class="p">,</span><span class="w"> </span>hDC<span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>DllCall<span class="p">(</span><span class="s">&quot;GetDC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="k">ifNotEqual</span><span class="p">,</span><span class="w"> </span>hFont<span class="p">,,</span><span class="w"> </span><span class="k">SetEnv</span><span class="p">,</span><span class="w"> </span>hOldFont<span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w"> </span>DllCall<span class="p">(</span><span class="s">&quot;SelectObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hDC<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hFont<span class="p">)</span>

<span class="w">	</span><span class="nf">VarSetCapacity</span><span class="p">(</span>RECT<span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">	</span><span class="nf">if</span><span class="w"> </span><span class="p">(</span>Rect0<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">		</span><span class="k">loop</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">			</span><span class="nf">NumPut</span><span class="p">(</span>Rect<span class="nv">%A_Index%</span><span class="p">,</span><span class="w"> </span>RECT<span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nb">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

<span class="w">	</span>h<span class="w"> </span><span class="o">:=</span><span class="w"> </span>DllCall<span class="p">(</span><span class="s">&quot;DrawTextA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hDC<span class="p">,</span><span class="w"> </span><span class="s">&quot;Str&quot;</span><span class="p">,</span><span class="w"> </span>Text<span class="p">,</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span>StrLen<span class="p">(</span>Text<span class="p">),</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span>RECT<span class="p">,</span><span class="w"> </span><span class="s">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span>hFlag<span class="p">)</span>

<span class="w">  </span><span class="c1">;clean</span>
<span class="w">   	</span><span class="k">ifNotEqual</span><span class="p">,</span><span class="w"> </span>hOldFont<span class="p">,,</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;SelectObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hDC<span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hOldFont<span class="p">)</span><span class="w"> </span>
<span class="w">	</span><span class="k">ifNotEqual</span><span class="p">,</span><span class="w"> </span>bUserHandle<span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;DeleteObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hFont<span class="p">)</span>
<span class="w">	</span><span class="k">ifNotEqual</span><span class="p">,</span><span class="w"> </span>DC<span class="p">,,</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReleaseDC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uint&quot;</span><span class="p">,</span><span class="w"> </span>hDC<span class="p">)</span><span class="w"> </span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nf">InStr</span><span class="p">(</span>Flags<span class="p">,</span><span class="w"> </span><span class="s">&quot;AHKSIZE&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="w"> </span>NumGet<span class="p">(</span>RECT<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="s">&quot; h&quot;</span><span class="w"> </span>h<span class="w"> </span><span class="o">:</span><span class="w"> </span>NumGet<span class="p">(</span>RECT<span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span>h
<span class="p">}</span><span class="w"> </span>

<span class="o">/*</span><span class="w"> </span>Group<span class="o">:</span><span class="w"> </span>About
<span class="w">	</span>o<span class="w"> </span>Version<span class="w"> </span><span class="mf">1.0</span><span class="w"> </span>by<span class="w"> </span>majkinetor<span class="p">.</span>
<span class="w">	</span>o<span class="w"> </span>Licensed<span class="w"> </span>under<span class="w"> </span>BSD<span class="w"> </span><span class="o">&lt;</span>http<span class="o">://</span>creativecommons<span class="p">.</span>org<span class="o">/</span>licenses<span class="o">/</span>BSD<span class="o">/&gt;</span><span class="p">.</span>
<span class="w"> </span><span class="o">*/</span>
</pre></div>


New Lexer: 
<div class="highlight"><pre><span class="cm">/* Title:	Font</span>
<span class="cm">			Font functions.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> Function:  Font</span>
<span class="cm">			Creates the font and optinally, sets it for the control.</span>

<span class="cm"> Parameters:</span>
<span class="cm">			hCtrl - Handle of the control. If omitted, function will create font and return its handle.</span>
<span class="cm">			Font  - AHK font defintion (&quot;s10 italic, Courier New&quot;). If you already have created font, pass its handle here.</span>
<span class="cm">			bRedraw	  - If this parameter is TRUE, the control redraws itself. By default 1.</span>

<span class="cm"> Returns:	</span>
<span class="cm">			Font handle.</span>
<span class="cm"> */</span>
<span class="n">Font</span><span class="p">(</span><span class="n">HCtrl</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Font</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">BRedraw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="w">	</span><span class="nb">static</span> <span class="n">WM_SETFONT</span> <span class="o">:=</span> <span class="mh">0x30</span>
<span class="w">	</span>
<span class="w">	</span><span class="nb">if </span><span class="n">Font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">integer</span>
	<span class="p">{</span>
<span class="w">		</span><span class="nb">StringSplit</span><span class="p">,</span> <span class="n">Font</span><span class="p">,</span> <span class="n">Font</span><span class="p">,</span> <span class="se">`,</span><span class="p">,</span><span class="nv">%A_Space%%A_Tab%</span>
		<span class="n">fontStyle</span> <span class="o">:=</span> <span class="n">Font1</span><span class="p">,</span> <span class="n">fontFace</span> <span class="o">:=</span> <span class="n">Font2</span><span class="c-Singleline"></span>

<span class="c-Singleline">	  ;parse font </span>
		<span class="n">italic</span>      <span class="o">:=</span> <span class="nf">InStr</span><span class="p">(</span><span class="n">Font1</span><span class="p">,</span> <span class="s">&quot;italic&quot;</span><span class="p">)</span>    <span class="o">?</span>  <span class="mi">1</span>    <span class="o">:</span>  <span class="mi">0</span> 
		<span class="n">underline</span>   <span class="o">:=</span> <span class="nf">InStr</span><span class="p">(</span><span class="n">Font1</span><span class="p">,</span> <span class="s">&quot;underline&quot;</span><span class="p">)</span> <span class="o">?</span>  <span class="mi">1</span>    <span class="o">:</span>  <span class="mi">0</span> 
		<span class="n">strikeout</span>   <span class="o">:=</span> <span class="nf">InStr</span><span class="p">(</span><span class="n">Font1</span><span class="p">,</span> <span class="s">&quot;strikeout&quot;</span><span class="p">)</span> <span class="o">?</span>  <span class="mi">1</span>    <span class="o">:</span>  <span class="mi">0</span> 
		<span class="n">weight</span>      <span class="o">:=</span> <span class="nf">InStr</span><span class="p">(</span><span class="n">Font1</span><span class="p">,</span> <span class="s">&quot;bold&quot;</span><span class="p">)</span>      <span class="o">?</span> <span class="mi">700</span>   <span class="o">:</span> <span class="mi">400</span><span class="c-Singleline"> </span>

<span class="c-Singleline">	  ;height </span>

		<span class="nf">RegExMatch</span><span class="p">(</span><span class="n">Font1</span><span class="p">,</span> <span class="s">&quot;(?&lt;=[S|s])(\d{1,2})(?=[ ,]*)&quot;</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> 
<span class="w">		</span><span class="nb">ifEqual</span><span class="p">,</span> <span class="n">height</span><span class="p">,,</span> <span class="n">SetEnv</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">10</span>
<span class="w">		</span><span class="nb">RegRead</span><span class="p">,</span> <span class="n">LogPixels</span><span class="p">,</span> <span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">SOFTWARE</span>\<span class="n">Microsoft</span>\<span class="n">Windows</span> <span class="n">NT</span>\<span class="n">CurrentVersion</span>\<span class="n">FontDPI</span><span class="p">,</span> <span class="n">LogPixels</span> 
		<span class="n">height</span> <span class="o">:=</span> <span class="o">-</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;MulDiv&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">Height</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">LogPixels</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span> 
<span class="w">	</span>
<span class="w">		</span><span class="nb">IfEqual</span><span class="p">,</span> <span class="n">Font2</span><span class="p">,,</span><span class="n">SetEnv</span> <span class="n">Font2</span><span class="p">,</span> <span class="n">MS</span> <span class="n">Sans</span> <span class="n">Serif</span><span class="c-Singleline"></span>
<span class="c-Singleline">	 ;create font </span>
		<span class="n">hFont</span>   <span class="o">:=</span> <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;CreateFont&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="n">height</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="mi">0</span>
						  <span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span>  <span class="n">weight</span><span class="p">,</span>   <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">italic</span><span class="p">,</span>   <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">underline</span> 
						  <span class="p">,</span><span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">strikeOut</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">nCharSet</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="n">Font2</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">)</span>
	<span class="p">}</span> <span class="n">else</span> <span class="n">hFont</span> <span class="o">:=</span> <span class="n">Font</span>
<span class="w">	</span><span class="nb">ifNotEqual</span><span class="p">,</span> <span class="n">HCtrl</span><span class="p">,,</span><span class="n">SendMessage</span><span class="p">,</span> <span class="n">WM_SETFONT</span><span class="p">,</span> <span class="n">hFont</span><span class="p">,</span> <span class="n">BRedraw</span><span class="p">,,</span><span class="n">ahk_id</span> <span class="nv">%HCtrl%</span>
<span class="w">	</span><span class="nb">return</span> <span class="n">hFont</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> Function: DrawText</span>
<span class="cm">		   Draws text using specified font on device context or calculates width and height of the text.</span>

<span class="cm"> Parameters: </span>
<span class="cm">		Text	- Text to be drawn or measured. </span>
<span class="cm">		DC		- Device context to use. If omitted, function will use Desktop&#39;s DC.</span>
<span class="cm">		Font	- If string, font description in AHK syntax. If number, font handle. If omitted, uses the system font to calculate text metrics.</span>
<span class="cm">		Flags	- Drawing/Calculating flags. Space separated combination of flag names. For the description of the flags see &lt;http://msdn.microsoft.com/en-us/library/ms901121.aspx&gt;.</span>
<span class="cm">		Rect	- Bounding rectangle. Space separated list of left,top,right,bottom coordinates. </span>
<span class="cm">				  Width could also be used with CALCRECT WORDBREAK style to calculate word-wrapped height of the text given its width.</span>
<span class="cm">				</span>
<span class="cm"> Flags:</span>
<span class="cm">		CALCRECT, BOTTOM, CALCRECT, CENTER, VCENTER, TABSTOP, SINGLELINE, RIGHT, NOPREFIX, NOCLIP, INTERNAL, EXPANDTABS, AHKSIZE.</span>

<span class="cm"> Returns:</span>
<span class="cm">		Decimal number. Width &quot;.&quot; Height of text. If AHKSIZE flag is set, the size will be returned as w%w% h%h%</span>

<span class="cm"> */</span>    
<span class="n">Font_DrawText</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">DC</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Font</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Flags</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Rect</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="w">	</span><span class="nb">static</span> <span class="n">DT_AHKSIZE</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">DT_CALCRECT</span><span class="o">=</span><span class="mh">0x400</span><span class="p">,</span> <span class="n">DT_WORDBREAK</span><span class="o">=</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">DT_BOTTOM</span><span class="o">=</span><span class="mh">0x8</span><span class="p">,</span> <span class="n">DT_CALCRECT</span><span class="o">=</span><span class="mh">0x400</span><span class="p">,</span> <span class="n">DT_CENTER</span><span class="o">=</span><span class="mh">0x1</span><span class="p">,</span> <span class="n">DT_VCENTER</span><span class="o">=</span><span class="mh">0x4</span><span class="p">,</span> <span class="n">DT_TABSTOP</span><span class="o">=</span><span class="mh">0x80</span><span class="p">,</span> <span class="n">DT_SINGLELINE</span><span class="o">=</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">DT_RIGHT</span><span class="o">=</span><span class="mh">0x2</span><span class="p">,</span> <span class="n">DT_NOPREFIX</span><span class="o">=</span><span class="mh">0x800</span><span class="p">,</span> <span class="n">DT_NOCLIP</span><span class="o">=</span><span class="mh">0x100</span><span class="p">,</span> <span class="n">DT_INTERNAL</span><span class="o">=</span><span class="mh">0x1000</span><span class="p">,</span> <span class="n">DT_EXPANDTABS</span><span class="o">=</span><span class="mh">0x40</span>

	<span class="n">hFlag</span> <span class="o">:=</span> <span class="p">(</span><span class="n">Rect</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">DT_NOCLIP</span> <span class="o">:</span> <span class="mi">0</span>

<span class="w">	</span><span class="nb">StringSplit</span><span class="p">,</span> <span class="n">Rect</span><span class="p">,</span> <span class="n">Rect</span><span class="p">,</span> <span class="nv">%A_Space%</span>
<span class="w">	</span><span class="nb">loop</span><span class="p">,</span> <span class="n">parse</span><span class="p">,</span> <span class="n">Flags</span><span class="p">,</span> <span class="nv">%A_Space%</span>
<span class="w">		</span><span class="nb">ifEqual</span><span class="p">,</span> <span class="nv">A_LoopField</span><span class="p">,,</span><span class="n">continue</span>
<span class="w">		</span><span class="nb">else</span> <span class="n">hFlag</span> <span class="o">|=</span> <span class="n">DT_</span><span class="nv">%A_LoopField%</span>

<span class="w">	</span><span class="nb">if </span><span class="n">Font</span> <span class="ow">is</span> <span class="n">integer</span>
		<span class="n">hFont</span> <span class="o">:=</span> <span class="n">Font</span><span class="p">,</span> <span class="n">bUserHandle</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="w">	</span><span class="nb">else</span> <span class="n">if</span> <span class="p">(</span><span class="n">Font</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">hFont</span> <span class="o">:=</span> <span class="n">Font</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Font</span><span class="p">)</span> 
<span class="w">	</span><span class="nb">else</span> <span class="n">hFlag</span> <span class="o">|=</span> <span class="n">DT_INTERNAL</span>

<span class="w">	</span><span class="nb">IfEqual</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,,</span><span class="n">SetEnv</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,</span> <span class="o">%</span> <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;GetDC&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="nb">ifNotEqual</span><span class="p">,</span> <span class="n">hFont</span><span class="p">,,</span> <span class="n">SetEnv</span><span class="p">,</span> <span class="n">hOldFont</span><span class="p">,</span> <span class="o">%</span> <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;SelectObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hFont</span><span class="p">)</span>

	<span class="nf">VarSetCapacity</span><span class="p">(</span><span class="n">RECT</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
	<span class="n">if</span> <span class="p">(</span><span class="n">Rect0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="w">		</span><span class="nb">loop</span><span class="p">,</span> <span class="mi">4</span>
			<span class="nf">NumPut</span><span class="p">(</span><span class="n">Rect</span><span class="nv">%A_Index%</span><span class="p">,</span> <span class="n">RECT</span><span class="p">,</span> <span class="p">(</span><span class="nv">A_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

	<span class="n">h</span> <span class="o">:=</span> <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;DrawTextA&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,</span> <span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="nf">StrLen</span><span class="p">(</span><span class="n">Text</span><span class="p">),</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">RECT</span><span class="p">,</span> <span class="s">&quot;uint&quot;</span><span class="p">,</span> <span class="n">hFlag</span><span class="p">)</span><span class="c-Singleline"></span>

<span class="c-Singleline">  ;clean</span>
<span class="w">   	</span><span class="nb">ifNotEqual</span><span class="p">,</span> <span class="n">hOldFont</span><span class="p">,,</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;SelectObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hDC</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hOldFont</span><span class="p">)</span> 
<span class="w">	</span><span class="nb">ifNotEqual</span><span class="p">,</span> <span class="n">bUserHandle</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;DeleteObject&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hFont</span><span class="p">)</span>
<span class="w">	</span><span class="nb">ifNotEqual</span><span class="p">,</span> <span class="n">DC</span><span class="p">,,</span><span class="nf">DllCall</span><span class="p">(</span><span class="s">&quot;ReleaseDC&quot;</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Uint&quot;</span><span class="p">,</span> <span class="n">hDC</span><span class="p">)</span> 

<span class="w">	</span><span class="nb">return</span> <span class="nf">InStr</span><span class="p">(</span><span class="n">Flags</span><span class="p">,</span> <span class="s">&quot;AHKSIZE&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;w&quot;</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">RECT</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="s">&quot; h&quot;</span> <span class="n">h</span> <span class="o">:</span> <span class="nf">NumGet</span><span class="p">(</span><span class="n">RECT</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="s">&quot;.&quot;</span> <span class="n">h</span>
<span class="p">}</span> 

<span class="cm">/* Group: About</span>
<span class="cm">	o Version 1.0 by majkinetor.</span>
<span class="cm">	o Licensed under BSD &lt;http://creativecommons.org/licenses/BSD/&gt;.</span>
<span class="cm"> */</span>
</pre></div>
